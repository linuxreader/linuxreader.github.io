<!DOCTYPE html>
<html lang="en-us" dir="ltr" itemscope itemtype="http://schema.org/Article" data-r-output-format="print">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="height=device-height, width=device-width, initial-scale=1.0, minimum-scale=1.0">
    <meta name="generator" content="Hugo 0.152.2">
    <meta name="generator" content="Relearn 8.2.0+d150cc8909ed7836ff5d545e76544f6923ffacf5">
    <meta name="description" content="FilesAdvanced File ManagementFile permissions, ACLs, and finding thingsBasic File ManagmentFile types, linking, viewing, and archiving files.Security Enhanced LinuxThe confusing world of SELinuxThe Linux FirewallFirewalld stuff mostlyThe Secure Shell ServiceOpenSSH, system access, file transfer">
    <meta name="author" content="David Thomas">
    <meta name="twitter:card" content="summary">
    <meta name="twitter:title" content="Cyber Security :: Linux Reader">
    <meta name="twitter:description" content="FilesAdvanced File ManagementFile permissions, ACLs, and finding thingsBasic File ManagmentFile types, linking, viewing, and archiving files.Security Enhanced LinuxThe confusing world of SELinuxThe Linux FirewallFirewalld stuff mostlyThe Secure Shell ServiceOpenSSH, system access, file transfer">
    <meta property="og:url" content="http://linuxreader.com/cyber-security/">
    <meta property="og:site_name" content="Linux Reader">
    <meta property="og:title" content="Cyber Security :: Linux Reader">
    <meta property="og:description" content="FilesAdvanced File ManagementFile permissions, ACLs, and finding thingsBasic File ManagmentFile types, linking, viewing, and archiving files.Security Enhanced LinuxThe confusing world of SELinuxThe Linux FirewallFirewalld stuff mostlyThe Secure Shell ServiceOpenSSH, system access, file transfer">
    <meta property="og:locale" content="en_us">
    <meta property="og:type" content="website">
    <meta itemprop="name" content="Cyber Security :: Linux Reader">
    <meta itemprop="description" content="FilesAdvanced File ManagementFile permissions, ACLs, and finding thingsBasic File ManagmentFile types, linking, viewing, and archiving files.Security Enhanced LinuxThe confusing world of SELinuxThe Linux FirewallFirewalld stuff mostlyThe Secure Shell ServiceOpenSSH, system access, file transfer">
    <meta itemprop="wordCount" content="43">
    <title>Cyber Security :: Linux Reader</title>
    <link href="http://linuxreader.com/cyber-security/" rel="canonical" type="text/html" title="Cyber Security :: Linux Reader">
    <link href="/cyber-security/index.xml" rel="alternate" type="application/rss+xml" title="Cyber Security :: Linux Reader">
    <link href="/images/favicon.svg?1764240624" rel="icon" type="image/svg+xml">
    <link href="/css/auto-complete/auto-complete.min.css?1764240624" rel="stylesheet">
    <script src="/js/auto-complete/auto-complete.min.js?1764240624" defer></script>
    <script src="/js/search-lunr.min.js?1764240624" defer></script>
    <script src="/js/search.min.js?1764240624" defer></script>
    <script>
      window.relearn = window.relearn || {};
      window.relearn.index_js_url="/searchindex.en.js?1764240624";
    </script>
    <script src="/js/lunr/lunr.min.js?1764240624" defer></script>
    <script src="/js/lunr/lunr.stemmer.support.min.js?1764240624" defer></script>
    <script src="/js/lunr/lunr.multi.min.js?1764240624" defer></script>
    <script src="/js/lunr/lunr.en.min.js?1764240624" defer></script>
    <script>
      window.relearn = window.relearn || {};
      window.relearn.contentLangs=['en'];
    </script>
    <link href="/fonts/fontawesome/css/fontawesome-all.min.css?1764240624" rel="stylesheet" media="print" onload="this.media='all';this.onload=null;"><noscript><link href="/fonts/fontawesome/css/fontawesome-all.min.css?1764240624" rel="stylesheet"></noscript>
    <link href="/css/perfect-scrollbar/perfect-scrollbar.min.css?1764240624" rel="stylesheet">
    <link href="/css/theme.min.css?1764240624" rel="stylesheet">
    <link href="/css/format-print.min.css?1764240624" rel="stylesheet" id="R-format-style">
    <script>
      window.relearn = window.relearn || {};
      // configuration
      window.relearn.min = `.min`;
      window.relearn.path='\/cyber-security\/';
      window.relearn.relBasePath='..';
      window.relearn.relBaseUri='..';
      window.relearn.absBaseUri='http:\/\/linuxreader.com';
      window.relearn.disableAnchorCopy=false;
      window.relearn.disableAnchorScrolling=false;
      window.relearn.disableInlineCopyToClipboard=true;
      window.relearn.enableBlockCodeWrap=true;
      // legal
      window.relearn.getItem = (s,n) => {return s.getItem(n)};
      window.relearn.setItem = (s,n,v) => {return s.setItem(n,v)};
      window.relearn.removeItem = (s,n) => {return s.removeItem(n)};
      // translations
      window.T_Copy_to_clipboard = `Copy to clipboard`;
      window.T_Copied_to_clipboard = `Copied to clipboard!`;
      window.T_Copy_link_to_clipboard = `Copy link to clipboard`;
      window.T_Link_copied_to_clipboard = `Copied link to clipboard!`;
      window.T_Reset_view = `Reset view`;
      window.T_View_reset = `View reset!`;
      window.T_No_results_found = `No results found for "{0}"`;
      window.T_N_results_found = `{1} results found for "{0}"`;
      // variant stuff
      window.relearn.themevariants = [ 'oled' ];
      window.relearn.customvariantname = "my-custom-variant";
      window.relearn.changeVariant = function(variant) {
        var oldVariant = document.documentElement.dataset.rThemeVariant;
        window.relearn.setItem(window.localStorage, window.relearn.absBaseUri + "/variant", variant);
        document.documentElement.dataset.rThemeVariant = variant;
        if (oldVariant != variant) {
          document.dispatchEvent( new CustomEvent('themeVariantLoaded', { detail: { variant, oldVariant } }) );
          window.relearn.markVariant();
        }
      }
      window.relearn.markVariant = function() {
        var variant = window.relearn.getItem(window.localStorage, window.relearn.absBaseUri + "/variant");
        document.querySelectorAll(".R-variantswitcher select").forEach((select) => {select.value = variant;});
      }
      window.relearn.initVariant = function() {
        var variant = window.relearn.getItem(window.localStorage, window.relearn.absBaseUri + "/variant") ?? "";
        if( variant == window.relearn.customvariantname ){
        }else if( !variant || !window.relearn.themevariants.includes(variant) ){
          variant = window.relearn.themevariants[0];
          window.relearn.setItem(window.localStorage, window.relearn.absBaseUri + "/variant", variant);
        }
        document.documentElement.dataset.rThemeVariant = variant;
      }
      window.relearn.initVariant();
      window.relearn.markVariant();
    </script>




   
   <!-- Thanks for using github/divinerites/plausible-hugo v1.22.0. Please, consider leaving a star on Github if you like it. -->











    
        <link rel="preconnect" href="https://analytics.linuxreader.com:8443">
    
        
            
            <script defer  data-domain="linuxreader.com" src="https://analytics.linuxreader.com:8443/js/script.js" ></script>

<!-- If you are using Content-Security-Policy, do not forget to add this code to your CSP : 
  script-src 'unsafe-inline' https://analytics.linuxreader.com:8443
  connect-src 'unsafe-inline' https://analytics.linuxreader.com:8443
  or just add the partial 'plausible_csp.html' to those 2 csp directives in your 'index.headers' file
-->



    
    <script>window.plausible = window.plausible || function() { (window.plausible.q = window.plausible.q || []).push(arguments) }</script>
    <script>
         
         
         
    </script>

    

<style>
:root {
    --MENU-WIDTH-S: 14.375rem;
    --MENU-WIDTH-M: 14.375rem;
    --MENU-WIDTH-L: 18.75rem;
    --MAIN-WIDTH-MAX: 80rem;
    font-size: 1.2rem;
}
</style>

  </head>
  <body class="mobile-support print" data-url="/cyber-security/">
    <div id="R-body" class="default-animation">
      <div id="R-body-overlay"></div>
      <nav id="R-topbar">
        <div class="topbar-wrapper">
          <div class="topbar-sidebar-divider"></div>
          <div class="topbar-area topbar-area-start" data-area="start">
            <div class="topbar-button topbar-button-sidebar" data-content-empty="disable" data-width-s="show" data-width-m="hide" data-width-l="hide">
<span class="btn cstyle link noborder notitle interactive"><button onclick="toggleNav()" type="button" title="Menu (CTRL&#43;ALT&#43;n)"><i class="fa-fw fas fa-bars"></i></button></span>
            </div>
            <div class="topbar-button topbar-button-prev" data-content-empty="disable" data-width-s="show" data-width-m="show" data-width-l="show">
<span class="btn cstyle link noborder notitle interactive"><a href="/containers/containers-1/" title="Containers (ü°ê)"><i class="fa-fw fas fa-chevron-left"></i></a></span>
            </div>

            <div class="topbar-button topbar-button-toc" data-content-empty="hide" data-width-s="show" data-width-m="show" data-width-l="show">
<span class="btn cstyle link noborder notitle interactive"><button onclick="toggleTopbarFlyout(this)" type="button" title="Table of Contents (CTRL&#43;ALT&#43;t)"><i class="fa-fw fas fa-list-alt"></i></button></span>
              <div class="topbar-content">
                <div class="topbar-content-wrapper"> 
                </div>
              </div>
            </div>


          </div>
          <span class="topbar-breadcrumbs highlightable">
            Cyber Security
          </span>
          <div class="topbar-area topbar-area-end" data-area="end">
            <div class="topbar-button topbar-button-print" data-content-empty="disable" data-width-s="area-more" data-width-m="show" data-width-l="show">
<span class="btn cstyle link noborder notitle interactive"><a href="/cyber-security/index.print.html" title="Print whole chapter (CTRL+ALT+p)"><i class="fa-fw fas fa-print"></i></a></span>
            </div>

            <div class="topbar-button topbar-button-next" data-content-empty="disable" data-width-s="show" data-width-m="show" data-width-l="show">
<span class="btn cstyle link noborder notitle interactive"><a href="/cyber-security/files/" title="Files (ü°í)"><i class="fa-fw fas fa-chevron-right"></i></a></span>
            </div>







          </div>
        </div>
      </nav>
      <div id="R-main-overlay"></div>
      <main id="R-body-inner" class="highlightable cyber-security" tabindex="-1">
        <div class="flex-block-wrapper">
<article class="default">
  <header class="headline">
  </header>

<h1 id="cyber-security">Cyber Security</h1>

<div class="children children-type-card children-sort-"><ul class="card-container">
<li>
  <article class="card card-popout" aria-labelledby="R-card-8889c4b3cf9afe9c380bdc871342cade">
    <div class="card-content">
      <div class="card-title" id="R-card-8889c4b3cf9afe9c380bdc871342cade">
        <a href="/cyber-security/files/">
        Files
        </a>
      </div>
      <div class="card-content-text">
          <p>
Advanced File ManagementFile permissions, ACLs, and finding thingsBasic File ManagmentFile types, linking, viewing, and archiving files.
      </div>
    </div>
    <div class="card-image">
        <img src="images/files.png">
    </div>
  </article>
</li>
<li>
  <article class="card card-popout" aria-labelledby="R-card-33aeee5290c2225fd5277b6f8e0c670b">
    <div class="card-content">
      <div class="card-title" id="R-card-33aeee5290c2225fd5277b6f8e0c670b">
        <a href="/cyber-security/security-enhanced-linux/">
        Security Enhanced Linux
        </a>
      </div>
      <div class="card-content-text">
          <p>
The confusing world of SELinux
      </div>
    </div>
  </article>
</li>
<li>
  <article class="card card-popout" aria-labelledby="R-card-e958a20d94071d2a49e1e78b0b6af4d6">
    <div class="card-content">
      <div class="card-title" id="R-card-e958a20d94071d2a49e1e78b0b6af4d6">
        <a href="/cyber-security/the-linux-firewall/">
        The Linux Firewall
        </a>
      </div>
      <div class="card-content-text">
          <p>
Firewalld stuff mostly
      </div>
    </div>
  </article>
</li>
<li>
  <article class="card card-popout" aria-labelledby="R-card-b648870abd5d427d4e8003309daaea87">
    <div class="card-content">
      <div class="card-title" id="R-card-b648870abd5d427d4e8003309daaea87">
        <a href="/cyber-security/the-secure-shell-service/">
        The Secure Shell Service
        </a>
      </div>
      <div class="card-content-text">
          <p>
OpenSSH, system access, file transfer
      </div>
    </div>
  </article>
</li>
</ul>
</div>

  <footer class="footline">
  </footer>
</article>
          <section>
            <h1 class="a11y-only">Subsections of Cyber Security</h1>
<article class="default">
  <header class="headline">
  </header>

<h1 id="files">Files</h1>

<div class="children children-type-card children-sort-"><ul class="card-container">
<li>
  <article class="card card-popout" aria-labelledby="R-card-d58c8c96efffe08280286f4e5fdc5643">
    <div class="card-content">
      <div class="card-title" id="R-card-d58c8c96efffe08280286f4e5fdc5643">
        <a href="/cyber-security/files/advanced-file-management/">
        Advanced File Management
        </a>
      </div>
      <div class="card-content-text">
          <p>
File permissions, ACLs, and finding things
      </div>
    </div>
  </article>
</li>
<li>
  <article class="card card-popout" aria-labelledby="R-card-ee7a6ac9b2a81c0fcd5b150999bd472b">
    <div class="card-content">
      <div class="card-title" id="R-card-ee7a6ac9b2a81c0fcd5b150999bd472b">
        <a href="/cyber-security/files/file-management/">
        Basic File Managment
        </a>
      </div>
      <div class="card-content-text">
          <p>
File types, linking, viewing, and archiving files.
      </div>
    </div>
  </article>
</li>
</ul>
</div>

  <footer class="footline">
  </footer>
</article>
          <section>
            <h1 class="a11y-only">Subsections of Files</h1>
<article class="default">
  <header class="headline">
  </header>

<h1 id="advanced-file-management">Advanced File Management</h1>

<h2 id="permission-classes-and-types">Permission Classes and Types</h2>
<p><strong>Permission classes</strong></p>
<ul>
<li>user (u)</li>
<li>group (g)</li>
<li>other (o) (public)</li>
<li>all (a) &lt;- all combined</li>
</ul>
<p><strong>Permission types</strong></p>
<ul>
<li>r,w,x</li>
<li>works differently on files and directories</li>
<li>hyphen (-) represents no permissions set</li>
</ul>
<h3 id="ls-results-permissions-groupings">ls results permissions groupings</h3>
<ul>
<li>
<ul>
<li>rwx rw- r&ndash;
<ul>
<li>user (owner), group, and other (public)</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="ls-results-first-character-meaning">ls results first character meaning</h3>
<ul>
<li>regular file
d directory
l symbolic link
c character device file
b block device file
p named pipe
s socket</li>
</ul>
<h3 id="modifying-access-permission-bits">Modifying Access Permission Bits</h3>
<h3 id="chmod--command"><code>chmod</code>  command</h3>
<ul>
<li>Modify permissions using symbolic or octal notation.</li>
<li>Used by root or the file owner.</li>
</ul>
<p>Flags
chmod -v ::: Verbose.</p>
<h3 id="symbolic-notation">Symbolic notation</h3>
<ul>
<li>Letters (ugo/rwx) and symbols (+, -, =) used to add, revoke, or assign permission bits.</li>
</ul>
<h3 id="octal-notation">Octal Notation</h3>
<p>Three-digit numbering system ranging from 0 to 7.
0 &mdash;
1 &ndash;x
2 -w-
3 -wx
4 r&ndash;
5 r-x
6 rw-
7 rwx</p>
<h3 id="default-permissions">Default Permissions</h3>
<ul>
<li>Calculated based on the umask (user mask) value subtracted from the initial permissions value.</li>
</ul>
<h4 id="umask">umask</h4>
<ul>
<li>Three-digit value (octal or symbolic) that refers to read, write, and execute permissions for owner, group, and public.</li>
<li>Default umask value is 0022 for the root user and 0002 normal users.</li>
<li>The left-most 0 has no significance.</li>
<li>If umask is set to 000 files will get max of 666</li>
<li>If the initial permissions are 666 and the umask is 002 then the default permissions are 664. (666-002)</li>
<li>Any new files or directories created after changing the umask will have the new default permissions set.</li>
<li>umask settings are lost when you log off. Add it to the appropriate startup file to make it permanent.</li>
</ul>
<p>Defaults</p>
<ul>
<li>files 666 rw-rw-rw-</li>
<li>directories 777 rwxrwxrwx</li>
</ul>
<h3 id="umask-command">umask command</h3>
<p>Options</p>
<ul>
<li>-S symbolic form</li>
</ul>
<h3 id="special-permission-bits">Special Permission Bits</h3>
<hr>
<ul>
<li>3 types of special permission bits for executable files or directories for non root users
<ul>
<li>setuid</li>
<li>setgid</li>
<li>sticky</li>
</ul>
</li>
<li>setuid
<ul>
<li>set on exe&rsquo;s to provide non-owners the ability to run them with the privileges of the owning user</li>
<li>may be set on directories and files but will have no effect.</li>
<li>example: the su command</li>
<li>shows an &rsquo;s&rsquo; in ls -l listing at the end of owners permissions</li>
<li>If the file already has the ‚Äúx‚Äù bit set for the user, the long listing will show a lowercase ‚Äús‚Äù, otherwise it will list it with an uppercase ‚ÄúS‚Äù.</li>
</ul>
</li>
<li>setgid
<ul>
<li>set on exe&rsquo;s to provide non-group members the ability to run them with the privileges of the owning group.</li>
<li>May be set on shared directories
<ul>
<li>allow files and subdirectories created underneath to automatically inherit the directory‚Äôs owning group.</li>
<li>saves group members who are sharing the directory contents from changing the group ID for every new file and subdirectory that they add.</li>
</ul>
</li>
<li>write command has this set by default so a member of the tty group can run it. If the file already has the ‚Äúx‚Äù bit set for the group, the long listing will show a lowercase ‚Äús‚Äù, otherwise it will list it with an uppercase ‚ÄúS‚Äù.</li>
</ul>
</li>
<li>Sticky bit
<ul>
<li>may be set on public directories for inhibiting file deletion by non-owners</li>
<li>may be set on directories and files but will have no effect.</li>
<li>Set on /tmp and /var/tmp by default</li>
<li>Letter &ldquo;t&rdquo; in other permission feild</li>
<li>If the directory already has the ‚Äúx‚Äù bit set for public, the long listing will show a lowercase ‚Äút‚Äù, otherwise it will list it with an uppercase ‚ÄúT‚Äù.</li>
</ul>
</li>
</ul>
<h2 id="access-control-lists-acls">Access Control Lists (ACLs)</h2>
<ul>
<li>
<p>Setting a default ACL on a directory allows content sharing among user&rsquo;s without having to modify access on each new file and subdirectory.</p>
</li>
<li>
<p>Extra permissions that can be set on files and directories.</p>
</li>
<li>
<p>Define permissions for named user and named groups.</p>
</li>
<li>
<p>Configured the same way on both files and directories.</p>
</li>
<li>
<p>Named Users</p>
<ul>
<li>May or may not be a part of the same group.</li>
</ul>
</li>
<li>
<p>2 different groups of ACLs. Default ACLs and Access ACLs.</p>
<ul>
<li>Access ACLs
<ul>
<li>Set on individual files and directories</li>
</ul>
</li>
<li>Default ACLs
<ul>
<li>Applied on directories</li>
<li>files and subdirectories inherit the ACL</li>
<li>Execute bit must be set on the directory for public.</li>
<li>Files receive the shared directory&rsquo;s default ACLs as their access ACLs - what the mask limits.</li>
<li>Subdirectories receive both default ACLs and access ACLs as they are.</li>
</ul>
</li>
</ul>
</li>
<li>
<p>A &ldquo;+&rdquo; at the end of ls -l listing indicates ACL is set</p>
<ul>
<li>-rw-rw-r&ndash;+</li>
</ul>
</li>
</ul>
<h3 id="acl-commands">ACL Commands</h3>
<p><code>getfacl</code></p>
<ul>
<li>Display ACL settings
<ul>
<li>Displays:</li>
<li>name of file</li>
<li>owner</li>
<li>owning group</li>
<li>Permissions
<ul>
<li>colon characters save space for named user/group (or UID/GID) when extended Permissions are set.</li>
<li>Example: user:1000:r&ndash;
<ul>
<li>the named user with UID 1000, who is neither the file owner nor a member of the owning group, is allowed read-only access to this file.</li>
</ul>
</li>
<li>Example: group:dba:rw-
<ul>
<li>give the named group (dba) read and write access to the file.
<code>setfacl</code></li>
</ul>
</li>
</ul>
</li>
<li>set, modify, substitute, or delete ACL settings</li>
<li>If you want to give read and write permissions to a specific user (user1) and change the mask to read-only at the same time, the setfacl command will allocate the permissions as mentioned; however, the effective permissions for the named user will only be read-only.</li>
</ul>
</li>
</ul>
<p>u:UID:perms</p>
<ul>
<li>named user must exist in /etc/passwd</li>
<li>if no user specified, permissions are given to the owner of the file/directory</li>
</ul>
<p>g:GID:perms</p>
<ul>
<li>Named group must exist in /etc/group</li>
<li>If no group specified, permissions are given to the owning group of the file/directory</li>
</ul>
<p>o:perms</p>
<ul>
<li>Neither owner or owning group</li>
</ul>
<p>m:perms</p>
<ul>
<li>Maximum permissions for named user or named group</li>
</ul>
<p>Switches</p>
<table>
  <thead>
      <tr>
          <th>Switch</th>
          <th>Description</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>-b</td>
          <td>Remove all Access ACLs</td>
      </tr>
      <tr>
          <td>-d</td>
          <td>Applies to default ACLs</td>
      </tr>
      <tr>
          <td>-k</td>
          <td>Removes all default ACLs</td>
      </tr>
      <tr>
          <td>-m</td>
          <td>Sets or modifies ACLs</td>
      </tr>
      <tr>
          <td>-n</td>
          <td>Prevent auto mask recalculation</td>
      </tr>
      <tr>
          <td>-R</td>
          <td>Apply Recursively to directory</td>
      </tr>
      <tr>
          <td>-x</td>
          <td>Remove Access ACL</td>
      </tr>
      <tr>
          <td>-c</td>
          <td>Display output without header</td>
      </tr>
  </tbody>
</table>
<h3 id="mask-value">Mask Value</h3>
<ul>
<li>Determine maximum allowable permissions for named user or named group</li>
<li>Mask value displayed on separate line in getfacl output</li>
<li>Mask is recalculated every time an ACL is modified unless value is manually entered.</li>
<li>Overrides the set ACL value.</li>
</ul>
<h2 id="find-command">Find Command</h2>
<ul>
<li>Search files and display the full path.</li>
<li>Execute command on search results.</li>
<li>Different search criteria
<ul>
<li>name</li>
<li>part name</li>
<li>ownership</li>
<li>owning group</li>
<li>permissions</li>
<li>inode number</li>
<li>last access</li>
<li>modification time in days or minutes</li>
<li>size</li>
<li>file type</li>
</ul>
</li>
<li>Command syntax
<ul>
<li>{find} + {path} + {search option} + {action}</li>
</ul>
</li>
<li>Options
<ul>
<li>-name / -iname (search by name)</li>
<li>-user / -group (UID / GID)</li>
<li>-perm (permissions)</li>
<li>-inum (inode)</li>
<li>-atime/amin (access time)</li>
<li>-mtime/amin (modification time)</li>
<li>-size / -type (size / type)</li>
<li></li>
</ul>
</li>
<li>Action
<ul>
<li>copy, erase, rename, change ownership, modify permissions
<ul>
<li>-exec  {} \;
<ul>
<li>replaces {} for each filename as it is found. The semicolon character (;) marks the termination of the command and it is escaped with the backslash character (\).</li>
</ul>
</li>
<li>-ok  {} \;
<ul>
<li>same as exec but requires confirmation.</li>
</ul>
</li>
</ul>
</li>
<li>-delete</li>
<li>-print &lt;- default</li>
</ul>
</li>
</ul>
<h1 id="advanced-file-management-labs">Advanced File Management Labs</h1>
<h3 id="lab-find-stuff">Lab: find stuff</h3>
<ol>
<li>Create file 10 and search for it.</li>
</ol>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#ff6ac1">[</span>vagrant@server1 ~<span style="color:#ff6ac1">]</span>$ sudo touch /root/file10
</span></span><span style="display:flex;"><span><span style="color:#ff6ac1">[</span>vagrant@server1 ~<span style="color:#ff6ac1">]</span>$ sudo find / -name file10 -print
</span></span><span style="display:flex;"><span>/root/file10</span></span></code></pre></div>
<ol start="2">
<li>Perform a case insensitive search for files and directories in /dev that begin with &ldquo;usb&rdquo; followed by any characters.</li>
</ol>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#ff6ac1">[</span>vagrant@server1 ~<span style="color:#ff6ac1">]</span>$ find /dev -iname usb*
</span></span><span style="display:flex;"><span>/dev/usbmon0</span></span></code></pre></div>
<ol start="3">
<li>Find files smaller than 1MB (-1M) in size (-size) in the root user‚Äôs home directory (~).</li>
</ol>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#ff6ac1">[</span>vagrant@server1 etc<span style="color:#ff6ac1">]</span>$ find ~ -size -1M</span></span></code></pre></div>
<ol start="4">
<li>Search for files larger than 40MB (+40M) in size (-size) in the /usr directory:</li>
</ol>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#ff6ac1">[</span>vagrant@server1 etc<span style="color:#ff6ac1">]</span>$ sudo find /usr -size +40M
</span></span><span style="display:flex;"><span>/usr/share/GeoIP/GeoLite2-City.b</span></span></code></pre></div>
<ol start="5">
<li>Find files in the entire root file system (/) with ownership (-user) set to user daemon and owning group (-group) set to any group other than (-not or ! for negation) user1:</li>
</ol>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#ff6ac1">[</span>vagrant@server1 etc<span style="color:#ff6ac1">]</span>$ sudo find / -user daemon -not -group user1</span></span></code></pre></div>
<ol start="6">
<li>Search for directories (-type) by the name ‚Äúsrc‚Äù (-name) in /usr at a maximum of two subdirectory levels below (-maxdepth):</li>
</ol>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#ff6ac1">[</span>vagrant@server1 etc<span style="color:#ff6ac1">]</span>$ sudo find /usr -maxdepth <span style="color:#ff9f43">2</span> -type d -name src
</span></span><span style="display:flex;"><span>/usr/local/src
</span></span><span style="display:flex;"><span>/usr/src</span></span></code></pre></div>
<ol start="7">
<li>Run the above search but at least three subdirectory levels beneath /usr, substitute -maxdepth 2 with -mindepth 3.</li>
</ol>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#ff6ac1">[</span>vagrant@server1 etc<span style="color:#ff6ac1">]</span>$ sudo find /usr -mindepth <span style="color:#ff9f43">3</span> -type d -name src
</span></span><span style="display:flex;"><span>/usr/src/kernels/4.18.0-425.3.1.el8.x86_64/drivers/gpu/drm//display/dmub/src
</span></span><span style="display:flex;"><span>/usr/src/kernels/4.18.0-425.3.1.el8.x86_64/tools/usb/usbip/src</span></span></code></pre></div>
<ol start="8">
<li>Find files in the /etc directory that were modified (-mtime) more than (the + sign) 2000 days ago:</li>
</ol>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#ff6ac1">[</span>vagrant@server1 etc<span style="color:#ff6ac1">]</span>$ sudo find /etc -mtime +2000
</span></span><span style="display:flex;"><span>/etc/libuser.conf
</span></span><span style="display:flex;"><span>/etc/xattr.conf
</span></span><span style="display:flex;"><span>/etc/whois.conf</span></span></code></pre></div>
<ol start="9">
<li>Run the above search for files that were modified exactly 12 days ago, replace ‚Äú+2000‚Äù with ‚Äú12‚Äù.</li>
</ol>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#ff6ac1">[</span>vagrant@server1 etc<span style="color:#ff6ac1">]</span>$ sudo find /etc -mtime <span style="color:#ff9f43">12</span></span></span></code></pre></div>
<ol start="10">
<li>To find files in the /var/log directory that have been modified (-mmin) in the past (the - sign) 100 minutes:</li>
</ol>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#ff6ac1">[</span>vagrant@server1 etc<span style="color:#ff6ac1">]</span>$ sudo find /var/log -mmin -100
</span></span><span style="display:flex;"><span>/var/log/rhsm/rhsmcertd.log
</span></span><span style="display:flex;"><span>/var/log/rhsm/rhsm.log
</span></span><span style="display:flex;"><span>/var/log/audit/audit.log
</span></span><span style="display:flex;"><span>/var/log/dnf.librepo.log
</span></span><span style="display:flex;"><span>/var/log/dnf.rpm.log
</span></span><span style="display:flex;"><span>/var/log/sa
</span></span><span style="display:flex;"><span>/var/log/sa/sa16
</span></span><span style="display:flex;"><span>/var/log/sa/sar15
</span></span><span style="display:flex;"><span>/var/log/dnf.log
</span></span><span style="display:flex;"><span>/var/log/hawkey.log
</span></span><span style="display:flex;"><span>/var/log/cron
</span></span><span style="display:flex;"><span>/var/log/messages
</span></span><span style="display:flex;"><span>/var/log/secure</span></span></code></pre></div>
<ol start="11">
<li>Run the above search for files that have been modified exactly 25 minutes ago, replace ‚Äú-100‚Äù with ‚Äú25‚Äù.</li>
</ol>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#ff6ac1">[</span>vagrant@server1 etc<span style="color:#ff6ac1">]</span>$ sudo find /var/log -mmin <span style="color:#ff9f43">25</span></span></span></code></pre></div>
<ol start="12">
<li>To search for block device files (-type) in the /dev directory with permissions (-perm) set to exactly 660:</li>
</ol>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#ff6ac1">[</span>vagrant@server1 etc<span style="color:#ff6ac1">]</span>$ sudo find /dev -type b -perm <span style="color:#ff9f43">660</span>
</span></span><span style="display:flex;"><span>/dev/dm-1
</span></span><span style="display:flex;"><span>/dev/dm-0
</span></span><span style="display:flex;"><span>/dev/sda2
</span></span><span style="display:flex;"><span>/dev/sda1
</span></span><span style="display:flex;"><span>/dev/sda</span></span></code></pre></div>
<ol start="13">
<li>Search for character device files (-type) in the /dev directory with at least (-222) world writable permissions (this example would ignore checking the write and execute permissions):</li>
</ol>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#ff6ac1">[</span>vagrant@server1 etc<span style="color:#ff6ac1">]</span>$ sudo find /dev -type c -perm -222</span></span></code></pre></div>
<ol start="14">
<li>Find files in the /etc/systemd directory that are executable by at least their owner or group members:</li>
</ol>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#ff6ac1">[</span>vagrant@server1 etc<span style="color:#ff6ac1">]</span>$ sudo find /etc/systemd -perm /110</span></span></code></pre></div>
<ol start="15">
<li>Search for symlinked files (-type) in /usr with permissions (-perm) set to read and write for the owner and owning group:</li>
</ol>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span> sudo find /usr -type l -perm -ug<span style="color:#ff6ac1">=</span>rw</span></span></code></pre></div>
<ol start="16">
<li>Search for directories in the entire directory tree (/) by the name ‚Äúcore‚Äù (-name) and list them (ls-ld) as they are discovered without prompting for user confirmation (-exec):</li>
</ol>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span> <span style="color:#ff6ac1">[</span>vagrant@server1 etc<span style="color:#ff6ac1">]</span>$ sudo find / -name core -exec ls -ld <span style="color:#ff6ac1">{}</span> <span style="color:#5af78e">\;</span></span></span></code></pre></div>
<ol start="17">
<li>Use the -ok switch to prompt for confirmation before it copies each matched file (-name) in /etc/sysconfig to /tmp:</li>
</ol>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span> sudo find /etc/sysconfig -name <span style="color:#5af78e">&#39;*.conf&#39;</span> -ok  cp <span style="color:#ff6ac1">{}</span> /tmp <span style="color:#5af78e">\;</span></span></span></code></pre></div>
<h3 id="lab-display-acl-and-give-permissions">Lab: Display ACL and give permissions</h3>
<ol>
<li>Create and empty file aclfile1 in /tmp and display ACLs on it:</li>
</ol>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span> <span style="color:#ff5c57">cd</span> /tmp
</span></span><span style="display:flex;"><span> touch aclfile1
</span></span><span style="display:flex;"><span> getfacl aclfile1</span></span></code></pre></div>
<ol start="2">
<li>Give rw permission to user 1 but with a mask of read only and view the results.</li>
</ol>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span> setfacl -m u:user1:rw,m:r aclfile1</span></span></code></pre></div>
<ol start="3">
<li>Promote the mask value to include write bit and verify:</li>
</ol>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span> setfacl -m m:rw aclfile1
</span></span><span style="display:flex;"><span> getfacl -c aclfile1</span></span></code></pre></div>
<h3 id="lab-identify-apply-and-erase-access-acls">Lab: Identify, Apply, and Erase Access ACLs</h3>
<ol>
<li>Switch to user1 and create file acluser1 in /tmp:</li>
</ol>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span> su - user1
</span></span><span style="display:flex;"><span> <span style="color:#ff5c57">cd</span> /tmp
</span></span><span style="display:flex;"><span> touch acluser1</span></span></code></pre></div>
<ol start="2">
<li>Use ls and getfacl to check existing acl entries:</li>
</ol>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span> ls -l acluser1
</span></span><span style="display:flex;"><span> getfacl acluser1 -c</span></span></code></pre></div>
<ol start="3">
<li>Allocate rw permissions to user100 with setfacl in octal form:</li>
</ol>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span> setfacl -m u:user100:6 acluser1</span></span></code></pre></div>
<ol start="4">
<li>Run ls (+) and getfacl to verify:</li>
</ol>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span> ls -l acluser1
</span></span><span style="display:flex;"><span> getfacl -c acluser1</span></span></code></pre></div>
<ol start="5">
<li>
<p>Open another terminal as user100 and open the file and edit it.</p>
</li>
<li>
<p>Add user200 with full rwx permissions to acluser1 using the symbolic notation and then show the updated ACL settings:</p>
</li>
</ol>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span> setfacl -m u:user200:rwx acluser1
</span></span><span style="display:flex;"><span> getfacl -c acluser1</span></span></code></pre></div>
<ol start="7">
<li>Delete the ACL entries set for user200 and validate:</li>
</ol>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span> setfacl -x u:user200 acluser1
</span></span><span style="display:flex;"><span> getfacl acluser1 -c</span></span></code></pre></div>
<ol start="8">
<li>Delete the rest of the ACLs:</li>
</ol>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span> setfacl -b acluser1</span></span></code></pre></div>
<ol start="9">
<li>Use the ls and getfacl commands and confirm for the ACLs removal:</li>
</ol>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span> ls -l acluser1
</span></span><span style="display:flex;"><span> getfacl acluser1 -c</span></span></code></pre></div>
<ol start="10">
<li>create group aclgroup1</li>
</ol>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span> groupadd -g <span style="color:#ff9f43">8000</span> aclgroup1</span></span></code></pre></div>
<ol start="11">
<li>add this group as a named group along with the two named users (user100 and user200).</li>
</ol>
<h3 id="lab-apply-identify-and-erase-default-acls">Lab: Apply, Identify, and erase default ACLs</h3>
<ol>
<li>Switch or log in as user1 and create a directory projects in /tmp:</li>
</ol>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span> su - user1
</span></span><span style="display:flex;"><span> <span style="color:#ff5c57">cd</span> /tmp
</span></span><span style="display:flex;"><span> mkdir projects</span></span></code></pre></div>
<ol start="2">
<li>Use the getfacl command for an initial look at the permissions on the directory:</li>
</ol>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span> getfacl -c projects</span></span></code></pre></div>
<ol start="3">
<li>Allocate default read, write, and execute permissions to user100 and user200 on the directory. Use both octal and symbolic notations and the -d (default) option with the setfacl command.</li>
</ol>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span> setfacl -dm u:user100:7,u:user200:rwx projects/
</span></span><span style="display:flex;"><span> getfacl -c projects/</span></span></code></pre></div>
<ol start="4">
<li>Create a subdirectory prjdir1 under projects and observe the ACL inheritance:</li>
</ol>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span> mkdir prjdir1
</span></span><span style="display:flex;"><span> getfacl -c prjdir1</span></span></code></pre></div>
<ol start="5">
<li>Create a file prjfile1 under projects and observe the ACL inheritance:</li>
</ol>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span> touch prjfile1
</span></span><span style="display:flex;"><span> getfacl -c prjfilel</span></span></code></pre></div>
<ol start="6">
<li>log in as one of the named users, change directory into /tmp/projects, and edit prjfile1 (add some random text). Then change into the prjdir1 and create file file100.</li>
</ol>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span> su - user100
</span></span><span style="display:flex;"><span> <span style="color:#ff5c57">cd</span> /tmp/projects
</span></span><span style="display:flex;"><span> vim prjfile1
</span></span><span style="display:flex;"><span> ls -l prjfile1
</span></span><span style="display:flex;"><span> <span style="color:#ff5c57">cd</span> prjdir1
</span></span><span style="display:flex;"><span> touch file100
</span></span><span style="display:flex;"><span> pwd</span></span></code></pre></div>
<ol start="7">
<li>Delete all the default ACLs from the projects directory as user1 and confirm:</li>
</ol>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span> <span style="color:#ff5c57">exit</span>
</span></span><span style="display:flex;"><span> su - user1
</span></span><span style="display:flex;"><span> <span style="color:#ff5c57">cd</span> /tmp
</span></span><span style="display:flex;"><span> setfacl -k projects
</span></span><span style="display:flex;"><span> getfacl -c projects</span></span></code></pre></div>
<ol start="8">
<li>create a group such as aclgroup2 by running groupadd -g 9000 aclgroup2 as the root user and repeat this exercise by adding this group as a named group along with the two named users (user100 and user200).</li>
</ol>
<h3 id="lab-modify-permission-bits-using-symbolic-form">Lab: Modify Permission Bits Using Symbolic Form</h3>
<ol>
<li>Add an execute bit for the owner and a write bit for group and public</li>
</ol>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span> <span style="color:#ff6ac1">[</span>vagrant@server1 ~<span style="color:#ff6ac1">]</span>$ chmod u+x permfile1 -v
</span></span><span style="display:flex;"><span> mode of <span style="color:#5af78e">&#39;permfile1&#39;</span> changed from <span style="color:#ff9f43">0444</span> <span style="color:#ff6ac1">(</span>r--r--r--<span style="color:#ff6ac1">)</span> to <span style="color:#ff9f43">0544</span> <span style="color:#ff6ac1">(</span>r-xr--r--<span style="color:#ff6ac1">)</span>
</span></span><span style="display:flex;"><span> <span style="color:#ff6ac1">[</span>vagrant@server1 ~<span style="color:#ff6ac1">]</span>$ chmod -v go+w permfile1
</span></span><span style="display:flex;"><span> mode of <span style="color:#5af78e">&#39;permfile1&#39;</span> changed from <span style="color:#ff9f43">0544</span> <span style="color:#ff6ac1">(</span>r-xr--r--<span style="color:#ff6ac1">)</span> to <span style="color:#ff9f43">0566</span> <span style="color:#ff6ac1">(</span>r-xrw-rw-<span style="color:#ff6ac1">)</span></span></span></code></pre></div>
<ol start="2">
<li>Revoke the write bit from public</li>
</ol>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span> <span style="color:#ff6ac1">[</span>vagrant@server1 ~<span style="color:#ff6ac1">]</span>$ chmod -v o-w permfile1
</span></span><span style="display:flex;"><span> mode of <span style="color:#5af78e">&#39;permfile1&#39;</span> changed from <span style="color:#ff9f43">0566</span> <span style="color:#ff6ac1">(</span>r-xrw-rw-<span style="color:#ff6ac1">)</span> to <span style="color:#ff9f43">0564</span> <span style="color:#ff6ac1">(</span>r-xrw-r--<span style="color:#ff6ac1">)</span>
</span></span><span style="display:flex;"><span> <span style="color:#ff6ac1">[</span>vagrant@server1 ~<span style="color:#ff6ac1">]</span>$ chmod -v <span style="color:#ff5c57">a</span><span style="color:#ff6ac1">=</span>rwx permfile1
</span></span><span style="display:flex;"><span> mode of <span style="color:#5af78e">&#39;permfile1&#39;</span> changed from <span style="color:#ff9f43">0564</span> <span style="color:#ff6ac1">(</span>r-xrw-r--<span style="color:#ff6ac1">)</span> to <span style="color:#ff9f43">0777</span> <span style="color:#ff6ac1">(</span>rwxrwxrwx<span style="color:#ff6ac1">)</span></span></span></code></pre></div>
<ol start="3">
<li>Revoke write from the owning group and write and execute bits from public.</li>
</ol>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span> <span style="color:#ff6ac1">[</span>vagrant@server1 ~<span style="color:#ff6ac1">]</span>$ chmod g-w,o-wx permfile1 -v
</span></span><span style="display:flex;"><span> mode of <span style="color:#5af78e">&#39;permfile1&#39;</span> changed from <span style="color:#ff9f43">0777</span> <span style="color:#ff6ac1">(</span>rwxrwxrwx<span style="color:#ff6ac1">)</span> to <span style="color:#ff9f43">0754</span> <span style="color:#ff6ac1">(</span>rwxr-xr--<span style="color:#ff6ac1">)</span></span></span></code></pre></div>
<h3 id="lab-modify-permission-bits-using-octal-form">Lab: Modify Permission Bits Using Octal Form</h3>
<ol>
<li>Read only for user, group, and other:</li>
</ol>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span> <span style="color:#ff6ac1">[</span>vagrant@server1 ~<span style="color:#ff6ac1">]</span>$ touch permfile2
</span></span><span style="display:flex;"><span> <span style="color:#ff6ac1">[</span>vagrant@server1 ~<span style="color:#ff6ac1">]</span>$ chmod <span style="color:#ff9f43">444</span> permfile2
</span></span><span style="display:flex;"><span> <span style="color:#ff6ac1">[</span>vagrant@server1 ~<span style="color:#ff6ac1">]</span>$ ls -l permfile2
</span></span><span style="display:flex;"><span> -r--r--r--. <span style="color:#ff9f43">1</span> vagrant vagrant <span style="color:#ff9f43">0</span> Feb  <span style="color:#ff9f43">4</span> 12:22 permfile2</span></span></code></pre></div>
<ol start="2">
<li>Add an execute bit for the owner:</li>
</ol>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span> <span style="color:#ff6ac1">[</span>vagrant@server1 ~<span style="color:#ff6ac1">]</span>$ chmod -v <span style="color:#ff9f43">544</span> permfile2
</span></span><span style="display:flex;"><span> mode of <span style="color:#5af78e">&#39;permfile2&#39;</span> changed from <span style="color:#ff9f43">0444</span> <span style="color:#ff6ac1">(</span>r--r--r--<span style="color:#ff6ac1">)</span> to <span style="color:#ff9f43">0544</span> <span style="color:#ff6ac1">(</span>r-xr--r--<span style="color:#ff6ac1">)</span></span></span></code></pre></div>
<ol start="3">
<li>Add a write permission bit for group and public:</li>
</ol>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span> <span style="color:#ff6ac1">[</span>vagrant@server1 ~<span style="color:#ff6ac1">]</span>$ chmod -v <span style="color:#ff9f43">566</span> permfile2
</span></span><span style="display:flex;"><span> mode of <span style="color:#5af78e">&#39;permfile2&#39;</span> changed from <span style="color:#ff9f43">0544</span> <span style="color:#ff6ac1">(</span>r-xr--r--<span style="color:#ff6ac1">)</span> to <span style="color:#ff9f43">0566</span> <span style="color:#ff6ac1">(</span>r-xrw-rw-<span style="color:#ff6ac1">)</span></span></span></code></pre></div>
<ol start="4">
<li>Revoke the write bit for public:</li>
</ol>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span> <span style="color:#ff6ac1">[</span>vagrant@server1 ~<span style="color:#ff6ac1">]</span>$ chmod -v <span style="color:#ff9f43">564</span> permfile2
</span></span><span style="display:flex;"><span> mode of <span style="color:#5af78e">&#39;permfile2&#39;</span> changed from <span style="color:#ff9f43">0566</span> <span style="color:#ff6ac1">(</span>r-xrw-rw-<span style="color:#ff6ac1">)</span> to <span style="color:#ff9f43">0564</span> <span style="color:#ff6ac1">(</span>r-xrw-r--<span style="color:#ff6ac1">)</span></span></span></code></pre></div>
<ol start="5">
<li>Assign read, write, and execute permission bits to all three user categories:</li>
</ol>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span> <span style="color:#ff6ac1">[</span>vagrant@server1 ~<span style="color:#ff6ac1">]</span>$ chmod -v <span style="color:#ff9f43">777</span> permfile2
</span></span><span style="display:flex;"><span> mode of <span style="color:#5af78e">&#39;permfile2&#39;</span> changed from <span style="color:#ff9f43">0564</span> <span style="color:#ff6ac1">(</span>r-xrw-r--<span style="color:#ff6ac1">)</span> to <span style="color:#ff9f43">0777</span> <span style="color:#ff6ac1">(</span>rwxrwxrwx<span style="color:#ff6ac1">)</span></span></span></code></pre></div>
<ol start="6">
<li>Run the umask command without any options and it will display the current umask value in octal notation:</li>
</ol>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span> <span style="color:#ff6ac1">[</span>vagrant@server1 ~<span style="color:#ff6ac1">]</span>$ <span style="color:#ff5c57">umask</span>
</span></span><span style="display:flex;"><span> <span style="color:#ff9f43">0002</span></span></span></code></pre></div>
<ol start="7">
<li>Symbolic form</li>
</ol>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span> <span style="color:#ff6ac1">[</span>vagrant@server1 ~<span style="color:#ff6ac1">]</span>$ <span style="color:#ff5c57">umask</span> -S
</span></span><span style="display:flex;"><span> <span style="color:#ff5c57">u</span><span style="color:#ff6ac1">=</span>rwx,g<span style="color:#ff6ac1">=</span>rwx,o<span style="color:#ff6ac1">=</span>rx</span></span></code></pre></div>
<ol start="8">
<li>Set all new files and directories to get 640 and 750 permissions,</li>
</ol>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span> <span style="color:#ff5c57">umask</span> <span style="color:#ff9f43">027</span>
</span></span><span style="display:flex;"><span> <span style="color:#ff5c57">umask</span> <span style="color:#ff5c57">u</span><span style="color:#ff6ac1">=</span>rwx,g<span style="color:#ff6ac1">=</span>rx,o<span style="color:#ff6ac1">=</span></span></span></code></pre></div>
<ol start="9">
<li>Test new umask (666-027=640) (777-027=750)</li>
</ol>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span> <span style="color:#ff6ac1">[</span>vagrant@server1 ~<span style="color:#ff6ac1">]</span>$ touch tempfile1
</span></span><span style="display:flex;"><span> <span style="color:#ff6ac1">[</span>vagrant@server1 ~<span style="color:#ff6ac1">]</span>$ ls -l tempfile1
</span></span><span style="display:flex;"><span> -rw-r-----. <span style="color:#ff9f43">1</span> vagrant vagrant <span style="color:#ff9f43">0</span> Feb  <span style="color:#ff9f43">5</span> 12:09 tempfile1
</span></span><span style="display:flex;"><span> <span style="color:#ff6ac1">[</span>vagrant@server1 ~<span style="color:#ff6ac1">]</span>$ mkdir tempdir1
</span></span><span style="display:flex;"><span> <span style="color:#ff6ac1">[</span>vagrant@server1 ~<span style="color:#ff6ac1">]</span>$ ls -ld tempdir1
</span></span><span style="display:flex;"><span> drwxr-x---. <span style="color:#ff9f43">2</span> vagrant vagrant <span style="color:#ff9f43">6</span> Feb  <span style="color:#ff9f43">5</span> 12:10 tempdir1</span></span></code></pre></div>
<h3 id="lab--view-suid-bit-on-su-command">Lab:  View suid bit on su command</h3>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span> <span style="color:#ff6ac1">[</span>vagrant@server1 ~<span style="color:#ff6ac1">]</span>$ ls -l /usr/bin/su
</span></span><span style="display:flex;"><span> -rwsr-xr-x. <span style="color:#ff9f43">1</span> root root <span style="color:#ff9f43">50152</span> Aug <span style="color:#ff9f43">22</span> 10:08 /usr/bin/su</span></span></code></pre></div>
<h3 id="lab-test-the-effect-of-setuid-bit-on-executable-files">Lab: Test the Effect of setuid Bit on Executable Files</h3>
<ol>
<li>Open 2 terminal windows. Switch to user1 in terminal1</li>
</ol>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span> <span style="color:#ff6ac1">[</span>vagrant@server1 ~<span style="color:#ff6ac1">]</span>$ su - user1
</span></span><span style="display:flex;"><span> Password:
</span></span><span style="display:flex;"><span> Last login: Sun Feb  <span style="color:#ff9f43">5</span> 12:37:12 UTC <span style="color:#ff9f43">2023</span> on pts/1</span></span></code></pre></div>
<ol start="2">
<li>Switch to root on terminal2</li>
</ol>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span> sudo su - root</span></span></code></pre></div>
<ol start="3">
<li>T1 Revoke the setuid bit from /usr/bin/su</li>
</ol>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span> chmod -v u-s /usr/bin/su</span></span></code></pre></div>
<ol start="4">
<li>T2 log off as root</li>
</ol>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span> ctrl+d</span></span></code></pre></div>
<ol start="5">
<li>Try to log in has root from both terminals</li>
</ol>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span> <span style="color:#ff6ac1">[</span>user1@server1 ~<span style="color:#ff6ac1">]</span>$ su - root
</span></span><span style="display:flex;"><span> Password:
</span></span><span style="display:flex;"><span> su: Authentication failure</span></span></code></pre></div>
<ol start="6">
<li>T1 restore the setuid bit</li>
</ol>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span> <span style="color:#ff6ac1">[</span>vagrant@server1 ~<span style="color:#ff6ac1">]</span>$ sudo chmod -v +4000 /usr/bin/su
</span></span><span style="display:flex;"><span> mode of <span style="color:#5af78e">&#39;/usr/bin/su&#39;</span> changed from <span style="color:#ff9f43">0755</span> <span style="color:#ff6ac1">(</span>rwxr-xr-x<span style="color:#ff6ac1">)</span> to <span style="color:#ff9f43">4755</span> <span style="color:#ff6ac1">(</span>rwsr-xr-x<span style="color:#ff6ac1">)</span></span></span></code></pre></div>
<h3 id="lab-test-the-effect-of-setgid-bit-on-executable-files">Lab: Test the Effect of setgid Bit on Executable Files</h3>
<ol>
<li>
<p>Log into two terminals
T1 root
T2 user1
Opened with ssh</p>
</li>
<li>
<p>T2 list users currently logged in</p>
</li>
</ol>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>who</span></span></code></pre></div>
<ol start="3">
<li>T2 send a message to root</li>
</ol>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>write root</span></span></code></pre></div>
<ol start="3">
<li>T1 revoke setgid from /usr/bin/write</li>
</ol>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>chmod g-s /usr/bin/write -v</span></span></code></pre></div>
<ol start="4">
<li>Try to write root</li>
</ol>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#ff6ac1">[</span>user1@server1 ~<span style="color:#ff6ac1">]</span>$ write root
</span></span><span style="display:flex;"><span>write: effective gid does not match group of /dev/pts/0</span></span></code></pre></div>
<ol start="5">
<li>Restore the setgid bit on /usr/bin/write:</li>
</ol>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#ff6ac1">[</span>root@server1 ~<span style="color:#ff6ac1">]</span><span style="color:#78787e"># sudo chmod -v +2000 /usr/bin/write</span>
</span></span><span style="display:flex;"><span>mode of <span style="color:#5af78e">&#39;/usr/bin/write&#39;</span> changed from <span style="color:#ff9f43">0755</span> <span style="color:#ff6ac1">(</span>rwxr-xr-x<span style="color:#ff6ac1">)</span> to <span style="color:#ff9f43">2755</span> <span style="color:#ff6ac1">(</span>rwxr-sr-x<span style="color:#ff6ac1">)</span></span></span></code></pre></div>
<ol start="6">
<li>Test</li>
</ol>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>write root</span></span></code></pre></div>
<h3 id="lab-set-up-shared-directory-for-group-collaboration">Lab: Set up Shared Directory for Group Collaboration</h3>
<ol>
<li>set up 2 test users</li>
</ol>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span> <span style="color:#ff6ac1">[</span>root@server1 ~<span style="color:#ff6ac1">]</span><span style="color:#78787e"># adduser user100</span>
</span></span><span style="display:flex;"><span> <span style="color:#ff6ac1">[</span>root@server1 ~<span style="color:#ff6ac1">]</span><span style="color:#78787e"># adduser user200</span></span></span></code></pre></div>
<ol start="2">
<li>Add group sgrp with GID 9999 with the groupadd command:</li>
</ol>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span> <span style="color:#ff6ac1">[</span>root@server1 ~<span style="color:#ff6ac1">]</span><span style="color:#78787e"># groupadd -g 9999 sgrp</span></span></span></code></pre></div>
<ol start="3">
<li>Add user100 and user200 as members to sgrp using the usermod command:</li>
</ol>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span> <span style="color:#ff6ac1">[</span>root@server1 ~<span style="color:#ff6ac1">]</span><span style="color:#78787e"># usermod -aG sgrp user100</span>
</span></span><span style="display:flex;"><span> <span style="color:#ff6ac1">[</span>root@server1 ~<span style="color:#ff6ac1">]</span><span style="color:#78787e"># usermod -aG sgrp user200</span></span></span></code></pre></div>
<ol start="4">
<li>Create /sdir directory</li>
</ol>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span> <span style="color:#ff6ac1">[</span>root@server1 ~<span style="color:#ff6ac1">]</span><span style="color:#78787e"># mkdir /sdir</span></span></span></code></pre></div>
<ol start="5">
<li>Set ownership and owning group on /sdir to root and sgrp, using the chown command:</li>
</ol>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span> <span style="color:#ff6ac1">[</span>root@server1 ~<span style="color:#ff6ac1">]</span><span style="color:#78787e"># chown root:sgrp /sdir</span></span></span></code></pre></div>
<ol start="6">
<li>Set the setgid bit on /sdir using the chmod command:</li>
</ol>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span> <span style="color:#ff6ac1">[</span>vagrant@server1 ~<span style="color:#ff6ac1">]</span>$ sudo chmod g+s /sdir</span></span></code></pre></div>
<ol start="7">
<li>Add write permission to the group members on /sdir and revoke all permissions from public:</li>
</ol>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span> <span style="color:#ff6ac1">[</span>root@server1 ~<span style="color:#ff6ac1">]</span><span style="color:#78787e"># chmod g+w,o-rx /sdir</span></span></span></code></pre></div>
<ol start="8">
<li>Verify</li>
</ol>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span> <span style="color:#ff6ac1">[</span>root@server1 ~<span style="color:#ff6ac1">]</span><span style="color:#78787e"># ls -ld /sdir</span>
</span></span><span style="display:flex;"><span> drwxrws---. <span style="color:#ff9f43">2</span> root sgrp <span style="color:#ff9f43">6</span> Feb <span style="color:#ff9f43">13</span> 15:49 /sdir</span></span></code></pre></div>
<ol start="9">
<li>Switch or log in as user100 and change to the /sdir directory:</li>
</ol>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span> <span style="color:#ff6ac1">[</span>root@server1 ~<span style="color:#ff6ac1">]</span><span style="color:#78787e"># su - user100</span>
</span></span><span style="display:flex;"><span> <span style="color:#ff6ac1">[</span>user100@server1 ~<span style="color:#ff6ac1">]</span>$ <span style="color:#ff5c57">cd</span> /sdir</span></span></code></pre></div>
<ol start="10">
<li>Create a file and check the owner and owning group on it:</li>
</ol>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span> <span style="color:#ff6ac1">[</span>user100@server1 sdir<span style="color:#ff6ac1">]</span>$ touch file100
</span></span><span style="display:flex;"><span> <span style="color:#ff6ac1">[</span>user100@server1 sdir<span style="color:#ff6ac1">]</span>$ ls -l file100
</span></span><span style="display:flex;"><span> -rw-rw-r--. <span style="color:#ff9f43">1</span> user100 sgrp <span style="color:#ff9f43">0</span> Feb <span style="color:#ff9f43">10</span> 22:41 file100</span></span></code></pre></div>
<ol start="11">
<li>Log out as user100, and switch or log in as user200 and change to the /sdir directory:</li>
</ol>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span> <span style="color:#ff6ac1">[</span>root@server1 ~<span style="color:#ff6ac1">]</span><span style="color:#78787e"># su - user200</span>
</span></span><span style="display:flex;"><span> <span style="color:#ff6ac1">[</span>user200@server1 ~<span style="color:#ff6ac1">]</span>$ <span style="color:#ff5c57">cd</span> /sdir</span></span></code></pre></div>
<ol start="12">
<li>Create a file and check the owner and owning group on it:</li>
</ol>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span> <span style="color:#ff6ac1">[</span>user200@server1 sdir<span style="color:#ff6ac1">]</span>$ touch file200
</span></span><span style="display:flex;"><span> <span style="color:#ff6ac1">[</span>user200@server1 sdir<span style="color:#ff6ac1">]</span>$ ls -l file200
</span></span><span style="display:flex;"><span> -rw-rw-r--. <span style="color:#ff9f43">1</span> user200 sgrp <span style="color:#ff9f43">0</span> Feb <span style="color:#ff9f43">13</span> 16:01 file200</span></span></code></pre></div>
<h3 id="lab-view-t-in-permissions-for-sticky-bit">Lab: View &ldquo;t&rdquo; in permissions for sticky bit</h3>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span> <span style="color:#ff6ac1">[</span>user200@server1 sdir<span style="color:#ff6ac1">]</span>$ ls -l /tmp /var/tmp -d
</span></span><span style="display:flex;"><span> drwxrwxrwt. <span style="color:#ff9f43">8</span> root root <span style="color:#ff9f43">185</span> Feb <span style="color:#ff9f43">13</span> 16:12 /tmp
</span></span><span style="display:flex;"><span> drwxrwxrwt. <span style="color:#ff9f43">4</span> root root <span style="color:#ff9f43">113</span> Feb <span style="color:#ff9f43">13</span> 16:00 /var/tmp</span></span></code></pre></div>
<h3 id="lab-test-the-effect-of-sticky-bit">Lab: Test the effect of Sticky Bit</h3>
<ol>
<li>Switch to user100 and change to the /tmp directory</li>
</ol>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#ff6ac1">[</span>user100@server1 sdir<span style="color:#ff6ac1">]</span>$ <span style="color:#ff5c57">cd</span> /tmp</span></span></code></pre></div>
<ol start="2">
<li>Create file called stckyfile</li>
</ol>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#ff6ac1">[</span>user100@server1 tmp<span style="color:#ff6ac1">]</span>$ touch stickyfile</span></span></code></pre></div>
<ol start="3">
<li>Try to delete the file as user200</li>
</ol>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#ff6ac1">[</span>user200@server1 tmp<span style="color:#ff6ac1">]</span>$ rm stickyfile
</span></span><span style="display:flex;"><span>rm: remove write-protected regular empty file <span style="color:#5af78e">&#39;stickyfile&#39;</span>? y
</span></span><span style="display:flex;"><span>rm: cannot remove <span style="color:#5af78e">&#39;stickyfile&#39;</span>: Operation not permitted</span></span></code></pre></div>
<ol start="4">
<li>Revoke the /tmp stickybit and confirm</li>
</ol>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#ff6ac1">[</span>vagrant@server1 ~<span style="color:#ff6ac1">]</span>$ sudo chmod o-t /tmp
</span></span><span style="display:flex;"><span><span style="color:#ff6ac1">[</span>vagrant@server1 ~<span style="color:#ff6ac1">]</span>$ ls -ld /tmp
</span></span><span style="display:flex;"><span>drwxrwxrwx. <span style="color:#ff9f43">8</span> root root <span style="color:#ff9f43">4096</span> Feb <span style="color:#ff9f43">13</span> 22:00 /tmp</span></span></code></pre></div>
<ol start="5">
<li>Retry the removal as user200</li>
</ol>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>rm stickyfile</span></span></code></pre></div>
<ol start="6">
<li>Restore the sticky bit on /tmp</li>
</ol>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>sudo chmod -v +1000 /tmp</span></span></code></pre></div>
<h3 id="lab-manipulate-file-permissions-user1">Lab: Manipulate File Permissions (user1)</h3>
<ol>
<li>Create file file11 and directory dir11 in the home directory. Make a note of the permissions on them.</li>
</ol>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span> touch file11
</span></span><span style="display:flex;"><span> mkdir dir11</span></span></code></pre></div>
<ol start="2">
<li>Run the umask command to determine the current umask.</li>
</ol>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span> umask</span></span></code></pre></div>
<ol start="3">
<li>Change the umask value to 0035 using symbolic notation.</li>
</ol>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span> <span style="color:#ff5c57">umask</span> <span style="color:#ff5c57">g</span><span style="color:#ff6ac1">=</span>r,0<span style="color:#ff6ac1">=</span>w</span></span></code></pre></div>
<ol start="4">
<li>Create file22 and directory dir22 in the home directory.</li>
</ol>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span> touch file22
</span></span><span style="display:flex;"><span> mkdir dir22</span></span></code></pre></div>
<ol start="5">
<li>Observe the permissions on file22 and dir22, and compare them with the permissions on file11 and dir11.</li>
</ol>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span> ls -l</span></span></code></pre></div>
<ol start="6">
<li>Use the chmod command and modify the permissions on file11 to match those on file22.</li>
</ol>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span> chmod g-w,o-r,o+w file11</span></span></code></pre></div>
<ol start="7">
<li>Use the chmod command and modify the permissions on dir22 to match those on dir11. Do not remove file11, file22, dir11, and dir22 yet.</li>
</ol>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span> chmod g-wx,o-rx,o+w dir11</span></span></code></pre></div>
<h3 id="lab-configure-group-collaboration-and-prevent-file-deletion-root">Lab: Configure Group Collaboration and Prevent File Deletion (root)</h3>
<ol>
<li>create directory /sdir. Create group sgrp and create user1000 and user2000 and add them to the group:</li>
</ol>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span> mkdir /sdir
</span></span><span style="display:flex;"><span> groupadd sgrp
</span></span><span style="display:flex;"><span> adduser user1000 <span style="color:#ff6ac1">&amp;&amp;</span> adduser user2000
</span></span><span style="display:flex;"><span> usermod -a -G sgrp user1000
</span></span><span style="display:flex;"><span> usermod -a -G sgrp user2000</span></span></code></pre></div>
<ol start="2">
<li>Set up appropriate ownership (root), owning group (sgrp), and permissions (rwx for group, &mdash; for public, s for group, and t for public) on the directory to support group collaboration and ensure non-owners cannot delete files.</li>
</ol>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span> chgrp sgrp sdir
</span></span><span style="display:flex;"><span> chmod <span style="color:#ff5c57">g</span><span style="color:#ff6ac1">=</span>rwx,o<span style="color:#ff6ac1">=</span>--- sdir
</span></span><span style="display:flex;"><span> chmod o+t sdir
</span></span><span style="display:flex;"><span> chmod g+s sdir</span></span></code></pre></div>
<ol start="3">
<li>Log on as user1000 and create a file under /sdir.</li>
</ol>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span> su - user1000
</span></span><span style="display:flex;"><span> <span style="color:#ff5c57">cd</span> /sdir
</span></span><span style="display:flex;"><span> touch testfile</span></span></code></pre></div>
<ol start="4">
<li>Log on as user2000 and try to edit that file. You should be able to edit the file successfully.</li>
</ol>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span> su - user200
</span></span><span style="display:flex;"><span> <span style="color:#ff5c57">cd</span> /sdir
</span></span><span style="display:flex;"><span> vim testfile
</span></span><span style="display:flex;"><span> cat testfile</span></span></code></pre></div>
<ol start="5">
<li>As user2000 try to delete the file. You should not be able to.</li>
</ol>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span> rm testfile</span></span></code></pre></div>
<h3 id="lab-find-files-root">Lab: Find Files (root)</h3>
<ol>
<li>Search for all files in the entire directory structure that have been modified in the last 300 minutes and display their type.</li>
</ol>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span> find /sdir -mtime -300 -exec file <span style="color:#ff6ac1">{}</span> <span style="color:#5af78e">\;</span></span></span></code></pre></div>
<ol start="2">
<li>Search for named pipe and socket files.</li>
</ol>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span> find / -type p
</span></span><span style="display:flex;"><span> find / -type s</span></span></code></pre></div>
<h3 id="lab-find-files-using-different-criteria-root">Lab: Find Files Using Different Criteria (root)</h3>
<ol>
<li>Search for regular files under /usr that were accessed more than 100 days ago, are not bigger than 5MB in size, and are owned by the user root.</li>
</ol>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span> find /usr -type f -mtime +100 -size -5M -user root</span></span></code></pre></div>
<h3 id="lab-apply-acl-settings-root">Lab: Apply ACL Settings (root)</h3>
<ol>
<li>Create file testfile under /tmp.</li>
</ol>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span> touch /tmp/testfile</span></span></code></pre></div>
<ol start="2">
<li>Create users.</li>
</ol>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span> adduser user2000
</span></span><span style="display:flex;"><span> adduser user3000
</span></span><span style="display:flex;"><span> adduser user4000</span></span></code></pre></div>
<ol start="3">
<li>Apply ACL settings on the file so that user2000 gets 7, user3000 gets 6, and user4000 gets 4 permissions.</li>
</ol>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span> setfacl -m u:user2000:7 testfile
</span></span><span style="display:flex;"><span> setfacl -m u:user3000:6 testfile
</span></span><span style="display:flex;"><span> setfacl -m u:user4000:4 testfile</span></span></code></pre></div>
<ol start="4">
<li>Remove the ACLs for user2000, and verify.</li>
</ol>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span> setfacl -x user2000 testfile
</span></span><span style="display:flex;"><span> getfacl testfile</span></span></code></pre></div>
<ol start="5">
<li>Erase all remaining ACLs at once, and confirm.</li>
</ol>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span> setfacl -b testfile
</span></span><span style="display:flex;"><span> getfacl testfile</span></span></code></pre></div>

  <footer class="footline">
  </footer>
</article>
<article class="default">
  <header class="headline">
  </header>

<h1 id="basic-file-managment">Basic File Managment</h1>

<h1 id="chapter-3-rhcsa-notes---file-management">Chapter 3 RHCSA Notes - File Management</h1>
<h2 id="7-file-types">7 File types</h2>
<ol>
<li>regular</li>
<li>directory</li>
<li>block special device</li>
<li>character special device</li>
<li>symbolic link</li>
<li>named pipe</li>
<li>socket</li>
</ol>
<p>Commands</p>
<ul>
<li>ls</li>
<li>stat</li>
<li>file</li>
</ul>
<h3 id="regular-files">Regular files</h3>
<ul>
<li>Text or binary data.</li>
<li>Represented by hyphen (-).</li>
</ul>
<h3 id="directory-files">Directory Files</h3>
<ul>
<li>Identified by the letter &ldquo;d&rdquo; in the beginning of ls output.</li>
</ul>
<h3 id="block-and-character-raw-special-device-files">Block and Character (raw) Special Device Files</h3>
<ul>
<li>All hardware has device file in /dev/.</li>
<li>Used by system to communicate with device.</li>
<li>Identified by &ldquo;c&rdquo; or &ldquo;b&rdquo; in ls listing.</li>
<li>Each device driver is assigned a unique number called the major number</li>
<li>Character device
<ul>
<li>Reads and writes 8 bits at a time.</li>
<li>Serial</li>
</ul>
</li>
<li>Block device
<ul>
<li>Receives data in fixed block size determined by drivers</li>
<li>512 or 4096 bytes</li>
</ul>
</li>
</ul>
<h4 id="major-number">Major Number</h4>
<ul>
<li>Used by kernel to recognize device driver type.</li>
<li>Column 5 of ls listing.</li>
</ul>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0"><code>ls -l /dev/sda</code></pre></div>
<h4 id="minor-number">Minor Number</h4>
<ul>
<li>Each device controlled by the same device driver gets a Minor Number</li>
<li>Applies to disk partitions as well.</li>
<li>The same driver can control multiple devices of the same type.</li>
<li>Column 6 of ls listing</li>
</ul>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0"><code>ls -l /dev/sda</code></pre></div>
<h3 id="symbolic-links">Symbolic Links</h3>
<ul>
<li>Shortcut to another file or directory.</li>
<li>Begins with &ldquo;l&rdquo; in ls listing.</li>
</ul>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0"><code>ls -l /usr/sbin/vigr
lrwxrwxrwx. 1 root root 4 Jul 21 14:36 /usr/sbin/vigr -&gt; vipw</code></pre></div>
<h2 id="compression-and-archiving">Compression and Archiving</h2>
<h3 id="archiving">Archiving</h3>
<ul>
<li>Preserves file attributes such as ownership, owning group, and timestamp.</li>
<li>Preserves extended file attributes such as ACLs and SELinux contexts.</li>
<li>Syntax of <code>tar</code> and <code>star</code> are identical.</li>
</ul>
<h3 id="star-command">star command</h3>
<h3 id="tar-tape-archive-command">tar (tape archive) command</h3>
<ul>
<li>Create, append, update, list, and extract files/directory tree to/from a file called a tarball(tarfile)</li>
<li>Can compress a tarball after it&rsquo;s been created.</li>
<li>Automatically removes &ldquo;/&rdquo; so you do not have to specify the full pathname¬† when restoring files at any location.</li>
</ul>
<p>flags
tar -c :: Create tarball.
tar -f :: Specify tarball name.
tar -p :: Preserve file permissions. Default for the root user. Specify this if you create an archive as a normal user.
tar -r :: Append files to the end of an existing uncompressed tarball.
tar -t :: List contents of a tarball.
tar -u :: Append files to the end of an existing uncompressed tarball provided the specified files being added are newer.
-z
-j
-C</p>
<h4 id="archive-entire-home-directory">Archive entire home directory:</h4>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0"><code>tar -cvf /tmp/home.tar /home</code></pre></div>
<h4 id="archive-two-specific-files">Archive two specific files:</h4>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0"><code>tar -cvf /tmp/files.tar /etc/passwd /etc/yum.conf</code></pre></div>
<h4 id="append-files-in-a-directory-to-existing-tarball">Append files in a directory to existing tarball:</h4>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0"><code>tar -rvf /tmp/files.tar /etc/yum.repos.d</code></pre></div>
<h4 id="list-what-is-included-in-hometar-tarball">List what is included in home.tar tarball:</h4>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0"><code>tar -tvf /tmp/files.tar</code></pre></div>
<h4 id="restore-single-file-and-confirm">Restore single file and confirm:</h4>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0"><code>tar -xf /tmp/files.tar etc/yum.conf
ls -l etc/yum.conf</code></pre></div>
<h4 id="restore-all-files-and-confirm">Restore all files and confirm:</h4>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0"><code>tar -xf /tmp/files.tar
ls</code></pre></div>
<h4 id="create-a-gzip-compressed-tarball-under-tmp-for-home">Create a gzip-compressed tarball under /tmp for /home:</h4>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0"><code>tar -czf /tmp/home.tar.gz /home</code></pre></div>
<h4 id="create-bzip2-compressed-tarball-under-tmp-for-home">Create bzip2-compressed tarball under /tmp for /home:</h4>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0"><code>sudo tar -cjf /tmp/home.tar.bz2 /home</code></pre></div>
<h4 id="list-content-of-gzip-compressed-archive-without-uncompressing-it">List content of gzip-compressed archive without uncompressing it:</h4>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0"><code>tar -tf /tmp/home.tar.gz</code></pre></div>
<h4 id="extract-files-from-gzip-compressed-tarball-in-the-current-directory">Extract files from gzip-compressed tarball in the current directory:</h4>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0"><code>tar -xf /tmp/home.tar.gz</code></pre></div>
<h4 id="extract-files-from-the-bzip2-compressed-tarball-under-tmp">Extract files from the bzip2-compressed tarball under /tmp:</h4>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0"><code>tar -xf /tmp/home.tar.bz2 -C /tmp</code></pre></div>
<h2 id="compression-tools">Compression tools</h2>
<h3 id="gzip-gunzip-command">gzip (gunzip) command</h3>
<ul>
<li>Create a compressed file for each of the specified files.</li>
<li>Adds .gz extension.</li>
</ul>
<p>Flags</p>
<h4 id="copy-etcfstab-to-the-current-directory-and-display-filename-when-uncompressed">Copy /etc/fstab to the current directory and display filename when uncompressed:</h4>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0"><code>cp /etc/fstab .
ls -l fstab</code></pre></div>
<h4 id="gzip-fstab-and-view-details">gzip fstab and view details:</h4>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0"><code>gzip fstab
ls -l fstab.gz</code></pre></div>
<h4 id="display-compression-info">Display compression info:</h4>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0"><code>gzip -l fstab.gz</code></pre></div>
<h4 id="uncompress-fstabgz">Uncompress fstab.gz:</h4>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0"><code>gunzip fstab.gz
ls -l fstab</code></pre></div>
<h3 id="bzip2-bunzip2-command"><code>bzip2</code> (<code>bunzip2</code>) command</h3>
<ul>
<li>Adds .bz2 extension.</li>
</ul>
<ul>
<li>Better compression/ decompression ratio but is slower than gzip.</li>
</ul>
<h4 id="compress-fstab-using-bzip-and-view-details">Compress fstab using bzip and view details:</h4>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0"><code>bzip2 fstab
ls -l fstab.bz2</code></pre></div>
<h4 id="unzip-fstabbz2-and-view-details">Unzip fstab.bz2 and view details:</h4>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0"><code>bunzip2 fstab.bz2
ls -l fstab</code></pre></div>
<h2 id="file-editing">File Editing</h2>
<h3 id="vim">Vim</h3>
<p><a href="../../tools%201/vimguide.md">vimguide</a></p>
<h3 id="file-and-directory-operations">File and Directory Operations</h3>
<h3 id="touch-command">touch command</h3>
<ul>
<li>File is created with 0 bytes in size.</li>
<li>Run touch on it and it will get a new timestamp</li>
</ul>
<p>Flags</p>
<h4 id="set-date-on-file1-to-2019-09-20">Set date on file1 to 2019-09-20:</h4>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0"><code>touch -d 2019-09-20 file1</code></pre></div>
<h4 id="change-modification-time-on-file1-to-current-system-time">Change modification time on file1 to current system time:</h4>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0"><code>touch -m file1</code></pre></div>
<h3 id="mkdir-command">mkdir command</h3>
<ul>
<li>Create a new directory.</li>
</ul>
<p>flags</p>
<h4 id="create-dir1-verbosely">Create dir1 verbosely:</h4>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0"><code>mkdir dir1 -v</code></pre></div>
<h4 id="create-dir2perlperl5">Create dir2/perl/perl5:</h4>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0"><code>mkdir -vp dir2/perl/perl5</code></pre></div>
<h2 id="commands-for-displaying-file-contents">Commands for displaying file contents</h2>
<ul>
<li>cat</li>
<li>more</li>
<li>less</li>
<li>head</li>
<li>tail</li>
</ul>
<h3 id="cat-command">cat command</h3>
<ul>
<li>Concatenate and print files to standard output.</li>
</ul>
<p>Flags</p>
<h4 id="redirect-output-to-specified-file">Redirect output to specified file:</h4>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0"><code>cat &gt; catfile1</code></pre></div>
<h3 id="tac-command">tac command</h3>
<ul>
<li>Display file contents in reverse</li>
</ul>
<h3 id="more-command">more command</h3>
<ul>
<li>Display files on page-by-page basis.</li>
<li>Forward text searching only.</li>
</ul>
<h4 id="navigation">Navigation</h4>
<h3 id="less-command">less command</h3>
<ul>
<li>Display files on page-by-page basis.</li>
<li>Forward and backwards searching.</li>
</ul>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0"><code>less /usr/bin/znew</code></pre></div>
<h4 id="navigation-1">Navigation</h4>
<h3 id="head-command">head command</h3>
<ul>
<li>Displays first 10 lines of a file.</li>
</ul>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0"><code>head /etc/profile</code></pre></div>
<h4 id="view-top-3-lines-of-a-file">View top 3 lines of a file:</h4>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0"><code>head -3 /etc/profile</code></pre></div>
<h3 id="tail-command">tail command</h3>
<ul>
<li>Display last 10 lines of a file.</li>
</ul>
<p>Flags</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0"><code>tail /etc/profile</code></pre></div>
<h4 id="view-last-3-lines-of-etcprofile">View last 3 lines of /etc/profile:</h4>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0"><code>tail -3 /etc/profile</code></pre></div>
<h4 id="view-updates-to-the-system-log-file-varlogmessages-in-real-time">View updates to the system log file /varlog/messages in real time:</h4>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0"><code>sudo tail -f /var/log/messages</code></pre></div>
<h2 id="counting-words-lines-and-characters-in-text-files">Counting Words, Lines, and Characters in Text Files</h2>
<h3 id="wc-word-count-command">wc (word count) command</h3>
<ul>
<li>Display the number of lines, words, and characters (or bytes) contained in a text file or input supplied.</li>
</ul>
<p>Flags</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0"><code> wc /etc/profile
  85  294 2123 /etc/profile</code></pre></div>
<h4 id="display-count-of-characters-on-etcprofile">Display count of characters on /etc/profile:</h4>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0"><code>wc -m /etc/profile</code></pre></div>
<h2 id="copying-files-and-directories">Copying Files and Directories</h2>
<h3 id="cp-command">cp command</h3>
<ul>
<li>Copy files or directories.</li>
<li>Overwrites destination without warning.</li>
<li>root has a custom alias in their .bashrc file that automatically adds the -i option.</li>
</ul>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0"><code>alias cp=&#39;cp -i&#39;</code></pre></div>
<p>Flags</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0"><code>cp file1 newfile1</code></pre></div>
<h4 id="copy-file-to-new-directory">Copy file to new directory:</h4>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0"><code>cp file1 dir1</code></pre></div>
<h4 id="get-confirmation-before-overwriting">Get confirmation before overwriting:</h4>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0"><code>cp file1 dir1 -i
cp: overwrite &#39;dir1/file1&#39;? y</code></pre></div>
<h4 id="copy-a-directory-and-view-hierarchy">Copy a directory and view hierarchy:</h4>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0"><code>cp -r dir1 dir2
ls -l dir2 -R</code></pre></div>
<h4 id="copy-file-while-preserving-attributes">Copy file while preserving attributes:</h4>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0"><code>cp -p file1 /tmp</code></pre></div>
<h2 id="moving-and-renaming-files-and-directories">Moving and renaming Files and Directories</h2>
<h3 id="mv-command">mv command</h3>
<ul>
<li>Move or rename files and directories.</li>
<li>Can move a directory into another directory.
<ul>
<li>Target directory must exist otherwise you are just renaming the directory.</li>
</ul>
</li>
<li>Alias exists in root&rsquo;s home directory for -i in the .bashrc file.</li>
</ul>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0"><code>alias‚Äî‚Äúalias mv=‚Äômv -i‚Äô&#34;&#34;</code></pre></div>
<p>Flags</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0"><code>mv -i file1 dir1</code></pre></div>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0"><code>mv newfile1 newfile2</code></pre></div>
<h4 id="move-a-dir-into-another-dir-target-exists">Move a dir into another dir (target exists):</h4>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0"><code>mv dir1 dir2</code></pre></div>
<h4 id="rename-a-directory-target-does-not-exist">Rename a directory (Target does not exist):</h4>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0"><code>mv dir2 dir20</code></pre></div>
<h2 id="removing-files">Removing files</h2>
<h3 id="rm-command">rm command</h3>
<ul>
<li>Delete one or more specified files or directories.</li>
<li>Alias‚Äî‚Äúalias rm=‚Äôrm -i‚Äô‚Äù‚Äî in the .bashrc file in the root user‚Äôs home directory.</li>
<li>Remember to backslash &ldquo;&quot; any wildcard characters in filenames.</li>
</ul>
<p>Flags</p>
<h4 id="erase-newfile2">Erase newfile2:</h4>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0"><code>rm -i newfile2</code></pre></div>
<h4 id="rm-a-directory">rm a directory:</h4>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0"><code> rm -dv emptydir</code></pre></div>
<h4 id="rm-a-directory-recursively">rm a directory recursively:</h4>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0"><code>rm -r dir20</code></pre></div>
<h4 id="rmdir-command">rmdir command</h4>
<ul>
<li>Remove empty directories.</li>
</ul>
<p>Flags</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0"><code>rmdir emptydir -v</code></pre></div>
<h2 id="file-linking">File Linking</h2>
<h3 id="inode-index-node">inode (index node)</h3>
<ul>
<li>Contains metadata about a file (128 bytes)
<ul>
<li>File type, Size, permissions, owner name, owning group, access times, link count, etc.</li>
<li>Also shows number of allocated blocks and pointers to the data storage location.</li>
</ul>
</li>
<li>Assigned a unique numeric identifier that is used by the kernel for accessing, tracking, and managing the file.</li>
<li>Does not store the filename.</li>
<li>Filename and corresponding inode number mapping is maintained in the directory‚Äôs metadata where the file resides.</li>
<li>Links are not created between files and directories</li>
</ul>
<h3 id="hard-links">Hard links</h3>
<ul>
<li>Mapping between one or more filenames and an inode number.</li>
<li>Hard-linked files are indistinguishable from one another.</li>
<li>All hard-linked files will have identical metadata.</li>
<li>Changes to the file metadata and content can be made by accessing any of the filenames.</li>
<li>Cannot cross file system boundaries.</li>
<li>Cannot link directories.</li>
</ul>
<h4 id="ls--li-output">ls -li output</h4>
<ul>
<li>Column 1 inode number.</li>
<li>Column 3 link count.</li>
</ul>
<h2 id="soft-links">Soft Links</h2>
<ul>
<li>Symbolic (symlink).</li>
<li>Like a Windows shortcut.</li>
<li>Unique inode number for each symlink.</li>
<li>Link count does not increase or decrease.</li>
<li>Size of soft link is the number of character in pathname to target.</li>
<li>Can cross file system boundaries.</li>
<li>Can link directories.</li>
<li>ls-l shows l at the beginning of the permissions for soft link</li>
<li>if you remove the original file, the softlink will point to a file that doesn&rsquo;t exist.</li>
<li>RHEL 8 has four soft-linked directories under /.
<ol>
<li>bin -&gt; usr/bin</li>
<li>lib -&gt; usr/lib</li>
<li>lib64 -&gt;usr/lib64</li>
<li>sbin -&gt; usr/sbin</li>
</ol>
</li>
<li>Same syntax for creating linked directories</li>
</ul>
<h3 id="ln-command">ln command</h3>
<ul>
<li>Create links between files.</li>
<li>Creates hard link by default.</li>
</ul>
<h3 id="hard-link-file10-and-file20-and-verify-the-inode-number">Hard link file10 and file20 and verify the inode number:</h3>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0"><code>touch file10
ln file10 file20
ls -li</code></pre></div>
<h4 id="create-a-soft-link-to-file10-called-soft10">Create a soft link to file10 called soft10:</h4>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0"><code>ln -s file10 soft10</code></pre></div>
<h2 id="copying-vs-linking">Copying vs linking</h2>
<p>Copying</p>
<ul>
<li>Duplicates source file.</li>
<li>Each copy stores data at a unique location.</li>
<li>Each copied file has a unique inode number and unique metadata.</li>
<li>If a copy is moved, erased, or renamed, the source file will have no impact, and vice versa.</li>
<li>Copy is used when the data needs to be edited independent of the other.</li>
<li>Permissions on the source and the copy are managed independent of each other.</li>
</ul>
<p>Linking</p>
<ul>
<li>Creates a shortcut that points to the source file.</li>
<li>Source can be accessed or modified using either the source file or the link.</li>
<li>All linked files point to the same data.</li>
<li>Hard Link: All hard-linked files share the same inode number, and hence the metadata.</li>
<li>Symlink: Each symlinked file has a unique inode number, but the inode number stores only the pathname to the source.</li>
<li>Hard Link: If the hard link is weeded out, the other file and the data will remain untouched.</li>
<li>Symlink: If the source is deleted, the soft link will be broken and become meaningless. If the soft link is removed, the source will have no impact.</li>
<li>Links are used when access to the same source is required from multiple locations.</li>
<li>Permissions are managed on the source file.</li>
</ul>
<h2 id="labs">Labs</h2>
<h3 id="lab-viewing-regular-file-information">Lab: Viewing regular file information:</h3>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0"><code>touch file1
ls -l</code></pre></div>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0"><code>file file1</code></pre></div>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0"><code>stat file1</code></pre></div>
<h3 id="lab-create-and-manage-hard-links">Lab Create and Manage Hard Links</h3>
<ol>
<li>Create an empty file /tmp/hard1, and display the long file listing including the inode number:</li>
</ol>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0"><code>touch /tmp/hard1
ls -li /tmp/hard1</code></pre></div>
<ol start="2">
<li>Create two hard links called hard2 and hard3 under /tmp, and display the long listing:</li>
</ol>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0"><code>ln /tmp/hard1 /tmp/hard2
ln /tmp/hard1 /tmp/hard3
ls -li /tmp/hard*</code></pre></div>
<ol start="3">
<li>Edit file hard2 and add some random text. Display the long listing for all three files again:</li>
</ol>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0"><code>vim /tmp/hard2
ls -li /tmp/hard*</code></pre></div>
<ol start="4">
<li>Erase file hard1 and hard3, and display the long listing for the remaining file:</li>
</ol>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0"><code>rm -f /tmp/hard1 /tmp/hard3
ls -li /tmp/hard*</code></pre></div>
<h3 id="lab-create-and-manage-soft-links">Lab: Create and Manage Soft Links</h3>
<ol>
<li>Create soft link /root/soft1 pointing to /tmp/hard2, and display the long file listing for both:</li>
</ol>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0"><code>sudo ln -s /tmp/hard2 /root/soft1
ls -li /tmp/hard2 /root/soft1
sudo ls -li /tmp/hard2 /root/soft1</code></pre></div>
<p>2.Edit soft1 and display the long listing again:</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0"><code>sudo vim /root/soft1
sudo ls -li /tmp/hard2 /root/soft1</code></pre></div>
<p>3.Remove hard2 and display the long listing:</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0"><code>sudo ls -li /tmp/hard2 /root/soft1</code></pre></div>
<p>remove the soft link</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0"><code>rm -f /root/soft1.</code></pre></div>
<h3 id="lab-archive-list-and-restore-files">Lab: Archive, List, and Restore Files</h3>
<p>Create a gzip-compressed archive of the /etc directory.</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0"><code>tar -czf etc.tar.gz /etc</code></pre></div>
<p>Create a bzip2-compressed archive of the /etc directory.</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0"><code>sudo tar -cjf etc.tar.bz2 /etc</code></pre></div>
<p>Compare the file sizes of the two archives.</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0"><code>ls -l etc*</code></pre></div>
<p>Run the tar command and uncompress and restore both archives without  specifying the compression tool used.</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0"><code>sudo tar -xf etc.tar.bz2 ; sudo tar -xf etc.tar.gz</code></pre></div>
<h3 id="lab-practice-the-vim-editor">Lab: Practice the vim Editor</h3>
<p>As user1 on server1, create a file called vipractice in the home directory using vim. Type (do not copy and paste) each sentence from Lab 3-1 on a separate line (do not worry about line wrapping). Save the file and quit the editor.</p>
<h4 id="open-vipractice-in-vim-again-and-reveal-line-numbering-copy-lines-2-and-3-to-the-end-of-the-file-to-make-the-total-number-of-lines-in-the-file-to-6">Open vipractice in vim again and reveal line numbering. Copy lines 2 and 3 to the end of the file to make the total number of lines in the file to 6.</h4>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0"><code>:set number!
#then
yy and p</code></pre></div>
<h4 id="move-line-3-to-make-it-line-1">Move line 3 to make it line 1.</h4>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0"><code>3m0</code></pre></div>
<h4 id="go-to-the-last-line-and-append-the-contents-of-the-bash_profile">Go to the last line and append the contents of the .bash_profile.</h4>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0"><code>:r ~/.bashrc</code></pre></div>
<h4 id="substitute-all-occurrences-of-the-string-profile-with-pro-file-and-all-occurrences-of-the-string-profile-with-pro-file">Substitute all occurrences of the string ‚ÄúProfile‚Äù with ‚ÄúPro File‚Äù, and all occurrences of the string ‚Äúprofile‚Äù with ‚Äúpro file‚Äù.</h4>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0"><code>:%s/profile/pro file/gi</code></pre></div>
<h4 id="erase-lines-5-to-8">Erase lines 5 to 8.</h4>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0"><code>:5,8d</code></pre></div>
<p>Provide a count of lines, words, and characters in the vipractice file using the wc command.</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0"><code>wc vipractice</code></pre></div>
<h3 id="lab-file-and-directory-operations">Lab: File and Directory Operations</h3>
<p>As user1 on server1, create one file and one directory in the home directory.</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0"><code>touch file3
mkdir dir5</code></pre></div>
<p>List the file and directory and observe the permissions, ownership, and owning group.</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0"><code>ls -l file3
ls -l dir5
ls -ld dir5</code></pre></div>
<p>Try to move the file and the directory to the /var/log directory and notice what happens.</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0"><code>mv dir5 /var/log
mv file3 /var/log</code></pre></div>
<p>Try again to move them to the /tmp directory.</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0"><code>mv dir5 /tmp
ls /tmp</code></pre></div>
<p>Duplicate the file with the cp command, and then rename the duplicated file using any name.</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0"><code>cp /tmp/file3 file4
ls /tmp
ls</code></pre></div>
<p>Erase the file and directory created for this lab.</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0"><code>rm -d /tmp/dir5; rm file4</code></pre></div>

  <footer class="footline">
  </footer>
</article>
          </section>
<article class="default">
  <header class="headline">
  </header>

<h1 id="security-enhanced-linux">Security Enhanced Linux</h1>

<h2 id="selinux-terminology">SELinux Terminology</h2>
<ul>
<li>
<p>Implementation of the Mandatory Access Control (MAC) architecture</p>
<ul>
<li>developed by the U.S. National Security Agency (NSA)</li>
<li>flexible, enriched, and granular security controls in Linux.</li>
<li>integrated into the Linux kernel as a set of patches using the Linux Security Modules (LSM) framework
<ul>
<li>allows the kernel to support various security implementations</li>
</ul>
</li>
<li>provides an added layer of protection above and beyond the standard Linux Discretionary Access Control (DAC) security architecture.</li>
<li>DAC includes:
<ul>
<li>traditional file and directory permissions</li>
<li>extended attribute settings</li>
<li>setuid/setgid bits</li>
<li>su/sudo privileges</li>
<li>etc.</li>
</ul>
</li>
<li>Limits the ability of a <strong>subject</strong> (Linux user or process) to access an <strong>object</strong> (file, directory, file system, device, network interface/connection, port, pipe, socket, etc.)
<ul>
<li>To reduce or eliminate the potential damage the subject may be able to inflict on the system if compromised.</li>
</ul>
</li>
</ul>
</li>
<li>
<p><strong>MAC controls</strong></p>
<ul>
<li>Fine-grained</li>
<li>Protect other services in the event one service is negotiated.</li>
<li>Example:
<ul>
<li>If the HTTP service process is compromised, the attacker can only damage the files the hacked process will have access to, and not the other processes running on the system, or the objects the other processes will have access to.</li>
</ul>
</li>
<li>To ensure this coarse-grained control, MAC uses a set of defined authorization rules called <strong>policy</strong> to examine security attributes associated with subjects and objects when a subject tries to access an object, and decides whether to permit the access attempt.</li>
<li>These attributes are stored in <strong>contexts</strong> (a.k.a. <strong>labels</strong>), and are applied to both subjects and objects.</li>
</ul>
</li>
<li>
<p>SELinux decisions are stored in a special cache area called <strong>Access</strong> <strong>Vector Cache</strong> (<strong>AVC</strong>).</p>
</li>
<li>
<p>This cache area is checked for each access attempt by a process to determine whether the access attempt was previously allowed.</p>
</li>
<li>
<p>With this mechanism in place, SELinux does not have to check the policy ruleset repeatedly, thus improving performance.</p>
</li>
<li>
<p>SELinux is enabled by default</p>
<ul>
<li>Confines processes to the bare minimum privileges that they need to function.</li>
</ul>
</li>
</ul>
<h3 id="key-terms">Key Terms</h3>
<p><strong>Subject</strong></p>
<ul>
<li>Any user or process that accesses an object.</li>
<li>Examples:
<ul>
<li><em>system_u</em> for the SELinux system user</li>
<li><em>unconfined_u</em> for subjects that are not bound by the SELinux policy</li>
</ul>
</li>
<li>Stored in field 1 of the context.</li>
</ul>
<p><strong>Object</strong></p>
<ul>
<li>A resource, such as a file, directory, hardware device, network interface/connection, port, pipe, or socket, that a subject accesses.</li>
<li>Examples:
<ul>
<li><em>object_r</em> for general objects</li>
<li><em>system_r</em> for system-owned objects</li>
<li><em>unconfined_r</em> for objects that are not bound by the SELinux policy.</li>
</ul>
</li>
</ul>
<p><strong>Access</strong></p>
<ul>
<li>An action performed by the subject on an object.</li>
<li>Examples:
<ul>
<li>creating, reading, or updating a file</li>
<li>creating or navigating a directory</li>
<li>accessing a network port or socket</li>
</ul>
</li>
</ul>
<p><strong>Policy</strong></p>
<ul>
<li>A defined ruleset that is enforced system-wide</li>
<li>Used to analyze security attributes assigned to subjects and objects.</li>
<li>Referenced to decide whether to permit a subject&rsquo;s access attempt to an object, or a subject&rsquo;s attempt to interact with another subject.</li>
<li>The default behavior of SELinux in the absence of a rule is to deny the access.</li>
<li>Standard preconfigured policies:
<ul>
<li><strong>targeted</strong> (default)
<ul>
<li>Any process that is targeted runs in a confined domain</li>
<li>Any process that is not targeted runs in an unconfined domain.</li>
<li>Example:
<ul>
<li>SELinux runs logged-in users in the unconfined domain, and the httpd process in a confined domain by default.</li>
<li>Any subject running unconfined is more vulnerable than the one running confined.</li>
</ul>
</li>
</ul>
</li>
<li><strong>mls</strong>
<ul>
<li>Places tight security controls at deeper levels.</li>
</ul>
</li>
<li><strong>minimum</strong>
<ul>
<li>light version of the targeted policy</li>
<li>designed to protect only selected processes.</li>
</ul>
</li>
</ul>
</li>
</ul>
<p><strong>Context</strong> (label)</p>
<ul>
<li>A tag to store security attributes for subjects and objects.</li>
<li>Every subject and object has a context assigned</li>
<li>Consists of a SELinux user, role, type (or domain), and sensitivity level.</li>
<li>Used by SELinux  to make access control decisions.</li>
</ul>
<p><strong>Labeling</strong></p>
<ul>
<li>Mapping of files with their stored contexts.</li>
</ul>
<p><strong>SELinux User</strong></p>
<ul>
<li>Several predefined SELinux user identities that are authorized for a particular set of roles.</li>
<li>Linux user to SELinux user identity mapping to place SELinux user restrictions on Linux users.</li>
<li>Controls what roles and levels a process (with a particular SELinux user identity) can enter.</li>
<li>Example:
<ul>
<li>A Linux user cannot run the <code>su</code> and <code>sudo</code> commands or the programs located in their home directories if they are mapped to the SELinux user <em>user_u</em>.</li>
</ul>
</li>
</ul>
<p><strong>Role</strong></p>
<ul>
<li>An attribute of the <strong>Role-Based Access Control (RBAC)</strong> security model that is part of SELinux.</li>
<li>Classifies who (subject) is allowed to access what (domains or types).</li>
<li>SELinux users are authorized for roles, and roles are authorized for domains and types.</li>
<li>Each subject has an associated role to ensure that the system and user processes are separated.</li>
<li>A subject can transition into a new role to gain access to other domains and types.</li>
<li>Examples:
<ul>
<li><em>user_r</em> for ordinary users</li>
<li><em>sysadm_r</em> for administrators</li>
<li><em>system_r</em> for processes that initiate under the <em>system_r</em> role</li>
</ul>
</li>
<li>Stored in field 2 of the context.</li>
</ul>
<p><strong>Type Enforcement</strong> (TE)</p>
<ul>
<li>Identifies and limits a subject&rsquo;s ability to access domains for processes, and types for files.</li>
<li>References the contexts of the subjects and objects for this enforcement.</li>
</ul>
<p><strong>Type</strong></p>
<ul>
<li>Attribute of type enforcement.</li>
<li>Group of objects based on uniformity in their security requirements.</li>
<li>Objects such as files and directories with common security requirements, are grouped within a specific type.</li>
<li>Examples:
<ul>
<li><em>user_home_dir_t</em> for objects located in user home directories</li>
<li><em>usr_t</em> for most objects stored in the /usr directory.</li>
</ul>
</li>
<li>Stored in field 3 of a file context.</li>
</ul>
<p><strong>Domain</strong></p>
<ul>
<li>Determines the type of access that a process has.</li>
<li>Processes with common security requirements are grouped within a specific domain type, and they run confined within that domain.</li>
<li>Examples:
<ul>
<li><em>init_t</em> for the systemd process</li>
<li><em>firewalld_t</em> for the firewalld process</li>
<li><em>unconfined_t</em> for all processes that are not bound by SELinux policy.</li>
</ul>
</li>
<li>Stored in field 3 of a process context.</li>
</ul>
<p><strong>Rules</strong></p>
<ul>
<li>Outline how types can access each other, domains can access types, and domains can access each other.</li>
</ul>
<p><strong>Level</strong></p>
<ul>
<li>An attribute of <strong>Multi-Level Security (MLS)</strong> and <strong>Multi-Category</strong> <strong>Security (MCS)</strong>.</li>
<li>Pair of <em>sensitivity:category</em> values that defines the level of security in the context.</li>
<li><em>category</em> may be defined as a single value or a range of values, such as c0.c4 to represent c0 through c4.</li>
<li>In RHEL 9, the targeted policy is used as the default, which enforces <strong>MCS</strong> (MCS supports only one sensitivity level (s0) with 0 to 1023 different categories).</li>
</ul>
<h2 id="selinux-contexts">SELinux Contexts</h2>
<h3 id="selinux-contexts-for-users">SELinux Contexts for Users</h3>
<ul>
<li>SELinux contexts define security attributes placed on subjects and objects.</li>
<li>Each context contains a type and a security level with subject and object information.</li>
</ul>
<p>Use the <code>id</code> command with the <code>-Z</code> option to view the context set on Linux users:</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#ff6ac1">[</span>root@server30 ~<span style="color:#ff6ac1">]</span><span style="color:#78787e"># id -Z</span>
</span></span><span style="display:flex;"><span>unconfined_u:unconfined_r:unconfined_t:s0-s0:c0.c1023</span></span></code></pre></div>
<p>Output:</p>
<ul>
<li>
<p>Mapped to the SELinux unconfined_u user</p>
</li>
<li>
<p>No SELinux restrictions placed on this user.</p>
</li>
<li>
<p>All Linux users, including root, run unconfined by default, (full system access)</p>
</li>
<li>
<p>Seven confined user identities with restricted access to objects.</p>
<ul>
<li>Mapped to Linux users via SELinux policy.</li>
<li>Helps safeguard the system from potential damage that Linux users might inflict on the system.</li>
</ul>
</li>
</ul>
<p>Use the <code>seinfo</code> query command to list the SELinux users; however, the <code>setools-console</code> software package must be installed before doing so.</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#ff6ac1">[</span>root@server30 ~<span style="color:#ff6ac1">]</span><span style="color:#78787e"># seinfo -u</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Users: <span style="color:#ff9f43">8</span>
</span></span><span style="display:flex;"><span>   guest_u
</span></span><span style="display:flex;"><span>   root
</span></span><span style="display:flex;"><span>   staff_u
</span></span><span style="display:flex;"><span>   sysadm_u
</span></span><span style="display:flex;"><span>   system_u
</span></span><span style="display:flex;"><span>   unconfined_u
</span></span><span style="display:flex;"><span>   user_u
</span></span><span style="display:flex;"><span>   xguest_u</span></span></code></pre></div>
<p>Use the <code>semanage</code> command to view the mapping between Linux and SELinux users:</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#ff6ac1">[</span>root@server30 ~<span style="color:#ff6ac1">]</span><span style="color:#78787e"># semanage login -l</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Login Name           SELinux User         MLS/MCS Range        Service
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>__default__          unconfined_u         s0-s0:c0.c1023       *
</span></span><span style="display:flex;"><span>root                 unconfined_u         s0-s0:c0.c1023       *</span></span></code></pre></div>
<p><strong>MLS/MCS Range</strong></p>
<ul>
<li>Associated security level and the context for the Linux user (the * represents all services).</li>
<li>By default, all non-root Linux users are represented as <code>__default__</code>, which is mapped to the unconfined_u user in the policy.</li>
</ul>
<h3 id="selinux-contexts-for-processes">SELinux Contexts for Processes</h3>
<p>Determine the context for processes using the <code>ps</code> command with the <code>-Z</code> flag:</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#ff6ac1">[</span>root@server30 ~<span style="color:#ff6ac1">]</span><span style="color:#78787e"># ps -eZ | head -2</span>
</span></span><span style="display:flex;"><span>LABEL                               PID TTY          TIME CMD
</span></span><span style="display:flex;"><span>system_u:system_r:init_t:s0           <span style="color:#ff9f43">1</span> ?        00:00:02 systemd</span></span></code></pre></div>
<p>Output:</p>
<ul>
<li>
<p>The subject <em>system_u</em> is a SELinux username (mapped to Linux user root)</p>
</li>
<li>
<p>Object is <em>system_r</em></p>
</li>
<li>
<p>Domain <em>init_t</em> reveals the type of protection applied to the process.</p>
</li>
<li>
<p>Level of security <code>s0</code></p>
</li>
<li>
<p>A process that is unprotected will run in the unconfined_t domain.</p>
</li>
</ul>
<h3 id="selinux-contexts-for-files">SELinux Contexts for Files</h3>
<p><code>ls -Z</code></p>
<ul>
<li>View context for files and directories.</li>
</ul>
<p>Show the four attributes set on the /etc/passwd file:</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#ff6ac1">[</span>root@server30 ~<span style="color:#ff6ac1">]</span><span style="color:#78787e"># ls -lZ /etc/passwd</span>
</span></span><span style="display:flex;"><span>-rw-r--r--. <span style="color:#ff9f43">1</span> root root system_u:object_r:passwd_file_t:s0 <span style="color:#ff9f43">2806</span> Jul <span style="color:#ff9f43">19</span> 21:54 /etc/passwd</span></span></code></pre></div>
<ul>
<li>Subject <em>system_u</em></li>
<li>Object <em>object_r</em></li>
<li>Type <code>passwd_file_t</code></li>
<li>Security level <code>s0</code> for the passwd file.</li>
</ul>
<p><em>/etc/selinux/targeted/contexts/files/file_contexts</em>
<em>/etc/selinux/targeted/contexts/files/file_contexts.local</em></p>
<ul>
<li>Stores contexts for system-installed and user-created files.</li>
<li>Policy files.</li>
<li>Can be updated using the <code>semanage</code> command.</li>
</ul>
<h3 id="copying-moving-and-archiving-files-with-selinux-contexts">Copying, Moving, and Archiving Files with SELinux Contexts</h3>
<ul>
<li>All files in RHEL are labeled with an SELINUX security context by default.</li>
<li>New files inherit the parent directory&rsquo;s context at the time of creation.</li>
</ul>
<p>Rules for copy move and archive:</p>
<ol>
<li>
<p>If a file is copied to a different directory, the destination file will receive the destination directory&rsquo;s context, unless the <code>--preserve=context</code> switch is specified with the <code>cp</code> command to retain the source file&rsquo;s original context.</p>
</li>
<li>
<p>If a copy operation overwrites the destination file in the same or different directory, the file being copied will receive the context of the overwritten file, unless the <code>--preserve=context</code> switch is specified with the <code>cp</code> command to preserve the source file&rsquo;s original context.</p>
</li>
<li>
<p>If a file is moved to the same or different directory, the SELinux context will remain intact, which may differ from the destination directory&rsquo;s context.</p>
</li>
<li>
<p>If a file is archived with the tar command, use the <code>--selinux</code> option to preserve the context.</p>
</li>
</ol>
<h3 id="selinux-contexts-for-ports">SELinux Contexts for Ports</h3>
<p>View attributes for network ports with the <code>semanage</code> command:</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#ff6ac1">[</span>root@server30 ~<span style="color:#ff6ac1">]</span><span style="color:#78787e"># semanage port -l | head -7</span>
</span></span><span style="display:flex;"><span>SELinux Port Type              Proto    Port Number
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>afs3_callback_port_t           tcp      <span style="color:#ff9f43">7001</span>
</span></span><span style="display:flex;"><span>afs3_callback_port_t           udp      <span style="color:#ff9f43">7001</span>
</span></span><span style="display:flex;"><span>afs_bos_port_t                 udp      <span style="color:#ff9f43">7007</span>
</span></span><span style="display:flex;"><span>afs_fs_port_t                  tcp      <span style="color:#ff9f43">2040</span>
</span></span><span style="display:flex;"><span>afs_fs_port_t                  udp      7000, <span style="color:#ff9f43">7005</span></span></span></code></pre></div>
<ul>
<li>By default, SELinux allows services to listen on a restricted set of network ports only.</li>
</ul>
<h2 id="domain-transitioning">Domain Transitioning</h2>
<ul>
<li>SELinux allows a process running in one domain to enter another domain to execute an application that is restricted to run in that domain only.</li>
<li>A rule must exist in the policy to support such transition.</li>
<li><strong>entrypoint</strong>
<ul>
<li>Permission setting</li>
<li>Control processes that can transition into another domain.</li>
</ul>
</li>
</ul>
<p>Example:
What happens when a Linux user attempts to change their password using the <code>/usr/bin/passwd</code> command.</p>
<p>The <code>passwd</code> command is labeled with the passwd_exec_t type:</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#ff6ac1">[</span>root@server30 ~<span style="color:#ff6ac1">]</span><span style="color:#78787e"># ls -lZ /usr/bin/passwd</span>
</span></span><span style="display:flex;"><span>-rwsr-xr-x. <span style="color:#ff9f43">1</span> root root system_u:object_r:passwd_exec_t:s0 <span style="color:#ff9f43">32648</span> Aug <span style="color:#ff9f43">10</span>  <span style="color:#ff9f43">2021</span> /usr/bin/passwd</span></span></code></pre></div>
<p>The <code>passwd</code> command requires access to the <code>/etc/shadow</code> file in order to modify a user password. The shadow file has a different type set on it
(<em>shadow_t</em>):</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>**<span style="color:#ff6ac1">[</span>root@server30 ~<span style="color:#ff6ac1">]</span><span style="color:#78787e"># ls -lZ /etc/shadow</span>
</span></span><span style="display:flex;"><span>----------. <span style="color:#ff9f43">1</span> root root system_u:object_r:shadow_t:s0 <span style="color:#ff9f43">2756</span> Jul <span style="color:#ff9f43">19</span> 21:54 /etc/shadow</span></span></code></pre></div>
<ul>
<li>The SELinux policy has rules that specifically allow processes running in domain <em>passwd_t</em> to read and modify the files with type <em>shadow_t</em>, and allow them <strong>entrypoint</strong> permission into domain <em>passwd_exec_t</em>.</li>
<li>This rule enables the user&rsquo;s shell process executing the <code>passwd</code> command to switch into the <em>passwd_t</em> domain and update the shadow file.</li>
</ul>
<p>Open two terminal windows. In window 1, issue the passwd command as
user1 and wait at the prompt:</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#ff6ac1">[</span>user1@server30 root<span style="color:#ff6ac1">]</span>$ passwd
</span></span><span style="display:flex;"><span>Changing password <span style="color:#ff6ac1">for</span> user user1.
</span></span><span style="display:flex;"><span>Current password: </span></span></code></pre></div>
<p>In window 2, run the ps command:</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#ff6ac1">[</span>root@server30 ~<span style="color:#ff6ac1">]</span><span style="color:#78787e"># ps -eZ | grep passwd</span>
</span></span><span style="display:flex;"><span>unconfined_u:unconfined_r:passwd_t:s0-s0:c0.c1023 <span style="color:#ff9f43">13001</span> pts/1 00:00:00 passwd</span></span></code></pre></div>
<ul>
<li>The <code>passwd</code> command (process) transitioned into the <em>passwd_t</em> domain to change the user password.</li>
</ul>
<h2 id="selinux-booleans">SELinux Booleans</h2>
<ul>
<li>on/off switches that SELinux uses to determine whether to permit an action.</li>
<li>Activate or deactivate certain rule in the SELinux policy immediately and without the need to recompile or reload the policy.</li>
<li>For instance, the <em>ftpd_anon_write</em> Boolean can be turned on to enable anonymous users to upload files.</li>
<li>This privilege can be revoked by turning this Boolean off.</li>
<li>Boolean values are stored in virtual files located in <em>/sys/fs/selinux/booleans/</em>.</li>
<li>The filenames match the Boolean names.</li>
</ul>
<p>A sample listing of this directory is provided below:</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#ff6ac1">[</span>root@server30 ~<span style="color:#ff6ac1">]</span><span style="color:#78787e"># ls -l /sys/fs/selinux/booleans/ | head -7</span>
</span></span><span style="display:flex;"><span>total <span style="color:#ff9f43">0</span>
</span></span><span style="display:flex;"><span>-rw-r--r--. <span style="color:#ff9f43">1</span> root root <span style="color:#ff9f43">0</span> Jul <span style="color:#ff9f43">23</span> 04:44 abrt_anon_write
</span></span><span style="display:flex;"><span>-rw-r--r--. <span style="color:#ff9f43">1</span> root root <span style="color:#ff9f43">0</span> Jul <span style="color:#ff9f43">23</span> 04:44 abrt_handle_event
</span></span><span style="display:flex;"><span>-rw-r--r--. <span style="color:#ff9f43">1</span> root root <span style="color:#ff9f43">0</span> Jul <span style="color:#ff9f43">23</span> 04:44 abrt_upload_watch_anon_write
</span></span><span style="display:flex;"><span>-rw-r--r--. <span style="color:#ff9f43">1</span> root root <span style="color:#ff9f43">0</span> Jul <span style="color:#ff9f43">23</span> 04:44 antivirus_can_scan_system
</span></span><span style="display:flex;"><span>-rw-r--r--. <span style="color:#ff9f43">1</span> root root <span style="color:#ff9f43">0</span> Jul <span style="color:#ff9f43">23</span> 04:44 antivirus_use_jit
</span></span><span style="display:flex;"><span>-rw-r--r--. <span style="color:#ff9f43">1</span> root root <span style="color:#ff9f43">0</span> Jul <span style="color:#ff9f43">23</span> 04:44 auditadm_exec_content</span></span></code></pre></div>
<ul>
<li>
<p>The manual pages of the Booleans are available through the <code>selinux-policy-doc</code> package.</p>
</li>
<li>
<p>Once installed, use the <code>-K</code> option with the <code>man</code> command to bring the pages up for a specific Boolean.</p>
</li>
<li>
<p>For instance, issue <code>man -K abrt_anon_write</code> to view the manual pages for the <code>abrt_anon_write</code> Boolean.</p>
</li>
<li>
<p>Can be viewed, and flipped temporarily or for permanence.</p>
</li>
<li>
<p>New value takes effect right away.</p>
</li>
<li>
<p>Temporary changes are stored as a &ldquo;1&rdquo; or &ldquo;0&rdquo; in the corresponding Boolean file in the <em>/sys/fs/selinux/booleans/</em></p>
</li>
<li>
<p>Permanent changes are saved in the policy database.</p>
</li>
</ul>
<h2 id="selinux-administration">SELinux Administration</h2>
<ul>
<li>Controlling the activation mode, checking operational status, setting security contexts on subjects and objects, and switching Boolean values.</li>
</ul>
<p>Utilities and the commands they provide</p>
<ul>
<li><code>libselinux-utils</code>
<ul>
<li><code>getenforce</code></li>
<li><code>getsebool</code></li>
</ul>
</li>
<li><code>policycoreutils</code>
<ul>
<li><code>sestatus</code></li>
<li><code>setsebool</code></li>
<li><code>restorecon</code></li>
</ul>
</li>
<li><code>policycoreutils-python-utils</code>
<ul>
<li><code>semanage</code></li>
</ul>
</li>
<li><code>setools-console</code>
<ul>
<li><code>seinfo</code></li>
<li><code>sesearch</code></li>
</ul>
</li>
</ul>
<p><strong>SELinux Alert Browser</strong></p>
<ul>
<li>
<p>Graphical tool for viewing alerts and debugging SELinux issues.</p>
</li>
<li>
<p>Part of the <code>setroubleshoot-server</code> package.</p>
</li>
<li>
<p>In order to fully manage SELinux, you need to ensure that all these packages are installed on the system.</p>
</li>
</ul>
<h3 id="management-commands">Management Commands</h3>
<p>SELinux delivers a variety of commands for effective administration.
Table 20-1 lists and describes the commands mentioned above plus a few more under various management categories.</p>
<p><strong>Mode Management</strong></p>
<p><code>getenforce</code></p>
<ul>
<li>Displays the current mode of operation</li>
</ul>
<p><code>grubby</code></p>
<ul>
<li>Updates and displays information about the configuration files for the grub2 boot loader</li>
</ul>
<p><code>sestatus</code></p>
<ul>
<li>Shows SELinux runtime status and Boolean values</li>
</ul>
<p><code>setenforce</code></p>
<ul>
<li>Switches the operating mode between enforcing and permissive temporarily</li>
</ul>
<p><strong>Context Management</strong></p>
<p><code>chcon</code></p>
<ul>
<li>Changes context on files (changes do not survive file system relabeling)</li>
</ul>
<p><code>restorecon</code></p>
<ul>
<li>Restores default contexts on files by referencing the files in  <em>/etc/selinux/targeted/contexts/files/</em></li>
</ul>
<p><code>semanage </code></p>
<ul>
<li>Changes context on files with the <code>fcontext</code> subcommand (changes survive file system relabeling)</li>
</ul>
<p><strong>Policy Management</strong></p>
<p><code>seinfo </code></p>
<ul>
<li>Provides information on policy components</li>
</ul>
<p><code>semanage</code></p>
<ul>
<li>Manages policy database</li>
</ul>
<p><code>sesearch</code></p>
<ul>
<li>Searches rules in the policy database</li>
</ul>
<p><strong>Boolean Management</strong></p>
<p><code>getsebool</code></p>
<ul>
<li>Displays Booleans and their current settings.</li>
</ul>
<p><code>setsebool</code></p>
<ul>
<li>Modifies Boolean values temporarily, or in the policy database.</li>
</ul>
<p><code>semanage</code></p>
<ul>
<li>Modifies Boolean values in the policy database with the <code>boolean</code>subcommand.</li>
</ul>
<p><strong>Troubleshooting</strong></p>
<p><code>sealert</code></p>
<ul>
<li>The graphical troubleshooting tool</li>
</ul>
<h3 id="viewing-and-controlling-selinux-operational-state">Viewing and Controlling SELinux Operational State</h3>
<p><em>/etc/selinux/config</em></p>
<ul>
<li>One of the key configuration files that controls the SELinux operational state, and sets its default type</li>
</ul>
<p>The default content of the file is displayed below:</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#ff6ac1">[</span>root@server30 ~<span style="color:#ff6ac1">]</span><span style="color:#78787e"># cat /etc/selinux/config</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#78787e"># This file controls the state of SELinux on the system.</span>
</span></span><span style="display:flex;"><span><span style="color:#78787e"># SELINUX= can take one of these three values:</span>
</span></span><span style="display:flex;"><span><span style="color:#78787e">#     enforcing - SELinux security policy is enforced.</span>
</span></span><span style="display:flex;"><span><span style="color:#78787e">#     permissive - SELinux prints warnings instead of enforcing.</span>
</span></span><span style="display:flex;"><span><span style="color:#78787e">#     disabled - No SELinux policy is loaded.</span>
</span></span><span style="display:flex;"><span><span style="color:#78787e"># See also:</span>
</span></span><span style="display:flex;"><span><span style="color:#78787e"># https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/9/html/using_selinux/changing-selinux-states-and-modes_using-selinux#changing-selinux-modes-at-boot-time_changing-selinux-states-and-modes</span>
</span></span><span style="display:flex;"><span><span style="color:#78787e">#</span>
</span></span><span style="display:flex;"><span><span style="color:#78787e"># NOTE: Up to RHEL 8 release included, SELINUX=disabled would also</span>
</span></span><span style="display:flex;"><span><span style="color:#78787e"># fully disable SELinux during boot. If you need a system with SELinux</span>
</span></span><span style="display:flex;"><span><span style="color:#78787e"># fully disabled instead of SELinux running with no policy loaded, you</span>
</span></span><span style="display:flex;"><span><span style="color:#78787e"># need to pass selinux=0 to the kernel command line. You can use grubby</span>
</span></span><span style="display:flex;"><span><span style="color:#78787e"># to persistently set the bootloader to boot with selinux=0:</span>
</span></span><span style="display:flex;"><span><span style="color:#78787e">#</span>
</span></span><span style="display:flex;"><span><span style="color:#78787e">#    grubby --update-kernel ALL --args selinux=0</span>
</span></span><span style="display:flex;"><span><span style="color:#78787e">#</span>
</span></span><span style="display:flex;"><span><span style="color:#78787e"># To revert back to SELinux enabled:</span>
</span></span><span style="display:flex;"><span><span style="color:#78787e">#</span>
</span></span><span style="display:flex;"><span><span style="color:#78787e">#    grubby --update-kernel ALL --remove-args selinux</span>
</span></span><span style="display:flex;"><span><span style="color:#78787e">#</span>
</span></span><span style="display:flex;"><span><span style="color:#ff5c57">SELINUX</span><span style="color:#ff6ac1">=</span>enforcing
</span></span><span style="display:flex;"><span><span style="color:#78787e"># SELINUXTYPE= can take one of these three values:</span>
</span></span><span style="display:flex;"><span><span style="color:#78787e">#     targeted - Targeted processes are protected,</span>
</span></span><span style="display:flex;"><span><span style="color:#78787e">#     minimum - Modification of targeted policy. Only selected processes are protected.</span>
</span></span><span style="display:flex;"><span><span style="color:#78787e">#     mls - Multi Level Security protection.</span>
</span></span><span style="display:flex;"><span><span style="color:#ff5c57">SELINUXTYPE</span><span style="color:#ff6ac1">=</span>targeted</span></span></code></pre></div>
<p>Directives:</p>
<p><strong>SELINUX</strong></p>
<ul>
<li>Sets the activation mode for SELinux.</li>
<li><em>Enforcing</em> activates it and allows or denies actions based on the policy rules.</li>
<li><em>Permissive</em> activates SELinux, but permits all actions.
<ul>
<li>It records all security violations.</li>
<li>Useful for troubleshooting and developing or tuning the policy.</li>
</ul>
</li>
<li>The third option is to completely turn SELinux off. When running in enforcing mode</li>
</ul>
<p><strong>SELINUXTYPE</strong></p>
<ul>
<li>Dictates the type of policy to be enforced.</li>
<li>Default is targeted.</li>
</ul>
<p>Determine the current operating mode:
<code>getenforce</code></p>
<p>Change the state to permissive and verify:</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#ff6ac1">[</span>root@server30 ~<span style="color:#ff6ac1">]</span><span style="color:#78787e"># setenforce permissive</span>
</span></span><span style="display:flex;"><span><span style="color:#ff6ac1">[</span>root@server30 ~<span style="color:#ff6ac1">]</span><span style="color:#78787e"># getenforce</span>
</span></span><span style="display:flex;"><span>Permissive</span></span></code></pre></div>
<ul>
<li>Can also &ldquo;0&rdquo; for permissive and a &ldquo;1&rdquo; for enforcing.</li>
<li>Changes will be lost at the next system reboot.</li>
<li>Edit  <em>/etc/selinux/config</em> <strong>SELINUX</strong> directive to the desired mode for persistence.</li>
</ul>
<p>EXAM TIP: You may switch SELinux to permissive for troubleshooting a
non-functioning service. Don&rsquo;t forget to change it back to enforcing
when the issue is resolved.</p>
<p>Disable SELinux persistently:
<code>grubby --update-kernel ALL --args selinux=0</code></p>
<ul>
<li>Appends the selinux=0 setting to the end of the &ldquo;options&rdquo; line in the bootloader configuration file located in the /boot/loader/entries directory:</li>
</ul>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>cat /boot/loader/entries/dcb323fab47049e8b89dae2ae00d41e8-5.14.0-427.26.1.el9_4.x86_64.conf </span></span></code></pre></div>
<p>Revert the above:
<code>grubby --update-kernel ALL --remove-args selinux=0</code></p>
<h3 id="querying-status">Querying Status</h3>
<p><code>sestatus</code> Command</p>
<ul>
<li>View the current runtime status of SELinux</li>
<li>Displays the location of principal directories, the policy in effect, and the activation mode.</li>
</ul>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#ff6ac1">[</span>root@server30 ~<span style="color:#ff6ac1">]</span><span style="color:#78787e"># sestatus</span>
</span></span><span style="display:flex;"><span>SELinux status:                 enabled
</span></span><span style="display:flex;"><span>SELinuxfs mount:                /sys/fs/selinux
</span></span><span style="display:flex;"><span>SELinux root directory:         /etc/selinux
</span></span><span style="display:flex;"><span>Loaded policy name:             targeted
</span></span><span style="display:flex;"><span>Current mode:                   permissive
</span></span><span style="display:flex;"><span>Mode from config file:          enforcing
</span></span><span style="display:flex;"><span>Policy MLS status:              enabled
</span></span><span style="display:flex;"><span>Policy deny_unknown status:     allowed
</span></span><span style="display:flex;"><span>Memory protection checking:     actual <span style="color:#ff6ac1">(</span>secure<span style="color:#ff6ac1">)</span>
</span></span><span style="display:flex;"><span>Max kernel policy version:      <span style="color:#ff9f43">33</span></span></span></code></pre></div>
<p><code>-v </code></p>
<ul>
<li>Report on security contexts set on files and processes, as listed in <em>/etc/sestatus.conf</em> .</li>
<li>Reports the contexts for the current process (Current context) and the init (systemd) process (Init context) under Process Contexts.</li>
<li>Reveals the file contexts for the controlling terminal and associated files under File Contexts.</li>
</ul>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#ff6ac1">[</span>root@server30 ~<span style="color:#ff6ac1">]</span><span style="color:#78787e"># cat /etc/sestatus.conf</span>
</span></span><span style="display:flex;"><span><span style="color:#ff6ac1">[</span>files<span style="color:#ff6ac1">]</span>
</span></span><span style="display:flex;"><span>/etc/passwd
</span></span><span style="display:flex;"><span>/etc/shadow
</span></span><span style="display:flex;"><span>/bin/bash
</span></span><span style="display:flex;"><span>/bin/login
</span></span><span style="display:flex;"><span>/bin/sh
</span></span><span style="display:flex;"><span>/sbin/agetty
</span></span><span style="display:flex;"><span>/sbin/init
</span></span><span style="display:flex;"><span>/sbin/mingetty
</span></span><span style="display:flex;"><span>/usr/sbin/sshd
</span></span><span style="display:flex;"><span>/lib/libc.so.6
</span></span><span style="display:flex;"><span>/lib/ld-linux.so.2
</span></span><span style="display:flex;"><span>/lib/ld.so.1
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff6ac1">[</span>process<span style="color:#ff6ac1">]</span>
</span></span><span style="display:flex;"><span>/sbin/mingetty
</span></span><span style="display:flex;"><span>/sbin/agetty
</span></span><span style="display:flex;"><span>/usr/sbin/sshd</span></span></code></pre></div>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#ff6ac1">[</span>root@server30 ~<span style="color:#ff6ac1">]</span><span style="color:#78787e"># sestatus -v</span>
</span></span><span style="display:flex;"><span>SELinux status:                 enabled
</span></span><span style="display:flex;"><span>SELinuxfs mount:                /sys/fs/selinux
</span></span><span style="display:flex;"><span>SELinux root directory:         /etc/selinux
</span></span><span style="display:flex;"><span>Loaded policy name:             targeted
</span></span><span style="display:flex;"><span>Current mode:                   permissive
</span></span><span style="display:flex;"><span>Mode from config file:          enforcing
</span></span><span style="display:flex;"><span>Policy MLS status:              enabled
</span></span><span style="display:flex;"><span>Policy deny_unknown status:     allowed
</span></span><span style="display:flex;"><span>Memory protection checking:     actual <span style="color:#ff6ac1">(</span>secure<span style="color:#ff6ac1">)</span>
</span></span><span style="display:flex;"><span>Max kernel policy version:      <span style="color:#ff9f43">33</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Process contexts:
</span></span><span style="display:flex;"><span>Current context:                unconfined_u:unconfined_r:unconfined_t:s0-s0:c0.c1023
</span></span><span style="display:flex;"><span>Init context:                   system_u:system_r:init_t:s0
</span></span><span style="display:flex;"><span>/sbin/agetty                    system_u:system_r:getty_t:s0-s0:c0.c1023
</span></span><span style="display:flex;"><span>/usr/sbin/sshd                  system_u:system_r:sshd_t:s0-s0:c0.c1023
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>File contexts:
</span></span><span style="display:flex;"><span>Controlling terminal:           unconfined_u:object_r:user_devpts_t:s0
</span></span><span style="display:flex;"><span>/etc/passwd                     system_u:object_r:passwd_file_t:s0
</span></span><span style="display:flex;"><span>/etc/shadow                     system_u:object_r:shadow_t:s0
</span></span><span style="display:flex;"><span>/bin/bash                       system_u:object_r:shell_exec_t:s0
</span></span><span style="display:flex;"><span>/bin/login                      system_u:object_r:login_exec_t:s0
</span></span><span style="display:flex;"><span>/bin/sh                         system_u:object_r:bin_t:s0 -&gt; system_u:object_r:shell_exec_t:s0
</span></span><span style="display:flex;"><span>/sbin/agetty                    system_u:object_r:getty_exec_t:s0
</span></span><span style="display:flex;"><span>/sbin/init                      system_u:object_r:bin_t:s0 -&gt; system_u:object_r:init_exec_t:s0
</span></span><span style="display:flex;"><span>/usr/sbin/sshd                  system_u:object_r:sshd_exec_t:s0</span></span></code></pre></div>
<h3 id="lab-modify-selinux-file-context">Lab: Modify SELinux File Context</h3>
<ul>
<li>Create a directory sedir1 under /tmp and a file sefile1 under sedir1.</li>
<li>Check the context on the directory and file.</li>
<li>Change the SELinux user and type to user_u and public_content_t on both and verify.</li>
</ul>
<p>1. Create the hierarchy sedir1/sefile1 under /tmp:</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span> <span style="color:#ff6ac1">[</span>root@server30 ~<span style="color:#ff6ac1">]</span><span style="color:#78787e"># cd /tmp</span>
</span></span><span style="display:flex;"><span> <span style="color:#ff6ac1">[</span>root@server30 tmp<span style="color:#ff6ac1">]</span><span style="color:#78787e"># mkdir sedir1</span>
</span></span><span style="display:flex;"><span> <span style="color:#ff6ac1">[</span>root@server30 tmp<span style="color:#ff6ac1">]</span><span style="color:#78787e"># touch sedir1/sefile1</span></span></span></code></pre></div>
<p>2. Determine the context on the new directory and file:</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span> <span style="color:#ff6ac1">[</span>root@server30 tmp<span style="color:#ff6ac1">]</span><span style="color:#78787e"># ls -ldZ sedir1</span>
</span></span><span style="display:flex;"><span> drwxr-xr-x. <span style="color:#ff9f43">2</span> root root  unconfined_u:object_r:user_tmp_t:s0 <span style="color:#ff9f43">21</span> Jul <span style="color:#ff9f43">28</span> 15:12  sedir1 </span></span></code></pre></div>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span> <span style="color:#ff6ac1">[</span>root@server30 tmp<span style="color:#ff6ac1">]</span><span style="color:#78787e"># ls -ldZ sedir1/sefile1</span>
</span></span><span style="display:flex;"><span> -rw-r--r--. <span style="color:#ff9f43">1</span> root root  unconfined_u:object_r:user_tmp_t:s0 <span style="color:#ff9f43">0</span> Jul <span style="color:#ff9f43">28</span> 15:12  sedir1/sefile1</span></span></code></pre></div>
<p>3. Modify the SELinux user (<code>-u</code>) on the directory to <code>user_u</code> and type
(<code>-t</code>) to <code>public_content_t</code> recursively (<code>-R</code>) with the <code>chcon</code> command:</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span> <span style="color:#ff6ac1">[</span>root@server30 tmp<span style="color:#ff6ac1">]</span><span style="color:#78787e"># chcon -vu user_u -t  public_content_t sedir1 -R</span>
</span></span><span style="display:flex;"><span> changing security context of <span style="color:#5af78e">&#39;sedir1/sefile1&#39;</span>
</span></span><span style="display:flex;"><span> changing security context of <span style="color:#5af78e">&#39;sedir1&#39;</span></span></span></code></pre></div>
<p>4. Validate the new context:</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span> <span style="color:#ff6ac1">[</span>root@server30 tmp<span style="color:#ff6ac1">]</span><span style="color:#78787e"># ls -ldZ sedir1</span>
</span></span><span style="display:flex;"><span> drwxr-xr-x. <span style="color:#ff9f43">2</span> root root  user_u:object_r:public_content_t:s0 <span style="color:#ff9f43">21</span> Jul <span style="color:#ff9f43">28</span> 15:12  sedir1</span></span></code></pre></div>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span> <span style="color:#ff6ac1">[</span>root@server30 tmp<span style="color:#ff6ac1">]</span><span style="color:#78787e"># ls -ldZ sedir1/sefile1</span>
</span></span><span style="display:flex;"><span> -rw-r--r--. <span style="color:#ff9f43">1</span> root root  user_u:object_r:public_content_t:s0 <span style="color:#ff9f43">0</span> Jul <span style="color:#ff9f43">28</span> 15:12  sedir1/sefile1</span></span></code></pre></div>
<h3 id="lab-add-and-apply-file-context">Lab: Add and Apply File Context</h3>
<ul>
<li>Add the current context on sedir1 to the SELinux policy database to ensure a relabeling will not reset it to its previous value</li>
<li>Change the context on the directory to some random values.</li>
<li>Restore the default context from the policy database back to the directory recursively.</li>
</ul>
<ol>
<li>Determine the current context:</li>
</ol>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span> <span style="color:#ff6ac1">[</span>root@server30 tmp<span style="color:#ff6ac1">]</span><span style="color:#78787e"># ls -ldZ sedir1</span>
</span></span><span style="display:flex;"><span> drwxr-xr-x. <span style="color:#ff9f43">2</span> root root  user_u:object_r:public_content_t:s0 <span style="color:#ff9f43">21</span> Jul <span style="color:#ff9f43">28</span> 15:12  sedir1</span></span></code></pre></div>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span> <span style="color:#ff6ac1">[</span>root@server30 tmp<span style="color:#ff6ac1">]</span><span style="color:#78787e"># ls -ldZ sedir1/sefile1</span>
</span></span><span style="display:flex;"><span> -rw-r--r--. <span style="color:#ff9f43">1</span> root root  user_u:object_r:public_content_t:s0 <span style="color:#ff9f43">0</span> Jul <span style="color:#ff9f43">28</span> 15:12  sedir1/sefile1</span></span></code></pre></div>
<ol start="2">
<li>Add (-a) the directory recursively to the policy database using the <code>semanage</code> command with the <code>fcontext</code> subcommand:</li>
</ol>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span> <span style="color:#ff6ac1">[</span>root@server30 tmp<span style="color:#ff6ac1">]</span><span style="color:#78787e"># semanage fcontext -a -s user_u -t public_content_t &#34;/tmp/sedir1(/.*)?&#34;</span></span></span></code></pre></div>
<ul>
<li>The regular expression (/.*)? instructs the command to include all files and subdirectories under /tmp/sedir1.
<ul>
<li>Needed only if recursion is required.</li>
</ul>
</li>
</ul>
<p>The above command added the context to the <em>/etc/selinux/targeted/contexts/files/file_contexts.local file</em>.</p>
<ol>
<li>Validate the addition by listing (-l) the recent changes (-C) in the policy database:</li>
</ol>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span> <span style="color:#ff6ac1">[</span>root@server30 tmp<span style="color:#ff6ac1">]</span><span style="color:#78787e"># semanage fcontext -Cl | grep  sedir</span>
</span></span><span style="display:flex;"><span> /tmp/sedir1<span style="color:#ff6ac1">(</span>/.*<span style="color:#ff6ac1">)</span>?                                   all files           user_u:object_r:public_content_t:s0 </span></span></code></pre></div>
<ol start="2">
<li>Change the current context on sedir1 to something random (staff_u/etc_t) with the <code>chcon</code> command:</li>
</ol>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span> root@server30 tmp<span style="color:#ff6ac1">]</span><span style="color:#78787e"># chcon -vu staff_u -t etc_t  sedir1 -R</span>
</span></span><span style="display:flex;"><span> changing security context of <span style="color:#5af78e">&#39;sedir1/sefile1&#39;</span>
</span></span><span style="display:flex;"><span> changing security context of <span style="color:#5af78e">&#39;sedir1&#39;</span></span></span></code></pre></div>
<ol>
<li>The security context is changed successfully. Confirm with the <code>ls</code> command:</li>
</ol>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span> <span style="color:#ff6ac1">[</span>root@server30 tmp<span style="color:#ff6ac1">]</span><span style="color:#78787e"># ls -ldZ sedir1 ; ls -lZ  sedir1/sefile1</span>
</span></span><span style="display:flex;"><span> drwxr-xr-x. <span style="color:#ff9f43">2</span> root root staff_u:object_r:etc_t:s0  <span style="color:#ff9f43">21</span> Jul <span style="color:#ff9f43">28</span> 15:12 sedir1
</span></span><span style="display:flex;"><span> -rw-r--r--. <span style="color:#ff9f43">1</span> root root staff_u:object_r:etc_t:s0 <span style="color:#ff9f43">0</span>  Jul <span style="color:#ff9f43">28</span> 15:12 sedir1/sefile1</span></span></code></pre></div>
<ol>
<li>Reinstate the context on the sedir1 directory recursively (<code>-R</code>) as stored in the policy database using the <code>restorecon</code> command: (-F option will update all attributes, only does type by default. )</li>
</ol>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>$ restorecon -R -v -F sedir1
</span></span><span style="display:flex;"><span>Relabeled /tmp/sedir1 from unconfined_u:object_r:public_content_t:s0 to user_u:object_r:public_content_t:s0
</span></span><span style="display:flex;"><span>Relabeled /tmp/sedir1/sefile1 from unconfined_u:object_r:public_content_t:s0 to user_u:object_r:public_content_t:s0</span></span></code></pre></div>
<h3 id="lab-add-and-delete-network-ports">Lab: Add and Delete Network Ports</h3>
<ul>
<li>Add a non-standard network port 8010 to the SELinux policy database for the httpd service.</li>
<li>Confirm the addition.</li>
<li>Remove the port from the policy and verify the deletion.</li>
</ul>
<ol start="2">
<li>List (<code>-l</code>) the ports for the httpd service as defined in the SELinux policy database:</li>
</ol>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span> <span style="color:#ff6ac1">[</span>root@server10 ~<span style="color:#ff6ac1">]</span><span style="color:#78787e"># semanage port -l | grep ^http_port</span>
</span></span><span style="display:flex;"><span> http_port_t                    tcp      80, 81, 443, 488, 8008, 8009, 8443, <span style="color:#ff9f43">9000</span></span></span></code></pre></div>
<p>The output reveals eight network ports the httpd process is currently allowed to listen on.</p>
<ol>
<li>Add port 8010 with type <code>http_port_t</code> and protocol tcp to the policy:</li>
</ol>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span> <span style="color:#ff6ac1">[</span>root@server10 ~<span style="color:#ff6ac1">]</span><span style="color:#78787e"># semanage port -at http_port_t -p  tcp 8010</span></span></span></code></pre></div>
<ol start="2">
<li>Confirm the addition:</li>
</ol>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span> <span style="color:#ff6ac1">[</span>root@server10 ~<span style="color:#ff6ac1">]</span><span style="color:#78787e"># semanage port -l | grep ^http_port</span>
</span></span><span style="display:flex;"><span> http_port_t                    tcp      8010, 80,  81, 443, 488, 8008, 8009, 8443, <span style="color:#ff9f43">9000</span></span></span></code></pre></div>
<ol>
<li>Delete port <code>8010</code> from the policy and confirm:</li>
</ol>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span> <span style="color:#ff6ac1">[</span>root@server10 ~<span style="color:#ff6ac1">]</span><span style="color:#78787e"># semanage port -dp tcp 8010</span>
</span></span><span style="display:flex;"><span> <span style="color:#ff6ac1">[</span>root@server10 ~<span style="color:#ff6ac1">]</span><span style="color:#78787e"># semanage port -l | grep ^http_port</span>
</span></span><span style="display:flex;"><span> http_port_t                    tcp      80, 81,  443, 488, 8008, 8009, 8443, <span style="color:#ff9f43">9000</span></span></span></code></pre></div>
<p>EXAM TIP: Any non-standard port you want to use for any service, make certain to add it to the SELinux policy database with the correct type.</p>
<h3 id="lab-copy-files-with-and-without-context">Lab: Copy Files with and without Context</h3>
<ul>
<li>Create a file called sefile2 under /tmp and display its context.</li>
<li>Copy this file to the /etc/default directory, and observe the change in the context.</li>
<li>Remove sefile2 from /etc/default, and copy it again to the same destination, ensuring that the target file receives the source file&rsquo;s context.</li>
</ul>
<p>1. Create file sefile2 under /tmp and show context:</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span> <span style="color:#ff6ac1">[</span>root@server10 ~<span style="color:#ff6ac1">]</span><span style="color:#78787e"># touch /tmp/sefile2</span>
</span></span><span style="display:flex;"><span> <span style="color:#ff6ac1">[</span>root@server10 ~<span style="color:#ff6ac1">]</span><span style="color:#78787e"># ls -lZ /tmp/sefile2</span>
</span></span><span style="display:flex;"><span> -rw-r--r--. <span style="color:#ff9f43">1</span> root root  unconfined_u:object_r:user_tmp_t:s0 <span style="color:#ff9f43">0</span> Jul <span style="color:#ff9f43">29</span> 08:44  /tmp/sefile2</span></span></code></pre></div>
<p>2. Copy this file to the /etc/default directory, and check the context again:</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span> <span style="color:#ff6ac1">[</span>root@server10 ~<span style="color:#ff6ac1">]</span><span style="color:#78787e"># cp /tmp/sefile2 /etc/default/</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span> <span style="color:#ff6ac1">[</span>root@server10 ~<span style="color:#ff6ac1">]</span><span style="color:#78787e"># ls -lZ /etc/default/sefile2</span>
</span></span><span style="display:flex;"><span> -rw-r--r--. <span style="color:#ff9f43">1</span> root root  unconfined_u:object_r:etc_t:s0 <span style="color:#ff9f43">0</span> Jul <span style="color:#ff9f43">29</span> 08:45  /etc/default/sefile2</span></span></code></pre></div>
<p>3. Erase the <em>/etc/default/sefile2</em> file, and copy it again with the <code>--preserve=context</code> option:</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span> <span style="color:#ff6ac1">[</span>root@server10 ~<span style="color:#ff6ac1">]</span><span style="color:#78787e"># rm /etc/default/sefile2</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span> <span style="color:#ff6ac1">[</span>root@server10 ~<span style="color:#ff6ac1">]</span><span style="color:#78787e"># cp --preserve=context  /tmp/sefile2 /etc/default</span></span></span></code></pre></div>
<p>4. List the file to view the context:</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span> <span style="color:#ff6ac1">[</span>root@server10 ~<span style="color:#ff6ac1">]</span><span style="color:#78787e"># ls -lZ /etc/default/sefile2</span>
</span></span><span style="display:flex;"><span> -rw-r--r--. <span style="color:#ff9f43">1</span> root root  unconfined_u:object_r:user_tmp_t:s0 <span style="color:#ff9f43">0</span> Jul <span style="color:#ff9f43">29</span> 08:49  /etc/default/sefile2</span></span></code></pre></div>
<h3 id="exercise-20-5-view-and-toggle-selinux-boolean-values">Exercise 20-5: View and Toggle SELinux Boolean Values</h3>
<ul>
<li>Display the current state of the Boolean <code>nfs_export_all_rw</code>.</li>
<li>Toggle its value temporarily, and reboot the system.</li>
<li>Flip its value persistently after the system has been back up.</li>
</ul>
<p>1. Display the current setting of the Boolean <code>nfs_export_all_rw</code> using three different commands&mdash;<code>getsebool</code>, <code>sestatus</code>, and <code>semanage</code>:</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span> <span style="color:#ff6ac1">[</span>root@server10 ~<span style="color:#ff6ac1">]</span><span style="color:#78787e"># getsebool -a | grep  nfs_export_all_rw</span>
</span></span><span style="display:flex;"><span> nfs_export_all_rw --&gt; on
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span> <span style="color:#ff6ac1">[</span>root@server10 ~<span style="color:#ff6ac1">]</span><span style="color:#78787e"># sestatus -b | grep  nfs_export_all_rw</span>
</span></span><span style="display:flex;"><span> nfs_export_all_rw                           on
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span> <span style="color:#ff6ac1">[</span>root@server10 ~<span style="color:#ff6ac1">]</span><span style="color:#78787e"># semanage boolean -l | grep  nfs_export_all_rw</span>
</span></span><span style="display:flex;"><span> nfs_export_all_rw              <span style="color:#ff6ac1">(</span>on   ,   on<span style="color:#ff6ac1">)</span>  Allow  nfs to <span style="color:#ff5c57">export</span> all rw
</span></span><span style="display:flex;"><span> <span style="color:#ff6ac1">[</span>root@server10 ~<span style="color:#ff6ac1">]</span><span style="color:#78787e"># </span></span></span></code></pre></div>
<p>2. Turn off the value of <code>nfs_export_all_rw</code> using the setsebool command by simply furnishing &ldquo;<code>off</code>&rdquo; or &ldquo;<code>0</code>&rdquo; with it and confirm:</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span> <span style="color:#ff6ac1">[</span>root@server10 ~<span style="color:#ff6ac1">]</span><span style="color:#78787e"># setsebool nfs_export_all_rw 0</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span> <span style="color:#ff6ac1">[</span>root@server10 ~<span style="color:#ff6ac1">]</span><span style="color:#78787e"># getsebool -a | grep  nfs_export_all_rw</span>
</span></span><span style="display:flex;"><span> nfs_export_all_rw --&gt; off</span></span></code></pre></div>
<p>3. Reboot the system and rerun the <code>getsebool</code> command to check the Boolean state:</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span> <span style="color:#ff6ac1">[</span>root@server10 ~<span style="color:#ff6ac1">]</span><span style="color:#78787e"># getsebool -a | grep  nfs_export_all_rw</span>
</span></span><span style="display:flex;"><span> nfs_export_all_rw --&gt; on</span></span></code></pre></div>
<p>4. Set the value of the Boolean persistently (<code>-P</code> or <code>-m</code> as needed) using either of the following:</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span> <span style="color:#ff6ac1">[</span>root@server10 ~<span style="color:#ff6ac1">]</span><span style="color:#78787e"># setsebool -P nfs_export_all_rw off</span>
</span></span><span style="display:flex;"><span> <span style="color:#ff6ac1">[</span>root@server10 ~<span style="color:#ff6ac1">]</span><span style="color:#78787e"># semanage boolean -m -0  nfs_export_all_rw</span></span></span></code></pre></div>
<p>5. Validate the new value using the getsebool, sestatus, or semanage command:</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span> <span style="color:#ff6ac1">[</span>root@server10 ~<span style="color:#ff6ac1">]</span><span style="color:#78787e"># sestatus -b | grep  nfs_export_all_rw</span>
</span></span><span style="display:flex;"><span> nfs_export_all_rw                           off
</span></span><span style="display:flex;"><span> <span style="color:#ff6ac1">[</span>root@server10 ~<span style="color:#ff6ac1">]</span><span style="color:#78787e"># semanage boolean -l | grep  nfs_export_all_rw</span>
</span></span><span style="display:flex;"><span> nfs_export_all_rw              <span style="color:#ff6ac1">(</span>off  ,  off<span style="color:#ff6ac1">)</span>  Allow  nfs to <span style="color:#ff5c57">export</span> all rw
</span></span><span style="display:flex;"><span> <span style="color:#ff6ac1">[</span>root@server10 ~<span style="color:#ff6ac1">]</span><span style="color:#78787e"># semanage boolean -l | grep  nfs_export_all_rw </span>
</span></span><span style="display:flex;"><span> nfs_export_all_rw              <span style="color:#ff6ac1">(</span>off  ,  off<span style="color:#ff6ac1">)</span>  Allow  nfs to <span style="color:#ff5c57">export</span> all rw</span></span></code></pre></div>
<h3 id="monitoring-and-analyzing-selinux-violations">Monitoring and Analyzing SELinux Violations</h3>
<ul>
<li>
<p>SELinux generates alerts for system activities when it runs in enforcing or permissive mode.</p>
</li>
<li>
<p>It writes the alerts to <em>/var/log/audit/audit.log</em>if the <strong>auditd</strong> daemon is running, or to <em>/var/log/messages</em> via the <strong>rsyslog</strong> daemon in the absence of <strong>auditd</strong>.</p>
</li>
<li>
<p>SELinux also logs the alerts that are generated due to denial of an action, and identifies them with a type tag <strong>AVC (Access Vector Cache)</strong> in the audit.log file.</p>
</li>
<li>
<p>It also writes the rejection in the messages file with a message ID, and how to view the message details.</p>
</li>
<li>
<p>SELinux denial messages are analyzed, and the audit data is examined to identify the potential cause of the rejection.</p>
</li>
<li>
<p>The results of the analysis are recorded with recommendations on how to fix it.</p>
</li>
<li>
<p>These results can be reviewed to aid in troubleshooting, and recommended actions taken to address the issue.</p>
</li>
<li>
<p>SELinux runs a service daemon called <strong>setroubleshootd</strong> that performs this analysis and examination in the background.</p>
</li>
<li>
<p>This service also has a client interface called <strong>SELinux Troubleshooter</strong> (the <code>sealert</code> command) that reads the data and displays it for assessment.</p>
</li>
<li>
<p>The client tool has both text and graphical interfaces.</p>
</li>
<li>
<p>The server and client components are part of the <code>setroubleshoot-server</code> software package that must be installed on the system prior to using this service.</p>
</li>
</ul>
<p>How SELinux handles an incoming access request (from a subject) to a target object:</p>
<p>Subject (eg: a process) makes an Action request (eg: read) &gt; SELinux Security Server checks the SELinux Policy Database &gt; if permission is not granted the AVC Denied Message is diaplayed. If Permission is granted, then access to object (eg: a file) is granted.</p>
<p>su to root from user1 and view the log:</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span> <span style="color:#ff6ac1">[</span>root@server10 ~<span style="color:#ff6ac1">]</span><span style="color:#78787e"># cat /var/log/audit/audit.log |  tail -10</span>
</span></span><span style="display:flex;"><span> ...
</span></span><span style="display:flex;"><span> <span style="color:#ff5c57">type</span><span style="color:#ff6ac1">=</span>USER_START <span style="color:#ff5c57">msg</span><span style="color:#ff6ac1">=</span>audit<span style="color:#ff6ac1">(</span>1722274070.748:90<span style="color:#ff6ac1">)</span>:  <span style="color:#ff5c57">pid</span><span style="color:#ff6ac1">=</span><span style="color:#ff9f43">1394</span> <span style="color:#ff5c57">uid</span><span style="color:#ff6ac1">=</span><span style="color:#ff9f43">1000</span> <span style="color:#ff5c57">auid</span><span style="color:#ff6ac1">=</span><span style="color:#ff9f43">0</span> <span style="color:#ff5c57">ses</span><span style="color:#ff6ac1">=</span><span style="color:#ff9f43">1</span>  <span style="color:#ff5c57">subj</span><span style="color:#ff6ac1">=</span>unconfined_u:unconfined_r:unconfined_t:s0- s0:c0.c1023 <span style="color:#ff5c57">msg</span><span style="color:#ff6ac1">=</span><span style="color:#5af78e">&#39;op=PAM:session_open  grantors=pam_keyinit,pam_limits,pam_systemd,pam_unix, pam_umask,pam_xauth acct=&#34;root&#34; exe=&#34;/usr/bin/su&#34;  hostname=? addr=? terminal=/dev/pts/0  res=success&#39;</span><span style="color:#ff5c57">UID</span><span style="color:#ff6ac1">=</span><span style="color:#5af78e">&#34;user1&#34;</span> <span style="color:#ff5c57">AUID</span><span style="color:#ff6ac1">=</span><span style="color:#5af78e">&#34;root&#34;</span></span></span></code></pre></div>
<p>WIll show avc denied if denied.</p>
<h3 id="lab-get-an-avc-deny-message">Lab Get an AVC deny message</h3>
<ul>
<li>Change the SELinux type on the shadow file to something random (etc_t).</li>
<li>Issue the <code>passwd</code> command as user1 to modify the password.</li>
<li>Restored the type on the shadow file with <code>restorecon /etc/shadow</code>. '</li>
<li>Re-try the password change.</li>
</ul>
<ol start="2">
<li>Change the SELinux type on <em>/etc/shadow</em> to something random (etc_t)</li>
</ol>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span> <span style="color:#ff6ac1">[</span>root@server10 ~<span style="color:#ff6ac1">]</span><span style="color:#78787e"># chcon -vt etc_t /etc/shadow</span>
</span></span><span style="display:flex;"><span> changing security context of <span style="color:#5af78e">&#39;/etc/shadow&#39;</span></span></span></code></pre></div>
<ol start="3">
<li>Issue the <code>passwd</code> command as user1 to modify the password:</li>
</ol>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span> <span style="color:#ff6ac1">[</span>root@server10 ~<span style="color:#ff6ac1">]</span><span style="color:#78787e"># su user1</span>
</span></span><span style="display:flex;"><span> <span style="color:#ff6ac1">[</span>user1@server10 root<span style="color:#ff6ac1">]</span>$ passwd
</span></span><span style="display:flex;"><span> Changing password <span style="color:#ff6ac1">for</span> user user1.
</span></span><span style="display:flex;"><span> Current password: 
</span></span><span style="display:flex;"><span> roopasswd: Authentication token manipulation error</span></span></code></pre></div>
<p>The following is a sample denial record from the same file in raw format:</p>
<p><a href="#R-image-44b37923c3071fb7a31963fb2f11d077" class="lightbox-link"><img class="lazy lightbox figure-image" loading="lazy" src="/images/image-C7TMRBJO%201.jpg" style="height: auto;width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-44b37923c3071fb7a31963fb2f11d077"><img class="lazy lightbox lightbox-image" loading="lazy" src="/images/image-C7TMRBJO%201.jpg"></a></p>
<ul>
<li>AVC type</li>
<li>Related to the <code>passwd</code> command (comm)</li>
<li>Source context (<code>scontext</code>) <code>unconfined_u:unconfined_r:passwd_t:s0-s0:c0.c1023</code></li>
<li><em>nshadow</em> file (name) with file type (<em>tclass</em>) &ldquo;file&rdquo;</li>
<li>Target context (tcontext) <code>system_u:object_r:etc_t:s0</code></li>
<li>Indicates the SELinux operating mode, which is enforcing <code>permissive=0</code>.</li>
<li>This message indicates that the <em>/etc/shadow</em> file does not have the correct context set on it, and that&rsquo;s why SELinux prevented the <code>passwd</code> command from updating the user&rsquo;s password.</li>
</ul>
<p>Use <code>sealert</code> to analyze (<code>-a</code>) all <strong>AVC</strong> records in the <em>audit.log</em> file. This command produces a formatted report with all relevant details:</p>
<p><a href="#R-image-41ffe6abd2fe3040396727c4016796f1" class="lightbox-link"><img class="lazy lightbox figure-image" loading="lazy" src="/images/image-WYWDQX1V%201.jpg" style="height: auto;width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-41ffe6abd2fe3040396727c4016796f1"><img class="lazy lightbox lightbox-image" loading="lazy" src="/images/image-WYWDQX1V%201.jpg"></a></p>
<h2 id="selinux-diy-labs">SELinux DIY Labs</h2>
<h3 id="lab-disable-and-enable-the-selinux-operating-mode">Lab: Disable and Enable the SELinux Operating Mode</h3>
<ul>
<li>Check and make a note of the current SELinux operating mode.</li>
</ul>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span> <span style="color:#ff6ac1">[</span>root@server30 ~<span style="color:#ff6ac1">]</span><span style="color:#78787e"># getenforce</span>
</span></span><span style="display:flex;"><span> Enforcing</span></span></code></pre></div>
<ul>
<li>Modify the configuration file and set the mode to disabled.</li>
</ul>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span> <span style="color:#ff6ac1">[</span>root@server30 ~<span style="color:#ff6ac1">]</span><span style="color:#78787e"># vim /etc/selinux/config </span>
</span></span><span style="display:flex;"><span> <span style="color:#ff5c57">SELINUX</span><span style="color:#ff6ac1">=</span>disabled</span></span></code></pre></div>
<ul>
<li>Reboot the system to apply the change.</li>
</ul>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span> <span style="color:#ff6ac1">[</span>root@server30 ~<span style="color:#ff6ac1">]</span><span style="color:#78787e"># reboot</span></span></span></code></pre></div>
<ul>
<li>Run <code>sudo getenforce</code> to confirm the change when the system is up.</li>
</ul>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span> <span style="color:#ff6ac1">[</span>root@server30 ~<span style="color:#ff6ac1">]</span><span style="color:#78787e"># getenforce</span>
</span></span><span style="display:flex;"><span> Disabled</span></span></code></pre></div>
<ul>
<li>Restore the directive&rsquo;s value to enforcing in the configuration file, and reboot to apply the new mode.</li>
</ul>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span> <span style="color:#ff6ac1">[</span>root@server30 ~<span style="color:#ff6ac1">]</span><span style="color:#78787e"># vim /etc/selinux/config</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span> <span style="color:#ff5c57">SELINUX</span><span style="color:#ff6ac1">=</span>enforcing
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span> <span style="color:#ff6ac1">[</span>root@server30 ~<span style="color:#ff6ac1">]</span><span style="color:#78787e"># reboot</span></span></span></code></pre></div>
<ul>
<li>Run <code>sudo getenforce</code> to confirm the mode when the system is up.</li>
</ul>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span> <span style="color:#ff6ac1">[</span>root@server30 ~<span style="color:#ff6ac1">]</span><span style="color:#78787e"># getenforce</span>
</span></span><span style="display:flex;"><span> Enforcing</span></span></code></pre></div>
<h3 id="lab-modify-context-on-files">Lab: Modify Context on Files</h3>
<ul>
<li>Create directory hierarchy <em>/tmp/d1/d2</em>.</li>
</ul>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span> mkdir -p /tmp/d1/d2</span></span></code></pre></div>
<ul>
<li>Check the contexts on <em>/tmp/d1</em> and <em>/tmp/d1/d2</em>.</li>
</ul>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span> <span style="color:#ff6ac1">[</span>root@server30 d1<span style="color:#ff6ac1">]</span><span style="color:#78787e"># ls -ldZ /tmp/d1</span>
</span></span><span style="display:flex;"><span> drwxr-xr-x. <span style="color:#ff9f43">3</span> root root unconfined_u:object_r:user_tmp_t:s0 <span style="color:#ff9f43">16</span> Jul <span style="color:#ff9f43">29</span> 13:17 /tmp/d1
</span></span><span style="display:flex;"><span> <span style="color:#ff6ac1">[</span>root@server30 d1<span style="color:#ff6ac1">]</span><span style="color:#78787e"># ls -ldZ /tmp/d1/d2</span>
</span></span><span style="display:flex;"><span> drwxr-xr-x. <span style="color:#ff9f43">2</span> root root unconfined_u:object_r:user_tmp_t:s0 <span style="color:#ff9f43">6</span> Jul <span style="color:#ff9f43">29</span>  13:17 /tmp/d1/d2</span></span></code></pre></div>
<ul>
<li>Change the SELinux type on <em>/tmp/d1</em> to <code>etc_t</code> recursively with the <code>chcon</code> command and confirm.</li>
</ul>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span> <span style="color:#ff6ac1">[</span>root@server30 tmp<span style="color:#ff6ac1">]</span><span style="color:#78787e"># chcon -Rv -t etc_t /tmp/d1</span>
</span></span><span style="display:flex;"><span> changing security context of <span style="color:#5af78e">&#39;/tmp/d1/d2&#39;</span>
</span></span><span style="display:flex;"><span> changing security context of <span style="color:#5af78e">&#39;/tmp/d1&#39;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span> <span style="color:#ff6ac1">[</span>root@server30 tmp<span style="color:#ff6ac1">]</span><span style="color:#78787e"># ls -ldZ /tmp/d1</span>
</span></span><span style="display:flex;"><span> drwxr-xr-x. <span style="color:#ff9f43">3</span> root root unconfined_u:object_r:etc_t:s0 <span style="color:#ff9f43">16</span> Jul <span style="color:#ff9f43">29</span>  13:17 /tmp/d1
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span> <span style="color:#ff6ac1">[</span>root@server30 tmp<span style="color:#ff6ac1">]</span><span style="color:#78787e"># ls -ldZ /tmp/d1/d2</span>
</span></span><span style="display:flex;"><span> drwxr-xr-x. <span style="color:#ff9f43">2</span> root root unconfined_u:object_r:etc_t:s0 <span style="color:#ff9f43">6</span> Jul <span style="color:#ff9f43">29</span> 13:17 /tmp/d1/d2</span></span></code></pre></div>
<ul>
<li>Add <em>/tmp/d1</em> to the policy database with the <code>semanage</code> command to ensure the new context is persistent on the directory hierarchy.</li>
</ul>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span> <span style="color:#ff6ac1">[</span>root@server30 tmp<span style="color:#ff6ac1">]</span><span style="color:#78787e"># semanage fcontext -a -t etc_t /tmp/d1</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span> <span style="color:#ff6ac1">[</span>root@server30 tmp<span style="color:#ff6ac1">]</span><span style="color:#78787e"># reboot</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span> <span style="color:#ff6ac1">[</span>root@server30 ~<span style="color:#ff6ac1">]</span><span style="color:#78787e"># ls -ldZ /tmp/d1</span>
</span></span><span style="display:flex;"><span> drwxr-xr-x. <span style="color:#ff9f43">3</span> root root unconfined_u:object_r:etc_t:s0 <span style="color:#ff9f43">16</span> Jul <span style="color:#ff9f43">29</span>  13:17 /tmp/d1
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span> <span style="color:#ff6ac1">[</span>root@server30 ~<span style="color:#ff6ac1">]</span><span style="color:#78787e"># ls -ldZ /tmp/d1/d2</span>
</span></span><span style="display:flex;"><span> drwxr-xr-x. <span style="color:#ff9f43">2</span> root root unconfined_u:object_r:etc_t:s0 <span style="color:#ff9f43">6</span> Jul <span style="color:#ff9f43">29</span> 13:17 /tmp/d1/d2</span></span></code></pre></div>
<h3 id="lab-add-network-port-to-policy-database">Lab: Add Network Port to Policy Database</h3>
<ul>
<li>Add network port 9005 to the SELinux policy database for the secure HTTP service using the semanage command.</li>
</ul>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span> <span style="color:#ff6ac1">[</span>root@server30 ~<span style="color:#ff6ac1">]</span><span style="color:#78787e"># semanage port -l | grep ^http_port</span>
</span></span><span style="display:flex;"><span> http_port_t                    tcp      80, 81, 443, 488, 8008, 8009, 8443, <span style="color:#ff9f43">9000</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span> <span style="color:#ff6ac1">[</span>root@server30 ~<span style="color:#ff6ac1">]</span><span style="color:#78787e"># semanage port -at http_port_t -p tcp 9005</span></span></span></code></pre></div>
<ul>
<li>Verify the addition.</li>
</ul>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span> <span style="color:#ff6ac1">[</span>root@server30 ~<span style="color:#ff6ac1">]</span><span style="color:#78787e"># semanage port -l | grep ^http_port</span>
</span></span><span style="display:flex;"><span> http_port_t                    tcp      9005, 80, 81, 443, 488, 8008, 8009, 8443, <span style="color:#ff9f43">9000</span></span></span></code></pre></div>
<h3 id="lab-copy-files-with-and-without-context-1">Lab: Copy Files with and without Context</h3>
<ul>
<li>Create file <em>sef1</em> under <em>/tmp</em>.</li>
</ul>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span> <span style="color:#ff6ac1">[</span>root@server30 ~<span style="color:#ff6ac1">]</span><span style="color:#78787e"># touch /tmp/sef1</span></span></span></code></pre></div>
<ul>
<li>Copy the file to the <em>/usr/local</em> directory.</li>
</ul>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span> <span style="color:#ff6ac1">[</span>root@server30 ~<span style="color:#ff6ac1">]</span><span style="color:#78787e"># cp /tmp/sef1 /usr/local</span></span></span></code></pre></div>
<ul>
<li>Check and compare the contexts on both source and destination files.</li>
</ul>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span> <span style="color:#ff6ac1">[</span>root@server30 ~<span style="color:#ff6ac1">]</span><span style="color:#78787e"># ls -lZ /tmp/sef1</span>
</span></span><span style="display:flex;"><span> -rw-r--r--. <span style="color:#ff9f43">1</span> root root unconfined_u:object_r:user_tmp_t:s0 <span style="color:#ff9f43">0</span> Jul <span style="color:#ff9f43">29</span>  13:33 /tmp/sef1
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span> <span style="color:#ff6ac1">[</span>root@server30 ~<span style="color:#ff6ac1">]</span><span style="color:#78787e"># ls -lZ /usr/local/sef1</span>
</span></span><span style="display:flex;"><span> -rw-r--r--. <span style="color:#ff9f43">1</span> root root unconfined_u:object_r:usr_t:s0 <span style="color:#ff9f43">0</span> Jul <span style="color:#ff9f43">29</span> 13:33 /usr/local/sef1</span></span></code></pre></div>
<ul>
<li>Create another file <em>sef2</em> under <em>/tmp</em> and copy it to the <em>/var/local</em> directory using the <code>--preserve=context</code> option with the <code>cp</code> command.</li>
</ul>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span> <span style="color:#ff6ac1">[</span>root@server30 ~<span style="color:#ff6ac1">]</span><span style="color:#78787e"># touch /tmp/sef2</span>
</span></span><span style="display:flex;"><span> <span style="color:#ff6ac1">[</span>root@server30 ~<span style="color:#ff6ac1">]</span><span style="color:#78787e"># cp --preserve=context /tmp/sef2 /var/local/</span></span></span></code></pre></div>
<ul>
<li>Check and compare the contexts on both source and destination files.</li>
</ul>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span> <span style="color:#ff6ac1">[</span>root@server30 ~<span style="color:#ff6ac1">]</span><span style="color:#78787e"># ls -lZ /tmp/sef2 /var/local/sef2</span>
</span></span><span style="display:flex;"><span> -rw-r--r--. <span style="color:#ff9f43">1</span> root root unconfined_u:object_r:user_tmp_t:s0 <span style="color:#ff9f43">0</span> Jul <span style="color:#ff9f43">29</span>  13:35 /tmp/sef2
</span></span><span style="display:flex;"><span> -rw-r--r--. <span style="color:#ff9f43">1</span> root root unconfined_u:object_r:user_tmp_t:s0 <span style="color:#ff9f43">0</span> Jul <span style="color:#ff9f43">29</span>  13:36 /var/local/sef2</span></span></code></pre></div>
<h3 id="lab-flip-selinux-booleans">Lab: Flip SELinux Booleans</h3>
<ul>
<li>Check the current value of Boolean <code>ssh_use_tcpd</code> using the <code>getsebool</code> and <code>sestatus</code> commands.</li>
</ul>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span> <span style="color:#ff6ac1">[</span>root@server30 ~<span style="color:#ff6ac1">]</span><span style="color:#78787e"># getsebool -a | grep ssh_use_tcpd</span>
</span></span><span style="display:flex;"><span> ssh_use_tcpd --&gt; off</span></span></code></pre></div>
<ul>
<li>Use the <code>setsebool</code> command and toggle the value of the directive.</li>
</ul>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span> <span style="color:#ff6ac1">[</span>root@server30 ~<span style="color:#ff6ac1">]</span><span style="color:#78787e"># setsebool ssh_use_tcpd 1 </span></span></span></code></pre></div>
<ul>
<li>Confirm the new value with the <code>getsebool</code>, <code>semanage</code>, or <code>sestatus</code> command.</li>
</ul>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span> <span style="color:#ff6ac1">[</span>root@server30 ~<span style="color:#ff6ac1">]</span><span style="color:#78787e"># getsebool -a | grep ssh_use_tcpd</span>
</span></span><span style="display:flex;"><span> ssh_use_tcpd --&gt; on
</span></span><span style="display:flex;"><span> <span style="color:#ff6ac1">[</span>root@server30 ~<span style="color:#ff6ac1">]</span><span style="color:#78787e"># sestatus -b | grep ssh_use_tcpd</span>
</span></span><span style="display:flex;"><span> ssh_use_tcpd                                on
</span></span><span style="display:flex;"><span> <span style="color:#ff6ac1">[</span>root@server30 ~<span style="color:#ff6ac1">]</span><span style="color:#78787e"># semanage boolean -l | grep ssh_use_tcpd </span>
</span></span><span style="display:flex;"><span> ssh_use_tcpd                   <span style="color:#ff6ac1">(</span>on   ,  off<span style="color:#ff6ac1">)</span>  Allow ssh to use tcpd</span></span></code></pre></div>

  <footer class="footline">
  </footer>
</article>
<article class="default">
  <header class="headline">
  </header>

<h1 id="the-linux-firewall">The Linux Firewall</h1>

<h1 id="firewalld-zones"><code>firewalld</code> Zones</h1>
<h2 id="firewalld"><code>firewalld</code></h2>
<ul>
<li>The host-based firewall solution employed in RHEL uses a kernel module called <strong>netfilter</strong> together with a filtering and packet classification framework called <strong>nftables</strong> for policing the traffic movement.</li>
<li>It also supports other advanced features such as <strong>Network Address Translation (NAT)</strong> and <strong>port forwarding</strong>.</li>
<li>This firewall solution inspects, modifies, drops, or routes incoming, outgoing, and forwarded network packets based on defined rulesets.</li>
<li>Default host-based firewall management service in RHEL</li>
<li>Ability to add, modify, or delete firewall rules immediately without disrupting current network connections or restarting the service process.</li>
<li>Also allows to save rules persistently so that they are activated automatically at system reboots.</li>
<li>Lets you perform management operations at the command line using the <code>firewall-cmd</code> command, graphically using the web console, or manually by editing rules files.</li>
<li>Stores the default rules in files located in the /usr/lib/firewalld directory, and those that contain custom rules in the /etc/firewalld directory.</li>
<li>The default rules files may be copied to the custom rules directory and modified.</li>
</ul>
<h3 id="firewalld-zones-1">firewalld Zones</h3>
<ul>
<li>Easier and transparent traffic management.</li>
<li>Define policies based on the trust level of network connections and source IP addresses.</li>
<li>A network connection can be part of only one zone at a time;</li>
<li>A zone can have multiple network connections assigned to it.</li>
<li>Zone configuration may include services, ports, and protocols that may be open or closed.</li>
<li>May include rules for advanced configuration items such as masquerading, port forwarding, NAT&rsquo;ing, ICMP filters, and rich language.</li>
<li>Rules for each zone are defined and manipulated independent of other zones.</li>
</ul>
<p>Match source ip to zone that matches address &gt; match based on zone the interface is in &gt; matches default zone</p>
<ul>
<li>
<p>firewalld inspects each incoming packet to determine the source IP address and applies the rules of the zone that has a match for the address.</p>
</li>
<li>
<p>In the event no zone configuration matches the address, it associates the packet with the zone that has the network connection defined, and applies the rules of that zone.</p>
</li>
<li>
<p>If neither works, firewalld associates the packet with the default zone, and enforces the rules of the default zone on the packet.</p>
</li>
<li>
<p>Several predefined zone files that may be selected or customized.</p>
</li>
<li>
<p>These files include templates for traffic that must be blocked or dropped, and for traffic that is:</p>
<ul>
<li>public-facing</li>
<li>internal</li>
<li>external</li>
<li>home</li>
<li>public</li>
<li>trusted</li>
<li>work-related.</li>
</ul>
</li>
<li>
<p>public zone is the default zone, and it is activated by default when the firewalld service is started.</p>
</li>
</ul>
<p>Predefined zones sorted based on the trust level from trusted to
untrusted:</p>
<p><strong>trusted</strong></p>
<ul>
<li>Allow all incoming traffic</li>
</ul>
<p><strong>internal</strong></p>
<ul>
<li>Reject all incoming traffic except for what is allowed. Intended for use on internal networks.</li>
</ul>
<p><strong>home</strong></p>
<ul>
<li>Reject all incoming traffic except for what is allowed. Intended for use in homes.</li>
</ul>
<p><strong>work</strong></p>
<ul>
<li>Reject all incoming traffic except for what is allowed. Intended for use at workplaces.</li>
</ul>
<p><strong>dmz</strong></p>
<ul>
<li>Reject all incoming traffic except for what is allowed. Intended for use in publicly accessible demilitarized zones.</li>
</ul>
<p><strong>external</strong></p>
<ul>
<li>Reject all incoming traffic except for what is allowed.</li>
<li>Outgoing IPv4 traffic forwarded through this zone is masqueraded to look like it originated from the IPv4 address of an outgoing network interface.</li>
<li>Intended for use on external networks with masquerading enabled.</li>
</ul>
<p><strong>public</strong></p>
<ul>
<li>Reject all incoming traffic except for what is allowed.</li>
<li>Default zone for any newly added network interfaces.</li>
<li>Intended for us in public places.</li>
</ul>
<p><strong>block</strong></p>
<ul>
<li>Reject all incoming traffic with icmp-host-prohibited message returned.</li>
<li>Intended for use in secure places.</li>
</ul>
<p><strong>drop</strong></p>
<ul>
<li>
<p>Drop all incoming traffic without responding with ICMP errors.</p>
</li>
<li>
<p>Intended for use in highly secure places.</p>
</li>
<li>
<p>For all the predefined zones, outgoing traffic is allowed by default.</p>
</li>
</ul>
<h3 id="zone-configuration-files">Zone Configuration Files</h3>
<ul>
<li>
<p>firewalld stores zone rules in XML format at two locations</p>
<ul>
<li><strong>system-defined rules</strong> in the <em>/usr/lib/firewalld/zones</em> directory
<ul>
<li>can be used as templates for adding new rules, or applied instantly to any available network connection</li>
<li>automatically copied to the /etc/firewalld/zones directory if it is modified with a management tool</li>
</ul>
</li>
<li><strong>user-defined rules</strong> in the <em>/etc/firewalld/zones</em> directory</li>
</ul>
</li>
<li>
<p>can copy the required zone file to the <em>/etc/firewalld/zones</em> directory manually, and make the necessary changes.</p>
</li>
<li>
<p>The firewalld service reads the files saved in this location, and applies the rules defined in them.</p>
</li>
</ul>
<p>View the system Zones:</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#ff6ac1">[</span>root@server30 ~<span style="color:#ff6ac1">]</span><span style="color:#78787e"># ll /usr/lib/firewalld/zones</span>
</span></span><span style="display:flex;"><span>total <span style="color:#ff9f43">40</span>
</span></span><span style="display:flex;"><span>-rw-r--r--. <span style="color:#ff9f43">1</span> root root <span style="color:#ff9f43">312</span> Nov  <span style="color:#ff9f43">6</span>  <span style="color:#ff9f43">2023</span> block.xml
</span></span><span style="display:flex;"><span>-rw-r--r--. <span style="color:#ff9f43">1</span> root root <span style="color:#ff9f43">306</span> Nov  <span style="color:#ff9f43">6</span>  <span style="color:#ff9f43">2023</span> dmz.xml
</span></span><span style="display:flex;"><span>-rw-r--r--. <span style="color:#ff9f43">1</span> root root <span style="color:#ff9f43">304</span> Nov  <span style="color:#ff9f43">6</span>  <span style="color:#ff9f43">2023</span> drop.xml
</span></span><span style="display:flex;"><span>-rw-r--r--. <span style="color:#ff9f43">1</span> root root <span style="color:#ff9f43">317</span> Nov  <span style="color:#ff9f43">6</span>  <span style="color:#ff9f43">2023</span> external.xml
</span></span><span style="display:flex;"><span>-rw-r--r--. <span style="color:#ff9f43">1</span> root root <span style="color:#ff9f43">410</span> Nov  <span style="color:#ff9f43">6</span>  <span style="color:#ff9f43">2023</span> home.xml
</span></span><span style="display:flex;"><span>-rw-r--r--. <span style="color:#ff9f43">1</span> root root <span style="color:#ff9f43">425</span> Nov  <span style="color:#ff9f43">6</span>  <span style="color:#ff9f43">2023</span> internal.xml
</span></span><span style="display:flex;"><span>-rw-r--r--. <span style="color:#ff9f43">1</span> root root <span style="color:#ff9f43">729</span> Feb <span style="color:#ff9f43">21</span> 23:44 nm-shared.xml
</span></span><span style="display:flex;"><span>-rw-r--r--. <span style="color:#ff9f43">1</span> root root <span style="color:#ff9f43">356</span> Nov  <span style="color:#ff9f43">6</span>  <span style="color:#ff9f43">2023</span> public.xml
</span></span><span style="display:flex;"><span>-rw-r--r--. <span style="color:#ff9f43">1</span> root root <span style="color:#ff9f43">175</span> Nov  <span style="color:#ff9f43">6</span>  <span style="color:#ff9f43">2023</span> trusted.xml
</span></span><span style="display:flex;"><span>-rw-r--r--. <span style="color:#ff9f43">1</span> root root <span style="color:#ff9f43">352</span> Nov  <span style="color:#ff9f43">6</span>  <span style="color:#ff9f43">2023</span> work.xml</span></span></code></pre></div>
<p>View the public zone:</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#ff6ac1">[</span>root@server30 ~<span style="color:#ff6ac1">]</span><span style="color:#78787e"># cat /usr/lib/firewalld/zones/public.xml </span>
</span></span><span style="display:flex;"><span>&lt;?xml <span style="color:#ff5c57">version</span><span style="color:#ff6ac1">=</span><span style="color:#5af78e">&#34;1.0&#34;</span> <span style="color:#ff5c57">encoding</span><span style="color:#ff6ac1">=</span><span style="color:#5af78e">&#34;utf-8&#34;</span>?&gt;
</span></span><span style="display:flex;"><span>&lt;zone&gt;
</span></span><span style="display:flex;"><span>  &lt;short&gt;Public&lt;/short&gt;
</span></span><span style="display:flex;"><span>  &lt;description&gt;For use in public areas. You <span style="color:#ff6ac1">do</span> not trust the other computers on networks to not harm your computer. Only selected incoming connections are accepted.&lt;/description&gt;
</span></span><span style="display:flex;"><span>  &lt;service <span style="color:#ff5c57">name</span><span style="color:#ff6ac1">=</span><span style="color:#5af78e">&#34;ssh&#34;</span>/&gt;
</span></span><span style="display:flex;"><span>  &lt;service <span style="color:#ff5c57">name</span><span style="color:#ff6ac1">=</span><span style="color:#5af78e">&#34;dhcpv6-client&#34;</span>/&gt;
</span></span><span style="display:flex;"><span>  &lt;service <span style="color:#ff5c57">name</span><span style="color:#ff6ac1">=</span><span style="color:#5af78e">&#34;cockpit&#34;</span>/&gt;
</span></span><span style="display:flex;"><span>  &lt;forward/&gt;
</span></span><span style="display:flex;"><span>&lt;/zone&gt;</span></span></code></pre></div>
<ul>
<li>See the manual pages for firewalld.zone for details on zone configuration files.</li>
</ul>
<h2 id="firewalld-services">firewalld Services</h2>
<ul>
<li>For easier activation and deactivation of specific rules.</li>
<li>Preconfigured firewall rules delineated for various services and stored in different files.</li>
<li>The rules consist of necessary settings, such as the port number, protocol, and possibly helper modules, to support the loading of the service.</li>
<li>Can be added to a zone.</li>
<li>By default, firewalld blocks all traffic unless a service or port is explicitly opened.</li>
</ul>
<h3 id="service-configuration-files">Service Configuration Files</h3>
<ul>
<li>firewalld stores service rules in XML format at two locations:</li>
<li><strong>system-defined</strong> rules in the <em>/usr/lib/firewalld/services</em> directory
<ul>
<li>Can be used as templates for adding new service rules, or activated instantly.</li>
<li>A system service configuration file is automatically copied to the /etc/firewalld/services directory if it is modified with a management tool.</li>
</ul>
</li>
<li><strong>user-defined</strong> rules in the <em>/etc/firewalld/services</em> directory.
<ul>
<li>You can copy the required service file to the /etc/firewalld/services directory manually, and make the necessary changes.</li>
</ul>
</li>
<li>Service reads the files saved in this location, and applies the rules defined in them.</li>
</ul>
<p>A listing of the system service files is presented below:</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>root@server30 ~<span style="color:#ff6ac1">]</span><span style="color:#78787e"># ll /usr/lib/firewalld/services</span>
</span></span><span style="display:flex;"><span>total <span style="color:#ff9f43">884</span>
</span></span><span style="display:flex;"><span>-rw-r--r--. <span style="color:#ff9f43">1</span> root root <span style="color:#ff9f43">352</span> Nov  <span style="color:#ff9f43">6</span>  <span style="color:#ff9f43">2023</span> afp.xml
</span></span><span style="display:flex;"><span>-rw-r--r--. <span style="color:#ff9f43">1</span> root root <span style="color:#ff9f43">399</span> Nov  <span style="color:#ff9f43">6</span>  <span style="color:#ff9f43">2023</span> amanda-client.xml
</span></span><span style="display:flex;"><span>-rw-r--r--. <span style="color:#ff9f43">1</span> root root <span style="color:#ff9f43">427</span> Nov  <span style="color:#ff9f43">6</span>  <span style="color:#ff9f43">2023</span> amanda-k5-client.xml
</span></span><span style="display:flex;"><span>-rw-r--r--. <span style="color:#ff9f43">1</span> root root <span style="color:#ff9f43">283</span> Nov  <span style="color:#ff9f43">6</span>  <span style="color:#ff9f43">2023</span> amqps.xml
</span></span><span style="display:flex;"><span>-rw-r--r--. <span style="color:#ff9f43">1</span> root root <span style="color:#ff9f43">273</span> Nov  <span style="color:#ff9f43">6</span>  <span style="color:#ff9f43">2023</span> amqp.xml
</span></span><span style="display:flex;"><span>-rw-r--r--. <span style="color:#ff9f43">1</span> root root <span style="color:#ff9f43">285</span> Nov  <span style="color:#ff9f43">6</span>  <span style="color:#ff9f43">2023</span> apcupsd.xml
</span></span><span style="display:flex;"><span>-rw-r--r--. <span style="color:#ff9f43">1</span> root root <span style="color:#ff9f43">301</span> Nov  <span style="color:#ff9f43">6</span>  <span style="color:#ff9f43">2023</span> audit.xml
</span></span><span style="display:flex;"><span>-rw-r--r--. <span style="color:#ff9f43">1</span> root root <span style="color:#ff9f43">436</span> Nov  <span style="color:#ff9f43">6</span>  <span style="color:#ff9f43">2023</span> ausweisapp2.xml
</span></span><span style="display:flex;"><span>-rw-r--r--. <span style="color:#ff9f43">1</span> root root <span style="color:#ff9f43">320</span> Nov  <span style="color:#ff9f43">6</span>  <span style="color:#ff9f43">2023</span> bacula-client.xml
</span></span><span style="display:flex;"><span>-rw-r--r--. <span style="color:#ff9f43">1</span> root root <span style="color:#ff9f43">346</span> Nov  <span style="color:#ff9f43">6</span>  <span style="color:#ff9f43">2023</span> bacula.xml
</span></span><span style="display:flex;"><span>-rw-r--r--. <span style="color:#ff9f43">1</span> root root <span style="color:#ff9f43">390</span> Nov  <span style="color:#ff9f43">6</span>  <span style="color:#ff9f43">2023</span> bareos-director.xml
</span></span><span style="display:flex;"><span>...
</span></span><span style="display:flex;"><span>...</span></span></code></pre></div>
<p>Shows the content of the ssh service file:</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#ff6ac1">[</span>root@server30 ~<span style="color:#ff6ac1">]</span><span style="color:#78787e"># cat /usr/lib/firewalld/services/ssh.xml</span>
</span></span><span style="display:flex;"><span>&lt;?xml <span style="color:#ff5c57">version</span><span style="color:#ff6ac1">=</span><span style="color:#5af78e">&#34;1.0&#34;</span> <span style="color:#ff5c57">encoding</span><span style="color:#ff6ac1">=</span><span style="color:#5af78e">&#34;utf-8&#34;</span>?&gt;
</span></span><span style="display:flex;"><span>&lt;service&gt;
</span></span><span style="display:flex;"><span>  &lt;short&gt;SSH&lt;/short&gt;
</span></span><span style="display:flex;"><span>  &lt;description&gt;Secure Shell <span style="color:#ff6ac1">(</span>SSH<span style="color:#ff6ac1">)</span> is a protocol <span style="color:#ff6ac1">for</span> logging into and executing commands on remote machines. It provides secure encrypted communications. If you plan on accessing your machine remotely via SSH over a firewalled interface, <span style="color:#ff5c57">enable</span> this option. You need the openssh-server package installed <span style="color:#ff6ac1">for</span> this option to be useful.&lt;/description&gt;
</span></span><span style="display:flex;"><span>  &lt;port <span style="color:#ff5c57">protocol</span><span style="color:#ff6ac1">=</span><span style="color:#5af78e">&#34;tcp&#34;</span> <span style="color:#ff5c57">port</span><span style="color:#ff6ac1">=</span><span style="color:#5af78e">&#34;22&#34;</span>/&gt;
</span></span><span style="display:flex;"><span>&lt;/service&gt;</span></span></code></pre></div>
<ul>
<li>Has a name and description</li>
<li>Defines the port and protocol for the service.</li>
<li>See the manual pages for firewalld.service for details on service configuration files.</li>
</ul>
<h2 id="firewalld-management">firewalld Management</h2>
<ul>
<li>Listing, querying, adding, changing, and removing zones, services, ports, IP sources, and network connections. Three methods:
<ul>
<li><code>firewall-cmd</code></li>
<li>Web interface for graphical administration.</li>
<li>Edit Zone and service templates manually</li>
</ul>
</li>
</ul>
<h3 id="firewall-cmd-command"><code>firewall-cmd</code> Command</h3>
<ul>
<li>Add or remove rules from the runtime configuration, or save any modifications to service configuration for persistence.</li>
<li>Supports numerous options for the management of zones, services, ports, connections, and so on</li>
</ul>
<h3 id="common-options">Common options</h3>
<h4 id="general">General</h4>
<p><strong>--state</strong></p>
<ul>
<li>Displays the running status of firewalld</li>
</ul>
<p><strong>--reload</strong></p>
<ul>
<li>Reloads firewall rules from zone files. All runtime changes are lost.</li>
</ul>
<p><strong>--permanent</strong></p>
<ul>
<li>Stores a change persistently. The change only becomes active after a service reload or restart.</li>
</ul>
<h4 id="zones">Zones</h4>
<p><strong>--get-default-zone</strong></p>
<ul>
<li>Shows the name of the default/active zone</li>
</ul>
<p><strong>--set-default-zone</strong></p>
<ul>
<li>Changes the default zone for both runtime and permanent configuration</li>
</ul>
<p><strong>--get-zones</strong></p>
<ul>
<li>Prints a list of available zones</li>
</ul>
<p><strong>&ndash;get-active-zones</strong></p>
<ul>
<li>Displays the active zone and the assigned interfaces</li>
</ul>
<p><strong>--list-all</strong></p>
<ul>
<li>Lists all settings for a zone</li>
</ul>
<p><strong>--list-all-zones</strong></p>
<ul>
<li>Lists the settings for all available zones</li>
</ul>
<p><strong>&ndash;zone</strong></p>
<ul>
<li>Specifies the name of the zone to work on. Without this option, the default zone is used.</li>
</ul>
<h4 id="services">Services</h4>
<p><strong>--get-services</strong></p>
<ul>
<li>Prints predefined services</li>
</ul>
<p><strong>--list-services</strong></p>
<ul>
<li>Lists services for a zone</li>
</ul>
<p><strong>--add-service</strong></p>
<ul>
<li>Adds a service to a zone</li>
</ul>
<p><strong>--remove-service</strong></p>
<ul>
<li>Removes a service from a zone</li>
</ul>
<p><strong>--query-service</strong></p>
<ul>
<li>Queries for the presence of a service</li>
</ul>
<h4 id="ports">Ports</h4>
<p><strong>--list-ports</strong></p>
<ul>
<li>Lists network ports</li>
</ul>
<p><strong>--add-port</strong></p>
<ul>
<li>Adds a port or a range of ports to a zone</li>
</ul>
<p><strong>--remove-port</strong></p>
<ul>
<li>Removes a port from a zone</li>
</ul>
<p><strong>--query-port</strong></p>
<ul>
<li>Queries for the presence of a port</li>
</ul>
<h4 id="network-connections">Network Connections</h4>
<p><strong>--list-interfaces</strong></p>
<ul>
<li>Lists network connections assigned to a zone</li>
</ul>
<p><strong>--add-interface</strong></p>
<ul>
<li>Binds a network connection to a zone</li>
</ul>
<p><strong>--change-interface</strong></p>
<ul>
<li>Changes the binding of a network connection to a different zone</li>
</ul>
<p><strong>--remove-interface</strong></p>
<ul>
<li>Unbinds a network connection from a zone</li>
</ul>
<h4 id="ip-sources">IP Sources</h4>
<p><strong>--list-sources</strong></p>
<ul>
<li>Lists IP sources assigned to a zone</li>
</ul>
<p><strong>--add-source</strong></p>
<ul>
<li>Adds an IP source to a zone</li>
</ul>
<p><strong>--change-source</strong></p>
<ul>
<li>Changes an IP source</li>
</ul>
<p><strong>--remove-source</strong></p>
<ul>
<li>Removes an IP source from a zone</li>
</ul>
<hr>
<p><strong>--add and --remove options</strong></p>
<ul>
<li>--permanent switch may be specified to ensure the rule is stored in the zone configuration file under the <em>/etc/firewalld/zones</em> directory for persistence.</li>
</ul>
<h3 id="querying-the-operational-status-of-firewalld">Querying the Operational Status of firewalld</h3>
<p>Check the running status of the firewalld service using either the <code>systemctl</code> or the <code>firewall-cmd</code> command.</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#ff6ac1">[</span>root@server20 ~<span style="color:#ff6ac1">]</span><span style="color:#78787e"># firewall-cmd --state</span>
</span></span><span style="display:flex;"><span>running
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff6ac1">[</span>root@server20 ~<span style="color:#ff6ac1">]</span><span style="color:#78787e"># systemctl status firewalld -l --no-pager</span>
</span></span><span style="display:flex;"><span>‚óè firewalld.service - firewalld - dynamic firewall daemon
</span></span><span style="display:flex;"><span>     Loaded: loaded <span style="color:#ff6ac1">(</span>/usr/lib/systemd/system/firewalld.service; enabled; preset: enabled<span style="color:#ff6ac1">)</span>
</span></span><span style="display:flex;"><span>     Active: active <span style="color:#ff6ac1">(</span>running<span style="color:#ff6ac1">)</span> since Thu 2024-07-25 13:25:21 MST; 44min ago
</span></span><span style="display:flex;"><span>       Docs: man:firewalld<span style="color:#ff6ac1">(</span>1<span style="color:#ff6ac1">)</span>
</span></span><span style="display:flex;"><span>   Main PID: <span style="color:#ff9f43">829</span> <span style="color:#ff6ac1">(</span>firewalld<span style="color:#ff6ac1">)</span>
</span></span><span style="display:flex;"><span>      Tasks: <span style="color:#ff9f43">2</span> <span style="color:#ff6ac1">(</span>limit: 11108<span style="color:#ff6ac1">)</span>
</span></span><span style="display:flex;"><span>     Memory: 43.9M
</span></span><span style="display:flex;"><span>        CPU: 599ms
</span></span><span style="display:flex;"><span>     CGroup: /system.slice/firewalld.service
</span></span><span style="display:flex;"><span>             ‚îî‚îÄ829 /usr/bin/python3 -s /usr/sbin/firewalld --nofork --nopid
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Jul <span style="color:#ff9f43">25</span> 13:25:21 server20 systemd<span style="color:#ff6ac1">[</span>1<span style="color:#ff6ac1">]</span>: Starting firewalld - dynamic firewall daemon...
</span></span><span style="display:flex;"><span>Jul <span style="color:#ff9f43">25</span> 13:25:21 server20 systemd<span style="color:#ff6ac1">[</span>1<span style="color:#ff6ac1">]</span>: Started firewalld - dynamic firewall daemon.</span></span></code></pre></div>
<h3 id="lab-add-services-and-ports-and-manage-zones">Lab: Add Services and Ports, and Manage Zones</h3>
<ul>
<li>Determine the current active zone.</li>
<li>Add and activate a permanent rule to allow HTTP traffic on port 80</li>
<li>Add a runtime rule for traffic intended for TCP port 443 (the HTTPS service).</li>
<li>Add a permanent rule to the internal zone for TCP port range 5901 to 5910.</li>
<li>Confirm the changes and display the contents of the affected zone files.</li>
<li>Switch the default zone to the internal zone and activate it.</li>
</ul>
<p>1. Determine the name of the current default zone:</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span> <span style="color:#ff6ac1">[</span>root@server20 ~<span style="color:#ff6ac1">]</span><span style="color:#78787e"># firewall-cmd --get-default-zone</span>
</span></span><span style="display:flex;"><span> public</span></span></code></pre></div>
<p>2. Add a permanent rule to allow HTTP traffic on its default port:</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span> <span style="color:#ff6ac1">[</span>root@server20 ~<span style="color:#ff6ac1">]</span><span style="color:#78787e"># firewall-cmd --permanent --add-service  http</span>
</span></span><span style="display:flex;"><span> success</span></span></code></pre></div>
<p>The command made a copy of the <em>public.xml</em> file from <em>/usr/lib/firewalld/zones</em> directory into the <em>/etc/firewalld/zones</em> directory, and added the rule for the HTTP service.</p>
<p>3. Activate the new rule:</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span> <span style="color:#ff6ac1">[</span>root@server20 zones<span style="color:#ff6ac1">]</span><span style="color:#78787e"># firewall-cmd --reload</span>
</span></span><span style="display:flex;"><span> success</span></span></code></pre></div>
<p>4. Confirm the activation of the new rule:</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span> <span style="color:#ff6ac1">[</span>root@server20 zones<span style="color:#ff6ac1">]</span><span style="color:#78787e"># firewall-cmd --list-services</span>
</span></span><span style="display:flex;"><span> cockpit dhcpv6-client http nfs ssh</span></span></code></pre></div>
<p>5. Display the content of the default zone file to confirm the addition of the permanent rule:</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span> <span style="color:#ff6ac1">[</span>root@server20 zones<span style="color:#ff6ac1">]</span><span style="color:#78787e"># cat /etc/firewalld/zones/public.xml</span>
</span></span><span style="display:flex;"><span> &lt;?xml <span style="color:#ff5c57">version</span><span style="color:#ff6ac1">=</span><span style="color:#5af78e">&#34;1.0&#34;</span> <span style="color:#ff5c57">encoding</span><span style="color:#ff6ac1">=</span><span style="color:#5af78e">&#34;utf-8&#34;</span>?&gt;
</span></span><span style="display:flex;"><span> &lt;zone&gt;
</span></span><span style="display:flex;"><span>  &lt;short&gt;Public&lt;/short&gt;
</span></span><span style="display:flex;"><span>  &lt;description&gt;For use in public areas. You <span style="color:#ff6ac1">do</span> not trust    the other computers on networks to not harm your computer.  Only selected incoming connections are accepted. &lt;/description&gt;
</span></span><span style="display:flex;"><span>  &lt;service <span style="color:#ff5c57">name</span><span style="color:#ff6ac1">=</span><span style="color:#5af78e">&#34;ssh&#34;</span>/&gt;
</span></span><span style="display:flex;"><span>  &lt;service <span style="color:#ff5c57">name</span><span style="color:#ff6ac1">=</span><span style="color:#5af78e">&#34;dhcpv6-client&#34;</span>/&gt;
</span></span><span style="display:flex;"><span>  &lt;service <span style="color:#ff5c57">name</span><span style="color:#ff6ac1">=</span><span style="color:#5af78e">&#34;cockpit&#34;</span>/&gt;
</span></span><span style="display:flex;"><span>  &lt;service <span style="color:#ff5c57">name</span><span style="color:#ff6ac1">=</span><span style="color:#5af78e">&#34;nfs&#34;</span>/&gt;
</span></span><span style="display:flex;"><span>  &lt;service <span style="color:#ff5c57">name</span><span style="color:#ff6ac1">=</span><span style="color:#5af78e">&#34;http&#34;</span>/&gt;
</span></span><span style="display:flex;"><span>  &lt;forward/&gt;
</span></span><span style="display:flex;"><span> &lt;/zone&gt;</span></span></code></pre></div>
<p>6. Add a runtime rule to allow traffic on TCP port 443 and verify:</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span> <span style="color:#ff6ac1">[</span>root@server20 zones<span style="color:#ff6ac1">]</span><span style="color:#78787e"># firewall-cmd --add-port 443/tcp</span>
</span></span><span style="display:flex;"><span> success
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span> <span style="color:#ff6ac1">[</span>root@server20 zones<span style="color:#ff6ac1">]</span><span style="color:#78787e"># firewall-cmd --list-ports</span>
</span></span><span style="display:flex;"><span> 443/tcp</span></span></code></pre></div>
<p>7. Add a permanent rule to the internal zone for TCP port range 5901 to 5910:</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span> <span style="color:#ff6ac1">[</span>root@server20 zones<span style="color:#ff6ac1">]</span><span style="color:#78787e"># firewall-cmd --add-port 5901-5910/tcp --permanent --zone internal</span>
</span></span><span style="display:flex;"><span> success</span></span></code></pre></div>
<p>8. Display the content of the internal zone file to confirm the addition of the permanent rule:</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span> <span style="color:#ff6ac1">[</span>root@server20 zones<span style="color:#ff6ac1">]</span><span style="color:#78787e"># cat /etc/firewalld/zones/internal.xml</span>
</span></span><span style="display:flex;"><span> &lt;?xml <span style="color:#ff5c57">version</span><span style="color:#ff6ac1">=</span><span style="color:#5af78e">&#34;1.0&#34;</span> <span style="color:#ff5c57">encoding</span><span style="color:#ff6ac1">=</span><span style="color:#5af78e">&#34;utf-8&#34;</span>?&gt;
</span></span><span style="display:flex;"><span> &lt;zone&gt;
</span></span><span style="display:flex;"><span>  &lt;short&gt;Internal&lt;/short&gt;
</span></span><span style="display:flex;"><span>  &lt;description&gt;For use on internal networks. You mostly  trust the other computers on the networks to not harm your  computer. Only selected incoming connections are accepted. &lt;/description&gt;
</span></span><span style="display:flex;"><span>  &lt;service <span style="color:#ff5c57">name</span><span style="color:#ff6ac1">=</span><span style="color:#5af78e">&#34;ssh&#34;</span>/&gt;
</span></span><span style="display:flex;"><span>  &lt;service <span style="color:#ff5c57">name</span><span style="color:#ff6ac1">=</span><span style="color:#5af78e">&#34;mdns&#34;</span>/&gt;
</span></span><span style="display:flex;"><span>  &lt;service <span style="color:#ff5c57">name</span><span style="color:#ff6ac1">=</span><span style="color:#5af78e">&#34;samba-client&#34;</span>/&gt;
</span></span><span style="display:flex;"><span>  &lt;service <span style="color:#ff5c57">name</span><span style="color:#ff6ac1">=</span><span style="color:#5af78e">&#34;dhcpv6-client&#34;</span>/&gt;
</span></span><span style="display:flex;"><span>  &lt;service <span style="color:#ff5c57">name</span><span style="color:#ff6ac1">=</span><span style="color:#5af78e">&#34;cockpit&#34;</span>/&gt;
</span></span><span style="display:flex;"><span>  &lt;port <span style="color:#ff5c57">port</span><span style="color:#ff6ac1">=</span><span style="color:#5af78e">&#34;5901-5910&#34;</span> <span style="color:#ff5c57">protocol</span><span style="color:#ff6ac1">=</span><span style="color:#5af78e">&#34;tcp&#34;</span>/&gt;
</span></span><span style="display:flex;"><span>  &lt;forward/&gt;
</span></span><span style="display:flex;"><span> &lt;/zone&gt;</span></span></code></pre></div>
<ul>
<li>The firewall-cmd command makes a backup of the affected zone file with a .old extension whenever an update is made to a zone.</li>
</ul>
<p>9. Switch the default zone to internal and confirm:</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span> <span style="color:#ff6ac1">[</span>root@server20 zones<span style="color:#ff6ac1">]</span><span style="color:#78787e"># firewall-cmd --set-default-zone  internal</span>
</span></span><span style="display:flex;"><span> success</span></span></code></pre></div>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span> <span style="color:#ff6ac1">[</span>root@server20 zones<span style="color:#ff6ac1">]</span><span style="color:#78787e"># firewall-cmd --get-default-zone</span>
</span></span><span style="display:flex;"><span> internal</span></span></code></pre></div>
<p>10. Activate the rules defined in the internal zone and list the port range added earlier:</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>  <span style="color:#ff6ac1">[</span>root@server20 zones<span style="color:#ff6ac1">]</span><span style="color:#78787e"># firewall-cmd --list-ports</span>
</span></span><span style="display:flex;"><span>  5901-5910/tcp</span></span></code></pre></div>
<h3 id="lab-remove-services-and-ports-and-manage-zones">Lab: Remove Services and Ports, and Manage Zones</h3>
<ul>
<li>Remove the two permanent rules that were added in the last lab.</li>
<li>Switch the public zone back as the default zone, and confirm the changes.</li>
</ul>
<p>1. Remove the permanent rule for HTTP from the public zone:</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span> <span style="color:#ff6ac1">[</span>root@server20 zones<span style="color:#ff6ac1">]</span><span style="color:#78787e"># firewall-cmd --remove-service=http --zone public --permanent</span>
</span></span><span style="display:flex;"><span> success</span></span></code></pre></div>
<ul>
<li>Must specify public zone as it is not the current default.</li>
</ul>
<p>2. Remove the permanent rule for ports 5901 to 5910 from the internal zone:</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span> <span style="color:#ff6ac1">[</span>root@server20 zones<span style="color:#ff6ac1">]</span><span style="color:#78787e"># firewall-cmd --remove-port 5901- 5910/tcp --permanent</span>
</span></span><span style="display:flex;"><span> success</span></span></code></pre></div>
<p>3. Switch the default zone to public and validate:</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span> <span style="color:#ff6ac1">[</span>root@server20 zones<span style="color:#ff6ac1">]</span><span style="color:#78787e"># firewall-cmd --set-default- zone=public</span>
</span></span><span style="display:flex;"><span> success
</span></span><span style="display:flex;"><span> <span style="color:#ff6ac1">[</span>root@server20 zones<span style="color:#ff6ac1">]</span><span style="color:#78787e"># firewall-cmd --get-default-zone </span>
</span></span><span style="display:flex;"><span> public</span></span></code></pre></div>
<p>4. Activate the public zone rules, and list the current services:</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span> <span style="color:#ff6ac1">[</span>root@server20 zones<span style="color:#ff6ac1">]</span><span style="color:#78787e"># firewall-cmd --reload</span>
</span></span><span style="display:flex;"><span> success
</span></span><span style="display:flex;"><span> <span style="color:#ff6ac1">[</span>root@server20 zones<span style="color:#ff6ac1">]</span><span style="color:#78787e"># firewall-cmd --list-services</span>
</span></span><span style="display:flex;"><span> cockpit dhcpv6-client nfs ssh</span></span></code></pre></div>
<h3 id="lab-test-the-effect-of-firewall-rule">Lab: Test the Effect of Firewall Rule</h3>
<ul>
<li>Remove the sshd service rule from the runtime configuration on server20</li>
<li>Try to access the server from server10 using the ssh command.</li>
</ul>
<p>1. Remove the rule for the sshd service on server20:</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span> <span style="color:#ff6ac1">[</span>root@server20 zones<span style="color:#ff6ac1">]</span><span style="color:#78787e"># firewall-cmd --remove-service ssh</span>
</span></span><span style="display:flex;"><span> success</span></span></code></pre></div>
<p>2. Issue the ssh command on server10 to access server20:</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span> <span style="color:#ff6ac1">[</span>root@server10 ~<span style="color:#ff6ac1">]</span><span style="color:#78787e"># ssh 192.168.0.37</span>
</span></span><span style="display:flex;"><span> ssh: connect to host 192.168.0.37 port 22: No route to host</span></span></code></pre></div>
<p>3. Add the rule back for sshd on server20:</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span> <span style="color:#ff6ac1">[</span>root@server20 zones<span style="color:#ff6ac1">]</span><span style="color:#78787e"># firewall-cmd --add-service ssh</span>
</span></span><span style="display:flex;"><span> success</span></span></code></pre></div>
<p>4. Issue the ssh command on server10 to access server20. Enter &ldquo;yes&rdquo; if
prompted and the password for user1.</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span> <span style="color:#ff6ac1">[</span>root@server10 ~<span style="color:#ff6ac1">]</span><span style="color:#78787e"># ssh 192.168.0.37</span>
</span></span><span style="display:flex;"><span> The authenticity of host <span style="color:#5af78e">&#39;192.168.0.37 (192.168.0.37)&#39;</span>  can<span style="color:#5af78e">&#39;t be established.
</span></span></span><span style="display:flex;"><span><span style="color:#5af78e"> ED25519 key fingerprint is  SHA256:Z8nFu0Jj1ASZeXByiy3aAWHpUhGhUmDCr+Omu/iWTjs.
</span></span></span><span style="display:flex;"><span><span style="color:#5af78e"> This key is not known by any other names
</span></span></span><span style="display:flex;"><span><span style="color:#5af78e"> Are you sure you want to continue connecting  (yes/no/[fingerprint])? yes
</span></span></span><span style="display:flex;"><span><span style="color:#5af78e"> Warning: Permanently added &#39;</span>192.168.0.37<span style="color:#5af78e">&#39; (ED25519) to  the list of known hosts.
</span></span></span><span style="display:flex;"><span><span style="color:#5af78e"> root@192.168.0.37&#39;</span>s password: 
</span></span><span style="display:flex;"><span> Web console: https://server20:9090/ or  https://192.168.0.37:9090/
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span> Register this system with Red Hat Insights: insights- client --register
</span></span><span style="display:flex;"><span> Create an account or view all your systems at  https://red.ht/insights-dashboard
</span></span><span style="display:flex;"><span> Last login: Thu Jul <span style="color:#ff9f43">25</span> 13:37:47 <span style="color:#ff9f43">2024</span> from 192.168.0.21/</span></span></code></pre></div>
<h1 id="the-linux-firewall-diy-labs">The Linux Firewall DIY Labs</h1>
<h3 id="lab-add-service-to-firewall">Lab: Add Service to Firewall</h3>
<ul>
<li>Add and activate a permanent rule for HTTPs traffic to the default zone.</li>
</ul>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span> <span style="color:#ff6ac1">[</span>root@server20 ~<span style="color:#ff6ac1">]</span><span style="color:#78787e"># firewall-cmd --add-service  https --permanent</span>
</span></span><span style="display:flex;"><span> success
</span></span><span style="display:flex;"><span> <span style="color:#ff6ac1">[</span>root@server20 ~<span style="color:#ff6ac1">]</span><span style="color:#78787e"># firewall-cmd --reload</span>
</span></span><span style="display:flex;"><span> success</span></span></code></pre></div>
<ul>
<li>Confirm the change by viewing the zone&rsquo;s XML file and running the <code>firewall-cmd</code> command.</li>
</ul>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span> <span style="color:#ff6ac1">[</span>root@server20 ~<span style="color:#ff6ac1">]</span><span style="color:#78787e"># cat  /etc/firewalld/zones/public.xml</span>
</span></span><span style="display:flex;"><span> &lt;?xml <span style="color:#ff5c57">version</span><span style="color:#ff6ac1">=</span><span style="color:#5af78e">&#34;1.0&#34;</span> <span style="color:#ff5c57">encoding</span><span style="color:#ff6ac1">=</span><span style="color:#5af78e">&#34;utf-8&#34;</span>?&gt;
</span></span><span style="display:flex;"><span> &lt;zone&gt;
</span></span><span style="display:flex;"><span>  &lt;short&gt;Public&lt;/short&gt;
</span></span><span style="display:flex;"><span>  &lt;description&gt;For use in public areas. You <span style="color:#ff6ac1">do</span> not trust the other computers on networks to not harm your computer. Only selected incoming connections are accepted.&lt;/description&gt;
</span></span><span style="display:flex;"><span>  &lt;service <span style="color:#ff5c57">name</span><span style="color:#ff6ac1">=</span><span style="color:#5af78e">&#34;ssh&#34;</span>/&gt;
</span></span><span style="display:flex;"><span>  &lt;service <span style="color:#ff5c57">name</span><span style="color:#ff6ac1">=</span><span style="color:#5af78e">&#34;dhcpv6-client&#34;</span>/&gt;
</span></span><span style="display:flex;"><span>  &lt;service <span style="color:#ff5c57">name</span><span style="color:#ff6ac1">=</span><span style="color:#5af78e">&#34;cockpit&#34;</span>/&gt;
</span></span><span style="display:flex;"><span>  &lt;service <span style="color:#ff5c57">name</span><span style="color:#ff6ac1">=</span><span style="color:#5af78e">&#34;nfs&#34;</span>/&gt;
</span></span><span style="display:flex;"><span>  &lt;service <span style="color:#ff5c57">name</span><span style="color:#ff6ac1">=</span><span style="color:#5af78e">&#34;https&#34;</span>/&gt;
</span></span><span style="display:flex;"><span>  &lt;forward/&gt;
</span></span><span style="display:flex;"><span> &lt;/zone&gt;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span> <span style="color:#ff6ac1">[</span>root@server20 ~<span style="color:#ff6ac1">]</span><span style="color:#78787e"># firewall-cmd --list-services</span>
</span></span><span style="display:flex;"><span> cockpit dhcpv6-client https nfs ssh</span></span></code></pre></div>
<h3 id="lab-add-port-range-to-firewall">Lab: Add Port Range to Firewall</h3>
<ul>
<li>Add and activate a permanent rule for the UDP port range 8000 to 8005 to the trusted zone.</li>
</ul>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span> <span style="color:#ff6ac1">[</span>root@server20 ~<span style="color:#ff6ac1">]</span><span style="color:#78787e"># firewall-cmd --add-port 8000- 8005/udp --zone trusted --permanent</span>
</span></span><span style="display:flex;"><span> success
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span> <span style="color:#ff6ac1">[</span>root@server20 ~<span style="color:#ff6ac1">]</span><span style="color:#78787e"># firewall-cmd --reload</span>
</span></span><span style="display:flex;"><span> success</span></span></code></pre></div>
<ul>
<li>Confirm the change by viewing the zone&rsquo;s XML file and running the <code>firewall-cmd</code> command.</li>
</ul>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span> <span style="color:#ff6ac1">[</span>root@server20 ~<span style="color:#ff6ac1">]</span><span style="color:#78787e"># firewall-cmd --list-ports -- zone trusted</span>
</span></span><span style="display:flex;"><span> 8000-8005/udp
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span> <span style="color:#ff6ac1">[</span>root@server20 ~<span style="color:#ff6ac1">]</span><span style="color:#78787e"># cat /etc/firewalld/zones/trusted.xml </span>
</span></span><span style="display:flex;"><span> &lt;?xml <span style="color:#ff5c57">version</span><span style="color:#ff6ac1">=</span><span style="color:#5af78e">&#34;1.0&#34;</span> <span style="color:#ff5c57">encoding</span><span style="color:#ff6ac1">=</span><span style="color:#5af78e">&#34;utf-8&#34;</span>?&gt;
</span></span><span style="display:flex;"><span> &lt;zone <span style="color:#ff5c57">target</span><span style="color:#ff6ac1">=</span><span style="color:#5af78e">&#34;ACCEPT&#34;</span>&gt;
</span></span><span style="display:flex;"><span>  &lt;short&gt;Trusted&lt;/short&gt;
</span></span><span style="display:flex;"><span>  &lt;description&gt;All network connections are  accepted.&lt;/description&gt;
</span></span><span style="display:flex;"><span>  &lt;port <span style="color:#ff5c57">port</span><span style="color:#ff6ac1">=</span><span style="color:#5af78e">&#34;8000-8005&#34;</span> <span style="color:#ff5c57">protocol</span><span style="color:#ff6ac1">=</span><span style="color:#5af78e">&#34;udp&#34;</span>/&gt;
</span></span><span style="display:flex;"><span>  &lt;forward/&gt;
</span></span><span style="display:flex;"><span> &lt;/zone&gt;</span></span></code></pre></div>

  <footer class="footline">
  </footer>
</article>
<article class="default">
  <header class="headline">
  </header>

<h1 id="the-secure-shell-service">The Secure Shell Service</h1>

<h2 id="the-openssh-service">The OpenSSH Service</h2>
<p><strong>Secure Shell (SSH)</strong></p>
<ul>
<li>Delivers a secure mechanism for data transmission between source and destination systems over IP networks.</li>
<li>Designed to replace the old remote login programs that transmitted user passwords in clear text and data unencrypted.</li>
<li>Employs digital signatures for user authentication with encryption to secure a communication channel.
<ul>
<li>this makes it extremely hard for unauthorized people to gain access to passwords or the data in transit.</li>
</ul>
</li>
<li>Monitors the data being transferred throughout a session to ensure integrity.</li>
<li>Includes a set of utilities <code>ssh</code> and <code>sftp</code> for remote users to log in, transfer files, and execute commands securely.</li>
</ul>
<h3 id="common-encryption-techniques">Common Encryption Techniques</h3>
<ul>
<li>Two common techniques: symmetric and asymetric</li>
</ul>
<p><strong>Symmetric Technique</strong></p>
<ul>
<li>Secret key encryption.</li>
<li>Uses a single key called a secret key that is generated as a result of a negotiation process between two entities at the time of their initial contact.</li>
<li>Both sides use the same secret key during subsequent communication for data encryption and decryption.</li>
</ul>
<p><strong>Asymmetric Technique</strong></p>
<ul>
<li>Public key encryption</li>
<li>Combination of private and public keys
<ul>
<li>Randomly generated and mathematically related strings of alphanumeric characters</li>
<li>attached to messages being exchanged.</li>
</ul>
</li>
<li>The client transmutes the information with a public key and the server decrypts it with the paired private key.</li>
<li>Private key must be kept secure since it is private to a single sender</li>
<li>the public key is disseminated to clients.</li>
<li>used for channel encryption and user authentication.</li>
</ul>
<h3 id="authentication-methods">Authentication Methods</h3>
<ul>
<li>Encrypted channel is established between the client and server</li>
<li>Then additional negotiations take place between the two to authenticate the user trying to access the server.</li>
<li>Methods listed in the order in which they are attempted during the authentication process:</li>
</ul>
<ol>
<li>GSSAPI-based ( Generic Security Service Application Program Interface) authentication</li>
<li>Host-based authentication</li>
<li>Public key-based authentication</li>
<li>Challenge-response authentication</li>
<li>Password-based authentication</li>
</ol>
<p><strong>GSSAPI-Based Authentication</strong></p>
<ul>
<li>Provides a standard interface that allows security mechanisms, such as Kerberos, to be plugged in.</li>
<li>OpenSSH uses this interface and the underlying Kerberos for authentication.</li>
<li>Exchange of tokens takes place between the client and server to validate user identity.</li>
</ul>
<p><strong>Host-Based Authentication</strong></p>
<ul>
<li>Allows a single user, a group of users, or all users on the client to be authenticated on the server.</li>
<li>A user may be configured to log in with a matching username on the server or as a different user that already exists there.</li>
<li>For each user that requires an automatic entry on the server, a ~/.shosts file is set up containing the client name or IP address, and, optionally, a different username.</li>
<li>The same rule applies to a group of users or all users on the client that require access to the server.
<ul>
<li>In that case, the setup is done in the /etc/ssh/shosts.equiv file on the server.</li>
</ul>
</li>
</ul>
<p><strong>Private/Public Key-Based Authentication</strong></p>
<ul>
<li>Uses a private/public key combination for user authentication.</li>
<li>User on the client has a private key and the server stores the corresponding public key.</li>
<li>At the login attempt, the server prompts the user to enter the passphrase associated with the key and logs the user in if the passphrase and key are validated.</li>
</ul>
<p><strong>Challenge-Response Authentication</strong></p>
<ul>
<li>Based on the response(s) to one or more arbitrary challenge questions that the user has to answer correctly in order to be allowed to log in to the server.</li>
</ul>
<p><strong>Password-Based Authentication</strong></p>
<ul>
<li>Last fall back option.</li>
<li>Server prompts the user to enter their password.</li>
<li>Checks the password against the stored entry in the shadow file and allows the user in if the password is confirmed.</li>
</ul>
<h3 id="openssh-protocol-version-and-algorithms">OpenSSH Protocol Version and Algorithms</h3>
<ul>
<li>V2</li>
<li>Supports various algorithms for data encryption and user authentication (digital signatures) such as:</li>
</ul>
<p><strong>RSA</strong> (Rivest-Shamir-Adleman)</p>
<ul>
<li>More prevalent than the rest</li>
<li>Supports both encryption and authentication.</li>
</ul>
<p><strong>DSA and ECDSA</strong> (Digital Signature Algorithm and Elliptic Curve Digital Signature Algorithm)</p>
<ul>
<li>Authentication only.</li>
<li>Used to generate public and private key pairs for the asymmetric technique.</li>
</ul>
<h3 id="openssh-packages">OpenSSH Packages</h3>
<ul>
<li>Installed during OS installation</li>
</ul>
<p><strong>openssh</strong></p>
<ul>
<li>provides the <code>ssh-keygen</code> command and some library routines</li>
</ul>
<p><strong>openssh-clients</strong></p>
<ul>
<li>includes commands, such as <code>sftp</code>, <code>ssh</code>, and <code>ssh-copy-id</code>, and a client configuration file <em>/etc/ssh/ssh_config</em></li>
</ul>
<p><strong>openssh-server</strong></p>
<ul>
<li>contains the sshd service daemon, server configuration file <em>/etc/ssh/sshd_config</em>, and library routines.</li>
</ul>
<h3 id="openssh-server-daemon-and-client-commands">OpenSSH Server Daemon and Client Commands</h3>
<ul>
<li>OpenSSH server program is sshd</li>
</ul>
<p><strong>sshd</strong></p>
<ul>
<li>
<p>Preconfigured and operational on new RHEL installations</p>
</li>
<li>
<p>Allows remote users to log in to the system using an ssh client program such as PuTTY or the ssh command.</p>
</li>
<li>
<p>Daemon listens on TCP port 22</p>
<ul>
<li>Documented in the /etc/ssh/sshd_config file with the Port directive.</li>
</ul>
</li>
<li>
<p>Use sftp instead of scp do to scp security flaws.</p>
</li>
</ul>
<p><code>sftp</code></p>
<ul>
<li>Secure remote file transfer program</li>
</ul>
<p><code>ssh</code></p>
<ul>
<li>Secure remote login command</li>
</ul>
<p><code>ssh-copy-id</code></p>
<ul>
<li>Copies public key to remote systems</li>
</ul>
<p><code>ssh-keygen</code></p>
<ul>
<li>Generates and manages private and public key pairs</li>
</ul>
<h3 id="server-configuration-file">Server Configuration File</h3>
<p><strong>/etc/ssh/sshd_config</strong></p>
<p><strong>/var/log/secure</strong></p>
<ul>
<li>log file is used to capture authentication messages.</li>
</ul>
<p>View directives listed in <em>/etc/ssh/sshd_config</em>:</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#ff6ac1">[</span>root@server30 tmp<span style="color:#ff6ac1">]</span><span style="color:#78787e"># cat /etc/ssh/sshd_config</span></span></span></code></pre></div>
<p><strong>Port</strong></p>
<ul>
<li>Port number to listen on. Default is 22.</li>
</ul>
<p><strong>Protocol</strong></p>
<ul>
<li>Default protocol version to use.</li>
</ul>
<p><strong>ListenAddress</strong></p>
<ul>
<li>Sets the local addresses the sshd service should listen on.</li>
<li>Default is to listen on all local addresses.</li>
</ul>
<p><strong>SyslogFacility</strong></p>
<ul>
<li>Defines the facility code to be used when logging messages to the /var/log/secure file. This is based on the configuration in the /etc/rsyslog.conf file. Default is <strong>AUTHPRIV.</strong></li>
</ul>
<p><strong>LogLevel</strong>                         <br>
Identifies the level of criticality for the messages to be logged. Default is <strong>INFO</strong>.</p>
<p><strong>PermitRootLogin</strong>                  <br>
Allows or disallows the root user to log in directly to the system. Default is yes.</p>
<p><strong>PubKeyAuthentication</strong>             <br>
Enables or disables public key-based authentication. Default is yes.</p>
<p><strong>AuthorizedKeysFile</strong>               <br>
Sets the name and location of the file containing a user&rsquo;s authorized keys. Default is ~/.ssh/authorized_keys.</p>
<p><strong>PasswordAuthentication</strong>           <br>
Enables or disables local password authentication. Default is yes.</p>
<p><strong>PermitEmptyPasswords</strong>             <br>
Allows or disallows the use of null passwords. Default is no.</p>
<p><strong>ChallengeResponseAuthentication</strong>  <br>
Enables or disables challenge-response authentication mechanism. Default is yes.</p>
<p><strong>UsePAM</strong>                           <br>
Enables or disables user authentication via PAM. If enabled, only root will be able to run the sshd daemon. Default is yes.</p>
<p><strong>X11Forwarding</strong>                    <br>
Allows or disallows remote access to graphical applications. Default is yes.</p>
<h3 id="client-configuration-file">Client Configuration File</h3>
<p><strong>/etc/ssh/ssh_config</strong></p>
<ul>
<li>Local configuration file that directs how the client should behave. This file, , is located in the /etc/ssh directory.</li>
<li>Directives preset in this file that affect all outbound ssh communication.</li>
</ul>
<p>View the default directive settings:
<code>[root@server30 tmp]# cat /etc/ssh/sshd_config</code></p>
<p><strong>Host</strong></p>
<ul>
<li>Container that declares directives applicable to one host, a group of hosts, or all hosts.</li>
<li>Ends when another occurrence of Host or Match is encountered. Default is *,  (all hosts)</li>
</ul>
<p><strong>ForwardX11</strong></p>
<ul>
<li>Enables or disables automatic redirection of X11 traffic over SSH connections.</li>
<li>Default is no.</li>
</ul>
<p><strong>PasswordAuthentication</strong></p>
<ul>
<li>Allows or disallows password authentication.</li>
<li>Default is yes.</li>
</ul>
<p><strong>StrictHostKeyChecking</strong></p>
<ul>
<li>
<p>Whether to add host keys (host fingerprints) to  ~/.ssh/known_hosts when accessing a host for the first time</p>
</li>
<li>
<p>What to do when the keys of a previously accessed host mismatch with what is stored in ~/.ssh/known_hosts.</p>
</li>
<li>
<p>no:</p>
<ul>
<li>Adds new host keys and ignores changes to existing keys.</li>
</ul>
</li>
<li>
<p>yes:</p>
<ul>
<li>Adds new host keys and disallows connections to hosts with non-matching keys.</li>
</ul>
</li>
<li>
<p>accept-new:</p>
<ul>
<li>Adds new host keys and disallows connections to hosts with non-matching keys.</li>
</ul>
</li>
<li>
<p>ask (default):</p>
<ul>
<li>Prompts whether to add new host keys and disallows connections to hosts with non-matching keys.</li>
</ul>
</li>
</ul>
<p><strong>IdentityFile</strong></p>
<ul>
<li>Defines the name and location of a file that stores a user&rsquo;s private key for their identity validation.</li>
<li>Defaults are:
<ul>
<li>id_rsa, id_dsa, and  id_ecdsa based on the type of algorithm used.</li>
<li>Corresponding public key files with .pub extension are also stored at the same directory location.</li>
</ul>
</li>
</ul>
<p><strong>Port</strong>                             <br>
Sets the port number to listen on. Default is 22.</p>
<p><strong>Protocol</strong>                         <br>
Specifies the default protocol version to use</p>
<p>~/.ssh/</p>
<ul>
<li>does not exist by default</li>
<li>created when:
<ul>
<li>a user executes the <code>ssh-keygen</code> command for the first time to generate a key pair</li>
<li>A user connects to a remote ssh server and accepts its host key for the first time.
<ul>
<li>The client stores the server&rsquo;s host key locally in a file called known_hosts along with its hostname or IP address.</li>
<li>On subsequent access attempts, the client will use this information to verify the server&rsquo;s authenticity.</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="system-access-and-file-transfer">System Access and File Transfer</h2>
<h3 id="lab-access-rhel-system-from-another-rhel-system">Lab: Access RHEL System from Another RHEL System</h3>
<ul>
<li>issue the ssh command as user1 on server10 to log in to server20.</li>
<li>Run appropriate commands on server20 for validation.</li>
<li>Log off and return to the originating system.</li>
</ul>
<p>1. Issue the ssh command as user1 on server10:</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#ff6ac1">[</span>user1@server30 tmp<span style="color:#ff6ac1">]</span>$ ssh server20</span></span></code></pre></div>
<p>2. Issue the basic Linux commands whoami, hostname, and pwd to confirm
that you are logged in as user1 on server20 and placed in the correct
home directory:</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#ff6ac1">[</span>user1@server40 ~<span style="color:#ff6ac1">]</span>$ whoami
</span></span><span style="display:flex;"><span>user1
</span></span><span style="display:flex;"><span><span style="color:#ff6ac1">[</span>user1@server40 ~<span style="color:#ff6ac1">]</span>$ hostname
</span></span><span style="display:flex;"><span>server40
</span></span><span style="display:flex;"><span><span style="color:#ff6ac1">[</span>user1@server40 ~<span style="color:#ff6ac1">]</span>$ <span style="color:#ff5c57">pwd</span>
</span></span><span style="display:flex;"><span>/home/user1</span></span></code></pre></div>
<p>3. Run the logout or the exit command or simply press the key combination Ctrl+d to log off server20 and return to server10:</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#ff6ac1">[</span>user1@server40 ~<span style="color:#ff6ac1">]</span>$ <span style="color:#ff5c57">exit</span>
</span></span><span style="display:flex;"><span><span style="color:#ff5c57">logout</span>
</span></span><span style="display:flex;"><span>Connection to server40 closed.</span></span></code></pre></div>
<p>If you wish to log on as a different user such as user2 (assuming user2
exists on the target server server20), you may run the ssh command in
either of the following ways:</p>
<p><code>[user1@server30 tmp]$ ssh -l user2 server40</code></p>
<p><code>[user1@server30 tmp]$ ssh user2@server40</code></p>
<h3 id="lab-generate-distribute-and-use-ssh-keys">Lab: Generate, Distribute, and Use SSH Keys</h3>
<ul>
<li>Generate a passwordless ssh key pair using RSA algorithm for user1 on server10.</li>
<li>display the private and public file contents.</li>
<li>Distribute the public key to server20 and attempt to log on to server20 from server10.</li>
<li>Show the log file message for the login attempt.</li>
</ul>
<p>1. Log on to server10 as user1.</p>
<p>2. Generate RSA keys without a password (-N) and without detailed
output (-q). Press Enter when prompted to provide the filename to store
the private key.</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#ff6ac1">[</span>user1@server30 tmp<span style="color:#ff6ac1">]</span>$ ssh-keygen -N <span style="color:#5af78e">&#34;&#34;</span> -q
</span></span><span style="display:flex;"><span>Enter file in which to save the key <span style="color:#ff6ac1">(</span>/home/user1/.ssh/id_rsa<span style="color:#ff6ac1">)</span>: </span></span></code></pre></div>
<p>View the private key:
<code>[user1@server30 tmp]$ cat ~/.ssh/id_rsa</code></p>
<p>View the public key:
<code>[user1@server30 tmp]$ cat ~/.ssh/id_rsa.pub</code></p>
<p>3. Copy the public key file to server20 under /home/user1/.ssh
directory.</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>user1@server30 tmp<span style="color:#ff6ac1">]</span>$ ssh-copy-id server40
</span></span><span style="display:flex;"><span>/usr/bin/ssh-copy-id: INFO: Source of key<span style="color:#ff6ac1">(</span>s<span style="color:#ff6ac1">)</span> to be installed: <span style="color:#5af78e">&#34;/home/user1/.ssh/id_rsa.pub&#34;</span>
</span></span><span style="display:flex;"><span>/usr/bin/ssh-copy-id: INFO: attempting to log in with the new key<span style="color:#ff6ac1">(</span>s<span style="color:#ff6ac1">)</span>, to filter out any that are already installed
</span></span><span style="display:flex;"><span>/usr/bin/ssh-copy-id: INFO: <span style="color:#ff9f43">1</span> key<span style="color:#ff6ac1">(</span>s<span style="color:#ff6ac1">)</span> remain to be installed -- <span style="color:#ff6ac1">if</span> you are prompted now it is to install the new keys
</span></span><span style="display:flex;"><span>user1@server40<span style="color:#5af78e">&#39;s password: 
</span></span></span><span style="display:flex;"><span><span style="color:#5af78e">
</span></span></span><span style="display:flex;"><span><span style="color:#5af78e">Number of key(s) added: 1
</span></span></span><span style="display:flex;"><span><span style="color:#5af78e">
</span></span></span><span style="display:flex;"><span><span style="color:#5af78e">Now try logging into the machine, with:   &#34;ssh &#39;</span>server40<span style="color:#ff5c57">&#39;</span><span style="color:#5af78e">&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#5af78e">and check to make sure that only the key(s) you wanted were added.</span></span></span></code></pre></div>
<ul>
<li>This command also creates or updates the known_hosts
file on server10 and stores the fingerprints for server20 in it.</li>
</ul>
<p><code>[user1@server30 tmp]$ cat ~/.ssh/known_hosts</code></p>
<p>4. On server10, run the ssh command as user1 to connect to server20.
You will not be prompted for a password because there was none assigned
to the ssh keys.</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#ff6ac1">[</span>user1@server30 tmp<span style="color:#ff6ac1">]</span>$ ssh server40
</span></span><span style="display:flex;"><span>Register this system with Red Hat Insights: insights-client --register
</span></span><span style="display:flex;"><span>Create an account or view all your systems at https://red.ht/insights-dashboard
</span></span><span style="display:flex;"><span>Last login: Sun Jul <span style="color:#ff9f43">21</span> 01:20:17 <span style="color:#ff9f43">2024</span> from 192.168.0.30</span></span></code></pre></div>
<p>View this login attempt in the /var/log/secure file on server20:
<code>[user1@server40 ~]$ sudo tail /var/log/secure</code></p>
<h3 id="executing-commands-remotely-using-ssh">Executing Commands Remotely Using ssh</h3>
<ul>
<li>Can use <code>ssh</code> command to run programs without remoting in:</li>
</ul>
<p>Execute the hostname command on server20:</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#ff6ac1">[</span>user1@server30 tmp<span style="color:#ff6ac1">]</span>$ ssh server40 hostname
</span></span><span style="display:flex;"><span>server40</span></span></code></pre></div>
<p>Run the <code>nmcli</code> command on server20 to show (s) active network connections(c):</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#ff6ac1">[</span>user1@server30 tmp<span style="color:#ff6ac1">]</span>$ ssh server40 nmcli c s
</span></span><span style="display:flex;"><span>NAME    UUID                                  TYPE      DEVICE 
</span></span><span style="display:flex;"><span>enp0s3  1c391bb6-20a3-4eb4-b717-1e458877dbe4  ethernet  enp0s3 
</span></span><span style="display:flex;"><span>lo      175f8a4c-1907-4006-b838-eb43438d847b  loopback  lo </span></span></code></pre></div>
<h3 id="sftp-command">sftp` command</h3>
<ul>
<li>Interactive file transfer tool.</li>
</ul>
<p>On server10, to connect to server20:</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#ff6ac1">[</span>user1@server30 tmp<span style="color:#ff6ac1">]</span>$ sftp server40
</span></span><span style="display:flex;"><span>Connected to server40.
</span></span><span style="display:flex;"><span>sftp&gt; </span></span></code></pre></div>
<p>Type ? at the prompt to list available commands along with a short description:</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#ff6ac1">[</span>user1@server30 tmp<span style="color:#ff6ac1">]</span>$ sftp server40
</span></span><span style="display:flex;"><span>Connected to server40.
</span></span><span style="display:flex;"><span>sftp&gt; ?
</span></span><span style="display:flex;"><span>Available commands:
</span></span><span style="display:flex;"><span>bye                                Quit sftp
</span></span><span style="display:flex;"><span><span style="color:#ff5c57">cd</span> path                            Change remote directory to <span style="color:#5af78e">&#39;path&#39;</span>
</span></span><span style="display:flex;"><span>chgrp <span style="color:#ff6ac1">[</span>-h<span style="color:#ff6ac1">]</span> grp path                Change group of file <span style="color:#5af78e">&#39;path&#39;</span> to <span style="color:#5af78e">&#39;grp&#39;</span>
</span></span><span style="display:flex;"><span>chmod <span style="color:#ff6ac1">[</span>-h<span style="color:#ff6ac1">]</span> mode path               Change permissions of file <span style="color:#5af78e">&#39;path&#39;</span> to <span style="color:#5af78e">&#39;mode&#39;</span>
</span></span><span style="display:flex;"><span>chown <span style="color:#ff6ac1">[</span>-h<span style="color:#ff6ac1">]</span> own path                Change owner of file <span style="color:#5af78e">&#39;path&#39;</span> to <span style="color:#5af78e">&#39;own&#39;</span>
</span></span><span style="display:flex;"><span>df <span style="color:#ff6ac1">[</span>-hi<span style="color:#ff6ac1">]</span> <span style="color:#ff6ac1">[</span>path<span style="color:#ff6ac1">]</span>                    Display statistics <span style="color:#ff6ac1">for</span> current directory or
</span></span><span style="display:flex;"><span>                                   filesystem containing <span style="color:#5af78e">&#39;path&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#ff5c57">exit</span>                               Quit sftp
</span></span><span style="display:flex;"><span>get <span style="color:#ff6ac1">[</span>-afpR<span style="color:#ff6ac1">]</span> remote <span style="color:#ff6ac1">[</span>local<span style="color:#ff6ac1">]</span>         Download file
</span></span><span style="display:flex;"><span><span style="color:#ff5c57">help</span>                               Display this <span style="color:#ff5c57">help</span> text
</span></span><span style="display:flex;"><span>lcd path                           Change <span style="color:#ff5c57">local</span> directory to <span style="color:#5af78e">&#39;path&#39;</span>
</span></span><span style="display:flex;"><span>lls <span style="color:#ff6ac1">[</span>ls-options <span style="color:#ff6ac1">[</span>path<span style="color:#ff6ac1">]]</span>            Display <span style="color:#ff5c57">local</span> directory listing
</span></span><span style="display:flex;"><span>lmkdir path                        Create <span style="color:#ff5c57">local</span> directory
</span></span><span style="display:flex;"><span>ln <span style="color:#ff6ac1">[</span>-s<span style="color:#ff6ac1">]</span> oldpath newpath            Link remote file <span style="color:#ff6ac1">(</span>-s <span style="color:#ff6ac1">for</span> symlink<span style="color:#ff6ac1">)</span>
</span></span><span style="display:flex;"><span>lpwd                               Print <span style="color:#ff5c57">local</span> working directory
</span></span><span style="display:flex;"><span>ls <span style="color:#ff6ac1">[</span>-1afhlnrSt<span style="color:#ff6ac1">]</span> <span style="color:#ff6ac1">[</span>path<span style="color:#ff6ac1">]</span>             Display remote directory listing
</span></span><span style="display:flex;"><span>lumask <span style="color:#ff5c57">umask</span>                       Set <span style="color:#ff5c57">local</span> <span style="color:#ff5c57">umask</span> to <span style="color:#5af78e">&#39;umask&#39;</span>
</span></span><span style="display:flex;"><span>mkdir path                         Create remote directory
</span></span><span style="display:flex;"><span>progress                           Toggle display of progress meter
</span></span><span style="display:flex;"><span>put <span style="color:#ff6ac1">[</span>-afpR<span style="color:#ff6ac1">]</span> <span style="color:#ff5c57">local</span> <span style="color:#ff6ac1">[</span>remote<span style="color:#ff6ac1">]</span>         Upload file
</span></span><span style="display:flex;"><span><span style="color:#ff5c57">pwd</span>                                Display remote working directory
</span></span><span style="display:flex;"><span>quit                               Quit sftp
</span></span><span style="display:flex;"><span>reget <span style="color:#ff6ac1">[</span>-fpR<span style="color:#ff6ac1">]</span> remote <span style="color:#ff6ac1">[</span>local<span style="color:#ff6ac1">]</span>        Resume download file
</span></span><span style="display:flex;"><span>rename oldpath newpath             Rename remote file
</span></span><span style="display:flex;"><span>reput <span style="color:#ff6ac1">[</span>-fpR<span style="color:#ff6ac1">]</span> <span style="color:#ff5c57">local</span> <span style="color:#ff6ac1">[</span>remote<span style="color:#ff6ac1">]</span>        Resume upload file
</span></span><span style="display:flex;"><span>rm path                            Delete remote file
</span></span><span style="display:flex;"><span>rmdir path                         Remove remote directory
</span></span><span style="display:flex;"><span>symlink oldpath newpath            Symlink remote file
</span></span><span style="display:flex;"><span>version                            Show SFTP version
</span></span><span style="display:flex;"><span>!command                           Execute <span style="color:#5af78e">&#39;command&#39;</span> in <span style="color:#ff5c57">local</span> shell
</span></span><span style="display:flex;"><span>!                                  Escape to <span style="color:#ff5c57">local</span> shell
</span></span><span style="display:flex;"><span>?                                  Synonym <span style="color:#ff6ac1">for</span> help</span></span></code></pre></div>
<p>Example:</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>sftp&gt; ls
</span></span><span style="display:flex;"><span>sftp&gt; mkdir /tmp/dir10-20
</span></span><span style="display:flex;"><span>sftp&gt; <span style="color:#ff5c57">cd</span> /tmp/dir10-20
</span></span><span style="display:flex;"><span>sftp&gt; <span style="color:#ff5c57">pwd</span>
</span></span><span style="display:flex;"><span>Remote working directory: /tmp/dir10-20
</span></span><span style="display:flex;"><span>sftp&gt; put /etc/group
</span></span><span style="display:flex;"><span>Uploading /etc/group to /tmp/dir10-20/group
</span></span><span style="display:flex;"><span>group                                       100% <span style="color:#ff9f43">1118</span>     1.0MB/s   00:00    
</span></span><span style="display:flex;"><span>sftp&gt; ls -l
</span></span><span style="display:flex;"><span>-rw-r--r--    <span style="color:#ff9f43">1</span> user1    user1        <span style="color:#ff9f43">1118</span> Jul <span style="color:#ff9f43">21</span> 01:41 group
</span></span><span style="display:flex;"><span>sftp&gt; <span style="color:#ff5c57">cd</span> ..
</span></span><span style="display:flex;"><span>sftp&gt; <span style="color:#ff5c57">pwd</span>
</span></span><span style="display:flex;"><span>Remote working directory: /tmp
</span></span><span style="display:flex;"><span>sftp&gt; <span style="color:#ff5c57">cd</span> /home/user1
</span></span><span style="display:flex;"><span>sftp&gt; get /usr/bin/gzip
</span></span><span style="display:flex;"><span>Fetching /usr/bin/gzip to gzip
</span></span><span style="display:flex;"><span>gzip                                        100%   90KB  23.0MB/s   00:00    
</span></span><span style="display:flex;"><span>sftp&gt; </span></span></code></pre></div>
<ul>
<li><code>lcd</code>, <code>lls</code>, <code>lpwd</code>, and <code>lmkdir</code> are run on the source server.</li>
<li>Other commands are also available. (See man pages)</li>
</ul>
<p>Type quit at the sftp&gt; prompt to exit the program when you&rsquo;re done:</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>sftp&gt; quit
</span></span><span style="display:flex;"><span><span style="color:#ff6ac1">[</span>user1@server30 tmp<span style="color:#ff6ac1">]</span>$ </span></span></code></pre></div>
<h2 id="secure-shell-service-diy-labs">Secure Shell Service DIY Labs</h2>
<h3 id="lab-establish-key-based-authentication">Lab: Establish Key-Based Authentication</h3>
<ul>
<li>Create user account user20 on both systems and assign a password.</li>
</ul>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#ff6ac1">[</span>root@server40 ~<span style="color:#ff6ac1">]</span><span style="color:#78787e"># adduser user20</span>
</span></span><span style="display:flex;"><span><span style="color:#ff6ac1">[</span>root@server40 ~<span style="color:#ff6ac1">]</span><span style="color:#78787e"># passwd user20</span>
</span></span><span style="display:flex;"><span>Changing password <span style="color:#ff6ac1">for</span> user user20.
</span></span><span style="display:flex;"><span>New password: 
</span></span><span style="display:flex;"><span>BAD PASSWORD: The password is shorter than <span style="color:#ff9f43">8</span> characters
</span></span><span style="display:flex;"><span>Retype new password: 
</span></span><span style="display:flex;"><span>passwd: all authentication tokens updated successfully.</span></span></code></pre></div>
<ul>
<li>As user20 on server40, generate a private/public key pair without a passphrase using the ssh-keygen command.</li>
</ul>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#ff6ac1">[</span>user20@server40 ~<span style="color:#ff6ac1">]</span><span style="color:#78787e"># ssh-keygen -N &#34;&#34; -q</span>
</span></span><span style="display:flex;"><span>Enter file in which to save the key <span style="color:#ff6ac1">(</span>/root/.ssh/id_rsa<span style="color:#ff6ac1">)</span>: </span></span></code></pre></div>
<ul>
<li>Distribute the public key to server30 with the ssh-copy-id command.
<code>[user20@server40 ~]# ssh-copy-id server30</code></li>
<li>Log on to server30 as user20 and accept the fingerprints for the server if presented.</li>
</ul>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#ff6ac1">[</span>user20@server40 ~<span style="color:#ff6ac1">]</span><span style="color:#78787e"># ssh server30</span>
</span></span><span style="display:flex;"><span>Activate the web console with: systemctl <span style="color:#ff5c57">enable</span> --now cockpit.socket
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Register this system with Red Hat Insights: insights-client --register
</span></span><span style="display:flex;"><span>Create an account or view all your systems at https://red.ht/insights-dashboard
</span></span><span style="display:flex;"><span>Last login: Fri Jul <span style="color:#ff9f43">19</span> 14:09:22 <span style="color:#ff9f43">2024</span>
</span></span><span style="display:flex;"><span><span style="color:#ff6ac1">[</span>user20@server30 ~<span style="color:#ff6ac1">]</span><span style="color:#78787e"># </span></span></span></code></pre></div>
<ul>
<li>On subsequent log in attempts from server40 to server30, user20 should not be prompted for their password.</li>
</ul>
<h3 id="lab-test-the-effect-of-permitrootlogin-directive">Lab: Test the Effect of PermitRootLogin Directive</h3>
<ul>
<li>
<p>As user1 with sudo on server30, edit the /etc/ssh/sshd_config file and change the value of the directive PermitRootLogin to &ldquo;no&rdquo;.
<code>[user1@server30 ~]$ sudo vim /etc/ssh/sshd_config</code></p>
</li>
<li>
<p>Use the systemctl command to activate the change.</p>
</li>
</ul>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#ff6ac1">[</span>user1@server30 ~<span style="color:#ff6ac1">]</span>$ systemctl restart <span style="color:#ff5c57">sshd</span>
</span></span><span style="display:flex;"><span><span style="color:#ff6ac1">====</span> AUTHENTICATING FOR org.freedesktop.systemd1.manage-units <span style="color:#ff6ac1">====</span>
</span></span><span style="display:flex;"><span>Authentication is required to restart <span style="color:#5af78e">&#39;sshd.service&#39;</span>.
</span></span><span style="display:flex;"><span>Authenticating as: root
</span></span><span style="display:flex;"><span>Password: 
</span></span><span style="display:flex;"><span><span style="color:#ff6ac1">====</span> AUTHENTICATION <span style="color:#ff5c57">COMPLETE</span> <span style="color:#ff6ac1">====</span></span></span></code></pre></div>
<ul>
<li>As root on server40, run ssh server40 (or use its IP). You&rsquo;ll get permission denied message.</li>
</ul>
<p>(this didn&rsquo;t work, I think it&rsquo;s because I configured passwordless authentication on here)</p>
<ul>
<li>Reverse the change on server40 and retry ssh server40. You should be able to log in.</li>
</ul>

  <footer class="footline">
  </footer>
</article>
          </section>
        </div>
      </main>
    </div>
    <script>
      window.MathJax = Object.assign( window.MathJax || {}, {
        tex: {
          inlineMath:  [['\\(', '\\)'], ['$',  '$']],  
          displayMath: [['\\[', '\\]'], ['$$', '$$']], 
        },
        options: {
          enableMenu: false 
        }
      }, JSON.parse("{}") );
    </script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="/js/js-yaml/js-yaml.min.js?1764240624" defer></script>
    <script src="/js/d3/d3-color.min.js?1764240624" defer></script>
    <script src="/js/d3/d3-dispatch.min.js?1764240624" defer></script>
    <script src="/js/d3/d3-drag.min.js?1764240624" defer></script>
    <script src="/js/d3/d3-ease.min.js?1764240624" defer></script>
    <script src="/js/d3/d3-interpolate.min.js?1764240624" defer></script>
    <script src="/js/d3/d3-selection.min.js?1764240624" defer></script>
    <script src="/js/d3/d3-timer.min.js?1764240624" defer></script>
    <script src="/js/d3/d3-transition.min.js?1764240624" defer></script>
    <script src="/js/d3/d3-zoom.min.js?1764240624" defer></script>
    <script src="https://unpkg.com/mermaid/dist/mermaid.min.js" defer></script>
    <script>
      window.relearn.themeUseMermaid = JSON.parse("{ \"theme\": \"default\" }");
    </script>
    <script src="/js/clipboard/clipboard.min.js?1764240624" defer></script>
    <script src="/js/perfect-scrollbar/perfect-scrollbar.min.js?1764240624" defer></script>
    <script src="/js/theme.min.js?1764240624" defer></script>
  </body>
</html>
