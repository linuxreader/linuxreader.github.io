<!DOCTYPE html>
<html lang="en-us" dir="ltr" itemscope itemtype="http://schema.org/Article" data-r-output-format="print">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="height=device-height, width=device-width, initial-scale=1.0, minimum-scale=1.0">
    <meta name="generator" content="Hugo 0.149.0">
    <meta name="generator" content="Relearn 8.0.0+9803d5122ebb3276acea823f476e9eb44f607862">
    <meta name="description" content="Security Enhanced LinuxThe confusing world of SELinux
The Linux FirewallFirewalld stuff mostly">
    <meta name="author" content="David Thomas">
    <meta name="twitter:card" content="summary">
    <meta name="twitter:title" content="Cyber Security :: Linux Reader">
    <meta name="twitter:description" content="Security Enhanced LinuxThe confusing world of SELinux
The Linux FirewallFirewalld stuff mostly">
    <meta property="og:url" content="http://linuxreader.com/cyber-security/">
    <meta property="og:site_name" content="Linux Reader">
    <meta property="og:title" content="Cyber Security :: Linux Reader">
    <meta property="og:description" content="Security Enhanced LinuxThe confusing world of SELinux
The Linux FirewallFirewalld stuff mostly">
    <meta property="og:locale" content="en_us">
    <meta property="og:type" content="website">
    <meta itemprop="name" content="Cyber Security :: Linux Reader">
    <meta itemprop="description" content="Security Enhanced LinuxThe confusing world of SELinux
The Linux FirewallFirewalld stuff mostly">
    <meta itemprop="wordCount" content="12">
    <title>Cyber Security :: Linux Reader</title>
    <link href="http://linuxreader.com/cyber-security/" rel="canonical" type="text/html" title="Cyber Security :: Linux Reader">
    <link href="/cyber-security/index.xml" rel="alternate" type="application/rss+xml" title="Cyber Security :: Linux Reader">
    <link href="/images/favicon.svg?1756899454" rel="icon" type="image/svg+xml">
    <link href="/css/auto-complete/auto-complete.min.css?1756899454" rel="stylesheet">
    <script src="/js/auto-complete/auto-complete.min.js?1756899454" defer></script>
    <script src="/js/search-lunr.min.js?1756899454" defer></script>
    <script src="/js/search.min.js?1756899454" defer></script>
    <script>
      window.relearn = window.relearn || {};
      window.relearn.index_js_url="/searchindex.en.js?1756899454";
    </script>
    <script src="/js/lunr/lunr.min.js?1756899454" defer></script>
    <script src="/js/lunr/lunr.stemmer.support.min.js?1756899454" defer></script>
    <script src="/js/lunr/lunr.multi.min.js?1756899454" defer></script>
    <script src="/js/lunr/lunr.en.min.js?1756899454" defer></script>
    <script>
      window.relearn = window.relearn || {};
      window.relearn.contentLangs=['en'];
    </script>
    <link href="/fonts/fontawesome/css/fontawesome-all.min.css?1756899454" rel="stylesheet" media="print" onload="this.media='all';this.onload=null;"><noscript><link href="/fonts/fontawesome/css/fontawesome-all.min.css?1756899454" rel="stylesheet"></noscript>
    <link href="/css/perfect-scrollbar/perfect-scrollbar.min.css?1756899454" rel="stylesheet">
    <link href="/css/theme.min.css?1756899454" rel="stylesheet">
    <link href="/css/format-print.min.css?1756899454" rel="stylesheet" id="R-format-style">
    <script>
      window.relearn = window.relearn || {};
      // configuration
      window.relearn.min = `.min`;
      window.relearn.path='\/cyber-security\/';
      window.relearn.relBasePath='..';
      window.relearn.relBaseUri='..';
      window.relearn.absBaseUri='http:\/\/linuxreader.com';
      window.relearn.disableAnchorCopy=false;
      window.relearn.disableAnchorScrolling=false;
      window.relearn.disableInlineCopyToClipboard=true;
      window.relearn.enableBlockCodeWrap=true;
      // legal
      window.relearn.getItem = (s,n) => {return s.getItem(n)};
      window.relearn.setItem = (s,n,v) => {return s.setItem(n,v)};
      window.relearn.removeItem = (s,n) => {return s.removeItem(n)};
      // translations
      window.T_Copy_to_clipboard = `Copy to clipboard`;
      window.T_Copied_to_clipboard = `Copied to clipboard!`;
      window.T_Copy_link_to_clipboard = `Copy link to clipboard`;
      window.T_Link_copied_to_clipboard = `Copied link to clipboard!`;
      window.T_Reset_view = `Reset view`;
      window.T_View_reset = `View reset!`;
      window.T_No_results_found = `No results found for "{0}"`;
      window.T_N_results_found = `{1} results found for "{0}"`;
      // variant stuff
      window.relearn.themevariants = [ 'oled' ];
      window.relearn.customvariantname = "my-custom-variant";
      window.relearn.changeVariant = function(variant) {
        var oldVariant = document.documentElement.dataset.rThemeVariant;
        window.relearn.setItem(window.localStorage, window.relearn.absBaseUri + "/variant", variant);
        document.documentElement.dataset.rThemeVariant = variant;
        if (oldVariant != variant) {
          document.dispatchEvent( new CustomEvent('themeVariantLoaded', { detail: { variant, oldVariant } }) );
          window.relearn.markVariant();
        }
      }
      window.relearn.markVariant = function() {
        var variant = window.relearn.getItem(window.localStorage, window.relearn.absBaseUri + "/variant");
        document.querySelectorAll(".R-variantswitcher select").forEach((select) => {select.value = variant;});
      }
      window.relearn.initVariant = function() {
        var variant = window.relearn.getItem(window.localStorage, window.relearn.absBaseUri + "/variant") ?? "";
        if( variant == window.relearn.customvariantname ){
        }else if( !variant || !window.relearn.themevariants.includes(variant) ){
          variant = window.relearn.themevariants[0];
          window.relearn.setItem(window.localStorage, window.relearn.absBaseUri + "/variant", variant);
        }
        document.documentElement.dataset.rThemeVariant = variant;
      }
      window.relearn.initVariant();
      window.relearn.markVariant();
    </script><style>
:root {
    --MENU-WIDTH-S: 14.375rem;
    --MENU-WIDTH-M: 14.375rem;
    --MENU-WIDTH-L: 18.75rem;
    --MAIN-WIDTH-MAX: 80rem;
    font-size: 1.2rem;
}
</style>

  </head>
  <body class="mobile-support print" data-url="/cyber-security/">
    <div id="R-body" class="default-animation">
      <div id="R-body-overlay"></div>
      <nav id="R-topbar">
        <div class="topbar-wrapper">
          <div class="topbar-sidebar-divider"></div>
          <div class="topbar-area topbar-area-start" data-area="start">
            <div class="topbar-button topbar-button-sidebar" data-content-empty="disable" data-width-s="show" data-width-m="hide" data-width-l="hide"><button class="topbar-control" onclick="toggleNav()" type="button" title="Menu (CTRL&#43;ALT&#43;n)"><i class="fa-fw fas fa-bars"></i></button>
            </div>
            <div class="topbar-button topbar-button-prev" data-content-empty="disable" data-width-s="show" data-width-m="show" data-width-l="show"><a class="topbar-control" href="/containers/containers/" title="Containers (ðŸ¡)"><i class="fa-fw fas fa-chevron-left"></i></a>
            </div>

            <div class="topbar-button topbar-button-toc" data-content-empty="hide" data-width-s="show" data-width-m="show" data-width-l="show"><button class="topbar-control" onclick="toggleTopbarFlyout(this)" type="button" title="Table of Contents (CTRL&#43;ALT&#43;t)"><i class="fa-fw fas fa-list-alt"></i></button>
              <div class="topbar-content">
                <div class="topbar-content-wrapper"> 
                </div>
              </div>
            </div>


          </div>
          <span class="topbar-breadcrumbs highlightable">
            Cyber Security
          </span>
          <div class="topbar-area topbar-area-end" data-area="end">
            <div class="topbar-button topbar-button-print" data-content-empty="disable" data-width-s="area-more" data-width-m="show" data-width-l="show"><a class="topbar-control" href="/cyber-security/index.print.html" title="Print whole chapter (CTRL+ALT+p)"><i class="fa-fw fas fa-print"></i></a>
            </div>

            <div class="topbar-button topbar-button-next" data-content-empty="disable" data-width-s="show" data-width-m="show" data-width-l="show"><a class="topbar-control" href="/cyber-security/security-enhanced-linux/" title="Security Enhanced Linux (ðŸ¡’)"><i class="fa-fw fas fa-chevron-right"></i></a>
            </div>







          </div>
        </div>
      </nav>
      <div id="R-main-overlay"></div>
      <main id="R-body-inner" class="highlightable cyber-security" tabindex="-1">
        <div class="flex-block-wrapper">
<article class="default">
  <header class="headline">
  </header>

<h1 id="cyber-security">Cyber Security</h1>

<div class="children children-h6 children-sort-">
  <h6 class="children-title" id="security-enhanced-linux"><a href="/cyber-security/security-enhanced-linux/">Security Enhanced Linux</a></h6><p>The confusing world of SELinux</p>
  <h6 class="children-title" id="the-linux-firewall"><a href="/cyber-security/the-linux-firewall/">The Linux Firewall</a></h6><p>Firewalld stuff mostly</p>
</div>

  <footer class="footline">
  </footer>
</article>
          <section>
            <h1 class="a11y-only">Subsections of Cyber Security</h1>
<article class="default">
  <header class="headline">
  </header>

<h1 id="security-enhanced-linux">Security Enhanced Linux</h1>

<h2 id="selinux-terminology">SELinux Terminology</h2>
<ul>
<li>
<p>Implementation of the Mandatory Access Control (MAC) architecture</p>
<ul>
<li>developed by the U.S. National Security Agency (NSA)</li>
<li>flexible, enriched, and granular security controls in Linux.</li>
<li>integrated into the Linux kernel as a set of patches using the Linux Security Modules (LSM) framework
<ul>
<li>allows the kernel to support various security implementations</li>
</ul>
</li>
<li>provides an added layer of protection above and beyond the standard Linux Discretionary Access Control (DAC) security architecture.</li>
<li>DAC includes:
<ul>
<li>traditional file and directory permissions</li>
<li>extended attribute settings</li>
<li>setuid/setgid bits</li>
<li>su/sudo privileges</li>
<li>etc.</li>
</ul>
</li>
<li>Limits the ability of a <strong>subject</strong> (Linux user or process) to access an <strong>object</strong> (file, directory, file system, device, network interface/connection, port, pipe, socket, etc.)
<ul>
<li>To reduce or eliminate the potential damage the subject may be able to inflict on the system if compromised.</li>
</ul>
</li>
</ul>
</li>
<li>
<p><strong>MAC controls</strong></p>
<ul>
<li>Fine-grained</li>
<li>Protect other services in the event one service is negotiated.</li>
<li>Example:
<ul>
<li>If the HTTP service process is compromised, the attacker can only damage the files the hacked process will have access to, and not the other processes running on the system, or the objects the other processes will have access to.</li>
</ul>
</li>
<li>To ensure this coarse-grained control, MAC uses a set of defined authorization rules called <strong>policy</strong> to examine security attributes associated with subjects and objects when a subject tries to access an object, and decides whether to permit the access attempt.</li>
<li>These attributes are stored in <strong>contexts</strong> (a.k.a. <strong>labels</strong>), and are applied to both subjects and objects.</li>
</ul>
</li>
<li>
<p>SELinux decisions are stored in a special cache area called <strong>Access</strong> <strong>Vector Cache</strong> (<strong>AVC</strong>).</p>
</li>
<li>
<p>This cache area is checked for each access attempt by a process to determine whether the access attempt was previously allowed.</p>
</li>
<li>
<p>With this mechanism in place, SELinux does not have to check the policy ruleset repeatedly, thus improving performance.</p>
</li>
<li>
<p>SELinux is enabled by default</p>
<ul>
<li>Confines processes to the bare minimum privileges that they need to function.</li>
</ul>
</li>
</ul>
<h3 id="key-terms">Key Terms</h3>
<p><strong>Subject</strong></p>
<ul>
<li>Any user or process that accesses an object.</li>
<li>Examples:
<ul>
<li><em>system_u</em> for the SELinux system user</li>
<li><em>unconfined_u</em> for subjects that are not bound by the SELinux policy</li>
</ul>
</li>
<li>Stored in field 1 of the context.</li>
</ul>
<p><strong>Object</strong></p>
<ul>
<li>A resource, such as a file, directory, hardware device, network interface/connection, port, pipe, or socket, that a subject accesses.</li>
<li>Examples:
<ul>
<li><em>object_r</em> for general objects</li>
<li><em>system_r</em> for system-owned objects</li>
<li><em>unconfined_r</em> for objects that are not bound by the SELinux policy.</li>
</ul>
</li>
</ul>
<p><strong>Access</strong></p>
<ul>
<li>An action performed by the subject on an object.</li>
<li>Examples:
<ul>
<li>creating, reading, or updating a file</li>
<li>creating or navigating a directory</li>
<li>accessing a network port or socket</li>
</ul>
</li>
</ul>
<p><strong>Policy</strong></p>
<ul>
<li>A defined ruleset that is enforced system-wide</li>
<li>Used to analyze security attributes assigned to subjects and objects.</li>
<li>Referenced to decide whether to permit a subject&rsquo;s access attempt to an object, or a subject&rsquo;s attempt to interact with another subject.</li>
<li>The default behavior of SELinux in the absence of a rule is to deny the access.</li>
<li>Standard preconfigured policies:
<ul>
<li><strong>targeted</strong> (default)
<ul>
<li>Any process that is targeted runs in a confined domain</li>
<li>Any process that is not targeted runs in an unconfined domain.</li>
<li>Example:
<ul>
<li>SELinux runs logged-in users in the unconfined domain, and the httpd process in a confined domain by default.</li>
<li>Any subject running unconfined is more vulnerable than the one running confined.</li>
</ul>
</li>
</ul>
</li>
<li><strong>mls</strong>
<ul>
<li>Places tight security controls at deeper levels.</li>
</ul>
</li>
<li><strong>minimum</strong>
<ul>
<li>light version of the targeted policy</li>
<li>designed to protect only selected processes.</li>
</ul>
</li>
</ul>
</li>
</ul>
<p><strong>Context</strong> (label)</p>
<ul>
<li>A tag to store security attributes for subjects and objects.</li>
<li>Every subject and object has a context assigned</li>
<li>Consists of a SELinux user, role, type (or domain), and sensitivity level.</li>
<li>Used by SELinux  to make access control decisions.</li>
</ul>
<p><strong>Labeling</strong></p>
<ul>
<li>Mapping of files with their stored contexts.</li>
</ul>
<p><strong>SELinux User</strong></p>
<ul>
<li>Several predefined SELinux user identities that are authorized for a particular set of roles.</li>
<li>Linux user to SELinux user identity mapping to place SELinux user restrictions on Linux users.</li>
<li>Controls what roles and levels a process (with a particular SELinux user identity) can enter.</li>
<li>Example:
<ul>
<li>A Linux user cannot run the <code>su</code> and <code>sudo</code> commands or the programs located in their home directories if they are mapped to the SELinux user <em>user_u</em>.</li>
</ul>
</li>
</ul>
<p><strong>Role</strong></p>
<ul>
<li>An attribute of the <strong>Role-Based Access Control (RBAC)</strong> security model that is part of SELinux.</li>
<li>Classifies who (subject) is allowed to access what (domains or types).</li>
<li>SELinux users are authorized for roles, and roles are authorized for domains and types.</li>
<li>Each subject has an associated role to ensure that the system and user processes are separated.</li>
<li>A subject can transition into a new role to gain access to other domains and types.</li>
<li>Examples:
<ul>
<li><em>user_r</em> for ordinary users</li>
<li><em>sysadm_r</em> for administrators</li>
<li><em>system_r</em> for processes that initiate under the <em>system_r</em> role</li>
</ul>
</li>
<li>Stored in field 2 of the context.</li>
</ul>
<p><strong>Type Enforcement</strong> (TE)</p>
<ul>
<li>Identifies and limits a subject&rsquo;s ability to access domains for processes, and types for files.</li>
<li>References the contexts of the subjects and objects for this enforcement.</li>
</ul>
<p><strong>Type</strong></p>
<ul>
<li>Attribute of type enforcement.</li>
<li>Group of objects based on uniformity in their security requirements.</li>
<li>Objects such as files and directories with common security requirements, are grouped within a specific type.</li>
<li>Examples:
<ul>
<li><em>user_home_dir_t</em> for objects located in user home directories</li>
<li><em>usr_t</em> for most objects stored in the /usr directory.</li>
</ul>
</li>
<li>Stored in field 3 of a file context.</li>
</ul>
<p><strong>Domain</strong></p>
<ul>
<li>Determines the type of access that a process has.</li>
<li>Processes with common security requirements are grouped within a specific domain type, and they run confined within that domain.</li>
<li>Examples:
<ul>
<li><em>init_t</em> for the systemd process</li>
<li><em>firewalld_t</em> for the firewalld process</li>
<li><em>unconfined_t</em> for all processes that are not bound by SELinux policy.</li>
</ul>
</li>
<li>Stored in field 3 of a process context.</li>
</ul>
<p><strong>Rules</strong></p>
<ul>
<li>Outline how types can access each other, domains can access types, and domains can access each other.</li>
</ul>
<p><strong>Level</strong></p>
<ul>
<li>An attribute of <strong>Multi-Level Security (MLS)</strong> and <strong>Multi-Category</strong> <strong>Security (MCS)</strong>.</li>
<li>Pair of <em>sensitivity:category</em> values that defines the level of security in the context.</li>
<li><em>category</em> may be defined as a single value or a range of values, such as c0.c4 to represent c0 through c4.</li>
<li>In RHEL 9, the targeted policy is used as the default, which enforces <strong>MCS</strong> (MCS supports only one sensitivity level (s0) with 0 to 1023 different categories).</li>
</ul>
<h2 id="selinux-contexts">SELinux Contexts</h2>
<h3 id="selinux-contexts-for-users">SELinux Contexts for Users</h3>
<ul>
<li>SELinux contexts define security attributes placed on subjects and objects.</li>
<li>Each context contains a type and a security level with subject and object information.</li>
</ul>
<p>Use the <code>id</code> command with the <code>-Z</code> option to view the context set on Linux users:</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#ff6ac1">[</span>root@server30 ~<span style="color:#ff6ac1">]</span><span style="color:#78787e"># id -Z</span>
</span></span><span style="display:flex;"><span>unconfined_u:unconfined_r:unconfined_t:s0-s0:c0.c1023</span></span></code></pre></div>
<p>Output:</p>
<ul>
<li>
<p>Mapped to the SELinux unconfined_u user</p>
</li>
<li>
<p>No SELinux restrictions placed on this user.</p>
</li>
<li>
<p>All Linux users, including root, run unconfined by default, (full system access)</p>
</li>
<li>
<p>Seven confined user identities with restricted access to objects.</p>
<ul>
<li>Mapped to Linux users via SELinux policy.</li>
<li>Helps safeguard the system from potential damage that Linux users might inflict on the system.</li>
</ul>
</li>
</ul>
<p>Use the <code>seinfo</code> query command to list the SELinux users; however, the <code>setools-console</code> software package must be installed before doing so.</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#ff6ac1">[</span>root@server30 ~<span style="color:#ff6ac1">]</span><span style="color:#78787e"># seinfo -u</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Users: <span style="color:#ff9f43">8</span>
</span></span><span style="display:flex;"><span>   guest_u
</span></span><span style="display:flex;"><span>   root
</span></span><span style="display:flex;"><span>   staff_u
</span></span><span style="display:flex;"><span>   sysadm_u
</span></span><span style="display:flex;"><span>   system_u
</span></span><span style="display:flex;"><span>   unconfined_u
</span></span><span style="display:flex;"><span>   user_u
</span></span><span style="display:flex;"><span>   xguest_u</span></span></code></pre></div>
<p>Use the <code>semanage</code> command to view the mapping between Linux and SELinux users:</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#ff6ac1">[</span>root@server30 ~<span style="color:#ff6ac1">]</span><span style="color:#78787e"># semanage login -l</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Login Name           SELinux User         MLS/MCS Range        Service
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>__default__          unconfined_u         s0-s0:c0.c1023       *
</span></span><span style="display:flex;"><span>root                 unconfined_u         s0-s0:c0.c1023       *</span></span></code></pre></div>
<p><strong>MLS/MCS Range</strong></p>
<ul>
<li>Associated security level and the context for the Linux user (the * represents all services).</li>
<li>By default, all non-root Linux users are represented as <code>__default__</code>, which is mapped to the unconfined_u user in the policy.</li>
</ul>
<h3 id="selinux-contexts-for-processes">SELinux Contexts for Processes</h3>
<p>Determine the context for processes using the <code>ps</code> command with the <code>-Z</code> flag:</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#ff6ac1">[</span>root@server30 ~<span style="color:#ff6ac1">]</span><span style="color:#78787e"># ps -eZ | head -2</span>
</span></span><span style="display:flex;"><span>LABEL                               PID TTY          TIME CMD
</span></span><span style="display:flex;"><span>system_u:system_r:init_t:s0           <span style="color:#ff9f43">1</span> ?        00:00:02 systemd</span></span></code></pre></div>
<p>Output:</p>
<ul>
<li>
<p>The subject <em>system_u</em> is a SELinux username (mapped to Linux user root)</p>
</li>
<li>
<p>Object is <em>system_r</em></p>
</li>
<li>
<p>Domain <em>init_t</em> reveals the type of protection applied to the process.</p>
</li>
<li>
<p>Level of security <code>s0</code></p>
</li>
<li>
<p>A process that is unprotected will run in the unconfined_t domain.</p>
</li>
</ul>
<h3 id="selinux-contexts-for-files">SELinux Contexts for Files</h3>
<p><code>ls -Z</code></p>
<ul>
<li>View context for files and directories.</li>
</ul>
<p>Show the four attributes set on the /etc/passwd file:</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#ff6ac1">[</span>root@server30 ~<span style="color:#ff6ac1">]</span><span style="color:#78787e"># ls -lZ /etc/passwd</span>
</span></span><span style="display:flex;"><span>-rw-r--r--. <span style="color:#ff9f43">1</span> root root system_u:object_r:passwd_file_t:s0 <span style="color:#ff9f43">2806</span> Jul <span style="color:#ff9f43">19</span> 21:54 /etc/passwd</span></span></code></pre></div>
<ul>
<li>Subject <em>system_u</em></li>
<li>Object <em>object_r</em></li>
<li>Type <code>passwd_file_t</code></li>
<li>Security level <code>s0</code> for the passwd file.</li>
</ul>
<p><em>/etc/selinux/targeted/contexts/files/file_contexts</em>
<em>/etc/selinux/targeted/contexts/files/file_contexts.local</em></p>
<ul>
<li>Stores contexts for system-installed and user-created files.</li>
<li>Policy files.</li>
<li>Can be updated using the <code>semanage</code> command.</li>
</ul>
<h3 id="copying-moving-and-archiving-files-with-selinux-contexts">Copying, Moving, and Archiving Files with SELinux Contexts</h3>
<ul>
<li>All files in RHEL are labeled with an SELINUX security context by default.</li>
<li>New files inherit the parent directory&rsquo;s context at the time of creation.</li>
</ul>
<p>Rules for copy move and archive:</p>
<ol>
<li>
<p>If a file is copied to a different directory, the destination file will receive the destination directory&rsquo;s context, unless the <code>--preserve=context</code> switch is specified with the <code>cp</code> command to retain the source file&rsquo;s original context.</p>
</li>
<li>
<p>If a copy operation overwrites the destination file in the same or different directory, the file being copied will receive the context of the overwritten file, unless the <code>--preserve=context</code> switch is specified with the <code>cp</code> command to preserve the source file&rsquo;s original context.</p>
</li>
<li>
<p>If a file is moved to the same or different directory, the SELinux context will remain intact, which may differ from the destination directory&rsquo;s context.</p>
</li>
<li>
<p>If a file is archived with the tar command, use the <code>--selinux</code> option to preserve the context.</p>
</li>
</ol>
<h3 id="selinux-contexts-for-ports">SELinux Contexts for Ports</h3>
<p>View attributes for network ports with the <code>semanage</code> command:</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#ff6ac1">[</span>root@server30 ~<span style="color:#ff6ac1">]</span><span style="color:#78787e"># semanage port -l | head -7</span>
</span></span><span style="display:flex;"><span>SELinux Port Type              Proto    Port Number
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>afs3_callback_port_t           tcp      <span style="color:#ff9f43">7001</span>
</span></span><span style="display:flex;"><span>afs3_callback_port_t           udp      <span style="color:#ff9f43">7001</span>
</span></span><span style="display:flex;"><span>afs_bos_port_t                 udp      <span style="color:#ff9f43">7007</span>
</span></span><span style="display:flex;"><span>afs_fs_port_t                  tcp      <span style="color:#ff9f43">2040</span>
</span></span><span style="display:flex;"><span>afs_fs_port_t                  udp      7000, <span style="color:#ff9f43">7005</span></span></span></code></pre></div>
<ul>
<li>By default, SELinux allows services to listen on a restricted set of network ports only.</li>
</ul>
<h2 id="domain-transitioning">Domain Transitioning</h2>
<ul>
<li>SELinux allows a process running in one domain to enter another domain to execute an application that is restricted to run in that domain only.</li>
<li>A rule must exist in the policy to support such transition.</li>
<li><strong>entrypoint</strong>
<ul>
<li>Permission setting</li>
<li>Control processes that can transition into another domain.</li>
</ul>
</li>
</ul>
<p>Example:
What happens when a Linux user attempts to change their password using the <code>/usr/bin/passwd</code> command.</p>
<p>The <code>passwd</code> command is labeled with the passwd_exec_t type:</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#ff6ac1">[</span>root@server30 ~<span style="color:#ff6ac1">]</span><span style="color:#78787e"># ls -lZ /usr/bin/passwd</span>
</span></span><span style="display:flex;"><span>-rwsr-xr-x. <span style="color:#ff9f43">1</span> root root system_u:object_r:passwd_exec_t:s0 <span style="color:#ff9f43">32648</span> Aug <span style="color:#ff9f43">10</span>  <span style="color:#ff9f43">2021</span> /usr/bin/passwd</span></span></code></pre></div>
<p>The <code>passwd</code> command requires access to the <code>/etc/shadow</code> file in order to modify a user password. The shadow file has a different type set on it
(<em>shadow_t</em>):</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>**<span style="color:#ff6ac1">[</span>root@server30 ~<span style="color:#ff6ac1">]</span><span style="color:#78787e"># ls -lZ /etc/shadow</span>
</span></span><span style="display:flex;"><span>----------. <span style="color:#ff9f43">1</span> root root system_u:object_r:shadow_t:s0 <span style="color:#ff9f43">2756</span> Jul <span style="color:#ff9f43">19</span> 21:54 /etc/shadow</span></span></code></pre></div>
<ul>
<li>The SELinux policy has rules that specifically allow processes running in domain <em>passwd_t</em> to read and modify the files with type <em>shadow_t</em>, and allow them <strong>entrypoint</strong> permission into domain <em>passwd_exec_t</em>.</li>
<li>This rule enables the user&rsquo;s shell process executing the <code>passwd</code> command to switch into the <em>passwd_t</em> domain and update the shadow file.</li>
</ul>
<p>Open two terminal windows. In window 1, issue the passwd command as
user1 and wait at the prompt:</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#ff6ac1">[</span>user1@server30 root<span style="color:#ff6ac1">]</span>$ passwd
</span></span><span style="display:flex;"><span>Changing password <span style="color:#ff6ac1">for</span> user user1.
</span></span><span style="display:flex;"><span>Current password: </span></span></code></pre></div>
<p>In window 2, run the ps command:</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#ff6ac1">[</span>root@server30 ~<span style="color:#ff6ac1">]</span><span style="color:#78787e"># ps -eZ | grep passwd</span>
</span></span><span style="display:flex;"><span>unconfined_u:unconfined_r:passwd_t:s0-s0:c0.c1023 <span style="color:#ff9f43">13001</span> pts/1 00:00:00 passwd</span></span></code></pre></div>
<ul>
<li>The <code>passwd</code> command (process) transitioned into the <em>passwd_t</em> domain to change the user password.</li>
</ul>
<h2 id="selinux-booleans">SELinux Booleans</h2>
<ul>
<li>on/off switches that SELinux uses to determine whether to permit an action.</li>
<li>Activate or deactivate certain rule in the SELinux policy immediately and without the need to recompile or reload the policy.</li>
<li>For instance, the <em>ftpd_anon_write</em> Boolean can be turned on to enable anonymous users to upload files.</li>
<li>This privilege can be revoked by turning this Boolean off.</li>
<li>Boolean values are stored in virtual files located in <em>/sys/fs/selinux/booleans/</em>.</li>
<li>The filenames match the Boolean names.</li>
</ul>
<p>A sample listing of this directory is provided below:</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#ff6ac1">[</span>root@server30 ~<span style="color:#ff6ac1">]</span><span style="color:#78787e"># ls -l /sys/fs/selinux/booleans/ | head -7</span>
</span></span><span style="display:flex;"><span>total <span style="color:#ff9f43">0</span>
</span></span><span style="display:flex;"><span>-rw-r--r--. <span style="color:#ff9f43">1</span> root root <span style="color:#ff9f43">0</span> Jul <span style="color:#ff9f43">23</span> 04:44 abrt_anon_write
</span></span><span style="display:flex;"><span>-rw-r--r--. <span style="color:#ff9f43">1</span> root root <span style="color:#ff9f43">0</span> Jul <span style="color:#ff9f43">23</span> 04:44 abrt_handle_event
</span></span><span style="display:flex;"><span>-rw-r--r--. <span style="color:#ff9f43">1</span> root root <span style="color:#ff9f43">0</span> Jul <span style="color:#ff9f43">23</span> 04:44 abrt_upload_watch_anon_write
</span></span><span style="display:flex;"><span>-rw-r--r--. <span style="color:#ff9f43">1</span> root root <span style="color:#ff9f43">0</span> Jul <span style="color:#ff9f43">23</span> 04:44 antivirus_can_scan_system
</span></span><span style="display:flex;"><span>-rw-r--r--. <span style="color:#ff9f43">1</span> root root <span style="color:#ff9f43">0</span> Jul <span style="color:#ff9f43">23</span> 04:44 antivirus_use_jit
</span></span><span style="display:flex;"><span>-rw-r--r--. <span style="color:#ff9f43">1</span> root root <span style="color:#ff9f43">0</span> Jul <span style="color:#ff9f43">23</span> 04:44 auditadm_exec_content</span></span></code></pre></div>
<ul>
<li>
<p>The manual pages of the Booleans are available through the <code>selinux-policy-doc</code> package.</p>
</li>
<li>
<p>Once installed, use the <code>-K</code> option with the <code>man</code> command to bring the pages up for a specific Boolean.</p>
</li>
<li>
<p>For instance, issue <code>man -K abrt_anon_write</code> to view the manual pages for the <code>abrt_anon_write</code> Boolean.</p>
</li>
<li>
<p>Can be viewed, and flipped temporarily or for permanence.</p>
</li>
<li>
<p>New value takes effect right away.</p>
</li>
<li>
<p>Temporary changes are stored as a &ldquo;1&rdquo; or &ldquo;0&rdquo; in the corresponding Boolean file in the <em>/sys/fs/selinux/booleans/</em></p>
</li>
<li>
<p>Permanent changes are saved in the policy database.</p>
</li>
</ul>
<h2 id="selinux-administration">SELinux Administration</h2>
<ul>
<li>Controlling the activation mode, checking operational status, setting security contexts on subjects and objects, and switching Boolean values.</li>
</ul>
<p>Utilities and the commands they provide</p>
<ul>
<li><code>libselinux-utils</code>
<ul>
<li><code>getenforce</code></li>
<li><code>getsebool</code></li>
</ul>
</li>
<li><code>policycoreutils</code>
<ul>
<li><code>sestatus</code></li>
<li><code>setsebool</code></li>
<li><code>restorecon</code></li>
</ul>
</li>
<li><code>policycoreutils-python-utils</code>
<ul>
<li><code>semanage</code></li>
</ul>
</li>
<li><code>setools-console</code>
<ul>
<li><code>seinfo</code></li>
<li><code>sesearch</code></li>
</ul>
</li>
</ul>
<p><strong>SELinux Alert Browser</strong></p>
<ul>
<li>
<p>Graphical tool for viewing alerts and debugging SELinux issues.</p>
</li>
<li>
<p>Part of the <code>setroubleshoot-server</code> package.</p>
</li>
<li>
<p>In order to fully manage SELinux, you need to ensure that all these packages are installed on the system.</p>
</li>
</ul>
<h3 id="management-commands">Management Commands</h3>
<p>SELinux delivers a variety of commands for effective administration.
Table 20-1 lists and describes the commands mentioned above plus a few more under various management categories.</p>
<p><strong>Mode Management</strong></p>
<p><code>getenforce</code></p>
<ul>
<li>Displays the current mode of operation</li>
</ul>
<p><code>grubby</code></p>
<ul>
<li>Updates and displays information about the configuration files for the grub2 boot loader</li>
</ul>
<p><code>sestatus</code></p>
<ul>
<li>Shows SELinux runtime status and Boolean values</li>
</ul>
<p><code>setenforce</code></p>
<ul>
<li>Switches the operating mode between enforcing and permissive temporarily</li>
</ul>
<p><strong>Context Management</strong></p>
<p><code>chcon</code></p>
<ul>
<li>Changes context on files (changes do not survive file system relabeling)</li>
</ul>
<p><code>restorecon</code></p>
<ul>
<li>Restores default contexts on files by referencing the files in  <em>/etc/selinux/targeted/contexts/files/</em></li>
</ul>
<p><code>semanage </code></p>
<ul>
<li>Changes context on files with the <code>fcontext</code> subcommand (changes survive file system relabeling)</li>
</ul>
<p><strong>Policy Management</strong></p>
<p><code>seinfo </code></p>
<ul>
<li>Provides information on policy components</li>
</ul>
<p><code>semanage</code></p>
<ul>
<li>Manages policy database</li>
</ul>
<p><code>sesearch</code></p>
<ul>
<li>Searches rules in the policy database</li>
</ul>
<p><strong>Boolean Management</strong></p>
<p><code>getsebool</code></p>
<ul>
<li>Displays Booleans and their current settings.</li>
</ul>
<p><code>setsebool</code></p>
<ul>
<li>Modifies Boolean values temporarily, or in the policy database.</li>
</ul>
<p><code>semanage</code></p>
<ul>
<li>Modifies Boolean values in the policy database with the <code>boolean</code>subcommand.</li>
</ul>
<p><strong>Troubleshooting</strong></p>
<p><code>sealert</code></p>
<ul>
<li>The graphical troubleshooting tool</li>
</ul>
<h3 id="viewing-and-controlling-selinux-operational-state">Viewing and Controlling SELinux Operational State</h3>
<p><em>/etc/selinux/config</em></p>
<ul>
<li>One of the key configuration files that controls the SELinux operational state, and sets its default type</li>
</ul>
<p>The default content of the file is displayed below:</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#ff6ac1">[</span>root@server30 ~<span style="color:#ff6ac1">]</span><span style="color:#78787e"># cat /etc/selinux/config</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#78787e"># This file controls the state of SELinux on the system.</span>
</span></span><span style="display:flex;"><span><span style="color:#78787e"># SELINUX= can take one of these three values:</span>
</span></span><span style="display:flex;"><span><span style="color:#78787e">#     enforcing - SELinux security policy is enforced.</span>
</span></span><span style="display:flex;"><span><span style="color:#78787e">#     permissive - SELinux prints warnings instead of enforcing.</span>
</span></span><span style="display:flex;"><span><span style="color:#78787e">#     disabled - No SELinux policy is loaded.</span>
</span></span><span style="display:flex;"><span><span style="color:#78787e"># See also:</span>
</span></span><span style="display:flex;"><span><span style="color:#78787e"># https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/9/html/using_selinux/changing-selinux-states-and-modes_using-selinux#changing-selinux-modes-at-boot-time_changing-selinux-states-and-modes</span>
</span></span><span style="display:flex;"><span><span style="color:#78787e">#</span>
</span></span><span style="display:flex;"><span><span style="color:#78787e"># NOTE: Up to RHEL 8 release included, SELINUX=disabled would also</span>
</span></span><span style="display:flex;"><span><span style="color:#78787e"># fully disable SELinux during boot. If you need a system with SELinux</span>
</span></span><span style="display:flex;"><span><span style="color:#78787e"># fully disabled instead of SELinux running with no policy loaded, you</span>
</span></span><span style="display:flex;"><span><span style="color:#78787e"># need to pass selinux=0 to the kernel command line. You can use grubby</span>
</span></span><span style="display:flex;"><span><span style="color:#78787e"># to persistently set the bootloader to boot with selinux=0:</span>
</span></span><span style="display:flex;"><span><span style="color:#78787e">#</span>
</span></span><span style="display:flex;"><span><span style="color:#78787e">#    grubby --update-kernel ALL --args selinux=0</span>
</span></span><span style="display:flex;"><span><span style="color:#78787e">#</span>
</span></span><span style="display:flex;"><span><span style="color:#78787e"># To revert back to SELinux enabled:</span>
</span></span><span style="display:flex;"><span><span style="color:#78787e">#</span>
</span></span><span style="display:flex;"><span><span style="color:#78787e">#    grubby --update-kernel ALL --remove-args selinux</span>
</span></span><span style="display:flex;"><span><span style="color:#78787e">#</span>
</span></span><span style="display:flex;"><span><span style="color:#ff5c57">SELINUX</span><span style="color:#ff6ac1">=</span>enforcing
</span></span><span style="display:flex;"><span><span style="color:#78787e"># SELINUXTYPE= can take one of these three values:</span>
</span></span><span style="display:flex;"><span><span style="color:#78787e">#     targeted - Targeted processes are protected,</span>
</span></span><span style="display:flex;"><span><span style="color:#78787e">#     minimum - Modification of targeted policy. Only selected processes are protected.</span>
</span></span><span style="display:flex;"><span><span style="color:#78787e">#     mls - Multi Level Security protection.</span>
</span></span><span style="display:flex;"><span><span style="color:#ff5c57">SELINUXTYPE</span><span style="color:#ff6ac1">=</span>targeted</span></span></code></pre></div>
<p>Directives:</p>
<p><strong>SELINUX</strong></p>
<ul>
<li>Sets the activation mode for SELinux.</li>
<li><em>Enforcing</em> activates it and allows or denies actions based on the policy rules.</li>
<li><em>Permissive</em> activates SELinux, but permits all actions.
<ul>
<li>It records all security violations.</li>
<li>Useful for troubleshooting and developing or tuning the policy.</li>
</ul>
</li>
<li>The third option is to completely turn SELinux off. When running in enforcing mode</li>
</ul>
<p><strong>SELINUXTYPE</strong></p>
<ul>
<li>Dictates the type of policy to be enforced.</li>
<li>Default is targeted.</li>
</ul>
<p>Determine the current operating mode:
<code>getenforce</code></p>
<p>Change the state to permissive and verify:</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#ff6ac1">[</span>root@server30 ~<span style="color:#ff6ac1">]</span><span style="color:#78787e"># setenforce permissive</span>
</span></span><span style="display:flex;"><span><span style="color:#ff6ac1">[</span>root@server30 ~<span style="color:#ff6ac1">]</span><span style="color:#78787e"># getenforce</span>
</span></span><span style="display:flex;"><span>Permissive</span></span></code></pre></div>
<ul>
<li>Can also &ldquo;0&rdquo; for permissive and a &ldquo;1&rdquo; for enforcing.</li>
<li>Changes will be lost at the next system reboot.</li>
<li>Edit  <em>/etc/selinux/config</em> <strong>SELINUX</strong> directive to the desired mode for persistence.</li>
</ul>
<p>EXAM TIP: You may switch SELinux to permissive for troubleshooting a
non-functioning service. Don&rsquo;t forget to change it back to enforcing
when the issue is resolved.</p>
<p>Disable SELinux persistently:
<code>grubby --update-kernel ALL --args selinux=0</code></p>
<ul>
<li>Appends the selinux=0 setting to the end of the &ldquo;options&rdquo; line in the bootloader configuration file located in the /boot/loader/entries directory:</li>
</ul>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>cat /boot/loader/entries/dcb323fab47049e8b89dae2ae00d41e8-5.14.0-427.26.1.el9_4.x86_64.conf </span></span></code></pre></div>
<p>Revert the above:
<code>grubby --update-kernel ALL --remove-args selinux=0</code></p>
<h3 id="querying-status">Querying Status</h3>
<p><code>sestatus</code> Command</p>
<ul>
<li>View the current runtime status of SELinux</li>
<li>Displays the location of principal directories, the policy in effect, and the activation mode.</li>
</ul>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#ff6ac1">[</span>root@server30 ~<span style="color:#ff6ac1">]</span><span style="color:#78787e"># sestatus</span>
</span></span><span style="display:flex;"><span>SELinux status:                 enabled
</span></span><span style="display:flex;"><span>SELinuxfs mount:                /sys/fs/selinux
</span></span><span style="display:flex;"><span>SELinux root directory:         /etc/selinux
</span></span><span style="display:flex;"><span>Loaded policy name:             targeted
</span></span><span style="display:flex;"><span>Current mode:                   permissive
</span></span><span style="display:flex;"><span>Mode from config file:          enforcing
</span></span><span style="display:flex;"><span>Policy MLS status:              enabled
</span></span><span style="display:flex;"><span>Policy deny_unknown status:     allowed
</span></span><span style="display:flex;"><span>Memory protection checking:     actual <span style="color:#ff6ac1">(</span>secure<span style="color:#ff6ac1">)</span>
</span></span><span style="display:flex;"><span>Max kernel policy version:      <span style="color:#ff9f43">33</span></span></span></code></pre></div>
<p><code>-v </code></p>
<ul>
<li>Report on security contexts set on files and processes, as listed in <em>/etc/sestatus.conf</em> .</li>
<li>Reports the contexts for the current process (Current context) and the init (systemd) process (Init context) under Process Contexts.</li>
<li>Reveals the file contexts for the controlling terminal and associated files under File Contexts.</li>
</ul>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#ff6ac1">[</span>root@server30 ~<span style="color:#ff6ac1">]</span><span style="color:#78787e"># cat /etc/sestatus.conf</span>
</span></span><span style="display:flex;"><span><span style="color:#ff6ac1">[</span>files<span style="color:#ff6ac1">]</span>
</span></span><span style="display:flex;"><span>/etc/passwd
</span></span><span style="display:flex;"><span>/etc/shadow
</span></span><span style="display:flex;"><span>/bin/bash
</span></span><span style="display:flex;"><span>/bin/login
</span></span><span style="display:flex;"><span>/bin/sh
</span></span><span style="display:flex;"><span>/sbin/agetty
</span></span><span style="display:flex;"><span>/sbin/init
</span></span><span style="display:flex;"><span>/sbin/mingetty
</span></span><span style="display:flex;"><span>/usr/sbin/sshd
</span></span><span style="display:flex;"><span>/lib/libc.so.6
</span></span><span style="display:flex;"><span>/lib/ld-linux.so.2
</span></span><span style="display:flex;"><span>/lib/ld.so.1
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff6ac1">[</span>process<span style="color:#ff6ac1">]</span>
</span></span><span style="display:flex;"><span>/sbin/mingetty
</span></span><span style="display:flex;"><span>/sbin/agetty
</span></span><span style="display:flex;"><span>/usr/sbin/sshd</span></span></code></pre></div>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#ff6ac1">[</span>root@server30 ~<span style="color:#ff6ac1">]</span><span style="color:#78787e"># sestatus -v</span>
</span></span><span style="display:flex;"><span>SELinux status:                 enabled
</span></span><span style="display:flex;"><span>SELinuxfs mount:                /sys/fs/selinux
</span></span><span style="display:flex;"><span>SELinux root directory:         /etc/selinux
</span></span><span style="display:flex;"><span>Loaded policy name:             targeted
</span></span><span style="display:flex;"><span>Current mode:                   permissive
</span></span><span style="display:flex;"><span>Mode from config file:          enforcing
</span></span><span style="display:flex;"><span>Policy MLS status:              enabled
</span></span><span style="display:flex;"><span>Policy deny_unknown status:     allowed
</span></span><span style="display:flex;"><span>Memory protection checking:     actual <span style="color:#ff6ac1">(</span>secure<span style="color:#ff6ac1">)</span>
</span></span><span style="display:flex;"><span>Max kernel policy version:      <span style="color:#ff9f43">33</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Process contexts:
</span></span><span style="display:flex;"><span>Current context:                unconfined_u:unconfined_r:unconfined_t:s0-s0:c0.c1023
</span></span><span style="display:flex;"><span>Init context:                   system_u:system_r:init_t:s0
</span></span><span style="display:flex;"><span>/sbin/agetty                    system_u:system_r:getty_t:s0-s0:c0.c1023
</span></span><span style="display:flex;"><span>/usr/sbin/sshd                  system_u:system_r:sshd_t:s0-s0:c0.c1023
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>File contexts:
</span></span><span style="display:flex;"><span>Controlling terminal:           unconfined_u:object_r:user_devpts_t:s0
</span></span><span style="display:flex;"><span>/etc/passwd                     system_u:object_r:passwd_file_t:s0
</span></span><span style="display:flex;"><span>/etc/shadow                     system_u:object_r:shadow_t:s0
</span></span><span style="display:flex;"><span>/bin/bash                       system_u:object_r:shell_exec_t:s0
</span></span><span style="display:flex;"><span>/bin/login                      system_u:object_r:login_exec_t:s0
</span></span><span style="display:flex;"><span>/bin/sh                         system_u:object_r:bin_t:s0 -&gt; system_u:object_r:shell_exec_t:s0
</span></span><span style="display:flex;"><span>/sbin/agetty                    system_u:object_r:getty_exec_t:s0
</span></span><span style="display:flex;"><span>/sbin/init                      system_u:object_r:bin_t:s0 -&gt; system_u:object_r:init_exec_t:s0
</span></span><span style="display:flex;"><span>/usr/sbin/sshd                  system_u:object_r:sshd_exec_t:s0</span></span></code></pre></div>
<h3 id="lab-modify-selinux-file-context">Lab: Modify SELinux File Context</h3>
<ul>
<li>Create a directory sedir1 under /tmp and a file sefile1 under sedir1.</li>
<li>Check the context on the directory and file.</li>
<li>Change the SELinux user and type to user_u and public_content_t on both and verify.</li>
</ul>
<p>1. Create the hierarchy sedir1/sefile1 under /tmp:</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span> <span style="color:#ff6ac1">[</span>root@server30 ~<span style="color:#ff6ac1">]</span><span style="color:#78787e"># cd /tmp</span>
</span></span><span style="display:flex;"><span> <span style="color:#ff6ac1">[</span>root@server30 tmp<span style="color:#ff6ac1">]</span><span style="color:#78787e"># mkdir sedir1</span>
</span></span><span style="display:flex;"><span> <span style="color:#ff6ac1">[</span>root@server30 tmp<span style="color:#ff6ac1">]</span><span style="color:#78787e"># touch sedir1/sefile1</span></span></span></code></pre></div>
<p>2. Determine the context on the new directory and file:</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span> <span style="color:#ff6ac1">[</span>root@server30 tmp<span style="color:#ff6ac1">]</span><span style="color:#78787e"># ls -ldZ sedir1</span>
</span></span><span style="display:flex;"><span> drwxr-xr-x. <span style="color:#ff9f43">2</span> root root  unconfined_u:object_r:user_tmp_t:s0 <span style="color:#ff9f43">21</span> Jul <span style="color:#ff9f43">28</span> 15:12  sedir1 </span></span></code></pre></div>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span> <span style="color:#ff6ac1">[</span>root@server30 tmp<span style="color:#ff6ac1">]</span><span style="color:#78787e"># ls -ldZ sedir1/sefile1</span>
</span></span><span style="display:flex;"><span> -rw-r--r--. <span style="color:#ff9f43">1</span> root root  unconfined_u:object_r:user_tmp_t:s0 <span style="color:#ff9f43">0</span> Jul <span style="color:#ff9f43">28</span> 15:12  sedir1/sefile1</span></span></code></pre></div>
<p>3. Modify the SELinux user (<code>-u</code>) on the directory to <code>user_u</code> and type
(<code>-t</code>) to <code>public_content_t</code> recursively (<code>-R</code>) with the <code>chcon</code> command:</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span> <span style="color:#ff6ac1">[</span>root@server30 tmp<span style="color:#ff6ac1">]</span><span style="color:#78787e"># chcon -vu user_u -t  public_content_t sedir1 -R</span>
</span></span><span style="display:flex;"><span> changing security context of <span style="color:#5af78e">&#39;sedir1/sefile1&#39;</span>
</span></span><span style="display:flex;"><span> changing security context of <span style="color:#5af78e">&#39;sedir1&#39;</span></span></span></code></pre></div>
<p>4. Validate the new context:</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span> <span style="color:#ff6ac1">[</span>root@server30 tmp<span style="color:#ff6ac1">]</span><span style="color:#78787e"># ls -ldZ sedir1</span>
</span></span><span style="display:flex;"><span> drwxr-xr-x. <span style="color:#ff9f43">2</span> root root  user_u:object_r:public_content_t:s0 <span style="color:#ff9f43">21</span> Jul <span style="color:#ff9f43">28</span> 15:12  sedir1</span></span></code></pre></div>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span> <span style="color:#ff6ac1">[</span>root@server30 tmp<span style="color:#ff6ac1">]</span><span style="color:#78787e"># ls -ldZ sedir1/sefile1</span>
</span></span><span style="display:flex;"><span> -rw-r--r--. <span style="color:#ff9f43">1</span> root root  user_u:object_r:public_content_t:s0 <span style="color:#ff9f43">0</span> Jul <span style="color:#ff9f43">28</span> 15:12  sedir1/sefile1</span></span></code></pre></div>
<h3 id="lab-add-and-apply-file-context">Lab: Add and Apply File Context</h3>
<ul>
<li>Add the current context on sedir1 to the SELinux policy database to ensure a relabeling will not reset it to its previous value</li>
<li>Change the context on the directory to some random values.</li>
<li>Restore the default context from the policy database back to the directory recursively.</li>
</ul>
<ol>
<li>Determine the current context:</li>
</ol>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span> <span style="color:#ff6ac1">[</span>root@server30 tmp<span style="color:#ff6ac1">]</span><span style="color:#78787e"># ls -ldZ sedir1</span>
</span></span><span style="display:flex;"><span> drwxr-xr-x. <span style="color:#ff9f43">2</span> root root  user_u:object_r:public_content_t:s0 <span style="color:#ff9f43">21</span> Jul <span style="color:#ff9f43">28</span> 15:12  sedir1</span></span></code></pre></div>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span> <span style="color:#ff6ac1">[</span>root@server30 tmp<span style="color:#ff6ac1">]</span><span style="color:#78787e"># ls -ldZ sedir1/sefile1</span>
</span></span><span style="display:flex;"><span> -rw-r--r--. <span style="color:#ff9f43">1</span> root root  user_u:object_r:public_content_t:s0 <span style="color:#ff9f43">0</span> Jul <span style="color:#ff9f43">28</span> 15:12  sedir1/sefile1</span></span></code></pre></div>
<ol start="2">
<li>Add (-a) the directory recursively to the policy database using the <code>semanage</code> command with the <code>fcontext</code> subcommand:</li>
</ol>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span> <span style="color:#ff6ac1">[</span>root@server30 tmp<span style="color:#ff6ac1">]</span><span style="color:#78787e"># semanage fcontext -a -s user_u -t public_content_t &#34;/tmp/sedir1(/.*)?&#34;</span></span></span></code></pre></div>
<ul>
<li>The regular expression (/.*)? instructs the command to include all files and subdirectories under /tmp/sedir1.
<ul>
<li>Needed only if recursion is required.</li>
</ul>
</li>
</ul>
<p>The above command added the context to the <em>/etc/selinux/targeted/contexts/files/file_contexts.local file</em>.</p>
<ol>
<li>Validate the addition by listing (-l) the recent changes (-C) in the policy database:</li>
</ol>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span> <span style="color:#ff6ac1">[</span>root@server30 tmp<span style="color:#ff6ac1">]</span><span style="color:#78787e"># semanage fcontext -Cl | grep  sedir</span>
</span></span><span style="display:flex;"><span> /tmp/sedir1<span style="color:#ff6ac1">(</span>/.*<span style="color:#ff6ac1">)</span>?                                   all files           user_u:object_r:public_content_t:s0 </span></span></code></pre></div>
<ol start="2">
<li>Change the current context on sedir1 to something random (staff_u/etc_t) with the <code>chcon</code> command:</li>
</ol>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span> root@server30 tmp<span style="color:#ff6ac1">]</span><span style="color:#78787e"># chcon -vu staff_u -t etc_t  sedir1 -R</span>
</span></span><span style="display:flex;"><span> changing security context of <span style="color:#5af78e">&#39;sedir1/sefile1&#39;</span>
</span></span><span style="display:flex;"><span> changing security context of <span style="color:#5af78e">&#39;sedir1&#39;</span></span></span></code></pre></div>
<ol>
<li>The security context is changed successfully. Confirm with the <code>ls</code> command:</li>
</ol>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span> <span style="color:#ff6ac1">[</span>root@server30 tmp<span style="color:#ff6ac1">]</span><span style="color:#78787e"># ls -ldZ sedir1 ; ls -lZ  sedir1/sefile1</span>
</span></span><span style="display:flex;"><span> drwxr-xr-x. <span style="color:#ff9f43">2</span> root root staff_u:object_r:etc_t:s0  <span style="color:#ff9f43">21</span> Jul <span style="color:#ff9f43">28</span> 15:12 sedir1
</span></span><span style="display:flex;"><span> -rw-r--r--. <span style="color:#ff9f43">1</span> root root staff_u:object_r:etc_t:s0 <span style="color:#ff9f43">0</span>  Jul <span style="color:#ff9f43">28</span> 15:12 sedir1/sefile1</span></span></code></pre></div>
<ol>
<li>Reinstate the context on the sedir1 directory recursively (<code>-R</code>) as stored in the policy database using the <code>restorecon</code> command: (-F option will update all attributes, only does type by default. )</li>
</ol>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>$ restorecon -R -v -F sedir1
</span></span><span style="display:flex;"><span>Relabeled /tmp/sedir1 from unconfined_u:object_r:public_content_t:s0 to user_u:object_r:public_content_t:s0
</span></span><span style="display:flex;"><span>Relabeled /tmp/sedir1/sefile1 from unconfined_u:object_r:public_content_t:s0 to user_u:object_r:public_content_t:s0</span></span></code></pre></div>
<h3 id="lab-add-and-delete-network-ports">Lab: Add and Delete Network Ports</h3>
<ul>
<li>Add a non-standard network port 8010 to the SELinux policy database for the httpd service.</li>
<li>Confirm the addition.</li>
<li>Remove the port from the policy and verify the deletion.</li>
</ul>
<ol start="2">
<li>List (<code>-l</code>) the ports for the httpd service as defined in the SELinux policy database:</li>
</ol>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span> <span style="color:#ff6ac1">[</span>root@server10 ~<span style="color:#ff6ac1">]</span><span style="color:#78787e"># semanage port -l | grep ^http_port</span>
</span></span><span style="display:flex;"><span> http_port_t                    tcp      80, 81, 443, 488, 8008, 8009, 8443, <span style="color:#ff9f43">9000</span></span></span></code></pre></div>
<p>The output reveals eight network ports the httpd process is currently allowed to listen on.</p>
<ol>
<li>Add port 8010 with type <code>http_port_t</code> and protocol tcp to the policy:</li>
</ol>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span> <span style="color:#ff6ac1">[</span>root@server10 ~<span style="color:#ff6ac1">]</span><span style="color:#78787e"># semanage port -at http_port_t -p  tcp 8010</span></span></span></code></pre></div>
<ol start="2">
<li>Confirm the addition:</li>
</ol>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span> <span style="color:#ff6ac1">[</span>root@server10 ~<span style="color:#ff6ac1">]</span><span style="color:#78787e"># semanage port -l | grep ^http_port</span>
</span></span><span style="display:flex;"><span> http_port_t                    tcp      8010, 80,  81, 443, 488, 8008, 8009, 8443, <span style="color:#ff9f43">9000</span></span></span></code></pre></div>
<ol>
<li>Delete port <code>8010</code> from the policy and confirm:</li>
</ol>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span> <span style="color:#ff6ac1">[</span>root@server10 ~<span style="color:#ff6ac1">]</span><span style="color:#78787e"># semanage port -dp tcp 8010</span>
</span></span><span style="display:flex;"><span> <span style="color:#ff6ac1">[</span>root@server10 ~<span style="color:#ff6ac1">]</span><span style="color:#78787e"># semanage port -l | grep ^http_port</span>
</span></span><span style="display:flex;"><span> http_port_t                    tcp      80, 81,  443, 488, 8008, 8009, 8443, <span style="color:#ff9f43">9000</span></span></span></code></pre></div>
<p>EXAM TIP: Any non-standard port you want to use for any service, make certain to add it to the SELinux policy database with the correct type.</p>
<h3 id="lab-copy-files-with-and-without-context">Lab: Copy Files with and without Context</h3>
<ul>
<li>Create a file called sefile2 under /tmp and display its context.</li>
<li>Copy this file to the /etc/default directory, and observe the change in the context.</li>
<li>Remove sefile2 from /etc/default, and copy it again to the same destination, ensuring that the target file receives the source file&rsquo;s context.</li>
</ul>
<p>1. Create file sefile2 under /tmp and show context:</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span> <span style="color:#ff6ac1">[</span>root@server10 ~<span style="color:#ff6ac1">]</span><span style="color:#78787e"># touch /tmp/sefile2</span>
</span></span><span style="display:flex;"><span> <span style="color:#ff6ac1">[</span>root@server10 ~<span style="color:#ff6ac1">]</span><span style="color:#78787e"># ls -lZ /tmp/sefile2</span>
</span></span><span style="display:flex;"><span> -rw-r--r--. <span style="color:#ff9f43">1</span> root root  unconfined_u:object_r:user_tmp_t:s0 <span style="color:#ff9f43">0</span> Jul <span style="color:#ff9f43">29</span> 08:44  /tmp/sefile2</span></span></code></pre></div>
<p>2. Copy this file to the /etc/default directory, and check the context again:</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span> <span style="color:#ff6ac1">[</span>root@server10 ~<span style="color:#ff6ac1">]</span><span style="color:#78787e"># cp /tmp/sefile2 /etc/default/</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span> <span style="color:#ff6ac1">[</span>root@server10 ~<span style="color:#ff6ac1">]</span><span style="color:#78787e"># ls -lZ /etc/default/sefile2</span>
</span></span><span style="display:flex;"><span> -rw-r--r--. <span style="color:#ff9f43">1</span> root root  unconfined_u:object_r:etc_t:s0 <span style="color:#ff9f43">0</span> Jul <span style="color:#ff9f43">29</span> 08:45  /etc/default/sefile2</span></span></code></pre></div>
<p>3. Erase the <em>/etc/default/sefile2</em> file, and copy it again with the <code>--preserve=context</code> option:</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span> <span style="color:#ff6ac1">[</span>root@server10 ~<span style="color:#ff6ac1">]</span><span style="color:#78787e"># rm /etc/default/sefile2</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span> <span style="color:#ff6ac1">[</span>root@server10 ~<span style="color:#ff6ac1">]</span><span style="color:#78787e"># cp --preserve=context  /tmp/sefile2 /etc/default</span></span></span></code></pre></div>
<p>4. List the file to view the context:</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span> <span style="color:#ff6ac1">[</span>root@server10 ~<span style="color:#ff6ac1">]</span><span style="color:#78787e"># ls -lZ /etc/default/sefile2</span>
</span></span><span style="display:flex;"><span> -rw-r--r--. <span style="color:#ff9f43">1</span> root root  unconfined_u:object_r:user_tmp_t:s0 <span style="color:#ff9f43">0</span> Jul <span style="color:#ff9f43">29</span> 08:49  /etc/default/sefile2</span></span></code></pre></div>
<h3 id="exercise-20-5-view-and-toggle-selinux-boolean-values">Exercise 20-5: View and Toggle SELinux Boolean Values</h3>
<ul>
<li>Display the current state of the Boolean <code>nfs_export_all_rw</code>.</li>
<li>Toggle its value temporarily, and reboot the system.</li>
<li>Flip its value persistently after the system has been back up.</li>
</ul>
<p>1. Display the current setting of the Boolean <code>nfs_export_all_rw</code> using three different commands&mdash;<code>getsebool</code>, <code>sestatus</code>, and <code>semanage</code>:</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span> <span style="color:#ff6ac1">[</span>root@server10 ~<span style="color:#ff6ac1">]</span><span style="color:#78787e"># getsebool -a | grep  nfs_export_all_rw</span>
</span></span><span style="display:flex;"><span> nfs_export_all_rw --&gt; on
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span> <span style="color:#ff6ac1">[</span>root@server10 ~<span style="color:#ff6ac1">]</span><span style="color:#78787e"># sestatus -b | grep  nfs_export_all_rw</span>
</span></span><span style="display:flex;"><span> nfs_export_all_rw                           on
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span> <span style="color:#ff6ac1">[</span>root@server10 ~<span style="color:#ff6ac1">]</span><span style="color:#78787e"># semanage boolean -l | grep  nfs_export_all_rw</span>
</span></span><span style="display:flex;"><span> nfs_export_all_rw              <span style="color:#ff6ac1">(</span>on   ,   on<span style="color:#ff6ac1">)</span>  Allow  nfs to <span style="color:#ff5c57">export</span> all rw
</span></span><span style="display:flex;"><span> <span style="color:#ff6ac1">[</span>root@server10 ~<span style="color:#ff6ac1">]</span><span style="color:#78787e"># </span></span></span></code></pre></div>
<p>2. Turn off the value of <code>nfs_export_all_rw</code> using the setsebool command by simply furnishing &ldquo;<code>off</code>&rdquo; or &ldquo;<code>0</code>&rdquo; with it and confirm:</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span> <span style="color:#ff6ac1">[</span>root@server10 ~<span style="color:#ff6ac1">]</span><span style="color:#78787e"># setsebool nfs_export_all_rw 0</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span> <span style="color:#ff6ac1">[</span>root@server10 ~<span style="color:#ff6ac1">]</span><span style="color:#78787e"># getsebool -a | grep  nfs_export_all_rw</span>
</span></span><span style="display:flex;"><span> nfs_export_all_rw --&gt; off</span></span></code></pre></div>
<p>3. Reboot the system and rerun the <code>getsebool</code> command to check the Boolean state:</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span> <span style="color:#ff6ac1">[</span>root@server10 ~<span style="color:#ff6ac1">]</span><span style="color:#78787e"># getsebool -a | grep  nfs_export_all_rw</span>
</span></span><span style="display:flex;"><span> nfs_export_all_rw --&gt; on</span></span></code></pre></div>
<p>4. Set the value of the Boolean persistently (<code>-P</code> or <code>-m</code> as needed) using either of the following:</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span> <span style="color:#ff6ac1">[</span>root@server10 ~<span style="color:#ff6ac1">]</span><span style="color:#78787e"># setsebool -P nfs_export_all_rw off</span>
</span></span><span style="display:flex;"><span> <span style="color:#ff6ac1">[</span>root@server10 ~<span style="color:#ff6ac1">]</span><span style="color:#78787e"># semanage boolean -m -0  nfs_export_all_rw</span></span></span></code></pre></div>
<p>5. Validate the new value using the getsebool, sestatus, or semanage command:</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span> <span style="color:#ff6ac1">[</span>root@server10 ~<span style="color:#ff6ac1">]</span><span style="color:#78787e"># sestatus -b | grep  nfs_export_all_rw</span>
</span></span><span style="display:flex;"><span> nfs_export_all_rw                           off
</span></span><span style="display:flex;"><span> <span style="color:#ff6ac1">[</span>root@server10 ~<span style="color:#ff6ac1">]</span><span style="color:#78787e"># semanage boolean -l | grep  nfs_export_all_rw</span>
</span></span><span style="display:flex;"><span> nfs_export_all_rw              <span style="color:#ff6ac1">(</span>off  ,  off<span style="color:#ff6ac1">)</span>  Allow  nfs to <span style="color:#ff5c57">export</span> all rw
</span></span><span style="display:flex;"><span> <span style="color:#ff6ac1">[</span>root@server10 ~<span style="color:#ff6ac1">]</span><span style="color:#78787e"># semanage boolean -l | grep  nfs_export_all_rw </span>
</span></span><span style="display:flex;"><span> nfs_export_all_rw              <span style="color:#ff6ac1">(</span>off  ,  off<span style="color:#ff6ac1">)</span>  Allow  nfs to <span style="color:#ff5c57">export</span> all rw</span></span></code></pre></div>
<h3 id="monitoring-and-analyzing-selinux-violations">Monitoring and Analyzing SELinux Violations</h3>
<ul>
<li>
<p>SELinux generates alerts for system activities when it runs in enforcing or permissive mode.</p>
</li>
<li>
<p>It writes the alerts to <em>/var/log/audit/audit.log</em>if the <strong>auditd</strong> daemon is running, or to <em>/var/log/messages</em> via the <strong>rsyslog</strong> daemon in the absence of <strong>auditd</strong>.</p>
</li>
<li>
<p>SELinux also logs the alerts that are generated due to denial of an action, and identifies them with a type tag <strong>AVC (Access Vector Cache)</strong> in the audit.log file.</p>
</li>
<li>
<p>It also writes the rejection in the messages file with a message ID, and how to view the message details.</p>
</li>
<li>
<p>SELinux denial messages are analyzed, and the audit data is examined to identify the potential cause of the rejection.</p>
</li>
<li>
<p>The results of the analysis are recorded with recommendations on how to fix it.</p>
</li>
<li>
<p>These results can be reviewed to aid in troubleshooting, and recommended actions taken to address the issue.</p>
</li>
<li>
<p>SELinux runs a service daemon called <strong>setroubleshootd</strong> that performs this analysis and examination in the background.</p>
</li>
<li>
<p>This service also has a client interface called <strong>SELinux Troubleshooter</strong> (the <code>sealert</code> command) that reads the data and displays it for assessment.</p>
</li>
<li>
<p>The client tool has both text and graphical interfaces.</p>
</li>
<li>
<p>The server and client components are part of the <code>setroubleshoot-server</code> software package that must be installed on the system prior to using this service.</p>
</li>
</ul>
<p>How SELinux handles an incoming access request (from a subject) to a target object:</p>
<p>Subject (eg: a process) makes an Action request (eg: read) &gt; SELinux Security Server checks the SELinux Policy Database &gt; if permission is not granted the AVC Denied Message is diaplayed. If Permission is granted, then access to object (eg: a file) is granted.</p>
<p>su to root from user1 and view the log:</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span> <span style="color:#ff6ac1">[</span>root@server10 ~<span style="color:#ff6ac1">]</span><span style="color:#78787e"># cat /var/log/audit/audit.log |  tail -10</span>
</span></span><span style="display:flex;"><span> ...
</span></span><span style="display:flex;"><span> <span style="color:#ff5c57">type</span><span style="color:#ff6ac1">=</span>USER_START <span style="color:#ff5c57">msg</span><span style="color:#ff6ac1">=</span>audit<span style="color:#ff6ac1">(</span>1722274070.748:90<span style="color:#ff6ac1">)</span>:  <span style="color:#ff5c57">pid</span><span style="color:#ff6ac1">=</span><span style="color:#ff9f43">1394</span> <span style="color:#ff5c57">uid</span><span style="color:#ff6ac1">=</span><span style="color:#ff9f43">1000</span> <span style="color:#ff5c57">auid</span><span style="color:#ff6ac1">=</span><span style="color:#ff9f43">0</span> <span style="color:#ff5c57">ses</span><span style="color:#ff6ac1">=</span><span style="color:#ff9f43">1</span>  <span style="color:#ff5c57">subj</span><span style="color:#ff6ac1">=</span>unconfined_u:unconfined_r:unconfined_t:s0- s0:c0.c1023 <span style="color:#ff5c57">msg</span><span style="color:#ff6ac1">=</span><span style="color:#5af78e">&#39;op=PAM:session_open  grantors=pam_keyinit,pam_limits,pam_systemd,pam_unix, pam_umask,pam_xauth acct=&#34;root&#34; exe=&#34;/usr/bin/su&#34;  hostname=? addr=? terminal=/dev/pts/0  res=success&#39;</span><span style="color:#ff5c57">UID</span><span style="color:#ff6ac1">=</span><span style="color:#5af78e">&#34;user1&#34;</span> <span style="color:#ff5c57">AUID</span><span style="color:#ff6ac1">=</span><span style="color:#5af78e">&#34;root&#34;</span></span></span></code></pre></div>
<p>WIll show avc denied if denied.</p>
<h3 id="lab-get-an-avc-deny-message">Lab Get an AVC deny message</h3>
<ul>
<li>Change the SELinux type on the shadow file to something random (etc_t).</li>
<li>Issue the <code>passwd</code> command as user1 to modify the password.</li>
<li>Restored the type on the shadow file with <code>restorecon /etc/shadow</code>. '</li>
<li>Re-try the password change.</li>
</ul>
<ol start="2">
<li>Change the SELinux type on <em>/etc/shadow</em> to something random (etc_t)</li>
</ol>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span> <span style="color:#ff6ac1">[</span>root@server10 ~<span style="color:#ff6ac1">]</span><span style="color:#78787e"># chcon -vt etc_t /etc/shadow</span>
</span></span><span style="display:flex;"><span> changing security context of <span style="color:#5af78e">&#39;/etc/shadow&#39;</span></span></span></code></pre></div>
<ol start="3">
<li>Issue the <code>passwd</code> command as user1 to modify the password:</li>
</ol>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span> <span style="color:#ff6ac1">[</span>root@server10 ~<span style="color:#ff6ac1">]</span><span style="color:#78787e"># su user1</span>
</span></span><span style="display:flex;"><span> <span style="color:#ff6ac1">[</span>user1@server10 root<span style="color:#ff6ac1">]</span>$ passwd
</span></span><span style="display:flex;"><span> Changing password <span style="color:#ff6ac1">for</span> user user1.
</span></span><span style="display:flex;"><span> Current password: 
</span></span><span style="display:flex;"><span> roopasswd: Authentication token manipulation error</span></span></code></pre></div>
<p>The following is a sample denial record from the same file in raw format:</p>
<p><a href="#R-image-cb0a1f26fcd89973d4c3101805d80da9" class="lightbox-link"><img class="lazy lightbox figure-image" loading="lazy" src="/images/image-C7TMRBJO%201.jpg" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-cb0a1f26fcd89973d4c3101805d80da9"><img class="lazy lightbox lightbox-image" loading="lazy" src="/images/image-C7TMRBJO%201.jpg"></a></p>
<ul>
<li>AVC type</li>
<li>Related to the <code>passwd</code> command (comm)</li>
<li>Source context (<code>scontext</code>) <code>unconfined_u:unconfined_r:passwd_t:s0-s0:c0.c1023</code></li>
<li><em>nshadow</em> file (name) with file type (<em>tclass</em>) &ldquo;file&rdquo;</li>
<li>Target context (tcontext) <code>system_u:object_r:etc_t:s0</code></li>
<li>Indicates the SELinux operating mode, which is enforcing <code>permissive=0</code>.</li>
<li>This message indicates that the <em>/etc/shadow</em> file does not have the correct context set on it, and that&rsquo;s why SELinux prevented the <code>passwd</code> command from updating the user&rsquo;s password.</li>
</ul>
<p>Use <code>sealert</code> to analyze (<code>-a</code>) all <strong>AVC</strong> records in the <em>audit.log</em> file. This command produces a formatted report with all relevant details:</p>
<p><a href="#R-image-3d5041a13826c6f92022b7d83fd68434" class="lightbox-link"><img class="lazy lightbox figure-image" loading="lazy" src="/images/image-WYWDQX1V%201.jpg" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-3d5041a13826c6f92022b7d83fd68434"><img class="lazy lightbox lightbox-image" loading="lazy" src="/images/image-WYWDQX1V%201.jpg"></a></p>
<h2 id="selinux-diy-labs">SELinux DIY Labs</h2>
<h3 id="lab-disable-and-enable-the-selinux-operating-mode">Lab: Disable and Enable the SELinux Operating Mode</h3>
<ul>
<li>Check and make a note of the current SELinux operating mode.</li>
</ul>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span> <span style="color:#ff6ac1">[</span>root@server30 ~<span style="color:#ff6ac1">]</span><span style="color:#78787e"># getenforce</span>
</span></span><span style="display:flex;"><span> Enforcing</span></span></code></pre></div>
<ul>
<li>Modify the configuration file and set the mode to disabled.</li>
</ul>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span> <span style="color:#ff6ac1">[</span>root@server30 ~<span style="color:#ff6ac1">]</span><span style="color:#78787e"># vim /etc/selinux/config </span>
</span></span><span style="display:flex;"><span> <span style="color:#ff5c57">SELINUX</span><span style="color:#ff6ac1">=</span>disabled</span></span></code></pre></div>
<ul>
<li>Reboot the system to apply the change.</li>
</ul>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span> <span style="color:#ff6ac1">[</span>root@server30 ~<span style="color:#ff6ac1">]</span><span style="color:#78787e"># reboot</span></span></span></code></pre></div>
<ul>
<li>Run <code>sudo getenforce</code> to confirm the change when the system is up.</li>
</ul>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span> <span style="color:#ff6ac1">[</span>root@server30 ~<span style="color:#ff6ac1">]</span><span style="color:#78787e"># getenforce</span>
</span></span><span style="display:flex;"><span> Disabled</span></span></code></pre></div>
<ul>
<li>Restore the directive&rsquo;s value to enforcing in the configuration file, and reboot to apply the new mode.</li>
</ul>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span> <span style="color:#ff6ac1">[</span>root@server30 ~<span style="color:#ff6ac1">]</span><span style="color:#78787e"># vim /etc/selinux/config</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span> <span style="color:#ff5c57">SELINUX</span><span style="color:#ff6ac1">=</span>enforcing
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span> <span style="color:#ff6ac1">[</span>root@server30 ~<span style="color:#ff6ac1">]</span><span style="color:#78787e"># reboot</span></span></span></code></pre></div>
<ul>
<li>Run <code>sudo getenforce</code> to confirm the mode when the system is up.</li>
</ul>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span> <span style="color:#ff6ac1">[</span>root@server30 ~<span style="color:#ff6ac1">]</span><span style="color:#78787e"># getenforce</span>
</span></span><span style="display:flex;"><span> Enforcing</span></span></code></pre></div>
<h3 id="lab-modify-context-on-files">Lab: Modify Context on Files</h3>
<ul>
<li>Create directory hierarchy <em>/tmp/d1/d2</em>.</li>
</ul>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span> mkdir -p /tmp/d1/d2</span></span></code></pre></div>
<ul>
<li>Check the contexts on <em>/tmp/d1</em> and <em>/tmp/d1/d2</em>.</li>
</ul>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span> <span style="color:#ff6ac1">[</span>root@server30 d1<span style="color:#ff6ac1">]</span><span style="color:#78787e"># ls -ldZ /tmp/d1</span>
</span></span><span style="display:flex;"><span> drwxr-xr-x. <span style="color:#ff9f43">3</span> root root unconfined_u:object_r:user_tmp_t:s0 <span style="color:#ff9f43">16</span> Jul <span style="color:#ff9f43">29</span> 13:17 /tmp/d1
</span></span><span style="display:flex;"><span> <span style="color:#ff6ac1">[</span>root@server30 d1<span style="color:#ff6ac1">]</span><span style="color:#78787e"># ls -ldZ /tmp/d1/d2</span>
</span></span><span style="display:flex;"><span> drwxr-xr-x. <span style="color:#ff9f43">2</span> root root unconfined_u:object_r:user_tmp_t:s0 <span style="color:#ff9f43">6</span> Jul <span style="color:#ff9f43">29</span>  13:17 /tmp/d1/d2</span></span></code></pre></div>
<ul>
<li>Change the SELinux type on <em>/tmp/d1</em> to <code>etc_t</code> recursively with the <code>chcon</code> command and confirm.</li>
</ul>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span> <span style="color:#ff6ac1">[</span>root@server30 tmp<span style="color:#ff6ac1">]</span><span style="color:#78787e"># chcon -Rv -t etc_t /tmp/d1</span>
</span></span><span style="display:flex;"><span> changing security context of <span style="color:#5af78e">&#39;/tmp/d1/d2&#39;</span>
</span></span><span style="display:flex;"><span> changing security context of <span style="color:#5af78e">&#39;/tmp/d1&#39;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span> <span style="color:#ff6ac1">[</span>root@server30 tmp<span style="color:#ff6ac1">]</span><span style="color:#78787e"># ls -ldZ /tmp/d1</span>
</span></span><span style="display:flex;"><span> drwxr-xr-x. <span style="color:#ff9f43">3</span> root root unconfined_u:object_r:etc_t:s0 <span style="color:#ff9f43">16</span> Jul <span style="color:#ff9f43">29</span>  13:17 /tmp/d1
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span> <span style="color:#ff6ac1">[</span>root@server30 tmp<span style="color:#ff6ac1">]</span><span style="color:#78787e"># ls -ldZ /tmp/d1/d2</span>
</span></span><span style="display:flex;"><span> drwxr-xr-x. <span style="color:#ff9f43">2</span> root root unconfined_u:object_r:etc_t:s0 <span style="color:#ff9f43">6</span> Jul <span style="color:#ff9f43">29</span> 13:17 /tmp/d1/d2</span></span></code></pre></div>
<ul>
<li>Add <em>/tmp/d1</em> to the policy database with the <code>semanage</code> command to ensure the new context is persistent on the directory hierarchy.</li>
</ul>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span> <span style="color:#ff6ac1">[</span>root@server30 tmp<span style="color:#ff6ac1">]</span><span style="color:#78787e"># semanage fcontext -a -t etc_t /tmp/d1</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span> <span style="color:#ff6ac1">[</span>root@server30 tmp<span style="color:#ff6ac1">]</span><span style="color:#78787e"># reboot</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span> <span style="color:#ff6ac1">[</span>root@server30 ~<span style="color:#ff6ac1">]</span><span style="color:#78787e"># ls -ldZ /tmp/d1</span>
</span></span><span style="display:flex;"><span> drwxr-xr-x. <span style="color:#ff9f43">3</span> root root unconfined_u:object_r:etc_t:s0 <span style="color:#ff9f43">16</span> Jul <span style="color:#ff9f43">29</span>  13:17 /tmp/d1
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span> <span style="color:#ff6ac1">[</span>root@server30 ~<span style="color:#ff6ac1">]</span><span style="color:#78787e"># ls -ldZ /tmp/d1/d2</span>
</span></span><span style="display:flex;"><span> drwxr-xr-x. <span style="color:#ff9f43">2</span> root root unconfined_u:object_r:etc_t:s0 <span style="color:#ff9f43">6</span> Jul <span style="color:#ff9f43">29</span> 13:17 /tmp/d1/d2</span></span></code></pre></div>
<h3 id="lab-add-network-port-to-policy-database">Lab: Add Network Port to Policy Database</h3>
<ul>
<li>Add network port 9005 to the SELinux policy database for the secure HTTP service using the semanage command.</li>
</ul>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span> <span style="color:#ff6ac1">[</span>root@server30 ~<span style="color:#ff6ac1">]</span><span style="color:#78787e"># semanage port -l | grep ^http_port</span>
</span></span><span style="display:flex;"><span> http_port_t                    tcp      80, 81, 443, 488, 8008, 8009, 8443, <span style="color:#ff9f43">9000</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span> <span style="color:#ff6ac1">[</span>root@server30 ~<span style="color:#ff6ac1">]</span><span style="color:#78787e"># semanage port -at http_port_t -p tcp 9005</span></span></span></code></pre></div>
<ul>
<li>Verify the addition.</li>
</ul>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span> <span style="color:#ff6ac1">[</span>root@server30 ~<span style="color:#ff6ac1">]</span><span style="color:#78787e"># semanage port -l | grep ^http_port</span>
</span></span><span style="display:flex;"><span> http_port_t                    tcp      9005, 80, 81, 443, 488, 8008, 8009, 8443, <span style="color:#ff9f43">9000</span></span></span></code></pre></div>
<h3 id="lab-copy-files-with-and-without-context-1">Lab: Copy Files with and without Context</h3>
<ul>
<li>Create file <em>sef1</em> under <em>/tmp</em>.</li>
</ul>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span> <span style="color:#ff6ac1">[</span>root@server30 ~<span style="color:#ff6ac1">]</span><span style="color:#78787e"># touch /tmp/sef1</span></span></span></code></pre></div>
<ul>
<li>Copy the file to the <em>/usr/local</em> directory.</li>
</ul>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span> <span style="color:#ff6ac1">[</span>root@server30 ~<span style="color:#ff6ac1">]</span><span style="color:#78787e"># cp /tmp/sef1 /usr/local</span></span></span></code></pre></div>
<ul>
<li>Check and compare the contexts on both source and destination files.</li>
</ul>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span> <span style="color:#ff6ac1">[</span>root@server30 ~<span style="color:#ff6ac1">]</span><span style="color:#78787e"># ls -lZ /tmp/sef1</span>
</span></span><span style="display:flex;"><span> -rw-r--r--. <span style="color:#ff9f43">1</span> root root unconfined_u:object_r:user_tmp_t:s0 <span style="color:#ff9f43">0</span> Jul <span style="color:#ff9f43">29</span>  13:33 /tmp/sef1
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span> <span style="color:#ff6ac1">[</span>root@server30 ~<span style="color:#ff6ac1">]</span><span style="color:#78787e"># ls -lZ /usr/local/sef1</span>
</span></span><span style="display:flex;"><span> -rw-r--r--. <span style="color:#ff9f43">1</span> root root unconfined_u:object_r:usr_t:s0 <span style="color:#ff9f43">0</span> Jul <span style="color:#ff9f43">29</span> 13:33 /usr/local/sef1</span></span></code></pre></div>
<ul>
<li>Create another file <em>sef2</em> under <em>/tmp</em> and copy it to the <em>/var/local</em> directory using the <code>--preserve=context</code> option with the <code>cp</code> command.</li>
</ul>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span> <span style="color:#ff6ac1">[</span>root@server30 ~<span style="color:#ff6ac1">]</span><span style="color:#78787e"># touch /tmp/sef2</span>
</span></span><span style="display:flex;"><span> <span style="color:#ff6ac1">[</span>root@server30 ~<span style="color:#ff6ac1">]</span><span style="color:#78787e"># cp --preserve=context /tmp/sef2 /var/local/</span></span></span></code></pre></div>
<ul>
<li>Check and compare the contexts on both source and destination files.</li>
</ul>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span> <span style="color:#ff6ac1">[</span>root@server30 ~<span style="color:#ff6ac1">]</span><span style="color:#78787e"># ls -lZ /tmp/sef2 /var/local/sef2</span>
</span></span><span style="display:flex;"><span> -rw-r--r--. <span style="color:#ff9f43">1</span> root root unconfined_u:object_r:user_tmp_t:s0 <span style="color:#ff9f43">0</span> Jul <span style="color:#ff9f43">29</span>  13:35 /tmp/sef2
</span></span><span style="display:flex;"><span> -rw-r--r--. <span style="color:#ff9f43">1</span> root root unconfined_u:object_r:user_tmp_t:s0 <span style="color:#ff9f43">0</span> Jul <span style="color:#ff9f43">29</span>  13:36 /var/local/sef2</span></span></code></pre></div>
<h3 id="lab-flip-selinux-booleans">Lab: Flip SELinux Booleans</h3>
<ul>
<li>Check the current value of Boolean <code>ssh_use_tcpd</code> using the <code>getsebool</code> and <code>sestatus</code> commands.</li>
</ul>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span> <span style="color:#ff6ac1">[</span>root@server30 ~<span style="color:#ff6ac1">]</span><span style="color:#78787e"># getsebool -a | grep ssh_use_tcpd</span>
</span></span><span style="display:flex;"><span> ssh_use_tcpd --&gt; off</span></span></code></pre></div>
<ul>
<li>Use the <code>setsebool</code> command and toggle the value of the directive.</li>
</ul>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span> <span style="color:#ff6ac1">[</span>root@server30 ~<span style="color:#ff6ac1">]</span><span style="color:#78787e"># setsebool ssh_use_tcpd 1 </span></span></span></code></pre></div>
<ul>
<li>Confirm the new value with the <code>getsebool</code>, <code>semanage</code>, or <code>sestatus</code> command.</li>
</ul>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span> <span style="color:#ff6ac1">[</span>root@server30 ~<span style="color:#ff6ac1">]</span><span style="color:#78787e"># getsebool -a | grep ssh_use_tcpd</span>
</span></span><span style="display:flex;"><span> ssh_use_tcpd --&gt; on
</span></span><span style="display:flex;"><span> <span style="color:#ff6ac1">[</span>root@server30 ~<span style="color:#ff6ac1">]</span><span style="color:#78787e"># sestatus -b | grep ssh_use_tcpd</span>
</span></span><span style="display:flex;"><span> ssh_use_tcpd                                on
</span></span><span style="display:flex;"><span> <span style="color:#ff6ac1">[</span>root@server30 ~<span style="color:#ff6ac1">]</span><span style="color:#78787e"># semanage boolean -l | grep ssh_use_tcpd </span>
</span></span><span style="display:flex;"><span> ssh_use_tcpd                   <span style="color:#ff6ac1">(</span>on   ,  off<span style="color:#ff6ac1">)</span>  Allow ssh to use tcpd</span></span></code></pre></div>

  <footer class="footline">
  </footer>
</article>
<article class="default">
  <header class="headline">
  </header>

<h1 id="the-linux-firewall">The Linux Firewall</h1>

<h1 id="firewalld-zones"><code>firewalld</code> Zones</h1>
<h2 id="firewalld"><code>firewalld</code></h2>
<ul>
<li>The host-based firewall solution employed in RHEL uses a kernel module called <strong>netfilter</strong> together with a filtering and packet classification framework called <strong>nftables</strong> for policing the traffic movement.</li>
<li>It also supports other advanced features such as <strong>Network Address Translation (NAT)</strong> and <strong>port forwarding</strong>.</li>
<li>This firewall solution inspects, modifies, drops, or routes incoming, outgoing, and forwarded network packets based on defined rulesets.</li>
<li>Default host-based firewall management service in RHEL</li>
<li>Ability to add, modify, or delete firewall rules immediately without disrupting current network connections or restarting the service process.</li>
<li>Also allows to save rules persistently so that they are activated automatically at system reboots.</li>
<li>Lets you perform management operations at the command line using the <code>firewall-cmd</code> command, graphically using the web console, or manually by editing rules files.</li>
<li>Stores the default rules in files located in the /usr/lib/firewalld directory, and those that contain custom rules in the /etc/firewalld directory.</li>
<li>The default rules files may be copied to the custom rules directory and modified.</li>
</ul>
<h3 id="firewalld-zones-1">firewalld Zones</h3>
<ul>
<li>Easier and transparent traffic management.</li>
<li>Define policies based on the trust level of network connections and source IP addresses.</li>
<li>A network connection can be part of only one zone at a time;</li>
<li>A zone can have multiple network connections assigned to it.</li>
<li>Zone configuration may include services, ports, and protocols that may be open or closed.</li>
<li>May include rules for advanced configuration items such as masquerading, port forwarding, NAT&rsquo;ing, ICMP filters, and rich language.</li>
<li>Rules for each zone are defined and manipulated independent of other zones.</li>
</ul>
<p>Match source ip to zone that matches address &gt; match based on zone the interface is in &gt; matches default zone</p>
<ul>
<li>
<p>firewalld inspects each incoming packet to determine the source IP address and applies the rules of the zone that has a match for the address.</p>
</li>
<li>
<p>In the event no zone configuration matches the address, it associates the packet with the zone that has the network connection defined, and applies the rules of that zone.</p>
</li>
<li>
<p>If neither works, firewalld associates the packet with the default zone, and enforces the rules of the default zone on the packet.</p>
</li>
<li>
<p>Several predefined zone files that may be selected or customized.</p>
</li>
<li>
<p>These files include templates for traffic that must be blocked or dropped, and for traffic that is:</p>
<ul>
<li>public-facing</li>
<li>internal</li>
<li>external</li>
<li>home</li>
<li>public</li>
<li>trusted</li>
<li>work-related.</li>
</ul>
</li>
<li>
<p>public zone is the default zone, and it is activated by default when the firewalld service is started.</p>
</li>
</ul>
<p>Predefined zones sorted based on the trust level from trusted to
untrusted:</p>
<p><strong>trusted</strong></p>
<ul>
<li>Allow all incoming traffic</li>
</ul>
<p><strong>internal</strong></p>
<ul>
<li>Reject all incoming traffic except for what is allowed. Intended for use on internal networks.</li>
</ul>
<p><strong>home</strong></p>
<ul>
<li>Reject all incoming traffic except for what is allowed. Intended for use in homes.</li>
</ul>
<p><strong>work</strong></p>
<ul>
<li>Reject all incoming traffic except for what is allowed. Intended for use at workplaces.</li>
</ul>
<p><strong>dmz</strong></p>
<ul>
<li>Reject all incoming traffic except for what is allowed. Intended for use in publicly accessible demilitarized zones.</li>
</ul>
<p><strong>external</strong></p>
<ul>
<li>Reject all incoming traffic except for what is allowed.</li>
<li>Outgoing IPv4 traffic forwarded through this zone is masqueraded to look like it originated from the IPv4 address of an outgoing network interface.</li>
<li>Intended for use on external networks with masquerading enabled.</li>
</ul>
<p><strong>public</strong></p>
<ul>
<li>Reject all incoming traffic except for what is allowed.</li>
<li>Default zone for any newly added network interfaces.</li>
<li>Intended for us in public places.</li>
</ul>
<p><strong>block</strong></p>
<ul>
<li>Reject all incoming traffic with icmp-host-prohibited message returned.</li>
<li>Intended for use in secure places.</li>
</ul>
<p><strong>drop</strong></p>
<ul>
<li>
<p>Drop all incoming traffic without responding with ICMP errors.</p>
</li>
<li>
<p>Intended for use in highly secure places.</p>
</li>
<li>
<p>For all the predefined zones, outgoing traffic is allowed by default.</p>
</li>
</ul>
<h3 id="zone-configuration-files">Zone Configuration Files</h3>
<ul>
<li>
<p>firewalld stores zone rules in XML format at two locations</p>
<ul>
<li><strong>system-defined rules</strong> in the <em>/usr/lib/firewalld/zones</em> directory
<ul>
<li>can be used as templates for adding new rules, or applied instantly to any available network connection</li>
<li>automatically copied to the /etc/firewalld/zones directory if it is modified with a management tool</li>
</ul>
</li>
<li><strong>user-defined rules</strong> in the <em>/etc/firewalld/zones</em> directory</li>
</ul>
</li>
<li>
<p>can copy the required zone file to the <em>/etc/firewalld/zones</em> directory manually, and make the necessary changes.</p>
</li>
<li>
<p>The firewalld service reads the files saved in this location, and applies the rules defined in them.</p>
</li>
</ul>
<p>View the system Zones:</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#ff6ac1">[</span>root@server30 ~<span style="color:#ff6ac1">]</span><span style="color:#78787e"># ll /usr/lib/firewalld/zones</span>
</span></span><span style="display:flex;"><span>total <span style="color:#ff9f43">40</span>
</span></span><span style="display:flex;"><span>-rw-r--r--. <span style="color:#ff9f43">1</span> root root <span style="color:#ff9f43">312</span> Nov  <span style="color:#ff9f43">6</span>  <span style="color:#ff9f43">2023</span> block.xml
</span></span><span style="display:flex;"><span>-rw-r--r--. <span style="color:#ff9f43">1</span> root root <span style="color:#ff9f43">306</span> Nov  <span style="color:#ff9f43">6</span>  <span style="color:#ff9f43">2023</span> dmz.xml
</span></span><span style="display:flex;"><span>-rw-r--r--. <span style="color:#ff9f43">1</span> root root <span style="color:#ff9f43">304</span> Nov  <span style="color:#ff9f43">6</span>  <span style="color:#ff9f43">2023</span> drop.xml
</span></span><span style="display:flex;"><span>-rw-r--r--. <span style="color:#ff9f43">1</span> root root <span style="color:#ff9f43">317</span> Nov  <span style="color:#ff9f43">6</span>  <span style="color:#ff9f43">2023</span> external.xml
</span></span><span style="display:flex;"><span>-rw-r--r--. <span style="color:#ff9f43">1</span> root root <span style="color:#ff9f43">410</span> Nov  <span style="color:#ff9f43">6</span>  <span style="color:#ff9f43">2023</span> home.xml
</span></span><span style="display:flex;"><span>-rw-r--r--. <span style="color:#ff9f43">1</span> root root <span style="color:#ff9f43">425</span> Nov  <span style="color:#ff9f43">6</span>  <span style="color:#ff9f43">2023</span> internal.xml
</span></span><span style="display:flex;"><span>-rw-r--r--. <span style="color:#ff9f43">1</span> root root <span style="color:#ff9f43">729</span> Feb <span style="color:#ff9f43">21</span> 23:44 nm-shared.xml
</span></span><span style="display:flex;"><span>-rw-r--r--. <span style="color:#ff9f43">1</span> root root <span style="color:#ff9f43">356</span> Nov  <span style="color:#ff9f43">6</span>  <span style="color:#ff9f43">2023</span> public.xml
</span></span><span style="display:flex;"><span>-rw-r--r--. <span style="color:#ff9f43">1</span> root root <span style="color:#ff9f43">175</span> Nov  <span style="color:#ff9f43">6</span>  <span style="color:#ff9f43">2023</span> trusted.xml
</span></span><span style="display:flex;"><span>-rw-r--r--. <span style="color:#ff9f43">1</span> root root <span style="color:#ff9f43">352</span> Nov  <span style="color:#ff9f43">6</span>  <span style="color:#ff9f43">2023</span> work.xml</span></span></code></pre></div>
<p>View the public zone:</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#ff6ac1">[</span>root@server30 ~<span style="color:#ff6ac1">]</span><span style="color:#78787e"># cat /usr/lib/firewalld/zones/public.xml </span>
</span></span><span style="display:flex;"><span>&lt;?xml <span style="color:#ff5c57">version</span><span style="color:#ff6ac1">=</span><span style="color:#5af78e">&#34;1.0&#34;</span> <span style="color:#ff5c57">encoding</span><span style="color:#ff6ac1">=</span><span style="color:#5af78e">&#34;utf-8&#34;</span>?&gt;
</span></span><span style="display:flex;"><span>&lt;zone&gt;
</span></span><span style="display:flex;"><span>  &lt;short&gt;Public&lt;/short&gt;
</span></span><span style="display:flex;"><span>  &lt;description&gt;For use in public areas. You <span style="color:#ff6ac1">do</span> not trust the other computers on networks to not harm your computer. Only selected incoming connections are accepted.&lt;/description&gt;
</span></span><span style="display:flex;"><span>  &lt;service <span style="color:#ff5c57">name</span><span style="color:#ff6ac1">=</span><span style="color:#5af78e">&#34;ssh&#34;</span>/&gt;
</span></span><span style="display:flex;"><span>  &lt;service <span style="color:#ff5c57">name</span><span style="color:#ff6ac1">=</span><span style="color:#5af78e">&#34;dhcpv6-client&#34;</span>/&gt;
</span></span><span style="display:flex;"><span>  &lt;service <span style="color:#ff5c57">name</span><span style="color:#ff6ac1">=</span><span style="color:#5af78e">&#34;cockpit&#34;</span>/&gt;
</span></span><span style="display:flex;"><span>  &lt;forward/&gt;
</span></span><span style="display:flex;"><span>&lt;/zone&gt;</span></span></code></pre></div>
<ul>
<li>See the manual pages for firewalld.zone for details on zone configuration files.</li>
</ul>
<h2 id="firewalld-services">firewalld Services</h2>
<ul>
<li>For easier activation and deactivation of specific rules.</li>
<li>Preconfigured firewall rules delineated for various services and stored in different files.</li>
<li>The rules consist of necessary settings, such as the port number, protocol, and possibly helper modules, to support the loading of the service.</li>
<li>Can be added to a zone.</li>
<li>By default, firewalld blocks all traffic unless a service or port is explicitly opened.</li>
</ul>
<h3 id="service-configuration-files">Service Configuration Files</h3>
<ul>
<li>firewalld stores service rules in XML format at two locations:</li>
<li><strong>system-defined</strong> rules in the <em>/usr/lib/firewalld/services</em> directory
<ul>
<li>Can be used as templates for adding new service rules, or activated instantly.</li>
<li>A system service configuration file is automatically copied to the /etc/firewalld/services directory if it is modified with a management tool.</li>
</ul>
</li>
<li><strong>user-defined</strong> rules in the <em>/etc/firewalld/services</em> directory.
<ul>
<li>You can copy the required service file to the /etc/firewalld/services directory manually, and make the necessary changes.</li>
</ul>
</li>
<li>Service reads the files saved in this location, and applies the rules defined in them.</li>
</ul>
<p>A listing of the system service files is presented below:</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>root@server30 ~<span style="color:#ff6ac1">]</span><span style="color:#78787e"># ll /usr/lib/firewalld/services</span>
</span></span><span style="display:flex;"><span>total <span style="color:#ff9f43">884</span>
</span></span><span style="display:flex;"><span>-rw-r--r--. <span style="color:#ff9f43">1</span> root root <span style="color:#ff9f43">352</span> Nov  <span style="color:#ff9f43">6</span>  <span style="color:#ff9f43">2023</span> afp.xml
</span></span><span style="display:flex;"><span>-rw-r--r--. <span style="color:#ff9f43">1</span> root root <span style="color:#ff9f43">399</span> Nov  <span style="color:#ff9f43">6</span>  <span style="color:#ff9f43">2023</span> amanda-client.xml
</span></span><span style="display:flex;"><span>-rw-r--r--. <span style="color:#ff9f43">1</span> root root <span style="color:#ff9f43">427</span> Nov  <span style="color:#ff9f43">6</span>  <span style="color:#ff9f43">2023</span> amanda-k5-client.xml
</span></span><span style="display:flex;"><span>-rw-r--r--. <span style="color:#ff9f43">1</span> root root <span style="color:#ff9f43">283</span> Nov  <span style="color:#ff9f43">6</span>  <span style="color:#ff9f43">2023</span> amqps.xml
</span></span><span style="display:flex;"><span>-rw-r--r--. <span style="color:#ff9f43">1</span> root root <span style="color:#ff9f43">273</span> Nov  <span style="color:#ff9f43">6</span>  <span style="color:#ff9f43">2023</span> amqp.xml
</span></span><span style="display:flex;"><span>-rw-r--r--. <span style="color:#ff9f43">1</span> root root <span style="color:#ff9f43">285</span> Nov  <span style="color:#ff9f43">6</span>  <span style="color:#ff9f43">2023</span> apcupsd.xml
</span></span><span style="display:flex;"><span>-rw-r--r--. <span style="color:#ff9f43">1</span> root root <span style="color:#ff9f43">301</span> Nov  <span style="color:#ff9f43">6</span>  <span style="color:#ff9f43">2023</span> audit.xml
</span></span><span style="display:flex;"><span>-rw-r--r--. <span style="color:#ff9f43">1</span> root root <span style="color:#ff9f43">436</span> Nov  <span style="color:#ff9f43">6</span>  <span style="color:#ff9f43">2023</span> ausweisapp2.xml
</span></span><span style="display:flex;"><span>-rw-r--r--. <span style="color:#ff9f43">1</span> root root <span style="color:#ff9f43">320</span> Nov  <span style="color:#ff9f43">6</span>  <span style="color:#ff9f43">2023</span> bacula-client.xml
</span></span><span style="display:flex;"><span>-rw-r--r--. <span style="color:#ff9f43">1</span> root root <span style="color:#ff9f43">346</span> Nov  <span style="color:#ff9f43">6</span>  <span style="color:#ff9f43">2023</span> bacula.xml
</span></span><span style="display:flex;"><span>-rw-r--r--. <span style="color:#ff9f43">1</span> root root <span style="color:#ff9f43">390</span> Nov  <span style="color:#ff9f43">6</span>  <span style="color:#ff9f43">2023</span> bareos-director.xml
</span></span><span style="display:flex;"><span>...
</span></span><span style="display:flex;"><span>...</span></span></code></pre></div>
<p>Shows the content of the ssh service file:</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#ff6ac1">[</span>root@server30 ~<span style="color:#ff6ac1">]</span><span style="color:#78787e"># cat /usr/lib/firewalld/services/ssh.xml</span>
</span></span><span style="display:flex;"><span>&lt;?xml <span style="color:#ff5c57">version</span><span style="color:#ff6ac1">=</span><span style="color:#5af78e">&#34;1.0&#34;</span> <span style="color:#ff5c57">encoding</span><span style="color:#ff6ac1">=</span><span style="color:#5af78e">&#34;utf-8&#34;</span>?&gt;
</span></span><span style="display:flex;"><span>&lt;service&gt;
</span></span><span style="display:flex;"><span>  &lt;short&gt;SSH&lt;/short&gt;
</span></span><span style="display:flex;"><span>  &lt;description&gt;Secure Shell <span style="color:#ff6ac1">(</span>SSH<span style="color:#ff6ac1">)</span> is a protocol <span style="color:#ff6ac1">for</span> logging into and executing commands on remote machines. It provides secure encrypted communications. If you plan on accessing your machine remotely via SSH over a firewalled interface, <span style="color:#ff5c57">enable</span> this option. You need the openssh-server package installed <span style="color:#ff6ac1">for</span> this option to be useful.&lt;/description&gt;
</span></span><span style="display:flex;"><span>  &lt;port <span style="color:#ff5c57">protocol</span><span style="color:#ff6ac1">=</span><span style="color:#5af78e">&#34;tcp&#34;</span> <span style="color:#ff5c57">port</span><span style="color:#ff6ac1">=</span><span style="color:#5af78e">&#34;22&#34;</span>/&gt;
</span></span><span style="display:flex;"><span>&lt;/service&gt;</span></span></code></pre></div>
<ul>
<li>Has a name and description</li>
<li>Defines the port and protocol for the service.</li>
<li>See the manual pages for firewalld.service for details on service configuration files.</li>
</ul>
<h2 id="firewalld-management">firewalld Management</h2>
<ul>
<li>Listing, querying, adding, changing, and removing zones, services, ports, IP sources, and network connections. Three methods:
<ul>
<li><code>firewall-cmd</code></li>
<li>Web interface for graphical administration.</li>
<li>Edit Zone and service templates manually</li>
</ul>
</li>
</ul>
<h3 id="firewall-cmd-command"><code>firewall-cmd</code> Command</h3>
<ul>
<li>Add or remove rules from the runtime configuration, or save any modifications to service configuration for persistence.</li>
<li>Supports numerous options for the management of zones, services, ports, connections, and so on</li>
</ul>
<h3 id="common-options">Common options</h3>
<h4 id="general">General</h4>
<p><strong>--state</strong></p>
<ul>
<li>Displays the running status of firewalld</li>
</ul>
<p><strong>--reload</strong></p>
<ul>
<li>Reloads firewall rules from zone files. All runtime changes are lost.</li>
</ul>
<p><strong>--permanent</strong></p>
<ul>
<li>Stores a change persistently. The change only becomes active after a service reload or restart.</li>
</ul>
<h4 id="zones">Zones</h4>
<p><strong>--get-default-zone</strong></p>
<ul>
<li>Shows the name of the default/active zone</li>
</ul>
<p><strong>--set-default-zone</strong></p>
<ul>
<li>Changes the default zone for both runtime and permanent configuration</li>
</ul>
<p><strong>--get-zones</strong></p>
<ul>
<li>Prints a list of available zones</li>
</ul>
<p><strong>&ndash;get-active-zones</strong></p>
<ul>
<li>Displays the active zone and the assigned interfaces</li>
</ul>
<p><strong>--list-all</strong></p>
<ul>
<li>Lists all settings for a zone</li>
</ul>
<p><strong>--list-all-zones</strong></p>
<ul>
<li>Lists the settings for all available zones</li>
</ul>
<p><strong>&ndash;zone</strong></p>
<ul>
<li>Specifies the name of the zone to work on. Without this option, the default zone is used.</li>
</ul>
<h4 id="services">Services</h4>
<p><strong>--get-services</strong></p>
<ul>
<li>Prints predefined services</li>
</ul>
<p><strong>--list-services</strong></p>
<ul>
<li>Lists services for a zone</li>
</ul>
<p><strong>--add-service</strong></p>
<ul>
<li>Adds a service to a zone</li>
</ul>
<p><strong>--remove-service</strong></p>
<ul>
<li>Removes a service from a zone</li>
</ul>
<p><strong>--query-service</strong></p>
<ul>
<li>Queries for the presence of a service</li>
</ul>
<h4 id="ports">Ports</h4>
<p><strong>--list-ports</strong></p>
<ul>
<li>Lists network ports</li>
</ul>
<p><strong>--add-port</strong></p>
<ul>
<li>Adds a port or a range of ports to a zone</li>
</ul>
<p><strong>--remove-port</strong></p>
<ul>
<li>Removes a port from a zone</li>
</ul>
<p><strong>--query-port</strong></p>
<ul>
<li>Queries for the presence of a port</li>
</ul>
<h4 id="network-connections">Network Connections</h4>
<p><strong>--list-interfaces</strong></p>
<ul>
<li>Lists network connections assigned to a zone</li>
</ul>
<p><strong>--add-interface</strong></p>
<ul>
<li>Binds a network connection to a zone</li>
</ul>
<p><strong>--change-interface</strong></p>
<ul>
<li>Changes the binding of a network connection to a different zone</li>
</ul>
<p><strong>--remove-interface</strong></p>
<ul>
<li>Unbinds a network connection from a zone</li>
</ul>
<h4 id="ip-sources">IP Sources</h4>
<p><strong>--list-sources</strong></p>
<ul>
<li>Lists IP sources assigned to a zone</li>
</ul>
<p><strong>--add-source</strong></p>
<ul>
<li>Adds an IP source to a zone</li>
</ul>
<p><strong>--change-source</strong></p>
<ul>
<li>Changes an IP source</li>
</ul>
<p><strong>--remove-source</strong></p>
<ul>
<li>Removes an IP source from a zone</li>
</ul>
<hr>
<p><strong>--add and --remove options</strong></p>
<ul>
<li>--permanent switch may be specified to ensure the rule is stored in the zone configuration file under the <em>/etc/firewalld/zones</em> directory for persistence.</li>
</ul>
<h3 id="querying-the-operational-status-of-firewalld">Querying the Operational Status of firewalld</h3>
<p>Check the running status of the firewalld service using either the <code>systemctl</code> or the <code>firewall-cmd</code> command.</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#ff6ac1">[</span>root@server20 ~<span style="color:#ff6ac1">]</span><span style="color:#78787e"># firewall-cmd --state</span>
</span></span><span style="display:flex;"><span>running
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff6ac1">[</span>root@server20 ~<span style="color:#ff6ac1">]</span><span style="color:#78787e"># systemctl status firewalld -l --no-pager</span>
</span></span><span style="display:flex;"><span>â— firewalld.service - firewalld - dynamic firewall daemon
</span></span><span style="display:flex;"><span>     Loaded: loaded <span style="color:#ff6ac1">(</span>/usr/lib/systemd/system/firewalld.service; enabled; preset: enabled<span style="color:#ff6ac1">)</span>
</span></span><span style="display:flex;"><span>     Active: active <span style="color:#ff6ac1">(</span>running<span style="color:#ff6ac1">)</span> since Thu 2024-07-25 13:25:21 MST; 44min ago
</span></span><span style="display:flex;"><span>       Docs: man:firewalld<span style="color:#ff6ac1">(</span>1<span style="color:#ff6ac1">)</span>
</span></span><span style="display:flex;"><span>   Main PID: <span style="color:#ff9f43">829</span> <span style="color:#ff6ac1">(</span>firewalld<span style="color:#ff6ac1">)</span>
</span></span><span style="display:flex;"><span>      Tasks: <span style="color:#ff9f43">2</span> <span style="color:#ff6ac1">(</span>limit: 11108<span style="color:#ff6ac1">)</span>
</span></span><span style="display:flex;"><span>     Memory: 43.9M
</span></span><span style="display:flex;"><span>        CPU: 599ms
</span></span><span style="display:flex;"><span>     CGroup: /system.slice/firewalld.service
</span></span><span style="display:flex;"><span>             â””â”€829 /usr/bin/python3 -s /usr/sbin/firewalld --nofork --nopid
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Jul <span style="color:#ff9f43">25</span> 13:25:21 server20 systemd<span style="color:#ff6ac1">[</span>1<span style="color:#ff6ac1">]</span>: Starting firewalld - dynamic firewall daemon...
</span></span><span style="display:flex;"><span>Jul <span style="color:#ff9f43">25</span> 13:25:21 server20 systemd<span style="color:#ff6ac1">[</span>1<span style="color:#ff6ac1">]</span>: Started firewalld - dynamic firewall daemon.</span></span></code></pre></div>
<h3 id="lab-add-services-and-ports-and-manage-zones">Lab: Add Services and Ports, and Manage Zones</h3>
<ul>
<li>Determine the current active zone.</li>
<li>Add and activate a permanent rule to allow HTTP traffic on port 80</li>
<li>Add a runtime rule for traffic intended for TCP port 443 (the HTTPS service).</li>
<li>Add a permanent rule to the internal zone for TCP port range 5901 to 5910.</li>
<li>Confirm the changes and display the contents of the affected zone files.</li>
<li>Switch the default zone to the internal zone and activate it.</li>
</ul>
<p>1. Determine the name of the current default zone:</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span> <span style="color:#ff6ac1">[</span>root@server20 ~<span style="color:#ff6ac1">]</span><span style="color:#78787e"># firewall-cmd --get-default-zone</span>
</span></span><span style="display:flex;"><span> public</span></span></code></pre></div>
<p>2. Add a permanent rule to allow HTTP traffic on its default port:</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span> <span style="color:#ff6ac1">[</span>root@server20 ~<span style="color:#ff6ac1">]</span><span style="color:#78787e"># firewall-cmd --permanent --add-service  http</span>
</span></span><span style="display:flex;"><span> success</span></span></code></pre></div>
<p>The command made a copy of the <em>public.xml</em> file from <em>/usr/lib/firewalld/zones</em> directory into the <em>/etc/firewalld/zones</em> directory, and added the rule for the HTTP service.</p>
<p>3. Activate the new rule:</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span> <span style="color:#ff6ac1">[</span>root@server20 zones<span style="color:#ff6ac1">]</span><span style="color:#78787e"># firewall-cmd --reload</span>
</span></span><span style="display:flex;"><span> success</span></span></code></pre></div>
<p>4. Confirm the activation of the new rule:</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span> <span style="color:#ff6ac1">[</span>root@server20 zones<span style="color:#ff6ac1">]</span><span style="color:#78787e"># firewall-cmd --list-services</span>
</span></span><span style="display:flex;"><span> cockpit dhcpv6-client http nfs ssh</span></span></code></pre></div>
<p>5. Display the content of the default zone file to confirm the addition of the permanent rule:</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span> <span style="color:#ff6ac1">[</span>root@server20 zones<span style="color:#ff6ac1">]</span><span style="color:#78787e"># cat /etc/firewalld/zones/public.xml</span>
</span></span><span style="display:flex;"><span> &lt;?xml <span style="color:#ff5c57">version</span><span style="color:#ff6ac1">=</span><span style="color:#5af78e">&#34;1.0&#34;</span> <span style="color:#ff5c57">encoding</span><span style="color:#ff6ac1">=</span><span style="color:#5af78e">&#34;utf-8&#34;</span>?&gt;
</span></span><span style="display:flex;"><span> &lt;zone&gt;
</span></span><span style="display:flex;"><span>  &lt;short&gt;Public&lt;/short&gt;
</span></span><span style="display:flex;"><span>  &lt;description&gt;For use in public areas. You <span style="color:#ff6ac1">do</span> not trust    the other computers on networks to not harm your computer.  Only selected incoming connections are accepted. &lt;/description&gt;
</span></span><span style="display:flex;"><span>  &lt;service <span style="color:#ff5c57">name</span><span style="color:#ff6ac1">=</span><span style="color:#5af78e">&#34;ssh&#34;</span>/&gt;
</span></span><span style="display:flex;"><span>  &lt;service <span style="color:#ff5c57">name</span><span style="color:#ff6ac1">=</span><span style="color:#5af78e">&#34;dhcpv6-client&#34;</span>/&gt;
</span></span><span style="display:flex;"><span>  &lt;service <span style="color:#ff5c57">name</span><span style="color:#ff6ac1">=</span><span style="color:#5af78e">&#34;cockpit&#34;</span>/&gt;
</span></span><span style="display:flex;"><span>  &lt;service <span style="color:#ff5c57">name</span><span style="color:#ff6ac1">=</span><span style="color:#5af78e">&#34;nfs&#34;</span>/&gt;
</span></span><span style="display:flex;"><span>  &lt;service <span style="color:#ff5c57">name</span><span style="color:#ff6ac1">=</span><span style="color:#5af78e">&#34;http&#34;</span>/&gt;
</span></span><span style="display:flex;"><span>  &lt;forward/&gt;
</span></span><span style="display:flex;"><span> &lt;/zone&gt;</span></span></code></pre></div>
<p>6. Add a runtime rule to allow traffic on TCP port 443 and verify:</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span> <span style="color:#ff6ac1">[</span>root@server20 zones<span style="color:#ff6ac1">]</span><span style="color:#78787e"># firewall-cmd --add-port 443/tcp</span>
</span></span><span style="display:flex;"><span> success
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span> <span style="color:#ff6ac1">[</span>root@server20 zones<span style="color:#ff6ac1">]</span><span style="color:#78787e"># firewall-cmd --list-ports</span>
</span></span><span style="display:flex;"><span> 443/tcp</span></span></code></pre></div>
<p>7. Add a permanent rule to the internal zone for TCP port range 5901 to 5910:</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span> <span style="color:#ff6ac1">[</span>root@server20 zones<span style="color:#ff6ac1">]</span><span style="color:#78787e"># firewall-cmd --add-port 5901-5910/tcp --permanent --zone internal</span>
</span></span><span style="display:flex;"><span> success</span></span></code></pre></div>
<p>8. Display the content of the internal zone file to confirm the addition of the permanent rule:</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span> <span style="color:#ff6ac1">[</span>root@server20 zones<span style="color:#ff6ac1">]</span><span style="color:#78787e"># cat /etc/firewalld/zones/internal.xml</span>
</span></span><span style="display:flex;"><span> &lt;?xml <span style="color:#ff5c57">version</span><span style="color:#ff6ac1">=</span><span style="color:#5af78e">&#34;1.0&#34;</span> <span style="color:#ff5c57">encoding</span><span style="color:#ff6ac1">=</span><span style="color:#5af78e">&#34;utf-8&#34;</span>?&gt;
</span></span><span style="display:flex;"><span> &lt;zone&gt;
</span></span><span style="display:flex;"><span>  &lt;short&gt;Internal&lt;/short&gt;
</span></span><span style="display:flex;"><span>  &lt;description&gt;For use on internal networks. You mostly  trust the other computers on the networks to not harm your  computer. Only selected incoming connections are accepted. &lt;/description&gt;
</span></span><span style="display:flex;"><span>  &lt;service <span style="color:#ff5c57">name</span><span style="color:#ff6ac1">=</span><span style="color:#5af78e">&#34;ssh&#34;</span>/&gt;
</span></span><span style="display:flex;"><span>  &lt;service <span style="color:#ff5c57">name</span><span style="color:#ff6ac1">=</span><span style="color:#5af78e">&#34;mdns&#34;</span>/&gt;
</span></span><span style="display:flex;"><span>  &lt;service <span style="color:#ff5c57">name</span><span style="color:#ff6ac1">=</span><span style="color:#5af78e">&#34;samba-client&#34;</span>/&gt;
</span></span><span style="display:flex;"><span>  &lt;service <span style="color:#ff5c57">name</span><span style="color:#ff6ac1">=</span><span style="color:#5af78e">&#34;dhcpv6-client&#34;</span>/&gt;
</span></span><span style="display:flex;"><span>  &lt;service <span style="color:#ff5c57">name</span><span style="color:#ff6ac1">=</span><span style="color:#5af78e">&#34;cockpit&#34;</span>/&gt;
</span></span><span style="display:flex;"><span>  &lt;port <span style="color:#ff5c57">port</span><span style="color:#ff6ac1">=</span><span style="color:#5af78e">&#34;5901-5910&#34;</span> <span style="color:#ff5c57">protocol</span><span style="color:#ff6ac1">=</span><span style="color:#5af78e">&#34;tcp&#34;</span>/&gt;
</span></span><span style="display:flex;"><span>  &lt;forward/&gt;
</span></span><span style="display:flex;"><span> &lt;/zone&gt;</span></span></code></pre></div>
<ul>
<li>The firewall-cmd command makes a backup of the affected zone file with a .old extension whenever an update is made to a zone.</li>
</ul>
<p>9. Switch the default zone to internal and confirm:</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span> <span style="color:#ff6ac1">[</span>root@server20 zones<span style="color:#ff6ac1">]</span><span style="color:#78787e"># firewall-cmd --set-default-zone  internal</span>
</span></span><span style="display:flex;"><span> success</span></span></code></pre></div>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span> <span style="color:#ff6ac1">[</span>root@server20 zones<span style="color:#ff6ac1">]</span><span style="color:#78787e"># firewall-cmd --get-default-zone</span>
</span></span><span style="display:flex;"><span> internal</span></span></code></pre></div>
<p>10. Activate the rules defined in the internal zone and list the port range added earlier:</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>  <span style="color:#ff6ac1">[</span>root@server20 zones<span style="color:#ff6ac1">]</span><span style="color:#78787e"># firewall-cmd --list-ports</span>
</span></span><span style="display:flex;"><span>  5901-5910/tcp</span></span></code></pre></div>
<h3 id="lab-remove-services-and-ports-and-manage-zones">Lab: Remove Services and Ports, and Manage Zones</h3>
<ul>
<li>Remove the two permanent rules that were added in the last lab.</li>
<li>Switch the public zone back as the default zone, and confirm the changes.</li>
</ul>
<p>1. Remove the permanent rule for HTTP from the public zone:</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span> <span style="color:#ff6ac1">[</span>root@server20 zones<span style="color:#ff6ac1">]</span><span style="color:#78787e"># firewall-cmd --remove-service=http --zone public --permanent</span>
</span></span><span style="display:flex;"><span> success</span></span></code></pre></div>
<ul>
<li>Must specify public zone as it is not the current default.</li>
</ul>
<p>2. Remove the permanent rule for ports 5901 to 5910 from the internal zone:</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span> <span style="color:#ff6ac1">[</span>root@server20 zones<span style="color:#ff6ac1">]</span><span style="color:#78787e"># firewall-cmd --remove-port 5901- 5910/tcp --permanent</span>
</span></span><span style="display:flex;"><span> success</span></span></code></pre></div>
<p>3. Switch the default zone to public and validate:</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span> <span style="color:#ff6ac1">[</span>root@server20 zones<span style="color:#ff6ac1">]</span><span style="color:#78787e"># firewall-cmd --set-default- zone=public</span>
</span></span><span style="display:flex;"><span> success
</span></span><span style="display:flex;"><span> <span style="color:#ff6ac1">[</span>root@server20 zones<span style="color:#ff6ac1">]</span><span style="color:#78787e"># firewall-cmd --get-default-zone </span>
</span></span><span style="display:flex;"><span> public</span></span></code></pre></div>
<p>4. Activate the public zone rules, and list the current services:</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span> <span style="color:#ff6ac1">[</span>root@server20 zones<span style="color:#ff6ac1">]</span><span style="color:#78787e"># firewall-cmd --reload</span>
</span></span><span style="display:flex;"><span> success
</span></span><span style="display:flex;"><span> <span style="color:#ff6ac1">[</span>root@server20 zones<span style="color:#ff6ac1">]</span><span style="color:#78787e"># firewall-cmd --list-services</span>
</span></span><span style="display:flex;"><span> cockpit dhcpv6-client nfs ssh</span></span></code></pre></div>
<h3 id="lab-test-the-effect-of-firewall-rule">Lab: Test the Effect of Firewall Rule</h3>
<ul>
<li>Remove the sshd service rule from the runtime configuration on server20</li>
<li>Try to access the server from server10 using the ssh command.</li>
</ul>
<p>1. Remove the rule for the sshd service on server20:</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span> <span style="color:#ff6ac1">[</span>root@server20 zones<span style="color:#ff6ac1">]</span><span style="color:#78787e"># firewall-cmd --remove-service ssh</span>
</span></span><span style="display:flex;"><span> success</span></span></code></pre></div>
<p>2. Issue the ssh command on server10 to access server20:</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span> <span style="color:#ff6ac1">[</span>root@server10 ~<span style="color:#ff6ac1">]</span><span style="color:#78787e"># ssh 192.168.0.37</span>
</span></span><span style="display:flex;"><span> ssh: connect to host 192.168.0.37 port 22: No route to host</span></span></code></pre></div>
<p>3. Add the rule back for sshd on server20:</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span> <span style="color:#ff6ac1">[</span>root@server20 zones<span style="color:#ff6ac1">]</span><span style="color:#78787e"># firewall-cmd --add-service ssh</span>
</span></span><span style="display:flex;"><span> success</span></span></code></pre></div>
<p>4. Issue the ssh command on server10 to access server20. Enter &ldquo;yes&rdquo; if
prompted and the password for user1.</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span> <span style="color:#ff6ac1">[</span>root@server10 ~<span style="color:#ff6ac1">]</span><span style="color:#78787e"># ssh 192.168.0.37</span>
</span></span><span style="display:flex;"><span> The authenticity of host <span style="color:#5af78e">&#39;192.168.0.37 (192.168.0.37)&#39;</span>  can<span style="color:#5af78e">&#39;t be established.
</span></span></span><span style="display:flex;"><span><span style="color:#5af78e"> ED25519 key fingerprint is  SHA256:Z8nFu0Jj1ASZeXByiy3aAWHpUhGhUmDCr+Omu/iWTjs.
</span></span></span><span style="display:flex;"><span><span style="color:#5af78e"> This key is not known by any other names
</span></span></span><span style="display:flex;"><span><span style="color:#5af78e"> Are you sure you want to continue connecting  (yes/no/[fingerprint])? yes
</span></span></span><span style="display:flex;"><span><span style="color:#5af78e"> Warning: Permanently added &#39;</span>192.168.0.37<span style="color:#5af78e">&#39; (ED25519) to  the list of known hosts.
</span></span></span><span style="display:flex;"><span><span style="color:#5af78e"> root@192.168.0.37&#39;</span>s password: 
</span></span><span style="display:flex;"><span> Web console: https://server20:9090/ or  https://192.168.0.37:9090/
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span> Register this system with Red Hat Insights: insights- client --register
</span></span><span style="display:flex;"><span> Create an account or view all your systems at  https://red.ht/insights-dashboard
</span></span><span style="display:flex;"><span> Last login: Thu Jul <span style="color:#ff9f43">25</span> 13:37:47 <span style="color:#ff9f43">2024</span> from 192.168.0.21/</span></span></code></pre></div>
<h1 id="the-linux-firewall-diy-labs">The Linux Firewall DIY Labs</h1>
<h3 id="lab-add-service-to-firewall">Lab: Add Service to Firewall</h3>
<ul>
<li>Add and activate a permanent rule for HTTPs traffic to the default zone.</li>
</ul>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span> <span style="color:#ff6ac1">[</span>root@server20 ~<span style="color:#ff6ac1">]</span><span style="color:#78787e"># firewall-cmd --add-service  https --permanent</span>
</span></span><span style="display:flex;"><span> success
</span></span><span style="display:flex;"><span> <span style="color:#ff6ac1">[</span>root@server20 ~<span style="color:#ff6ac1">]</span><span style="color:#78787e"># firewall-cmd --reload</span>
</span></span><span style="display:flex;"><span> success</span></span></code></pre></div>
<ul>
<li>Confirm the change by viewing the zone&rsquo;s XML file and running the <code>firewall-cmd</code> command.</li>
</ul>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span> <span style="color:#ff6ac1">[</span>root@server20 ~<span style="color:#ff6ac1">]</span><span style="color:#78787e"># cat  /etc/firewalld/zones/public.xml</span>
</span></span><span style="display:flex;"><span> &lt;?xml <span style="color:#ff5c57">version</span><span style="color:#ff6ac1">=</span><span style="color:#5af78e">&#34;1.0&#34;</span> <span style="color:#ff5c57">encoding</span><span style="color:#ff6ac1">=</span><span style="color:#5af78e">&#34;utf-8&#34;</span>?&gt;
</span></span><span style="display:flex;"><span> &lt;zone&gt;
</span></span><span style="display:flex;"><span>  &lt;short&gt;Public&lt;/short&gt;
</span></span><span style="display:flex;"><span>  &lt;description&gt;For use in public areas. You <span style="color:#ff6ac1">do</span> not trust the other computers on networks to not harm your computer. Only selected incoming connections are accepted.&lt;/description&gt;
</span></span><span style="display:flex;"><span>  &lt;service <span style="color:#ff5c57">name</span><span style="color:#ff6ac1">=</span><span style="color:#5af78e">&#34;ssh&#34;</span>/&gt;
</span></span><span style="display:flex;"><span>  &lt;service <span style="color:#ff5c57">name</span><span style="color:#ff6ac1">=</span><span style="color:#5af78e">&#34;dhcpv6-client&#34;</span>/&gt;
</span></span><span style="display:flex;"><span>  &lt;service <span style="color:#ff5c57">name</span><span style="color:#ff6ac1">=</span><span style="color:#5af78e">&#34;cockpit&#34;</span>/&gt;
</span></span><span style="display:flex;"><span>  &lt;service <span style="color:#ff5c57">name</span><span style="color:#ff6ac1">=</span><span style="color:#5af78e">&#34;nfs&#34;</span>/&gt;
</span></span><span style="display:flex;"><span>  &lt;service <span style="color:#ff5c57">name</span><span style="color:#ff6ac1">=</span><span style="color:#5af78e">&#34;https&#34;</span>/&gt;
</span></span><span style="display:flex;"><span>  &lt;forward/&gt;
</span></span><span style="display:flex;"><span> &lt;/zone&gt;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span> <span style="color:#ff6ac1">[</span>root@server20 ~<span style="color:#ff6ac1">]</span><span style="color:#78787e"># firewall-cmd --list-services</span>
</span></span><span style="display:flex;"><span> cockpit dhcpv6-client https nfs ssh</span></span></code></pre></div>
<h3 id="lab-add-port-range-to-firewall">Lab: Add Port Range to Firewall</h3>
<ul>
<li>Add and activate a permanent rule for the UDP port range 8000 to 8005 to the trusted zone.</li>
</ul>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span> <span style="color:#ff6ac1">[</span>root@server20 ~<span style="color:#ff6ac1">]</span><span style="color:#78787e"># firewall-cmd --add-port 8000- 8005/udp --zone trusted --permanent</span>
</span></span><span style="display:flex;"><span> success
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span> <span style="color:#ff6ac1">[</span>root@server20 ~<span style="color:#ff6ac1">]</span><span style="color:#78787e"># firewall-cmd --reload</span>
</span></span><span style="display:flex;"><span> success</span></span></code></pre></div>
<ul>
<li>Confirm the change by viewing the zone&rsquo;s XML file and running the <code>firewall-cmd</code> command.</li>
</ul>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span> <span style="color:#ff6ac1">[</span>root@server20 ~<span style="color:#ff6ac1">]</span><span style="color:#78787e"># firewall-cmd --list-ports -- zone trusted</span>
</span></span><span style="display:flex;"><span> 8000-8005/udp
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span> <span style="color:#ff6ac1">[</span>root@server20 ~<span style="color:#ff6ac1">]</span><span style="color:#78787e"># cat /etc/firewalld/zones/trusted.xml </span>
</span></span><span style="display:flex;"><span> &lt;?xml <span style="color:#ff5c57">version</span><span style="color:#ff6ac1">=</span><span style="color:#5af78e">&#34;1.0&#34;</span> <span style="color:#ff5c57">encoding</span><span style="color:#ff6ac1">=</span><span style="color:#5af78e">&#34;utf-8&#34;</span>?&gt;
</span></span><span style="display:flex;"><span> &lt;zone <span style="color:#ff5c57">target</span><span style="color:#ff6ac1">=</span><span style="color:#5af78e">&#34;ACCEPT&#34;</span>&gt;
</span></span><span style="display:flex;"><span>  &lt;short&gt;Trusted&lt;/short&gt;
</span></span><span style="display:flex;"><span>  &lt;description&gt;All network connections are  accepted.&lt;/description&gt;
</span></span><span style="display:flex;"><span>  &lt;port <span style="color:#ff5c57">port</span><span style="color:#ff6ac1">=</span><span style="color:#5af78e">&#34;8000-8005&#34;</span> <span style="color:#ff5c57">protocol</span><span style="color:#ff6ac1">=</span><span style="color:#5af78e">&#34;udp&#34;</span>/&gt;
</span></span><span style="display:flex;"><span>  &lt;forward/&gt;
</span></span><span style="display:flex;"><span> &lt;/zone&gt;</span></span></code></pre></div>

  <footer class="footline">
  </footer>
</article>
          </section>
        </div>
      </main>
    </div>
    <script>
      window.MathJax = Object.assign( window.MathJax || {}, {
        tex: {
          inlineMath:  [['\\(', '\\)'], ['$',  '$']],  
          displayMath: [['\\[', '\\]'], ['$$', '$$']], 
        },
        options: {
          enableMenu: false 
        }
      }, JSON.parse("{}") );
    </script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="/js/js-yaml/js-yaml.min.js?1756899454" defer></script>
    <script src="/js/d3/d3-color.min.js?1756899454" defer></script>
    <script src="/js/d3/d3-dispatch.min.js?1756899454" defer></script>
    <script src="/js/d3/d3-drag.min.js?1756899454" defer></script>
    <script src="/js/d3/d3-ease.min.js?1756899454" defer></script>
    <script src="/js/d3/d3-interpolate.min.js?1756899454" defer></script>
    <script src="/js/d3/d3-selection.min.js?1756899454" defer></script>
    <script src="/js/d3/d3-timer.min.js?1756899454" defer></script>
    <script src="/js/d3/d3-transition.min.js?1756899454" defer></script>
    <script src="/js/d3/d3-zoom.min.js?1756899454" defer></script>
    <script src="https://unpkg.com/mermaid/dist/mermaid.min.js" defer></script>
    <script>
      window.relearn.themeUseMermaid = JSON.parse("{ \"theme\": \"default\" }");
    </script>
    <script src="/js/clipboard/clipboard.min.js?1756899454" defer></script>
    <script src="/js/perfect-scrollbar/perfect-scrollbar.min.js?1756899454" defer></script>
    <script src="/js/theme.min.js?1756899454" defer></script>
  </body>
</html>
