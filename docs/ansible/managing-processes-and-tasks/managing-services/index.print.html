<!DOCTYPE html>
<html lang="en-us" dir="ltr" itemscope itemtype="http://schema.org/Article" data-r-output-format="print">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="height=device-height, width=device-width, initial-scale=1.0, minimum-scale=1.0">
    <meta name="generator" content="Hugo 0.152.2">
    <meta name="generator" content="Relearn 8.2.0+d150cc8909ed7836ff5d545e76544f6923ffacf5">
    <meta name="description" content="Managing Services with Ansible">
    <meta name="author" content="David Thomas">
    <meta name="twitter:card" content="summary">
    <meta name="twitter:title" content="Managing Services :: Linux Reader">
    <meta name="twitter:description" content="Managing Services with Ansible">
    <meta property="og:url" content="http://linuxreader.com/ansible/managing-processes-and-tasks/managing-services/">
    <meta property="og:site_name" content="Linux Reader">
    <meta property="og:title" content="Managing Services :: Linux Reader">
    <meta property="og:description" content="Managing Services with Ansible">
    <meta property="og:locale" content="en_us">
    <meta property="og:type" content="article">
    <meta property="article:section" content="Ansible">
    <meta itemprop="name" content="Managing Services :: Linux Reader">
    <meta itemprop="description" content="Managing Services with Ansible">
    <meta itemprop="wordCount" content="1108">
    <title>Managing Services :: Linux Reader</title>
    <link href="http://linuxreader.com/ansible/managing-processes-and-tasks/managing-services/" rel="canonical" type="text/html" title="Managing Services :: Linux Reader">
    <link href="/ansible/managing-processes-and-tasks/managing-services/index.xml" rel="alternate" type="application/rss+xml" title="Managing Services :: Linux Reader">
    <link href="/images/favicon.svg?1762527705" rel="icon" type="image/svg+xml">
    <link href="/css/auto-complete/auto-complete.min.css?1762527705" rel="stylesheet">
    <script src="/js/auto-complete/auto-complete.min.js?1762527705" defer></script>
    <script src="/js/search-lunr.min.js?1762527705" defer></script>
    <script src="/js/search.min.js?1762527705" defer></script>
    <script>
      window.relearn = window.relearn || {};
      window.relearn.index_js_url="/searchindex.en.js?1762527705";
    </script>
    <script src="/js/lunr/lunr.min.js?1762527705" defer></script>
    <script src="/js/lunr/lunr.stemmer.support.min.js?1762527705" defer></script>
    <script src="/js/lunr/lunr.multi.min.js?1762527705" defer></script>
    <script src="/js/lunr/lunr.en.min.js?1762527705" defer></script>
    <script>
      window.relearn = window.relearn || {};
      window.relearn.contentLangs=['en'];
    </script>
    <link href="/fonts/fontawesome/css/fontawesome-all.min.css?1762527705" rel="stylesheet" media="print" onload="this.media='all';this.onload=null;"><noscript><link href="/fonts/fontawesome/css/fontawesome-all.min.css?1762527705" rel="stylesheet"></noscript>
    <link href="/css/perfect-scrollbar/perfect-scrollbar.min.css?1762527705" rel="stylesheet">
    <link href="/css/theme.min.css?1762527705" rel="stylesheet">
    <link href="/css/format-print.min.css?1762527705" rel="stylesheet" id="R-format-style">
    <script>
      window.relearn = window.relearn || {};
      // configuration
      window.relearn.min = `.min`;
      window.relearn.path='\/ansible\/managing-processes-and-tasks\/managing-services\/';
      window.relearn.relBasePath='..\/..\/..';
      window.relearn.relBaseUri='..\/..\/..';
      window.relearn.absBaseUri='http:\/\/linuxreader.com';
      window.relearn.disableAnchorCopy=false;
      window.relearn.disableAnchorScrolling=false;
      window.relearn.disableInlineCopyToClipboard=true;
      window.relearn.enableBlockCodeWrap=true;
      // legal
      window.relearn.getItem = (s,n) => {return s.getItem(n)};
      window.relearn.setItem = (s,n,v) => {return s.setItem(n,v)};
      window.relearn.removeItem = (s,n) => {return s.removeItem(n)};
      // translations
      window.T_Copy_to_clipboard = `Copy to clipboard`;
      window.T_Copied_to_clipboard = `Copied to clipboard!`;
      window.T_Copy_link_to_clipboard = `Copy link to clipboard`;
      window.T_Link_copied_to_clipboard = `Copied link to clipboard!`;
      window.T_Reset_view = `Reset view`;
      window.T_View_reset = `View reset!`;
      window.T_No_results_found = `No results found for "{0}"`;
      window.T_N_results_found = `{1} results found for "{0}"`;
      // variant stuff
      window.relearn.themevariants = [ 'oled' ];
      window.relearn.customvariantname = "my-custom-variant";
      window.relearn.changeVariant = function(variant) {
        var oldVariant = document.documentElement.dataset.rThemeVariant;
        window.relearn.setItem(window.localStorage, window.relearn.absBaseUri + "/variant", variant);
        document.documentElement.dataset.rThemeVariant = variant;
        if (oldVariant != variant) {
          document.dispatchEvent( new CustomEvent('themeVariantLoaded', { detail: { variant, oldVariant } }) );
          window.relearn.markVariant();
        }
      }
      window.relearn.markVariant = function() {
        var variant = window.relearn.getItem(window.localStorage, window.relearn.absBaseUri + "/variant");
        document.querySelectorAll(".R-variantswitcher select").forEach((select) => {select.value = variant;});
      }
      window.relearn.initVariant = function() {
        var variant = window.relearn.getItem(window.localStorage, window.relearn.absBaseUri + "/variant") ?? "";
        if( variant == window.relearn.customvariantname ){
        }else if( !variant || !window.relearn.themevariants.includes(variant) ){
          variant = window.relearn.themevariants[0];
          window.relearn.setItem(window.localStorage, window.relearn.absBaseUri + "/variant", variant);
        }
        document.documentElement.dataset.rThemeVariant = variant;
      }
      window.relearn.initVariant();
      window.relearn.markVariant();
    </script><style>
:root {
    --MENU-WIDTH-S: 14.375rem;
    --MENU-WIDTH-M: 14.375rem;
    --MENU-WIDTH-L: 18.75rem;
    --MAIN-WIDTH-MAX: 80rem;
    font-size: 1.2rem;
}
</style>

  </head>
  <body class="mobile-support print" data-url="/ansible/managing-processes-and-tasks/managing-services/">
    <div id="R-body" class="default-animation">
      <div id="R-body-overlay"></div>
      <nav id="R-topbar">
        <div class="topbar-wrapper">
          <div class="topbar-sidebar-divider"></div>
          <div class="topbar-area topbar-area-start" data-area="start">
            <div class="topbar-button topbar-button-sidebar" data-content-empty="disable" data-width-s="show" data-width-m="hide" data-width-l="hide">
<span class="btn cstyle link noborder notitle interactive"><button onclick="toggleNav()" type="button" title="Menu (CTRL&#43;ALT&#43;n)"><i class="fa-fw fas fa-bars"></i></button></span>
            </div>
            <div class="topbar-button topbar-button-prev" data-content-empty="disable" data-width-s="show" data-width-m="show" data-width-l="show">
<span class="btn cstyle link noborder notitle interactive"><a href="/ansible/managing-processes-and-tasks/boot-process/" title="Boot Process (ðŸ¡)"><i class="fa-fw fas fa-chevron-left"></i></a></span>
            </div>

            <div class="topbar-button topbar-button-toc" data-content-empty="hide" data-width-s="show" data-width-m="show" data-width-l="show">
<span class="btn cstyle link noborder notitle interactive"><button onclick="toggleTopbarFlyout(this)" type="button" title="Table of Contents (CTRL&#43;ALT&#43;t)"><i class="fa-fw fas fa-list-alt"></i></button></span>
              <div class="topbar-content">
                <div class="topbar-content-wrapper">
<nav class="TableOfContents">
  <ul>
    <li>
      <ul>
        <li><a href="#managing-services">Managing Services</a></li>
      </ul>
    </li>
  </ul>
</nav>
                </div>
              </div>
            </div>


          </div>
          <span class="topbar-breadcrumbs highlightable">
            Managing Services
          </span>
          <div class="topbar-area topbar-area-end" data-area="end">
            <div class="topbar-button topbar-button-print" data-content-empty="disable" data-width-s="area-more" data-width-m="show" data-width-l="show">
<span class="btn cstyle link noborder notitle interactive"><a href="/ansible/managing-processes-and-tasks/managing-services/index.print.html" title="Print whole chapter (CTRL+ALT+p)"><i class="fa-fw fas fa-print"></i></a></span>
            </div>

            <div class="topbar-button topbar-button-next" data-content-empty="disable" data-width-s="show" data-width-m="show" data-width-l="show">
<span class="btn cstyle link noborder notitle interactive"><a href="/ansible/managing-software/" title="Managing Software (ðŸ¡’)"><i class="fa-fw fas fa-chevron-right"></i></a></span>
            </div>







          </div>
        </div>
      </nav>
      <div id="R-main-overlay"></div>
      <main id="R-body-inner" class="highlightable ansible" tabindex="-1">
        <div class="flex-block-wrapper">
<article class="default">
  <header class="headline">
  </header>

<h1 id="managing-services">Managing Services</h1>

<h3 id="managing-services">Managing Services</h3>
<p>Services can be managed in many ways. You can manage systemd services,
but Ansible also allows for management of tasks using Linux cron and at.
Apart from that, you can use Ansible to manage the desired systemd
target that a managed system should be started in, and it can reboot
running machines. <a href="/ansible/managing-processes-and-tasks/managing-services/#ch14.xhtml#tab14_2">Table 14-2</a> gives an overview of
the most significant modules for managing services.</p>
<p><strong>Table 14-2</strong> Modules Related to Service Management</p>
<p><a href="#R-image-098d12473656ace389992f48ac91e7ce" class="lightbox-link"><img alt="Image" class="lazy lightbox figure-image" loading="lazy" src="/Images/14tab02.jpg" style="height: auto;width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-098d12473656ace389992f48ac91e7ce"><img alt="Image" class="lazy lightbox lightbox-image" loading="lazy" src="/Images/14tab02.jpg"></a></p>
<h4 id="managing-systemd-services">Managing Systemd Services</h4>
<p>Throughout this book you have used the service module a lot. This module
enables you to manage services, regardless of the init system that is
used, so it works with System-V init, with Upstart, as well as systemd.
In many cases, you can use the service module for any service-related
task.</p>
<p>If systemd specifics need to be addressed, you must use the systemd
module instead of the service module. Such systemd-specific features
include <strong>daemon_reload</strong> and <strong>mask</strong>. The <strong>daemon_reload</strong> feature
forces the systemd daemon to reread its configuration files, which is
useful after applying changes (or after editing the service files
directory, without using the Linux <strong>systemctl</strong> command). The <strong>mask</strong>
feature marks a systemd service in such a way that it cannot be started,
not even by accident. <a href="/ansible/managing-processes-and-tasks/managing-services/#ch14.xhtml#list14_1">Listing 14-1</a> shows an
example where the systemd module is used to manage services.</p>
<p><strong>Listing 14-1</strong> Using systemd Module Features</p>
<p>::: pre_1
&mdash;
- name: using systemd module to manage services
hosts: ansible2
tasks:
- name: enable service httpd and ensure it is not masked
systemd:
name: httpd
enabled: yes
masked: no
daemon_reload: yes
:::</p>
<p>Given the large amount of functionality that is available in systemd,
the functions that are offered by the systemd services are a bit
limited, and for many specific features, you must use generic modules
such as file and command instead. An example is setting the default
target, which is done by creating a symbolic link using the file module.</p>
<h4 id="managing-cron-jobs">Managing cron Jobs</h4>
<p>The cron module can be used to manage cron jobs. A Linux cron job is one
that is periodically executed by the Linux crond daemon at a specific
time. The cron module can manage jobs in different ways:</p>
<p>â€¢ Write the job directly to a user&rsquo;s crontab</p>
<p>â€¢ Write the job to /etc/crontab or under the /etc/cron.d directory</p>
<p>â€¢ Pass the job to anacron so that it will be run once an hour, day,
week, month, or year without specifically defining when exactly</p>
<p>If you are familiar with Linux cron, using the Ansible cron module is
straightforward. <a href="/ansible/managing-processes-and-tasks/managing-services/#ch14.xhtml#list14_2">Listing 14-2</a> shows an example
that runs the <strong>fstrim</strong> command every day at 4:05 and at 19:05.</p>
<p><strong>Listing 14-2</strong> Running a cron Job</p>
<pre><code>---
- name: run a cron job
  hosts: ansible2
  tasks:
  - name: run a periodic job
    cron:
      name: &quot;run fstrim&quot;
      minute: &quot;5&quot;
      hour: &quot;4,19&quot;
      job: &quot;fstrim&quot;
</code></pre>
<p>As a result of this playbook, a crontab file is created for user root.
To create a crontab file for another user, you can use the <strong>user</strong>
attribute. Notice that while managing cron jobs using the cron module, a
<strong>name</strong> attribute is specified. This attribute is required for Ansible
to manage the cron jobs and has no meaning for Linux crontab itself. If,
for instance, you later want to remove a cron job, you must use the name
of the job as an identifier.</p>
<p><a href="/ansible/managing-processes-and-tasks/managing-services/#ch14.xhtml#list14_3">Listing 14-3</a> shows a sample playbook that
removes the job that was created in <a href="/ansible/managing-processes-and-tasks/managing-services/#ch14.xhtml#list14_2">Listing
14-2</a>. Notice that it just specifies <strong>state:
absent</strong> as well as the name of the job that was previously created; no
other parameters are required.</p>
<p><strong>Listing 14-3</strong> Removing a cron Job Using the <strong>name</strong> Attribute</p>
<p>::: pre_1
&mdash;
- name: run a cron job
hosts: ansible2
tasks:
- name: run a periodic job
cron:
name: &ldquo;run fstrim&rdquo;
state: absent
:::</p>
<h4 class="h4" id="managing-at-jobs">Managing at Jobs</h4>
<p>Whereas you use Linux cron to schedule tasks at a regular interval, you
use Linux at to manage tasks that need to run once only. To interface
with Linux at, the Ansible at module is provided. <a href="/ansible/managing-processes-and-tasks/managing-services/#ch14.xhtml#tab14_3">Table
14-3</a> gives an overview of the arguments it takes
to specify how the task should be executed.</p>
<p>::: group
<strong>Table 14-3</strong> at Module Arguments Overview</p>
<p><a href="#R-image-cf76bfa04e3438a1f539a68cece57c83" class="lightbox-link"><img alt="Image" class="lazy lightbox figure-image" loading="lazy" src="/Images/14tab03.jpg" style="height: auto;width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-cf76bfa04e3438a1f539a68cece57c83"><img alt="Image" class="lazy lightbox lightbox-image" loading="lazy" src="/Images/14tab03.jpg"></a></p>
<p>The most important point to understand when working with at is that it
is used to defined how far from now a task has to be executed. This is
done using <strong>count</strong> and <strong>units</strong>. If, for example, you want to run a
task five minutes from now, you specify the job with the arguments
<strong>count: 5</strong> and <strong>units: minutes</strong>. Also notice the use of the
<strong>unique</strong> argument. If set to yes, the task is ignored if a similar job
is scheduled to run already. <a href="/ansible/managing-processes-and-tasks/managing-services/#ch14.xhtml#list14_4">Listing 14-4</a> shows
an example.</p>
<p><strong>Listing 14-4</strong> Running Commands in the Future with at</p>
<p>::: pre_1
&mdash;
- name: run an at task
hosts: ansible2
tasks:
- name: run command and write output to file
at:
command: &ldquo;date &gt; /tmp/my-at-file&rdquo;
count: 5
units: minutes
unique: yes
state: present
:::</p>
<p>In <a href="/ansible/managing-processes-and-tasks/managing-services/#ch14.xhtml#exe14_1">Exercise 14-1</a> you practice your skills working
with the cron module.</p>
<p>::: box
<strong>Exercise 14-1 Managing cron Jobs</strong></p>
<p>1. Use your editor to create the playbook exercise141-1.yaml and give
it the following contents:</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0"><code class="language-pre1" data-lang="pre1">---
- name: run a cron job
  hosts: ansible2
  tasks:
  - name: run a periodic job
    cron:
      name: &#34;run logger&#34;
      minute: &#34;0&#34;
      hour: &#34;5&#34;
      job: &#34;logger IT IS 5 AM&#34;</code></pre></div>
<p>2. Use <strong>ansible-playbook exercise141-1.yaml</strong> to run the job.</p>
<p>3. Use the command <strong>ansible ansible2 -a &ldquo;crontab -l&rdquo;</strong> to verify the
cron job has been added. The output should look as follows:</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0"><code class="language-pre1" data-lang="pre1">ansible2 | CHANGED | rc=0 &gt;&gt;
#Ansible: run logger
0 5 * * * logger IT IS 5 AM</code></pre></div>
<p>4. Create a new playbook with the name exercise141-2 that runs a new
cron job but uses the same name:</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0"><code class="language-pre1" data-lang="pre1">---
- name: run a cron job
  hosts: ansible2
  tasks:
  - name: run a periodic job
    cron:
      name: &#34;run logger&#34;
      minute: &#34;0&#34;
      hour: &#34;6&#34;
      job: &#34;logger IT IS 6 AM&#34;</code></pre></div>
<p>5. Run this new playbook by using <strong>ansible-playbook
exercise141-2.yaml</strong>. Notice that the job runs with a <strong>changed</strong>
status.</p>
<p>6. Repeat the command <strong>ansible ansible2 -a &ldquo;crontab -l&rdquo;</strong>. This shows
you that the new cron job has overwritten the old job because it was
using the same name. Here is something important to remember: all cron
jobs should have a unique name!</p>
<p>7. Write the playbook exercise141-3.yaml to remove the cron job that
you just created:</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0"><code class="language-pre1" data-lang="pre1">---
- name: run a cron job
  hosts: ansible2
  tasks:
  - name: run logger
    cron:
      name: &#34;run logger&#34;
      state: absent</code></pre></div>
<p>8. Use <strong>ansible-playbook exercise141-3.yaml</strong> to run the last
playbook. Next, use <strong>ansible ansible2 -a &ldquo;crontab -l&rdquo;</strong> to verify that
the cron job was indeed removed.</p>

  <footer class="footline">
  </footer>
</article>
        </div>
      </main>
    </div>
    <script>
      window.MathJax = Object.assign( window.MathJax || {}, {
        tex: {
          inlineMath:  [['\\(', '\\)'], ['$',  '$']],  
          displayMath: [['\\[', '\\]'], ['$$', '$$']], 
        },
        options: {
          enableMenu: false 
        }
      }, JSON.parse("{}") );
    </script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="/js/js-yaml/js-yaml.min.js?1762527705" defer></script>
    <script src="/js/d3/d3-color.min.js?1762527705" defer></script>
    <script src="/js/d3/d3-dispatch.min.js?1762527705" defer></script>
    <script src="/js/d3/d3-drag.min.js?1762527705" defer></script>
    <script src="/js/d3/d3-ease.min.js?1762527705" defer></script>
    <script src="/js/d3/d3-interpolate.min.js?1762527705" defer></script>
    <script src="/js/d3/d3-selection.min.js?1762527705" defer></script>
    <script src="/js/d3/d3-timer.min.js?1762527705" defer></script>
    <script src="/js/d3/d3-transition.min.js?1762527705" defer></script>
    <script src="/js/d3/d3-zoom.min.js?1762527705" defer></script>
    <script src="https://unpkg.com/mermaid/dist/mermaid.min.js" defer></script>
    <script>
      window.relearn.themeUseMermaid = JSON.parse("{ \"theme\": \"default\" }");
    </script>
    <script src="/js/clipboard/clipboard.min.js?1762527705" defer></script>
    <script src="/js/perfect-scrollbar/perfect-scrollbar.min.js?1762527705" defer></script>
    <script src="/js/theme.min.js?1762527705" defer></script>
  </body>
</html>
