<!DOCTYPE html>
<html lang="en-us" dir="ltr" itemscope itemtype="http://schema.org/Article" data-r-output-format="html">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="height=device-height, width=device-width, initial-scale=1.0, minimum-scale=1.0">
    <meta name="generator" content="Hugo 0.152.2">
    <meta name="generator" content="Relearn 8.2.0+d150cc8909ed7836ff5d545e76544f6923ffacf5">
    <meta name="robots" content="noindex, nofollow, noarchive, noimageindex">
    <meta name="description" content="Chapter 3 - Ad-Hoc Commands In the previous chapter, we ended our exploration of local infrastructure testing with Vagrant by creating a very simple Ansible playbook. Earlier still, we used a simple ansible ad-hoc command to run a one-off command on a remote server.
Weâ€™ll dive deeper into playbooks in coming chapters; for now, weâ€™ll explore how Ansible helps you quickly perform common tasks on, and gather data from, one or many servers with ad-hoc commands.">
    <meta name="author" content="David Thomas">
    <meta name="twitter:card" content="summary">
    <meta name="twitter:description" content="Chapter 3 - Ad-Hoc Commands In the previous chapter, we ended our exploration of local infrastructure testing with Vagrant by creating a very simple Ansible playbook. Earlier still, we used a simple ansible ad-hoc command to run a one-off command on a remote server.
Weâ€™ll dive deeper into playbooks in coming chapters; for now, weâ€™ll explore how Ansible helps you quickly perform common tasks on, and gather data from, one or many servers with ad-hoc commands.">
    <meta property="og:url" content="http://linuxreader.com/ansible/ansible4devops/chapter-3---ad-hoc-commands/">
    <meta property="og:site_name" content="Linux Reader">
    <meta property="og:description" content="Chapter 3 - Ad-Hoc Commands In the previous chapter, we ended our exploration of local infrastructure testing with Vagrant by creating a very simple Ansible playbook. Earlier still, we used a simple ansible ad-hoc command to run a one-off command on a remote server.
Weâ€™ll dive deeper into playbooks in coming chapters; for now, weâ€™ll explore how Ansible helps you quickly perform common tasks on, and gather data from, one or many servers with ad-hoc commands.">
    <meta property="og:locale" content="en_us">
    <meta property="og:type" content="article">
    <meta property="article:section" content="Ansible">
    <meta itemprop="description" content="Chapter 3 - Ad-Hoc Commands In the previous chapter, we ended our exploration of local infrastructure testing with Vagrant by creating a very simple Ansible playbook. Earlier still, we used a simple ansible ad-hoc command to run a one-off command on a remote server.
Weâ€™ll dive deeper into playbooks in coming chapters; for now, weâ€™ll explore how Ansible helps you quickly perform common tasks on, and gather data from, one or many servers with ad-hoc commands.">
    <meta itemprop="wordCount" content="7001">
    <title></title>
    <link href="/ansible/ansible4devops/chapter-3---ad-hoc-commands/index.xml" rel="alternate" type="application/rss+xml" title="">
    <link href="/ansible/ansible4devops/chapter-3---ad-hoc-commands/index.print.html" rel="alternate" type="text/html" title="">
    <link href="/images/favicon.svg?1762644799" rel="icon" type="image/svg+xml">
    <link href="/css/auto-complete/auto-complete.min.css?1762644799" rel="stylesheet">
    <script src="/js/auto-complete/auto-complete.min.js?1762644799" defer></script>
    <script src="/js/search-lunr.min.js?1762644799" defer></script>
    <script src="/js/search.min.js?1762644799" defer></script>
    <script>
      window.relearn = window.relearn || {};
      window.relearn.index_js_url="/searchindex.en.js?1762644799";
    </script>
    <script src="/js/lunr/lunr.min.js?1762644799" defer></script>
    <script src="/js/lunr/lunr.stemmer.support.min.js?1762644799" defer></script>
    <script src="/js/lunr/lunr.multi.min.js?1762644799" defer></script>
    <script src="/js/lunr/lunr.en.min.js?1762644799" defer></script>
    <script>
      window.relearn = window.relearn || {};
      window.relearn.contentLangs=['en'];
    </script>
    <link href="/fonts/fontawesome/css/fontawesome-all.min.css?1762644799" rel="stylesheet" media="print" onload="this.media='all';this.onload=null;"><noscript><link href="/fonts/fontawesome/css/fontawesome-all.min.css?1762644799" rel="stylesheet"></noscript>
    <link href="/css/perfect-scrollbar/perfect-scrollbar.min.css?1762644799" rel="stylesheet">
    <link href="/css/theme.min.css?1762644799" rel="stylesheet">
    <link href="/css/format-html.min.css?1762644799" rel="stylesheet" id="R-format-style">
    <script>
      window.relearn = window.relearn || {};
      // configuration
      window.relearn.min = `.min`;
      window.relearn.path='\/ansible\/ansible4devops\/chapter-3---ad-hoc-commands\/';
      window.relearn.relBasePath='..\/..\/..';
      window.relearn.relBaseUri='..\/..\/..';
      window.relearn.absBaseUri='http:\/\/linuxreader.com';
      window.relearn.disableAnchorCopy=false;
      window.relearn.disableAnchorScrolling=false;
      window.relearn.disableInlineCopyToClipboard=true;
      window.relearn.enableBlockCodeWrap=true;
      // legal
      window.relearn.getItem = (s,n) => {return s.getItem(n)};
      window.relearn.setItem = (s,n,v) => {return s.setItem(n,v)};
      window.relearn.removeItem = (s,n) => {return s.removeItem(n)};
      // translations
      window.T_Copy_to_clipboard = `Copy to clipboard`;
      window.T_Copied_to_clipboard = `Copied to clipboard!`;
      window.T_Copy_link_to_clipboard = `Copy link to clipboard`;
      window.T_Link_copied_to_clipboard = `Copied link to clipboard!`;
      window.T_Reset_view = `Reset view`;
      window.T_View_reset = `View reset!`;
      window.T_No_results_found = `No results found for "{0}"`;
      window.T_N_results_found = `{1} results found for "{0}"`;
      // variant stuff
      window.relearn.themevariants = [ 'oled' ];
      window.relearn.customvariantname = "my-custom-variant";
      window.relearn.changeVariant = function(variant) {
        var oldVariant = document.documentElement.dataset.rThemeVariant;
        window.relearn.setItem(window.localStorage, window.relearn.absBaseUri + "/variant", variant);
        document.documentElement.dataset.rThemeVariant = variant;
        if (oldVariant != variant) {
          document.dispatchEvent( new CustomEvent('themeVariantLoaded', { detail: { variant, oldVariant } }) );
          window.relearn.markVariant();
        }
      }
      window.relearn.markVariant = function() {
        var variant = window.relearn.getItem(window.localStorage, window.relearn.absBaseUri + "/variant");
        document.querySelectorAll(".R-variantswitcher select").forEach((select) => {select.value = variant;});
      }
      window.relearn.initVariant = function() {
        var variant = window.relearn.getItem(window.localStorage, window.relearn.absBaseUri + "/variant") ?? "";
        if( variant == window.relearn.customvariantname ){
        }else if( !variant || !window.relearn.themevariants.includes(variant) ){
          variant = window.relearn.themevariants[0];
          window.relearn.setItem(window.localStorage, window.relearn.absBaseUri + "/variant", variant);
        }
        document.documentElement.dataset.rThemeVariant = variant;
      }
      window.relearn.initVariant();
      window.relearn.markVariant();
    </script><style>
:root {
    --MENU-WIDTH-S: 14.375rem;
    --MENU-WIDTH-M: 14.375rem;
    --MENU-WIDTH-L: 18.75rem;
    --MAIN-WIDTH-MAX: 80rem;
    font-size: 1.2rem;
}
</style>

  </head>
  <body class="mobile-support html" data-url="/ansible/ansible4devops/chapter-3---ad-hoc-commands/">
    <div id="R-body" class="default-animation">
      <div id="R-body-overlay"></div>
      <nav id="R-topbar">
        <div class="topbar-wrapper">
          <div class="topbar-sidebar-divider"></div>
          <div class="topbar-area topbar-area-start" data-area="start">
            <div class="topbar-button topbar-button-sidebar" data-content-empty="disable" data-width-s="show" data-width-m="hide" data-width-l="hide">
<span class="btn cstyle link noborder notitle interactive"><button onclick="toggleNav()" type="button" title="Menu (CTRL&#43;ALT&#43;n)"><i class="fa-fw fas fa-bars"></i></button></span>
            </div>
            <div class="topbar-button topbar-button-prev" data-content-empty="disable" data-width-s="show" data-width-m="show" data-width-l="show">
<span class="btn cstyle link noborder notitle interactive"><a href="/ansible/" title="Ansible (ðŸ¡)"><i class="fa-fw fas fa-chevron-left"></i></a></span>
            </div>

            <div class="topbar-button topbar-button-toc" data-content-empty="hide" data-width-s="show" data-width-m="show" data-width-l="show">
<span class="btn cstyle link noborder notitle interactive"><button onclick="toggleTopbarFlyout(this)" type="button" title="Table of Contents (CTRL&#43;ALT&#43;t)"><i class="fa-fw fas fa-list-alt"></i></button></span>
              <div class="topbar-content">
                <div class="topbar-content-wrapper">
<nav class="TableOfContents">
  <ul>
    <li><a href="#chapter-3---ad-hoc-commands">Chapter 3 - Ad-Hoc Commands</a>
      <ul>
        <li><a href="#chap05.xhtml_leanpub-auto-conducting-an-orchestra">Conducting an orchestra</a></li>
        <li><a href="#chap05.xhtml_leanpub-auto-build-infrastructure-with-vagrant-for-testing">Build infrastructure with Vagrant for testing</a></li>
        <li><a href="#chap05.xhtml_multiple-server-inventory">Inventory file for multiple servers</a></li>
        <li><a href="#chap05.xhtml_leanpub-auto-your-first-ad-hoc-commands">Your first ad-hoc commands</a></li>
        <li><a href="#chap05.xhtml_leanpub-auto-configure-groups-of-servers-or-individual-servers">Configure groups of servers, or individual servers</a></li>
      </ul>
    </li>
  </ul>

  <ul>
    <li>
      <ul>
        <li><a href="#chap05.xhtml_leanpub-auto-manage-users-and-groups">Manage users and groups</a></li>
        <li><a href="#chap05.xhtml_leanpub-auto-manage-files-and-directories">Manage files and directories</a></li>
        <li><a href="#chap05.xhtml_leanpub-auto-run-operations-in-the-background">Run operations in the background</a></li>
        <li><a href="#chap05.xhtml_leanpub-auto-check-log-files">Check log files</a></li>
        <li><a href="#chap05.xhtml_leanpub-auto-manage-cron-jobs">Manage cron jobs</a></li>
        <li><a href="#chap05.xhtml_leanpub-auto-deploy-a-version-controlled-application">Deploy a version-controlled application</a></li>
        <li><a href="#chap05.xhtml_leanpub-auto-ansibles-ssh-connection-history">Ansible&rsquo;s SSH connection history</a></li>
        <li><a href="#chap05.xhtml_leanpub-auto-summary-2">Summary</a></li>
      </ul>
    </li>
  </ul>
</nav>
                </div>
              </div>
            </div>


          </div>
          <span class="topbar-breadcrumbs highlightable">
            
          </span>
          <div class="topbar-area topbar-area-end" data-area="end">
            <div class="topbar-button topbar-button-print" data-content-empty="disable" data-width-s="area-more" data-width-m="show" data-width-l="show">
<span class="btn cstyle link noborder notitle interactive"><a href="/ansible/ansible4devops/chapter-3---ad-hoc-commands/index.print.html" title="Print whole chapter (CTRL+ALT+p)"><i class="fa-fw fas fa-print"></i></a></span>
            </div>

            <div class="topbar-button topbar-button-next" data-content-empty="disable" data-width-s="show" data-width-m="show" data-width-l="show">
<span class="btn cstyle link noborder notitle interactive"><a href="/ansible/ad-hoc-ansible-commands/" title="Ad Hoc Ansible Commands (ðŸ¡’)"><i class="fa-fw fas fa-chevron-right"></i></a></span>
            </div>







          </div>
        </div>
      </nav>
      <div id="R-main-overlay"></div>
      <main id="R-body-inner" class="highlightable ansible" tabindex="-1">
        <div class="flex-block-wrapper">
<article class="default">
  <header class="headline">
  </header>

<h1 id=""></h1>

<h2 id="chapter-3---ad-hoc-commands">Chapter 3 - Ad-Hoc Commands</h2>
<p>In the previous chapter, we ended our exploration of local
infrastructure testing with Vagrant by creating a very simple Ansible
playbook. Earlier still, we used a simple ansible ad-hoc command to run
a one-off command on a remote server.</p>
<p>We&rsquo;ll dive deeper into playbooks in coming chapters; for now, we&rsquo;ll
explore how Ansible helps you quickly perform common tasks on, and
gather data from, one or many servers with ad-hoc commands.</p>
<h3 id="chap05.xhtml_leanpub-auto-conducting-an-orchestra">Conducting an orchestra</h3>
<p>The number of servers managed by an individual administrator has risen
dramatically in the past decade, especially as virtualization and
growing cloud application usage has become standard fare. As a result,
admins have had to find new ways of managing servers in a streamlined
fashion.</p>
<p>On any given day, a systems administrator has many tasks:</p>
<ul>
<li>Apply patches and updates via <code>yum</code>, <code>apt</code>, and other package
managers.</li>
<li>Check resource usage (disk space, memory, CPU, swap space, network).</li>
<li>Check log files.</li>
<li>Manage system users and groups.</li>
<li>Manage DNS settings, hosts files, etc.</li>
<li>Copy files to and from servers.</li>
<li>Deploy applications or run application maintenance.</li>
<li>Reboot servers.</li>
<li>Manage cron jobs.</li>
</ul>
<p>Nearly all of these tasks can be (and usually are) at least partially
automated&mdash;but some often need a human touch, especially when it comes
to diagnosing issues in real time. And in today&rsquo;s complex multi-server
environments, logging into servers individually is not a workable
solution.</p>
<p>Ansible allows admins to run ad-hoc commands on one or hundreds of
machines at the same time, using the <code>ansible</code> command. In Chapter 1, we
ran a couple of commands (<code>ping</code> and <code>free -m</code>) on a server that we
added to our Ansible inventory file. This chapter will explore ad-hoc
commands and multi-server environments in much greater detail. Even if
you decide to ignore the rest of Ansible&rsquo;s powerful features, you will
be able to manage your servers much more efficiently after reading this
chapter.</p>
<aside class="information blurb">
<p>Some of the examples in this chapter will display how you can configure
certain aspects of a server with ad-hoc commands. It is usually more
appropriate to contain all configuration within playbooks and templates,
so it&rsquo;s easier to provision your servers (running the playbook the first
time) and then ensure their configuration is idempotent (you can run the
playbooks over and over again, and your servers will be in the correct
state).</p>
<p>The examples in this chapter are for illustration purposes only, and all
might not be applicable to your environment. But even if you <em>only</em> used
Ansible for server management and running individual tasks against
groups of servers, and didn&rsquo;t use Ansible&rsquo;s playbook functionality at
all, you&rsquo;d still have a great orchestration and deployment tool in
Ansible!</p>
</aside>
<h3 id="chap05.xhtml_leanpub-auto-build-infrastructure-with-vagrant-for-testing">Build infrastructure with Vagrant for testing</h3>
<p>For the rest of this chapter, since we want to do a bunch of
experimentation without damaging any production servers, we&rsquo;re going to
use Vagrant&rsquo;s powerful multi-machine capabilities to configure a few
servers which we&rsquo;ll manage with Ansible.</p>
<p>Earlier, we used Vagrant to boot up one virtual machine running CentOS
7. In that example, we used all of Vagrant&rsquo;s default configuration
defined in the Vagrantfile. In this example, we&rsquo;ll use Vagrant&rsquo;s
powerful multi-machine management features.</p>
<figure class="image center">
<img src="images/1-basic-vagrant-application.png"
alt="Three servers: two application, one database." />
<figcaption aria-hidden="true">Three servers: two application, one
database.</figcaption>
</figure>
<p>We&rsquo;re going to manage three VMs: two app servers and a database server.
Many simple web applications and websites have a similar architecture,
and even though this may not reflect the vast realm of infrastructure
combinations that exist, it will be enough to highlight Ansible&rsquo;s server
management abilities.</p>
<p>To begin, create a new folder somewhere on your local drive (I like
using <code>~/VMs/[dir]</code>), and create a new blank file named <code>Vagrantfile</code>
(this is how we describe our virtual machines to Vagrant). Open the file
in your favorite editor, and add the following, then save the file:</p>
<figure class="code">
<div class="highlight">
<pre class="lineno"><code> 1 # -*- mode: ruby -*-
 2 # vi: set ft=ruby :
 3 
 4 VAGRANTFILE_API_VERSION = &quot;2&quot;
 5 
 6 Vagrant.configure(VAGRANTFILE_API_VERSION) do |config|
 7   config.ssh.insert_key = false
 8   config.vm.provider :virtualbox do |vb|
 9     vb.customize [&quot;modifyvm&quot;, :id, &quot;--memory&quot;, &quot;256&quot;]
10   end
11 
12   # Application server 1.
13   config.vm.define &quot;app1&quot; do |app|
14     app.vm.hostname = &quot;orc-app1.dev&quot;
15     app.vm.box = &quot;geerlingguy/centos7&quot;
16     app.vm.network :private_network, ip: &quot;192.168.60.4&quot;
17   end
18 
19   # Application server 2.
20   config.vm.define &quot;app2&quot; do |app|
21     app.vm.hostname = &quot;orc-app2.dev&quot;
22     app.vm.box = &quot;geerlingguy/centos7&quot;
23     app.vm.network :private_network, ip: &quot;192.168.60.5&quot;
24   end
25 
26   # Database server.
27   config.vm.define &quot;db&quot; do |db|
28     db.vm.hostname = &quot;orc-db.dev&quot;
29     db.vm.box = &quot;geerlingguy/centos7&quot;
30     db.vm.network :private_network, ip: &quot;192.168.60.6&quot;
31   end
32 end</code></pre>
</div>
</figure>
<p>This Vagrantfile defines the three servers we want to manage, and gives
each one a unique hostname, machine name (for VirtualBox), and IP
address. For simplicity&rsquo;s sake, all three servers will be running CentOS
7.</p>
<p>Open up a terminal window and change directory to the same folder where
the Vagrantfile you just created exists. Enter <code>vagrant up</code> to let
Vagrant begin building the three VMs. If you already downloaded the box
while building the example from Chapter 2, this process shouldn&rsquo;t take
too long&mdash;maybe 5-10 minutes.</p>
<p>While that&rsquo;s going on, we&rsquo;ll work on telling Ansible about the servers,
so we can start managing them right away.</p>
<h3 id="chap05.xhtml_multiple-server-inventory">Inventory file for multiple servers</h3>
<p>There are many ways you can tell Ansible about the servers you manage,
but the most standard, and simplest, is to add them to your system&rsquo;s
main Ansible inventory file, which is located at <code>/etc/ansible/hosts</code>.
If you didn&rsquo;t create the file in the previous chapter, go ahead and
create the file now; make sure your user account has read permissions
for the file.</p>
<p>Add the following to the file:</p>
<figure class="code">
<div class="highlight">
<pre class="lineno"><code> 1 # Lines beginning with a # are comments, and are only included for
 2 # illustration. These comments are overkill for most inventory files.
 3 
 4 # Application servers
 5 [app]
 6 192.168.60.4
 7 192.168.60.5
 8 
 9 # Database server
10 [db]
11 192.168.60.6
12 
13 # Group &#39;multi&#39; with all servers
14 [multi:children]
15 app
16 db
17 
18 # Variables that will be applied to all servers
19 [multi:vars]
20 ansible_ssh_user=vagrant
21 ansible_ssh_private_key_file=~/.vagrant.d/insecure_private_key</code></pre>
</div>
</figure>
<p>Let&rsquo;s step through this example, group by group:</p>
<ol>
<li>The first block puts both of our application servers into an &lsquo;app&rsquo;
group.</li>
<li>The second block puts the database server into a &lsquo;db&rsquo; group.</li>
<li>The third block tells ansible to define a new group &lsquo;multi&rsquo;, with
child groups, and we add in both the &lsquo;app&rsquo; and &lsquo;db&rsquo; groups.</li>
<li>The fourth block adds variables to the multi group that will be
applied to <em>all</em> servers within multi and all its children.</li>
</ol>
<aside class="information blurb">
<p>We&rsquo;ll dive deeper into variables, group definitions, group hierarchy,
and other Inventory file topics later. For now, we just want Ansible to
know about our servers, so we can start managing them quickly.</p>
</aside>
<p>Save the updated inventory file, and then check to see if Vagrant has
finished building the three VMs. Once Vagrant has finished, we can start
managing the servers with Ansible.</p>
<h3 id="chap05.xhtml_leanpub-auto-your-first-ad-hoc-commands">Your first ad-hoc commands</h3>
<p>One of the first things you need to do is to check in on your servers.
Let&rsquo;s make sure they&rsquo;re configured correctly, have the right time and
date (we don&rsquo;t want any time synchronization-related errors in our
application!), and have enough free resources to run an application.</p>
<aside class="tip blurb">
<p>Many of the things we&rsquo;re manually checking here should also be monitored
by an automated system on production servers; the best way to prevent
disaster is to know when it could be coming, and to fix the problem
<em>before</em> it happens. You should use tools like Munin, Nagios, Cacti,
Hyperic, etc. to ensure you have a good idea of your servers&rsquo; past and
present resource usage! If you&rsquo;re running a website or web application
available over the Internet, you should probably also use an external
monitoring solution like Pingdom or Server Check.in.</p>
</aside>
<h4 id="chap05.xhtml_leanpub-auto-discover-ansibles-parallel-nature">Discover Ansible&rsquo;s parallel nature</h4>
<p>First, I want to make sure Vagrant configured the VMs with the right
hostnames. Use ansible with the <code>-a</code> argument &lsquo;hostname&rsquo; to run hostname
against all the servers:</p>
<figure class="code">
<div class="highlight">
<pre><code>$ ansible multi -a &quot;hostname&quot;</code></pre>
</div>
</figure>
<p>Ansible will run this command against all three of the servers, and
return the results (if Ansible can&rsquo;t reach one a server, it will show an
error for that server, but continue running the command on the others).</p>
<aside class="tip blurb">
<p>If Ansible reports <code>No hosts matched</code> or returns some other
inventory-related error, try setting the <code>ANSIBLE_HOSTS</code> environment
variable explicitly: <code>export ANSIBLE_HOSTS=/etc/ansible/hosts</code>.
Generally Ansible will read the file in <code>/etc/ansible/hosts</code>
automatically, but depending on how you installed Ansible, you may need
to explicitly set <code>ANSIBLE_HOSTS</code> for the <code>ansible</code> command to work
correctly.</p>
</aside>
<p>You may have noticed that the command was not run on each server in the
order you&rsquo;d expect. Go ahead and run the command a few more times, and
see the order:</p>
<figure class="code">
<div class="highlight">
<pre><code># First run results:                # Second run results:
192.168.60.5 | success | rc=0 &gt;&gt;    192.168.60.6 | success | rc=0 &gt;&gt;
orc-app2.dev                        orc-db.dev
<p>192.168.60.6 | success | rc=0 &gt;&gt;    192.168.60.5 | success | rc=0 &gt;&gt;
orc-db.dev                          orc-app2.dev</p>
<p>192.168.60.4 | success | rc=0 &gt;&gt;    192.168.60.4 | success | rc=0 &gt;&gt;
orc-app1.dev                        orc-app1.dev</code></pre></p>
</div>
</figure>
<p>By default, Ansible will run your commands in parallel, using multiple
process forks, so the command will complete more quickly. If you&rsquo;re
managing a few servers, this may not be much quicker than running the
command serially, on one server after the other, but even managing 5-10
servers, you&rsquo;ll notice a dramatic speedup if you use Ansible&rsquo;s
parallelism (which is enabled by default).</p>
<p>Run the same command again, but this time, add the argument <code>-f 1</code> to
tell Ansible to use only one fork (basically, to perform the command on
each server in sequence):</p>
<figure class="code">
<div class="highlight">
<pre><code>$ ansible multi -a &quot;hostname&quot; -f 1
192.168.60.4 | success | rc=0 &gt;&gt;
orc-app1.dev
<p>192.168.60.5 | success | rc=0 &gt;&gt;
orc-app2.dev</p>
<p>192.168.60.6 | success | rc=0 &gt;&gt;
orc-db.dev</code></pre></p>
</div>
</figure>
<p>Run the same command over and over again, and it will always return
results in the same order. It&rsquo;s fairly rare that you will ever need to
do this, but it&rsquo;s much more frequent that you&rsquo;ll want to <em>increase</em> the
value (like <code>-f 10</code>, or <code>-f 25</code>&hellip; depending on how much your system and
network connection can handle) to speed up the process of running
commands on tens or hundreds of servers.</p>
<aside class="tip blurb">
<p>Most people place the target of the action (<code>multi</code>) before the
command/action itself (&ldquo;on X servers, run Y command&rdquo;), but if your brain
works in the reverse order (&ldquo;run Y command on X servers&rdquo;), you could put
the target <em>after</em> the other arguments
(<code>ansible -a &quot;hostname&quot; multi</code>)&mdash;the commands are equivalent.</p>
</aside>
<h4 id="chap05.xhtml_leanpub-auto-learning-about-your-environment">Learning about your environment</h4>
<p>Now that we trust Vagrant&rsquo;s ability to set hostnames correctly, let&rsquo;s
make sure everything else is in order.</p>
<p>First, let&rsquo;s make sure the servers have disk space available for our
application:</p>
<figure class="code">
<div class="highlight">
<pre><code>$ ansible multi -a &quot;df -h&quot;
192.168.60.6 | success | rc=0 &gt;&gt;
Filesystem               Size  Used Avail Use% Mounted on
/dev/mapper/centos-root   19G 1014M   18G   6% /
devtmpfs                 111M     0  111M   0% /dev
tmpfs                    120M     0  120M   0% /dev/shm
tmpfs                    120M  4.3M  115M   4% /run
tmpfs                    120M     0  120M   0% /sys/fs/cgroup
/dev/sda1                497M  124M  374M  25% /boot
none                     233G  217G   17G  94% /vagrant
<p>192.168.60.5 | success | rc=0 &gt;&gt;
Filesystem               Size  Used Avail Use% Mounted on
/dev/mapper/centos-root   19G 1014M   18G   6% /
devtmpfs                 111M     0  111M   0% /dev
tmpfs                    120M     0  120M   0% /dev/shm
tmpfs                    120M  4.3M  115M   4% /run
tmpfs                    120M     0  120M   0% /sys/fs/cgroup
/dev/sda1                497M  124M  374M  25% /boot
none                     233G  217G   17G  94% /vagrant</p>
<p>192.168.60.4 | success | rc=0 &gt;&gt;
Filesystem               Size  Used Avail Use% Mounted on
/dev/mapper/centos-root   19G 1014M   18G   6% /
devtmpfs                 111M     0  111M   0% /dev
tmpfs                    120M     0  120M   0% /dev/shm
tmpfs                    120M  4.3M  115M   4% /run
tmpfs                    120M     0  120M   0% /sys/fs/cgroup
/dev/sda1                497M  124M  374M  25% /boot
none                     233G  217G   17G  94% /vagrant</code></pre></p>
</div>
</figure>
<p>It looks like we have plenty of room for now; our application is pretty
lightweight.</p>
<p>Second, let&rsquo;s also make sure there is enough memory on our servers:</p>
<figure class="code">
<div class="highlight">
<pre><code>$ ansible multi -a &quot;free -m&quot;
192.168.60.4 | success | rc=0 &gt;&gt;
             total       used       free     shared    buffers     cached
Mem:           238        187         50          4          1         69
-/+ buffers/cache:        116        121
Swap:         1055          0       1055
<p>192.168.60.6 | success | rc=0 &gt;&gt;
total       used       free     shared    buffers     cached
Mem:           238        190         47          4          1         72
-/+ buffers/cache:        116        121
Swap:         1055          0       1055</p>
<p>192.168.60.5 | success | rc=0 &gt;&gt;
total       used       free     shared    buffers     cached
Mem:           238        186         52          4          1         67
-/+ buffers/cache:        116        121
Swap:         1055          0       1055</code></pre></p>
</div>
</figure>
<p>Memory is pretty tight, but since we&rsquo;re running three VMs on our
localhost, we need to be a little conservative.</p>
<p>Third, let&rsquo;s make sure the date and time on each server is in sync:</p>
<figure class="code">
<div class="highlight">
<pre><code>$ ansible multi -a &quot;date&quot;
192.168.60.5 | success | rc=0 &gt;&gt;
Sat Feb  1 20:23:08 UTC 2021
<p>192.168.60.4 | success | rc=0 &gt;&gt;
Sat Feb  1 20:23:08 UTC 2021</p>
<p>192.168.60.6 | success | rc=0 &gt;&gt;
Sat Feb  1 20:23:08 UTC 2021</code></pre></p>
</div>
</figure>
<p>Most applications are written with slight tolerances for per-server time
jitter, but it&rsquo;s always a good idea to make sure the times on the
different servers are as close as possible, and the simplest way to do
that is to use the Network Time Protocol, which is easy enough to
configure. We&rsquo;ll do that next, using Ansible&rsquo;s modules to make the
process painless.</p>
<aside class="tip blurb">
<p>To get an exhaustive list of all the environment details (&lsquo;facts&rsquo;, in
Ansible&rsquo;s lingo) for a particular server (or for a group of servers),
use the command <code>ansible [host-or-group] -m setup</code>. This will provide a
list of every minute bit of detail about the server (including file
systems, memory, OS, network interfaces&hellip; you name it, it&rsquo;s in the
list).</p>
</aside>
<h4 id="chap05.xhtml_leanpub-auto-make-changes-using-ansible-modules">Make changes using Ansible modules</h4>
<p>We want to install the NTP daemon on the server to keep the time in
sync. Instead of running the command <code>yum install -y ntp</code> on each of the
servers, we&rsquo;ll use ansible&rsquo;s <code>yum</code> module to do the same (just like we
did in the playbook example earlier, but this time using an ad-hoc
command).</p>
<figure class="code">
<div class="highlight">
<pre><code>$ ansible multi -s -m yum -a &quot;name=ntp state=present&quot;</code></pre>
</div>
</figure>
<p>You should see three simple &lsquo;success&rsquo; messages, reporting no change,
since NTP was already installed on the three machines; this confirms
everything is in working order.</p>
<aside class="information blurb">
<p>The <code>-s</code> option (alias for <code>--sudo</code>) tells Ansible to run the command
with sudo. This will work fine with our Vagrant VMs, but if you&rsquo;re
running commands against a server where your user account requires a
sudo password, you should also pass in <code>-K</code> (alias for
<code>--ask-sudo-pass</code>), so you can enter your sudo password when Ansible
needs it.</p>
</aside>
<p>Now we&rsquo;ll make sure the NTP daemon is started and set to run on boot. We
could use two separate commands, <code>service ntpd start</code> and
<code>chkconfig ntpd on</code>, but we&rsquo;ll use Ansible&rsquo;s <code>service</code> module instead.</p>
<figure class="code">
<div class="highlight">
<pre><code>$ ansible multi -s -m service -a &quot;name=ntpd state=started enabled=yes&quot;</code></pre>
</div>
</figure>
<p>All three servers should show a success message like:</p>
<figure class="code">
<div class="highlight">
<pre><code>&quot;changed&quot;: true,
&quot;enabled&quot;: true,
&quot;name&quot;: &quot;ntpd&quot;,
&quot;state&quot;: &quot;started&quot;</code></pre>
</div>
</figure>
<p>If you run the exact same command again, everything will be the same,
but Ansible will report that nothing has changed, so the <code>&quot;changed&quot;</code>
value becomes <code>false</code>.</p>
<p>When you use Ansible&rsquo;s modules instead of plain shell commands, you can
use the powers of abstraction and idempotency offered by Ansible. Even
if you&rsquo;re running shell commands, you could wrap them in Ansible&rsquo;s
<code>shell</code> or <code>command</code> modules (like <code>ansible -m shell -a &quot;date&quot; multi</code>),
but for these kind of commands, there&rsquo;s usually no need to use an
Ansible module when running them ad-hoc.</p>
<p>The last thing we should do is check to make sure our servers are synced
closely to the official time on the NTP server:</p>
<figure class="code">
<div class="highlight">
<pre><code>$ ansible multi -s -a &quot;service ntpd stop&quot;
$ ansible multi -s -a &quot;ntpdate -q 0.rhel.pool.ntp.org&quot;
$ ansible multi -s -a &quot;service ntpd start&quot;</code></pre>
</div>
</figure>
<p>For the <code>ntpdate</code> command to work, the <code>ntpd</code> service has to be stopped,
so we stop the service, run the command to check our jitter, then start
the service again.</p>
<p>In my test, I was within three one-hundredths of a second on all three
servers&mdash;close enough for my purposes.</p>
<h3 id="chap05.xhtml_leanpub-auto-configure-groups-of-servers-or-individual-servers">Configure groups of servers, or individual servers</h3>
<p>Now that we&rsquo;ve been able to get all our servers to a solid baseline
(e.g. all of them at least have the correct time), we need to set up the
application servers, then the database server.</p>
<p>Since we set up two separate groups in our inventory file, <code>app</code> and
<code>db</code>, we can target commands to just the servers in those groups.</p>
<h4 id="chap05.xhtml_leanpub-auto-configure-the-application-servers">Configure the Application servers</h4>
<p>Our hypothetical web application uses Django, so we need to make sure
Django and its dependencies are installed. Django is not in the official
CentOS yum repository, but we can install it using Python&rsquo;s easy_install
(which, conveniently, has an Ansible module).</p>
<figure class="code">
<div class="highlight">
<pre><code>$ ansible app -s -m yum -a &quot;name=MySQL-python state=present&quot;
$ ansible app -s -m yum -a &quot;name=python-setuptools state=present&quot;
$ ansible app -s -m easy_install -a &quot;name=django&quot;</code></pre>
</div>
</figure>
<p>You could also install django using <code>pip</code>, which can be installed via
<code>easy_install</code> (since Ansible&rsquo;s <code>easy_install</code> module doesn&rsquo;t allow you
to uninstall packages like <code>pip</code> does), but for simplicity&rsquo;s sake, we&rsquo;ve
installed it with <code>easy_install</code>.</p>
<p>Check to make sure Django is installed and working correctly.</p>
<figure class="code">
<div class="highlight">
<pre><code>$ ansible app -a &quot;python -c &#39;import django; print django.get_version()&#39;&quot;
192.168.60.4 | success | rc=0 &gt;&gt;
1.8
<p>192.168.60.5 | success | rc=0 &gt;&gt;
1.8</code></pre></p>
</div>
</figure>
<p>Things look like they&rsquo;re working correctly on our app servers. We can
now move on to our database server.</p>
<aside class="tip blurb">
<p>Almost all of the configuration we&rsquo;ve done in this chapter would be much
better off in an Ansible playbook (which will be explored in greater
depth throughout the rest of this book). This chapter demonstrates how
easy it is to manage multiple servers&mdash;for whatever purpose&mdash;using
Ansible. Even if you set up and configure servers by hand using shell
commands, using Ansible will save you a ton of time and help you do
everything in the most secure and efficient manner possible.</p>
</aside>
<h4 id="chap05.xhtml_leanpub-auto-configure-the-database-servers">Configure the Database servers</h4>
<p>We configured the application servers using the <code>app</code> group defined in
Ansible&rsquo;s main inventory, and we can configure the database server
(currently the only server in the <code>db</code> group) using the
similarly-defined <code>db</code> group.</p>
<p>Let&rsquo;s install MariaDB, start it, and configure the server&rsquo;s firewall to
allow access on MariaDB&rsquo;s default port, 3306.</p>
<figure class="code">
<div class="highlight">
<pre><code>$ ansible db -s -m yum -a &quot;name=mariadb-server state=present&quot;
$ ansible db -s -m service -a &quot;name=mariadb state=started enabled=yes&quot;
$ ansible db -s -a &quot;iptables -F&quot;
$ ansible db -s -a &quot;iptables -A INPUT -s 192.168.60.0/24 -p tcp \
-m tcp --dport 3306 -j ACCEPT&quot;</code></pre>
</div>
</figure>
<p>If you try connecting to the database from the app servers (or your host
machine) at this point, you won&rsquo;t be able to connect, since MariaDB
still needs to be set up. Typically, you&rsquo;d do this by logging into the
server and running <code>mysql_secure_installation</code>. Luckily, though, Ansible
can control a MariaDB server with its assorted <code>mysql_*</code> modules. For
now, we need to allow MySQL access for one user from our app servers.
The MySQL modules require the <code>MySQL-python</code> module to be present on the
managed server.</p>
<aside class="tip blurb">
<p>Why MariaDB and not MySQL? RHEL 7 and CentOS 7 have MariaDB as the
default supported MySQL-compatible database server. Some of the tooling
around MariaDB still uses the old &lsquo;MySQL*&rsquo; naming syntax, but if you&rsquo;re
used to MySQL, things work similarly with MariaDB.</p>
</aside>
<figure class="code">
<div class="highlight">
<pre><code>$ ansible db -s -m yum -a &quot;name=MySQL-python state=present&quot;
$ ansible db -s -m mysql_user -a &quot;name=django host=% password=12345 \
priv=*.*:ALL state=present&quot;</code></pre>
</div>
</figure>
<p>At this point, you should be able to create or deploy a Django
application on the app servers, then point it at the database server
with the username django and password 12345.</p>
<aside class="information blurb">
<p>The MySQL configuration used here is for example/development purposes
only! There are a few other things you should do to secure a production
MySQL server, including removing the test database, adding a password
for the root user account, restricting the IP addresses allowed to
access port 3306 more closely, and some other minor cleanups. Some of
these things will be covered later in this book, but, as always, you are
responsible for securing your servers&mdash;make sure you&rsquo;re doing it
correctly!</p>
</aside>
<h4 id="chap05.xhtml_leanpub-auto-make-changes-to-just-one-server">Make changes to just one server</h4>
<p>Congratulations! You now have a small web application environment
running Django and MySQL. It&rsquo;s not much, and there&rsquo;s not even a load
balancer in front of the app servers to spread out the requests; but
we&rsquo;ve configured everything pretty quickly, and without ever having to
log into a server. What&rsquo;s even more impressive is that you could run any
of the ansible commands again (besides a couple of the simple shell
commands), and they wouldn&rsquo;t change anything&mdash;they would return
<code>&quot;changed&quot;: false</code>, giving you peace of mind that the original
configuration is intact.</p>
<p>Now that your local infrastructure has been running a while, you notice
(hypothetically, of course) that the logs indicate one of the two app
servers&rsquo; time has gotten way out of sync with the others, likely because
the NTP daemon has crashed or somehow been stopped. Quickly, you enter
the following command to check the status of <code>ntpd</code>:</p>
<figure class="code">
<div class="highlight">
<pre><code>$ ansible app -s -a &quot;service ntpd status&quot;</code></pre>
</div>
</figure>
<p>Then, you restart the service on the affected app server:</p>
<figure class="code">
<div class="highlight">
<pre><code>$ ansible app -s -a &quot;service ntpd restart&quot; --limit &quot;192.168.60.4&quot;</code></pre>
</div>
</figure>
<p>In this command, we used the <code>--limit</code> argument to limit the command to
a specific host in the specified group. <code>--limit</code> will match either an
exact string or a regular expression (prefixed with <code>~</code>). The above
command could be stated more simply if you want to apply the command to
only the <code>.4</code> server (assuming you know there are no other servers with
the an IP address ending in .4), the following would work exactly the
same:</p>
<figure class="code">
<div class="highlight">
<pre><code># Limit hosts with a simple pattern (asterisk is a wildcard).
$ ansible app -s -a &quot;service ntpd restart&quot; --limit &quot;*.4&quot;
<h1 id="limit-hosts-with-a-regular-expression-prefix-with-a-tilde">Limit hosts with a regular expression (prefix with a tilde).</h1>
<p>$ ansible app -s -a &quot;service ntpd restart&quot; &ndash;limit ~&quot;.*.4&quot;</code></pre></p>
</div>
</figure>
<p>In these examples, we&rsquo;ve been using IP addresses instead of hostnames,
but in many real-world scenarios, you&rsquo;ll probably be using hostnames
like nyc-dev-1.example.com; being able to match on regular expressions
is often helpful.</p>
<aside class="tip blurb">
<p>Try to reserve the <code>--limit</code> option for running commands on single
servers. If you often find yourself running commands on the same set of
servers using <code>--limit</code>, consider instead adding them to a group in your
inventory file. That way you can enter
<code>ansible [my-new-group-name] [command]</code>, and save yourself a few
keystrokes.</p>
</aside>
<h3 id="chap05.xhtml_leanpub-auto-manage-users-and-groups">Manage users and groups</h3>
<p>One of the most common uses for Ansible&rsquo;s ad-hoc commands in my
day-to-day usage is user and group management. I don&rsquo;t know how many
times I&rsquo;ve had to re-read the man pages or do a Google search just to
remember which arguments I need to create a user with or without a home
folder, add the user to certain groups, etc.</p>
<p>Ansible&rsquo;s <code>user</code> and <code>group</code> modules make things pretty simple and
standard across any Linux flavor.</p>
<p>First, add an <code>admin</code> group on the app servers for the server
administrators:</p>
<figure class="code">
<div class="highlight">
<pre><code>$ ansible app -s -m group -a &quot;name=admin state=present&quot;</code></pre>
</div>
</figure>
<p>The <code>group</code> module is pretty simple; you can remove a group by setting
<code>state=absent</code>, set a group id with <code>gid=[gid]</code>, and indicate that the
group is a system group with <code>system=yes</code>.</p>
<p>Now add the user <code>johndoe</code> to the app servers with the group I just
created and give him a home folder in <code>/home/johndoe</code> (the default
location for most Linux distributions). Simple:</p>
<figure class="code">
<div class="highlight">
<pre><code>$ ansible app -s -m user -a &quot;name=johndoe group=admin createhome=yes&quot;</code></pre>
</div>
</figure>
<p>If you want to automatically create an SSH key for the new user (if one
doesn&rsquo;t already exist), you can run the same command with the additional
parameter <code>generate_ssh_key=yes</code>. You can also set the UID of the user
by passing in <code>uid=[uid]</code>, set the user&rsquo;s shell with <code>shell=[shell]</code>,
and the password with <code>password=[encrypted-password]</code>.</p>
<p>What if you want to delete the account?</p>
<figure class="code">
<div class="highlight">
<pre><code>$ ansible app -s -m user -a &quot;name=johndoe state=absent remove=yes&quot;</code></pre>
</div>
</figure>
<p>You can do just about anything you could do with <code>useradd</code>, <code>userdel</code>,
and <code>usermod</code> using Ansible&rsquo;s <code>user</code> module, except you can do it more
easily. The <a href="http://docs.ansible.com/user_module.html" rel="external" target="_blank">official documentation of the User
module</a> explains all the
possibilities in great detail.</p>
<h3 id="chap05.xhtml_leanpub-auto-manage-files-and-directories">Manage files and directories</h3>
<p>Another common use for ad-hoc commands is remote file management.
Ansible makes it easy to copy files from your host to remote servers,
create directories, manage file and directory permissions and ownership,
and delete files or directories.</p>
<h4 id="chap05.xhtml_leanpub-auto-get-information-about-a-file">Get information about a file</h4>
<p>If you need to check a file&rsquo;s permissions, MD5, or owner, use Ansible&rsquo;s
<code>stat</code> module:</p>
<figure class="code">
<div class="highlight">
<pre><code>$ ansible multi -m stat -a &quot;path=/etc/environment&quot;</code></pre>
</div>
</figure>
<p>This gives the same information you&rsquo;d get when running the <code>stat</code>
command, but passes back information in JSON, which can be parsed a
little more easily (or, later, used in playbooks to conditionally do or
not do certain tasks).</p>
<h4 id="chap05.xhtml_leanpub-auto-copy-a-file-to-the-servers">Copy a file to the servers</h4>
<p>You probably use <code>scp</code> and/or <code>rsync</code> to copy files and directories to
remote servers, and while Ansible has recently gained an <code>rsync</code> module,
most file copy operations can be completed with Ansible&rsquo;s <code>copy</code> module:</p>
<figure class="code">
<div class="highlight">
<pre><code>$ ansible multi -m copy -a &quot;src=/etc/hosts dest=/tmp/hosts&quot;</code></pre>
</div>
</figure>
<p>The <code>src</code> can be a file or a directory. If you include a trailing slash,
only the contents of the directory will be copied into the <code>dest</code>. If
you omit the trailing slash, the contents <em>and</em> the directory itself
will be copied into the <code>dest</code>.</p>
<p>The <code>copy</code> module is perfect for single-file copies, and works very well
with small directories. When you want to copy hundreds of files,
especially in very deeply-nested directory structures, you should
consider either copying then expanding an archive of the files with
Ansible&rsquo;s <code>unarchive</code> module, or using Ansible&rsquo;s <code>synchronize</code> module.</p>
<h4 id="chap05.xhtml_leanpub-auto-retrieve-a-file-from-the-servers">Retrieve a file from the servers</h4>
<p>The <code>fetch</code> module works almost exactly the same as the <code>copy</code> module,
except in reverse. The major difference is that files will be copied
down to the local <code>dest</code> in a directory structure that matches the host
from which you copied them. For example, use the following command to
grab the hosts file from the servers:</p>
<figure class="code">
<div class="highlight">
<pre><code>$ ansible multi -s -m fetch -a &quot;src=/etc/hosts dest=/tmp&quot;</code></pre>
</div>
</figure>
<p>Fetch will, by default, put the <code>/etc/hosts</code> file from each server into
a folder in the destination with the name of the host (in our case, the
three IP addresses), then in the location defined by <code>src</code>. So, the db
server&rsquo;s hosts file will end up in <code>/tmp/192.168.60.6/etc/hosts</code>.</p>
<p>You can add the parameter <code>flat=yes</code>, and set the <code>dest</code> to <code>dest=/tmp/</code>
(add a trailing slash), to make Ansible fetch the files directly into
the <code>/tmp</code> directory. However, filenames must be unique for this to
work, so it&rsquo;s not as useful when copying down files from multiple hosts.
Only use <code>flat=yes</code> if you&rsquo;re copying files from a single host.</p>
<h4 id="chap05.xhtml_leanpub-auto-create-directories-and-files">Create directories and files</h4>
<p>You can use the <code>file</code> module to create files and directories (like
<code>touch</code>), manage permissions and ownership on files and directories,
modify SELinux properties, and create symlinks.</p>
<p>Here&rsquo;s how to create a directory:</p>
<figure class="code">
<div class="highlight">
<pre><code>$ ansible multi -m file -a &quot;dest=/tmp/test mode=644 state=directory&quot;</code></pre>
</div>
</figure>
<p>Here&rsquo;s how to create a symlink (set <code>state=link</code>):</p>
<figure class="code">
<div class="highlight">
<pre><code>$ ansible multi -m file -a &quot;src=/src/symlink dest=/dest/symlink \
owner=root group=root state=link&quot;</code></pre>
</div>
</figure>
<h4 id="chap05.xhtml_leanpub-auto-delete-directories-and-files">Delete directories and files</h4>
<p>You can set the <code>state</code> to <code>absent</code> to delete a file or directory.</p>
<figure class="code">
<div class="highlight">
<pre><code>$ ansible multi -m file -a &quot;dest=/tmp/test state=absent&quot;</code></pre>
</div>
</figure>
<p>There are many simple ways to manage files remotely using Ansible. We&rsquo;ve
briefly covered the <code>copy</code> and <code>file</code> modules here, but be sure to read
the documentation for the other file-management modules like
<code>lineinfile</code>, <code>ini_file</code>, and <code>unarchive</code>. This book will cover these
additional modules in depth in later chapters (when dealing with
playbooks).</p>
<h3 id="chap05.xhtml_leanpub-auto-run-operations-in-the-background">Run operations in the background</h3>
<p>Some operations take quite a while (minutes or even hours). For example,
when you run <code>yum update</code> or <code>apt-get update &amp;&amp; apt-get dist-upgrade</code>,
it could be a few minutes before all the packages on your servers are
updated.</p>
<p>In these situations, you can tell Ansible to run the commands
asynchronously, and poll the servers to see when the commands finish.
When you&rsquo;re only managing one server, this is not really helpful, but if
you have many servers, Ansible starts the command <em>very</em> quickly on all
your servers (especially if you set a higher <code>--forks</code> value), then
polls the servers for status until they&rsquo;re all up to date.</p>
<p>To run a command in the background, you set the following options:</p>
<ul>
<li><code>-B &lt;seconds&gt;</code>: the maximum amount of time (in seconds) to let the job
run.</li>
<li><code>-P &lt;seconds&gt;</code>: the amount of time (in seconds) to wait between
polling the servers for an updated job status.</li>
</ul>
<h4 id="chap05.xhtml_leanpub-auto-update-servers-asynchronously-monitoring-progress">Update servers asynchronously, monitoring progress</h4>
<p>Let&rsquo;s run <code>yum -y update</code> on all our servers to get them up to date. If
we leave out <code>-P</code>, Ansible defaults to polling every 10 seconds:</p>
<figure class="code">
<div class="highlight">
<pre><code>$ ansible multi -s -B 3600 -a &quot;yum -y update&quot;
background launch...
<p>192.168.60.6 | success &gt;&gt; {
&quot;ansible_job_id&quot;: &quot;763350539037&quot;,
&quot;results_file&quot;: &quot;/root/.ansible_async/763350539037&quot;,
&quot;started&quot;: 1
}</p>
<p>&hellip; [other hosts] &hellip;</code></pre></p>
</div>
</figure>
<p>Wait a little while (or a <em>long</em> while, depending on how old the system
image is we used to build our example VMs!), and eventually, you should
see something like:</p>
<figure class="code">
<div class="highlight">
<pre><code>&lt;job 763350539037&gt; finished on 192.168.60.6 =&gt; {
    &quot;ansible_job_id&quot;: &quot;763350539037&quot;,
    &quot;changed&quot;: true,
    &quot;cmd&quot;: [
        &quot;yum&quot;,
        &quot;-y&quot;,
        &quot;update&quot;
    ],
    &quot;delta&quot;: &quot;0:13:13.973892&quot;,
    &quot;end&quot;: &quot;2021-02-09 04:47:58.259723&quot;,
    &quot;finished&quot;: 1,
<p>&hellip; [more info and stdout from job] &hellip;</code></pre></p>
</div>
</figure>
<p>While a background task is running, you can also check on the status
elsewhere using Ansible&rsquo;s <code>async_status</code> module, as long as you have the
<code>ansible_job_id</code> value to pass in as <code>jid</code>:</p>
<figure class="code">
<div class="highlight">
<pre><code>$ ansible multi -s -m async_status -a &quot;jid=763350539037&quot;</code></pre>
</div>
</figure>
<h4 id="chap05.xhtml_leanpub-auto-fire-and-forget-tasks">Fire-and-forget tasks</h4>
<p>You may also need to run occasional long-running maintenance scripts, or
other tasks that take many minutes or hours to complete, and you&rsquo;d
rather not babysit the task. In these cases, you can set the <code>-B</code> value
as high as you want (be generous, so your task will complete before
Ansible kills it!), and set <code>-P</code> to &lsquo;0&rsquo;, so Ansible fires off the
command then forgets about it:</p>
<figure class="code">
<div class="highlight">
<pre><code>$ ansible multi -B 3600 -P 0 -a &quot;/path/to/fire-and-forget-script.sh&quot;
background launch...
<p>192.168.60.5 | success &gt;&gt; {
&quot;ansible_job_id&quot;: &quot;204960925196&quot;,
&quot;results_file&quot;: &quot;/root/.ansible_async/204960925196&quot;,
&quot;started&quot;: 1
}</p>
<p>&hellip; [other hosts] &hellip;</p>
<p>$</code></pre></p>
</div>
</figure>
<p>Running the command this way doesn&rsquo;t allow status updates via
<code>async_status</code> and a jid, but you can still inspect the file
<code>~/.ansible_async/&lt;jid&gt;</code> on the remote server. This option is usually
more helpful for &lsquo;fire-and-forget&rsquo; tasks.</p>
<aside class="warning blurb">
<p>For tasks you don&rsquo;t track remotely, it&rsquo;s usually a good idea to log the
progress of the task <em>somewhere</em>, and also send some sort of alert on
failure&mdash;especially, for example, when running backgrounded tasks that
perform backup operations, or when running business-critical database
maintenance tasks.</p>
</aside>
<p>You can also run tasks in Ansible playbooks in the background,
asynchronously, by defining an <code>async</code> and <code>poll</code> parameter on the play.
We&rsquo;ll discuss playbook task backgrounding in later chapters.</p>
<h3 id="chap05.xhtml_leanpub-auto-check-log-files">Check log files</h3>
<p>Sometimes, when debugging application errors, or diagnosing outages or
other problems, you need to check server log files. Any common log file
operation (like using <code>tail</code>, <code>cat</code>, <code>grep</code>, etc.) works through the
<code>ansible</code> command, with a few caveats:</p>
<ol>
<li>Operations that continuously monitor a file, like <code>tail -f</code>, won&rsquo;t
work via Ansible, because Ansible only displays output after the
operation is complete, and you won&rsquo;t be able to send the Control-C
command to stop following the file. Someday, the async module might
have this feature, but for now, it&rsquo;s not possible.</li>
<li>It&rsquo;s not a good idea to run a command that returns a huge amount of
data via stdout via Ansible. If you&rsquo;re going to cat a file larger
than a few KB, you should probably log into the server(s)
individually.</li>
<li>If you redirect and filter output from a command run via Ansible,
you need to use the <code>shell</code> module instead of Ansible&rsquo;s default
<code>command</code> module (add <code>-m shell</code> to your commands).</li>
</ol>
<p>As a simple example, let&rsquo;s view the last few lines of the messages log
file on each of our servers:</p>
<figure class="code">
<div class="highlight">
<pre><code>$ ansible multi -s -a &quot;tail /var/log/messages&quot;</code></pre>
</div>
</figure>
<p>As stated in the caveats, if you want to filter the messages log with
something like <code>grep</code>, you can&rsquo;t use Ansible&rsquo;s default <code>command</code> module,
but instead, <code>shell</code>:</p>
<figure class="code">
<div class="highlight">
<pre><code>$ ansible multi -s -m shell -a &quot;tail /var/log/messages | \
grep ansible-command | wc -l&quot;
<p>192.168.60.5 | success | rc=0 &gt;&gt;
12</p>
<p>192.168.60.4 | success | rc=0 &gt;&gt;
12</p>
<p>192.168.60.6 | success | rc=0 &gt;&gt;
14</code></pre></p>
</div>
</figure>
<p>This command shows how many ansible commands have been run on each
server (the numbers you get may be different).</p>
<h3 id="chap05.xhtml_leanpub-auto-manage-cron-jobs">Manage cron jobs</h3>
<p>Periodic tasks run via cron are managed by a system&rsquo;s crontab. Normally,
to change cron job settings on a server, you would log into the server,
use <code>crontab -e</code> under the account where the cron jobs reside, and type
in an entry with the interval and job.</p>
<p>Ansible makes managing cron jobs easy with its <code>cron</code> module. If you
want to run a shell script on all the servers every day at 4 a.m., add
the cron job with:</p>
<figure class="code">
<div class="highlight">
<pre><code>$ ansible multi -s -m cron -a &quot;name=&#39;daily-cron-all-servers&#39; \
hour=4 job=&#39;/path/to/daily-script.sh&#39;&quot;</code></pre>
</div>
</figure>
<p>Ansible will assume <code>*</code> for all values you don&rsquo;t specify (valid values
are <code>day</code>, <code>hour</code>, <code>minute</code>, <code>month</code>, and <code>weekday</code>). You could also
specify special time values like <code>reboot</code>, <code>yearly</code>, or <code>monthly</code> using
<code>special_time=[value]</code>. You can also set the user the job will run under
via <code>user=[user]</code>, and create a backup of the current crontab by passing
<code>backup=yes</code>.</p>
<p>What if we want to remove the cron job? Simple enough, use the same
<code>cron</code> command, and pass the name of the cron job you want to delete,
and <code>state=absent</code>:</p>
<figure class="code">
<div class="highlight">
<pre><code>$ ansible multi -s -m cron -a &quot;name=&#39;daily-cron-all-servers&#39; state=absent&quot;</code></pre>
</div>
</figure>
<p>You can also use Ansible to manage custom crontab files; use the same
syntax as you used earlier, but specify the location to the cron file
with: <code>cron_file=cron_file_name</code> (where <code>cron_file_name</code> is a cron file
located in <code>/etc/cron.d</code>).</p>
<aside class="information blurb">
<p>Ansible denotes Ansible-managed crontab entries by adding a comment on
the line above the entry like <code>#Ansible: daily-cron-all-servers</code>. It&rsquo;s
best to leave things be in the crontab itself, and always manage entries
via ad-hoc commands or playbooks using Ansible&rsquo;s <code>cron</code> module.</p>
</aside>
<h3 id="chap05.xhtml_leanpub-auto-deploy-a-version-controlled-application">Deploy a version-controlled application</h3>
<p>For simple application deployments, where you may need to update a git
checkout, or copy a new bit of code to a group of servers, then run a
command to finish the deployment, Ansible&rsquo;s ad-hoc mode can help. For
more complicated deployments, use Ansible playbooks and rolling update
features (which will be discussed in later chapters) to ensure
successful deployments with zero downtime.</p>
<p>In the example below, I&rsquo;ll assume we&rsquo;re running a simple application on
one or two servers, in the directory <code>/opt/myapp</code>. This directory is a
git repository cloned from a central server or a service like GitHub,
and application deployments and updates are done by updating the clone,
then running a shell script at <code>/opt/myapp/scripts/update.sh</code>.</p>
<p>First, update the git checkout to the application&rsquo;s new version branch,
1.2.4, on all the app servers:</p>
<figure class="code">
<div class="highlight">
<pre><code>$ ansible app -s -m git -a &quot;repo=git://example.com/path/to/repo.git \
dest=/opt/myapp update=yes version=1.2.4&quot;</code></pre>
</div>
</figure>
<p>Ansible&rsquo;s git module lets you specify a branch, tag, or even a specific
commit with the <code>version</code> parameter (in this case, we chose to checkout
tag <code>1.2.4</code>, but if you run the command again with a branch name, like
<code>prod</code>, Ansible will happily do that instead). To force Ansible to
update the checked-out copy, we passed in <code>update=yes</code>. The <code>repo</code> and
<code>dest</code> options should be self-explanatory.</p>
<aside class="information blurb">
<p>If you get a message saying &ldquo;Failed to find required executable git&rdquo;,
you will need to install Git on the server. To do so, run the ad-hoc
command <code>ansible app -s -m yum -a &quot;name=git state=present&quot;</code> (substitute
your OS&rsquo;s package manager for <code>yum</code>).</p>
<p>If you get a message saying the Git server has an &ldquo;unknown hostkey&rdquo;, add
the option <code>accept_hostkey=yes</code> to the command, or add the hostkey to
your server&rsquo;s <code>known_hosts</code> file before running this command.</p>
</aside>
<p>Then, run the application&rsquo;s <code>update.sh</code> shell script:</p>
<figure class="code">
<div class="highlight">
<pre><code>$ ansible app -s -a &quot;/opt/myapp/update.sh&quot;</code></pre>
</div>
</figure>
<p>Ad-hoc commands are fine for the simple deployments (like our example
above), but you should use Ansible&rsquo;s more powerful and flexible
application deployment features described later in this book if you have
complex application or infrastructure needs. See especially the &lsquo;Rolling
Updates&rsquo; section later in this book.</p>
<h3 id="chap05.xhtml_leanpub-auto-ansibles-ssh-connection-history">Ansible&rsquo;s SSH connection history</h3>
<p>One of Ansible&rsquo;s greatest features is its ability to function without
running any extra applications or daemons on the servers it manages.
Instead of using a proprietary protocol to communicate with the servers,
Ansible uses the standard and secure SSH connection that is commonly
used for basic administration on almost every Linux server running
today.</p>
<p>Since a stable, fast, and secure SSH connection is the heart of
Ansible&rsquo;s communication abilities, Ansible&rsquo;s implementation of SSH has
continually improved throughout the past few years&mdash;and is still
improving today.</p>
<p>One thing that is universal to all of Ansible&rsquo;s SSH connection methods
is that Ansible uses the connection to transfer one or a few files
defining a play or command to the remote server, then runs the
play/command, then deletes the transferred file(s), and reports back the
results. This sequence of events may change and become more
simple/direct with later versions of Ansible (see the notes on Ansible
1.5 below), but a fast, stable, and secure SSH connection is of
paramount importance to Ansible.</p>
<h4 id="chap05.xhtml_leanpub-auto-paramiko">Paramiko</h4>
<p>In the beginning, Ansible used paramiko&mdash;an open source SSH2
implementation for Python&mdash;exclusively. However, as a single library
for a single language (Python), development of paramiko doesn&rsquo;t keep
pace with development of OpenSSH (the standard implementation of SSH
used almost everywhere), and its performance and security is slightly
worse than OpenSSH&mdash;at least to this writer&rsquo;s eyes.</p>
<p>Ansible continues to support the use of paramiko, and even chooses it as
the default for systems (like RHEL 5/6) which don&rsquo;t support
ControlPersist&mdash;an option present only in OpenSSH 5.6 or newer.
(ControlPersist allows SSH connections to persist so frequent commands
run over SSH don&rsquo;t have to go through the initial handshake over and
over again until the <code>ControlPersist</code> timeout set in the server&rsquo;s SSH
config is reached.)</p>
<h4 id="chap05.xhtml_leanpub-auto-openssh-default">OpenSSH (default)</h4>
<p>Beginning in Ansible 1.3, Ansible defaulted to using native OpenSSH
connections to connect to servers supporting ControlPersist. Ansible had
this ability since version 0.5, but didn&rsquo;t default to it until 1.3.</p>
<p>Most local SSH configuration parameters (like hosts, key files, etc.)
are respected, but if you need to connect via a port other than port 22
(the default SSH port), you need to specify the port in an inventory
file (<code>ansible_ssh_port</code> option) or when running <code>ansible</code> commands.</p>
<p>OpenSSH is faster, and a little more reliable, than paramiko, but there
are ways to make Ansible faster still.</p>
<h4 id="chap05.xhtml_leanpub-auto-accelerated-mode">Accelerated Mode</h4>
<p>While not too helpful for ad-hoc commands, Ansible&rsquo;s Accelerated mode
achieves greater performance for playbooks. Instead of connecting
repeatedly via SSH, Ansible connects via SSH initially, then uses the
AES key used in the initial connection to communicate further commands
and transfers via a separate port (5099 by default, but this is
configurable).</p>
<p>The only extra package required to use accelerated mode is
<code>python-keyczar</code>, and almost everything in normal OpenSSH/Paramiko mode
works in Accelerated mode, with two exceptions when using <code>sudo</code>:</p>
<ul>
<li>Your sudoers file needs to have <code>requiretty</code> disabled (comment out the
line with it, or set it per user by changing the line to
<code>Defaults:username !requiretty</code>).</li>
<li>You must disable sudo passwords by setting <code>NOPASSWD</code> in the sudoers
file.</li>
</ul>
<p>Accelerated mode can offer 2-4 times faster performance (especially for
things like file transfers) compared to OpenSSH, and you can enable it
for a playbook by adding the option <code>accelerate: true</code> to your playbook,
like so:</p>
<figure class="code">
<div class="highlight">
<pre><code>---
- hosts: all
  accelerate: true
  [...]</code></pre>
</div>
</figure>
<p>It goes without saying, if you use accelerated mode, you need to have
the port through which it communicates open in your firewall (port 5099
by default, or whatever port you set with the <code>accelerate_port</code> option
after <code>accelerate</code>).</p>
<p>Accelerate mode is a spiritual descendant of the now-deprecated
&lsquo;Fireball&rsquo; mode, which used a similar method for accelerating Ansible
communications, but required ZeroMQ to be installed on the controlled
server (which is at odds with Ansible&rsquo;s simple no-dependency, no-daemon
philosophy), and didn&rsquo;t work with sudo commands at all.</p>
<h4 id="chap05.xhtml_leanpub-auto-faster-openssh-in-ansible-15">Faster OpenSSH in Ansible 1.5+</h4>
<p>Ansible 1.5 and later contains a very nice improvement to Ansible&rsquo;s
default OpenSSH implementation.</p>
<p>Instead of copying files, running them on the remote server, then
removing them, the new method of OpenSSH transfer will send and execute
commands for most Ansible modules directly over the SSH connection.</p>
<p>This method of connection is only available in Ansible 1.5+, and it can
be enabled by adding <code>pipelining=True</code> under the <code>[ssh_connection]</code>
section of the Ansible configuration file (<code>ansible.cfg</code>, which will be
covered in more detail later).</p>
<aside class="warning blurb">
<p>The <code>pipelining=True</code> configuration option won&rsquo;t help much unless you
have removed or commented the <code>Defaults requiretty</code> option in
<code>/etc/sudoers</code>. This is commented out in the default configuration for
most OSes, but you might want to double-check this setting to make sure
you&rsquo;re getting the fastest connection possible!</p>
</aside>
<aside class="warning blurb">
<p>If you&rsquo;re running a recent version of Mac OS X, Ubuntu, Windows with
Cygwin, or most other OS for the host from which you run <code>ansible</code> and
<code>ansible-playbook</code>, you should be running OpenSSH version 5.6 or later,
which works perfectly with the <code>ControlPersist</code> setting used with all of
Ansible&rsquo;s SSH connections settings.</p>
<p>If the host on which Ansible runs has RHEL or CentOS, however, you might
need to update your version of OpenSSH so it supports the
faster/persistent connection method. Any OpenSSH version 5.6 or greater
should work. To install a later version, either compile from source, or
use a different repository (like
<a href="http://mirror.neu.edu.cn/CentALT/readme.txt" rel="external" target="_blank">CentALT</a> and
<code>yum update openssh</code>.</p>
</aside>
<h3 id="chap05.xhtml_leanpub-auto-summary-2">Summary</h3>
<p>In this chapter, you learned how to build a multi-server infrastructure
for testing on your local workstation using Vagrant, and you configured,
monitored, and managed the infrastructure without ever logging in to an
individual server. You also learned how Ansible connects to remote
servers, and how to use the <code>ansible</code> command to perform tasks on many
servers quickly in parallel, or one by one.</p>
<p>By now, you should be getting familiar with the basics of Ansible, and
you should be able to start managing your own infrastructure more
efficiently.</p>
<figure class="code">
<div class="highlight">
<pre><code> ______________________________________
/ It&#39;s easier to seek forgiveness than \
\ ask for permission. (Proverb)        /
 --------------------------------------
        \   ^__^
         \  (oo)\_______
            (__)\       )\/\
                ||----w |
                ||     ||</code></pre>
</div>
</figure>
:::
<p>[]{#chap06.xhtml}</p>
<p>::: {}</p>

  <footer class="footline">
  </footer>
</article>
        </div>
      </main>
    </div>
    <aside id="R-sidebar" class="default-animation">
      <div id="R-header-topbar" class="default-animation"></div>
      <div id="R-header-wrapper" class="default-animation">
        <div id="R-header" class="default-animation">
<a href="https://linuxreader.com">
  <img src="/images/linuxreader.svg" alt="Linux Reader" >
</a>

        </div>
        <search><form action="/search/" method="get">
          <div class="searchbox default-animation">
            <button class="search-detail" type="submit" title="Search (CTRL+ALT+f)"><i class="fas fa-search"></i></button>
            <label class="a11y-only" for="R-search-by">Search</label>
            <input data-search-input id="R-search-by" name="search-by" class="search-by" type="search" placeholder="Search...">
            <button class="search-clear" type="button" data-search-clear="" title="Clear search"><i class="fas fa-times" title="Clear search"></i></button>
          </div>
        </form></search>
      </div>
      <div id="R-homelinks" class="default-animation">
        <div class="R-menu-divider default-animation">
          <hr class="padding">
        </div>
        <div class="R-sidebarmenu R-shortcutmenu-homelinks">
          <ul class="space collapsible-menu">
          </ul>
        </div>
        <div class="R-menu-divider default-animation">
          <hr class="padding">
        </div>
        <div class="R-sidebarmenu R-shortcutmenu-headercontrols">
          <ul class="">
          </ul>
        </div>
        <div class="R-menu-divider default-animation">
          <hr class="padding">
        </div>
      </div>
      <div id="R-content-wrapper" class="highlightable">
        <div class="R-sidebarmenu R-shortcutmenu-main">
          <ul class="enlarge morespace collapsible-menu">
            <li class="parent " data-nav-url="/ansible/"><input type="checkbox" id="R-section-e5b911977d99c31c82b120cc3d2f2606" aria-controls="R-subsections-e5b911977d99c31c82b120cc3d2f2606" checked><label for="R-section-e5b911977d99c31c82b120cc3d2f2606"><i class="fa-fw fas fa-chevron-right"></i><span class="a11y-only">Submenu Ansible</span></label><a class="padding" href="/ansible/"><i class="fa-solid fa-robot"></i> Ansible</a><ul id="R-subsections-e5b911977d99c31c82b120cc3d2f2606" class="collapsible-menu">
            <li class="active hidden " data-nav-url="/ansible/ansible4devops/chapter-3---ad-hoc-commands/"><a class="padding" href="/ansible/ansible4devops/chapter-3---ad-hoc-commands/"></a></li>
            <li class="" data-nav-url="/ansible/ad-hoc-ansible-commands/"><a class="padding" href="/ansible/ad-hoc-ansible-commands/">Ad Hoc Ansible Commands</a></li>
            <li class="" data-nav-url="/ansible/ansible-builder/"><a class="padding" href="/ansible/ansible-builder/">Ansible Builder</a></li>
            <li class="" data-nav-url="/ansible/ansible-documentation/"><a class="padding" href="/ansible/ansible-documentation/">Ansible Documentation</a></li>
            <li class="" data-nav-url="/ansible/ansible-facts/"><a class="padding" href="/ansible/ansible-facts/">Ansible Facts</a></li>
            <li class="" data-nav-url="/ansible/ansible-galaxy-roles/"><a class="padding" href="/ansible/ansible-galaxy-roles/">Ansible Galaxy Roles</a></li>
            <li class="" data-nav-url="/ansible/ansible-inventory/"><a class="padding" href="/ansible/ansible-inventory/">Ansible Inventory and Ansible.cfg</a></li>
            <li class="" data-nav-url="/ansible/ansible-playbooks/"><a class="padding" href="/ansible/ansible-playbooks/">Ansible Playbooks</a></li>
            <li class="" data-nav-url="/ansible/using-ansible-roles/"><a class="padding" href="/ansible/using-ansible-roles/">Ansible Roles</a></li>
            <li class="" data-nav-url="/ansible/ansible-vault/"><a class="padding" href="/ansible/ansible-vault/">Ansible Vault</a></li>
            <li class="" data-nav-url="/ansible/ansible-inventory-command/"><a class="padding" href="/ansible/ansible-inventory-command/">Ansible-inventory command</a></li>
            <li class="" data-nav-url="/ansible/ansible.cfg/"><a class="padding" href="/ansible/ansible.cfg/">Ansible.cfg</a></li>
            <li class="" data-nav-url="/ansible/boot-process/"><a class="padding" href="/ansible/boot-process/">Boot Process</a></li>
            <li class="" data-nav-url="/ansible/building-an-ansible-lab-with-ansible/"><a class="padding" href="/ansible/building-an-ansible-lab-with-ansible/">Building an Ansible lab with Ansible</a></li>
            <li class="" data-nav-url="/ansible/common-modules-with-examples/"><a class="padding" href="/ansible/common-modules-with-examples/">Common modules with examples</a></li>
            <li class="" data-nav-url="/ansible/configuring-storage-advanced-exercise/"><a class="padding" href="/ansible/configuring-storage-advanced-exercise/">Configuring Storage Advanced Exercise</a></li>
            <li class="" data-nav-url="/ansible/deploying-files/"><a class="padding" href="/ansible/deploying-files/">Deploying files</a></li>
            <li class="" data-nav-url="/ansible/discovering-storage-related-facts/"><a class="padding" href="/ansible/discovering-storage-related-facts/">Discovering storage related facts</a></li>
            <li class="" data-nav-url="/ansible/dynamic-inventory/"><a class="padding" href="/ansible/dynamic-inventory/">Dynamic Inventory</a></li>
            <li class="" data-nav-url="/ansible/encrypted-passwords/"><a class="padding" href="/ansible/encrypted-passwords/">Encrypted passwords</a></li>
            <li class="" data-nav-url="/ansible/execution-environments-1/"><a class="padding" href="/ansible/execution-environments-1/">Execution Environments</a></li>
            <li class="" data-nav-url="/ansible/handlers/"><a class="padding" href="/ansible/handlers/">Handlers</a></li>
            <li class="" data-nav-url="/ansible/host-name-patterns/"><a class="padding" href="/ansible/host-name-patterns/">Host Name Patterns</a></li>
            <li class="" data-nav-url="/ansible/including-and-importing-files/"><a class="padding" href="/ansible/including-and-importing-files/">Including and importing Files</a></li>
            <li class="" data-nav-url="/ansible/jinja2-templates/"><a class="padding" href="/ansible/jinja2-templates/">Jinja2 templates</a></li>
            <li class="" data-nav-url="/ansible/managing-ansible-errors-and-logs/"><a class="padding" href="/ansible/managing-ansible-errors-and-logs/">Managing Ansible Errors and Logs</a></li>
            <li class="" data-nav-url="/ansible/managing-packages/"><a class="padding" href="/ansible/managing-packages/">Managing Packages</a></li>
            <li class="" data-nav-url="/ansible/managing-partitions-and-lvm/"><a class="padding" href="/ansible/managing-partitions-and-lvm/">Managing Partitions and LVM</a></li>
            <li class="" data-nav-url="/ansible/managing-services/"><a class="padding" href="/ansible/managing-services/">Managing Services</a></li>
            <li class="" data-nav-url="/ansible/networking-with-ansible/"><a class="padding" href="/ansible/networking-with-ansible/">Networking with Ansible</a></li>
            <li class="" data-nav-url="/ansible/nfs-setup/"><a class="padding" href="/ansible/nfs-setup/">NFS Setup</a></li>
            <li class="" data-nav-url="/ansible/optimizing-ansible-processing/"><a class="padding" href="/ansible/optimizing-ansible-processing/">Optimizing Ansible Processing</a></li>
            <li class="" data-nav-url="/ansible/repositories-and-subscriptions/"><a class="padding" href="/ansible/repositories-and-subscriptions/">Repositories and subscriptions</a></li>
            <li class="" data-nav-url="/ansible/selinux-file-properties/"><a class="padding" href="/ansible/selinux-file-properties/">SeLinux File Properties</a></li>
            <li class="" data-nav-url="/ansible/setting-up-an-ansible-lab/"><a class="padding" href="/ansible/setting-up-an-ansible-lab/">Setting up an Ansible Lab</a></li>
            <li class="" data-nav-url="/ansible/ssh-connections/"><a class="padding" href="/ansible/ssh-connections/">SSH Connections</a></li>
            <li class="" data-nav-url="/ansible/troubleshooting-common-scenarios/"><a class="padding" href="/ansible/troubleshooting-common-scenarios/">Troubleshooting Common Scenarios</a></li>
            <li class="" data-nav-url="/ansible/users-and-groups/"><a class="padding" href="/ansible/users-and-groups/">Users and Groups</a></li>
            <li class="" data-nav-url="/ansible/using-ad-hoc-commands-in-scripts/"><a class="padding" href="/ansible/using-ad-hoc-commands-in-scripts/">Using Ad Hoc commands in scripts</a></li>
            <li class="" data-nav-url="/ansible/using-loops-and-items/"><a class="padding" href="/ansible/using-loops-and-items/">Using Loops and Items</a></li>
            <li class="" data-nav-url="/ansible/using-modules-for-troubleshooting-and-testing/"><a class="padding" href="/ansible/using-modules-for-troubleshooting-and-testing/">Using Modules for Troubleshooting and Testing</a></li>
            <li class="" data-nav-url="/ansible/using-multiple-inventories/"><a class="padding" href="/ansible/using-multiple-inventories/">Using Multiple Inventories</a></li>
            <li class="" data-nav-url="/ansible/using-rhel-system-roles/"><a class="padding" href="/ansible/using-rhel-system-roles/">Using RHEL System roles</a></li>
            <li class="" data-nav-url="/ansible/using-tags/"><a class="padding" href="/ansible/using-tags/">Using Tags</a></li>
            <li class="" data-nav-url="/ansible/using-when-to-run-tasks-conditionally/"><a class="padding" href="/ansible/using-when-to-run-tasks-conditionally/">Using when to Run Tasks Conditionally</a></li>
            <li class="" data-nav-url="/ansible/variables/"><a class="padding" href="/ansible/variables/">Variables</a></li></ul></li>
            <li class="" data-nav-url="/bash/"><input type="checkbox" id="R-section-4b42c24c987a75657a389c72aa61a56d" aria-controls="R-subsections-4b42c24c987a75657a389c72aa61a56d"><label for="R-section-4b42c24c987a75657a389c72aa61a56d"><i class="fa-fw fas fa-chevron-right"></i><span class="a11y-only">Submenu Bash</span></label><a class="padding" href="/bash/"><i class="fa-fw fas fa-code"></i> Bash</a><ul id="R-subsections-4b42c24c987a75657a389c72aa61a56d" class="collapsible-menu">
            <li class="" data-nav-url="/bash/bash-shell/"><a class="padding" href="/bash/bash-shell/">Bash</a></li>
            <li class="" data-nav-url="/bash/shell-scripting/"><a class="padding" href="/bash/shell-scripting/">Shell Scripting</a></li></ul></li>
            <li class="" data-nav-url="/boot/"><input type="checkbox" id="R-section-a53bfb333437907a8d5bdc636d15c75d" aria-controls="R-subsections-a53bfb333437907a8d5bdc636d15c75d"><label for="R-section-a53bfb333437907a8d5bdc636d15c75d"><i class="fa-fw fas fa-chevron-right"></i><span class="a11y-only">Submenu Boot</span></label><a class="padding" href="/boot/"><i class="fa-solid fa-hourglass-start"></i> Boot</a><ul id="R-subsections-a53bfb333437907a8d5bdc636d15c75d" class="collapsible-menu">
            <li class="" data-nav-url="/boot/boot-process-grub2-and-kernel/"><a class="padding" href="/boot/boot-process-grub2-and-kernel/">Boot Process, Grub2, and Kernel</a></li>
            <li class="" data-nav-url="/boot/system-initialization-message-logging-and-system-tuning/"><a class="padding" href="/boot/system-initialization-message-logging-and-system-tuning/">System Initialization, Message Logging, and System Tuning</a></li></ul></li>
            <li class="" data-nav-url="/containers/"><input type="checkbox" id="R-section-98e55644e7defe4a283b28e510b18cf5" aria-controls="R-subsections-98e55644e7defe4a283b28e510b18cf5"><label for="R-section-98e55644e7defe4a283b28e510b18cf5"><i class="fa-fw fas fa-chevron-right"></i><span class="a11y-only">Submenu Containers</span></label><a class="padding" href="/containers/"><i class="fa-solid fa-cubes"></i> Containers</a><ul id="R-subsections-98e55644e7defe4a283b28e510b18cf5" class="collapsible-menu">
            <li class="" data-nav-url="/containers/containers-1/"><a class="padding" href="/containers/containers-1/">Containers</a></li></ul></li>
            <li class="" data-nav-url="/cyber-security/"><input type="checkbox" id="R-section-f95cf8cea1c115dd046e46a833f33dfa" aria-controls="R-subsections-f95cf8cea1c115dd046e46a833f33dfa"><label for="R-section-f95cf8cea1c115dd046e46a833f33dfa"><i class="fa-fw fas fa-chevron-right"></i><span class="a11y-only">Submenu Cyber Security</span></label><a class="padding" href="/cyber-security/"><i class="fa-solid fa-user-secret"></i> Cyber Security</a><ul id="R-subsections-f95cf8cea1c115dd046e46a833f33dfa" class="collapsible-menu">
            <li class="" data-nav-url="/cyber-security/security-enhanced-linux/"><a class="padding" href="/cyber-security/security-enhanced-linux/">Security Enhanced Linux</a></li>
            <li class="" data-nav-url="/cyber-security/the-linux-firewall/"><a class="padding" href="/cyber-security/the-linux-firewall/">The Linux Firewall</a></li>
            <li class="" data-nav-url="/cyber-security/the-secure-shell-service/"><a class="padding" href="/cyber-security/the-secure-shell-service/">The Secure Shell Service</a></li></ul></li>
            <li class="" data-nav-url="/desktop/"><input type="checkbox" id="R-section-e1fc414efb00462ad25041a21e45e696" aria-controls="R-subsections-e1fc414efb00462ad25041a21e45e696"><label for="R-section-e1fc414efb00462ad25041a21e45e696"><i class="fa-fw fas fa-chevron-right"></i><span class="a11y-only">Submenu Desktop</span></label><a class="padding" href="/desktop/"><i class="fa-fw fas fa-computer"></i> Desktop</a><ul id="R-subsections-e1fc414efb00462ad25041a21e45e696" class="collapsible-menu">
            <li class="" data-nav-url="/desktop/new-setup/"><a class="padding" href="/desktop/new-setup/">Configure Fedora Desktop using Ansible</a></li>
            <li class="" data-nav-url="/desktop/learning-touch-typing/"><a class="padding" href="/desktop/learning-touch-typing/">Learning Touch Typing</a></li>
            <li class="" data-nav-url="/desktop/my-fedora-setup/"><a class="padding" href="/desktop/my-fedora-setup/">My Fedora Setup</a></li>
            <li class="" data-nav-url="/desktop/silverblue/"><a class="padding" href="/desktop/silverblue/">Silverblue</a></li></ul></li>
            <li class="" data-nav-url="/files/"><input type="checkbox" id="R-section-31e56884d732922d4a0e407592968056" aria-controls="R-subsections-31e56884d732922d4a0e407592968056"><label for="R-section-31e56884d732922d4a0e407592968056"><i class="fa-fw fas fa-chevron-right"></i><span class="a11y-only">Submenu Files</span></label><a class="padding" href="/files/"><i class="fa-solid fa-copy"></i> Files</a><ul id="R-subsections-31e56884d732922d4a0e407592968056" class="collapsible-menu">
            <li class="" data-nav-url="/files/advanced-file-management/"><a class="padding" href="/files/advanced-file-management/">Advanced File Management</a></li>
            <li class="" data-nav-url="/files/file-management/"><a class="padding" href="/files/file-management/">Basic File Managment</a></li></ul></li>
            <li class="" data-nav-url="/networking/"><input type="checkbox" id="R-section-d7c3359b808d40df139a3bb9f9073483" aria-controls="R-subsections-d7c3359b808d40df139a3bb9f9073483"><label for="R-section-d7c3359b808d40df139a3bb9f9073483"><i class="fa-fw fas fa-chevron-right"></i><span class="a11y-only">Submenu Networking</span></label><a class="padding" href="/networking/"><i class="fa-fw fas fa-network-wired"></i> Networking</a><ul id="R-subsections-d7c3359b808d40df139a3bb9f9073483" class="collapsible-menu">
            <li class="" data-nav-url="/networking/consoling_in_to_mx80_from_linux/"><a class="padding" href="/networking/consoling_in_to_mx80_from_linux/">Consoling in to MX80 from linux</a></li>
            <li class="" data-nav-url="/networking/dns-and-time-synchronization/"><a class="padding" href="/networking/dns-and-time-synchronization/">DNS</a></li>
            <li class="" data-nav-url="/networking/how-to-study-for-the-ccna-exam/"><a class="padding" href="/networking/how-to-study-for-the-ccna-exam/">How to Study for the CCNA Exam</a></li>
            <li class="" data-nav-url="/networking/juniper_cli_basics/"><a class="padding" href="/networking/juniper_cli_basics/">Juniper CLI Basics</a></li>
            <li class="" data-nav-url="/networking/ccna/ccna-notes/my-ccna-notes/"><a class="padding" href="/networking/ccna/ccna-notes/my-ccna-notes/">My CCNA Notes</a></li>
            <li class="" data-nav-url="/networking/networking-network-devices-and-network-connections/"><a class="padding" href="/networking/networking-network-devices-and-network-connections/">Networking Network Devices and Network Connections</a></li>
            <li class="" data-nav-url="/networking/resources-for-passing-ccna/"><a class="padding" href="/networking/resources-for-passing-ccna/">Resources for Passing CCNA</a></li>
            <li class="" data-nav-url="/networking/time-synchronization/"><a class="padding" href="/networking/time-synchronization/">Time Synchronization</a></li>
            <li class="" data-nav-url="/networking/toggle_poe/"><a class="padding" href="/networking/toggle_poe/">Toggle PoE on a Juniper Switch</a></li>
            <li class="" data-nav-url="/networking/what-to-learn-after-ccna/"><a class="padding" href="/networking/what-to-learn-after-ccna/">What to Learn After CCNA</a></li></ul></li>
            <li class="" data-nav-url="/packages/"><input type="checkbox" id="R-section-bdf1e8ce92aa8ff6883c617f10480430" aria-controls="R-subsections-bdf1e8ce92aa8ff6883c617f10480430"><label for="R-section-bdf1e8ce92aa8ff6883c617f10480430"><i class="fa-fw fas fa-chevron-right"></i><span class="a11y-only">Submenu Packages</span></label><a class="padding" href="/packages/"><i class="fa-solid fa-box-open"></i> Packages</a><ul id="R-subsections-bdf1e8ce92aa8ff6883c617f10480430" class="collapsible-menu">
            <li class="" data-nav-url="/packages/advanced-package-management/"><a class="padding" href="/packages/advanced-package-management/">Advanced Package Management</a></li>
            <li class="" data-nav-url="/packages/basic-package-management/"><a class="padding" href="/packages/basic-package-management/">Basic Package Management</a></li></ul></li>
            <li class="" data-nav-url="/storage/"><input type="checkbox" id="R-section-28a53f7a259bc0e6bfd5bf73591250a9" aria-controls="R-subsections-28a53f7a259bc0e6bfd5bf73591250a9"><label for="R-section-28a53f7a259bc0e6bfd5bf73591250a9"><i class="fa-fw fas fa-chevron-right"></i><span class="a11y-only">Submenu Storage</span></label><a class="padding" href="/storage/"><i class="fa-solid fa-hard-drive"></i> Storage</a><ul id="R-subsections-28a53f7a259bc0e6bfd5bf73591250a9" class="collapsible-menu">
            <li class="" data-nav-url="/storage/autofs/"><a class="padding" href="/storage/autofs/">AutoFS</a></li>
            <li class="" data-nav-url="/storage/local-file-systems-and-swap/"><a class="padding" href="/storage/local-file-systems-and-swap/">Local File Systems and Swap</a></li>
            <li class="" data-nav-url="/storage/network-file-system-nfs/"><a class="padding" href="/storage/network-file-system-nfs/">Network File System (NFS)</a></li>
            <li class="" data-nav-url="/storage/partitioning-mbr-and-gpt/"><a class="padding" href="/storage/partitioning-mbr-and-gpt/">Partitioning, MBR, and GPT</a></li>
            <li class="" data-nav-url="/storage/remove-a-filesystem-from-a-partition/"><a class="padding" href="/storage/remove-a-filesystem-from-a-partition/">Remove a filesystem from a partition</a></li>
            <li class="" data-nav-url="/storage/thin-provisioning/"><a class="padding" href="/storage/thin-provisioning/">Thin Provisioning and LVM</a></li>
            <li class="" data-nav-url="/storage/virtual-data-optimizer-vdo/"><a class="padding" href="/storage/virtual-data-optimizer-vdo/">Virtual Data Optimizer (VDO)</a></li></ul></li>
            <li class="" data-nav-url="/system/"><input type="checkbox" id="R-section-0ea554b019cc5a3e6337c45b68b3a647" aria-controls="R-subsections-0ea554b019cc5a3e6337c45b68b3a647"><label for="R-section-0ea554b019cc5a3e6337c45b68b3a647"><i class="fa-fw fas fa-chevron-right"></i><span class="a11y-only">Submenu System</span></label><a class="padding" href="/system/"><i class="fa-solid fa-server"></i> System</a><ul id="R-subsections-0ea554b019cc5a3e6337c45b68b3a647" class="collapsible-menu">
            <li class="" data-nav-url="/system/installation/"><a class="padding" href="/system/installation/">Installation</a></li>
            <li class="" data-nav-url="/system/interaction/"><a class="padding" href="/system/interaction/">Interaction</a></li>
            <li class="" data-nav-url="/system/process-and-task-scheduling/"><a class="padding" href="/system/process-and-task-scheduling/">Process and Task Scheduling</a></li></ul></li>
            <li class="" data-nav-url="/tools/"><input type="checkbox" id="R-section-bf1399820dde3dd110e03ace4147ff86" aria-controls="R-subsections-bf1399820dde3dd110e03ace4147ff86"><label for="R-section-bf1399820dde3dd110e03ace4147ff86"><i class="fa-fw fas fa-chevron-right"></i><span class="a11y-only">Submenu Tools</span></label><a class="padding" href="/tools/"><i class="fa-solid fa-screwdriver-wrench"></i> Tools</a><ul id="R-subsections-bf1399820dde3dd110e03ace4147ff86" class="collapsible-menu">
            <li class="" data-nav-url="/tools/calibre-web-with-docker-and-nginx/"><a class="padding" href="/tools/calibre-web-with-docker-and-nginx/">Calibre Web with Docker and NGINX</a></li>
            <li class="" data-nav-url="/tools/how-to-build-a-website-with-hugo/"><a class="padding" href="/tools/how-to-build-a-website-with-hugo/">How to Build a website With Hugo</a></li>
            <li class="" data-nav-url="/tools/process-bookfusion-highlights/"><a class="padding" href="/tools/process-bookfusion-highlights/">How to Process Bookfusion Highlights with Vim</a></li>
            <li class="" data-nav-url="/tools/how-to-set-up-hugo-relearn-theme/"><a class="padding" href="/tools/how-to-set-up-hugo-relearn-theme/">How to Set Up Hugo Relearn Theme</a></li>
            <li class="" data-nav-url="/tools/nextcloud-on-rhel-based-systems/"><a class="padding" href="/tools/nextcloud-on-rhel-based-systems/">Nextcloud on RHEL Based Systems</a></li>
            <li class="" data-nav-url="/tools/setting-up-a-self-hosted-nextcloud-server/"><a class="padding" href="/tools/setting-up-a-self-hosted-nextcloud-server/">Self hosting a Nextcloud Server</a></li>
            <li class="" data-nav-url="/tools/using-vagrant-on-linux/"><a class="padding" href="/tools/using-vagrant-on-linux/">Using Vagrant on Linux</a></li>
            <li class="" data-nav-url="/tools/vimguide/"><a class="padding" href="/tools/vimguide/">Vim Guide</a></li>
            <li class="" data-nav-url="/tools/using-man-pages/"><a class="padding" href="/tools/using-man-pages/">You Need to Learn Man Pages</a></li></ul></li>
            <li class="" data-nav-url="/users-and-groups/"><input type="checkbox" id="R-section-ea23e0c86f0adbd857ee01a4f4dd70e4" aria-controls="R-subsections-ea23e0c86f0adbd857ee01a4f4dd70e4"><label for="R-section-ea23e0c86f0adbd857ee01a4f4dd70e4"><i class="fa-fw fas fa-chevron-right"></i><span class="a11y-only">Submenu Users and Groups</span></label><a class="padding" href="/users-and-groups/"><i class="fa-solid fa-users"></i> Users and Groups</a><ul id="R-subsections-ea23e0c86f0adbd857ee01a4f4dd70e4" class="collapsible-menu">
            <li class="" data-nav-url="/users-and-groups/advanced-user-management/"><a class="padding" href="/users-and-groups/advanced-user-management/">Advanced User Management</a></li>
            <li class="" data-nav-url="/users-and-groups/basic-user-management/"><a class="padding" href="/users-and-groups/basic-user-management/">Basic User Management</a></li></ul></li>
            <li class="" data-nav-url="/virtualization/"><input type="checkbox" id="R-section-da8ee4406de37987b502b79e5b0a9d1c" aria-controls="R-subsections-da8ee4406de37987b502b79e5b0a9d1c"><label for="R-section-da8ee4406de37987b502b79e5b0a9d1c"><i class="fa-fw fas fa-chevron-right"></i><span class="a11y-only">Submenu Virtualization</span></label><a class="padding" href="/virtualization/"><i class="fa-solid fa-microchip"></i> Virtualization</a><ul id="R-subsections-da8ee4406de37987b502b79e5b0a9d1c" class="collapsible-menu">
            <li class="" data-nav-url="/virtualization/rhcsa-vagrant-lab-setup/"><a class="padding" href="/virtualization/rhcsa-vagrant-lab-setup/">RHCSA Vagrant Lab Setup</a></li></ul></li>
          </ul>
        </div>
        <div class="R-sidebarmenu R-shortcutmenu-shortcuts">
          <div class="nav-title padding">More</div>
          <ul class="space collapsible-menu">
            <li class="" data-nav-url="/about/"><a class="padding" href="/about/"><i class='fas fa-solid fa-circle-info'></i> About</a></li>
            <li class="" data-nav-url="https://www.youtube.com/@linuxreader"><a class="padding" href="https://www.youtube.com/@linuxreader" rel="external" target="_blank"><i class='fas fa-fw fa-play'></i> YouTube</a></li>
            <li class="" data-nav-url="/contact/"><a class="padding" href="/contact/"><i class='fas fa-fw fa-envelope'></i> Contact</a></li>
            <li class="" data-nav-url="https://github.com/linuxreader"><a class="padding" href="https://github.com/linuxreader" rel="external" target="_blank"><i class='fab fa-fw fa-github'></i> GitHub</a></li>
            <li class="" data-nav-url="https://linkedin.com/in/linuxreader/"><a class="padding" href="https://linkedin.com/in/linuxreader/" rel="external" target="_blank"><i class='fab fa-fw fa-linkedin'></i> LinkedIn</a></li>
            <li class="" data-nav-url="https://everythingelsexyz.github.io/"><a class="padding" href="https://everythingelsexyz.github.io/" rel="external" target="_blank"><i class='fa-solid fa-circle-notch'></i> Everything Else</a></li>
          </ul>
        </div>
        <div id="R-footer-margin"></div>
        <div class="R-menu-divider default-animation">
          <hr class="padding">
        </div>
        <div class="R-sidebarmenu R-shortcutmenu-footercontrols">
          <ul class="">
          </ul>
        </div>
<div id="R-footer"><p>Built with <a href="https://github.com/McShelby/hugo-theme-relearn" title="love"><i class="fas fa-heart"></i></a> by <a href="https://gohugo.io/">Hugo</a></p></div>
      </div>
    </aside>
    <script>
      window.MathJax = Object.assign( window.MathJax || {}, {
        tex: {
          inlineMath:  [['\\(', '\\)'], ['$',  '$']],  
          displayMath: [['\\[', '\\]'], ['$$', '$$']], 
        },
        options: {
          enableMenu: false 
        }
      }, JSON.parse("{}") );
    </script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="/js/js-yaml/js-yaml.min.js?1762644799" defer></script>
    <script src="/js/d3/d3-color.min.js?1762644799" defer></script>
    <script src="/js/d3/d3-dispatch.min.js?1762644799" defer></script>
    <script src="/js/d3/d3-drag.min.js?1762644799" defer></script>
    <script src="/js/d3/d3-ease.min.js?1762644799" defer></script>
    <script src="/js/d3/d3-interpolate.min.js?1762644799" defer></script>
    <script src="/js/d3/d3-selection.min.js?1762644799" defer></script>
    <script src="/js/d3/d3-timer.min.js?1762644799" defer></script>
    <script src="/js/d3/d3-transition.min.js?1762644799" defer></script>
    <script src="/js/d3/d3-zoom.min.js?1762644799" defer></script>
    <script src="https://unpkg.com/mermaid/dist/mermaid.min.js" defer></script>
    <script>
      window.relearn.themeUseMermaid = JSON.parse("{ \"theme\": \"default\" }");
    </script>
    <script src="/js/clipboard/clipboard.min.js?1762644799" defer></script>
    <script src="/js/perfect-scrollbar/perfect-scrollbar.min.js?1762644799" defer></script>
    <script src="/js/theme.min.js?1762644799" defer></script>
  </body>
</html>
