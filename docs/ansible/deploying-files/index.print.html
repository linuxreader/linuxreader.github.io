<!DOCTYPE html>
<html lang="en-us" dir="ltr" itemscope itemtype="http://schema.org/Article" data-r-output-format="print">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="height=device-height, width=device-width, initial-scale=1.0, minimum-scale=1.0">
    <meta name="generator" content="Hugo 0.152.2">
    <meta name="generator" content="Relearn 8.2.0+d150cc8909ed7836ff5d545e76544f6923ffacf5">
    <meta name="description" content="Deploying filesJinja2 templatesJinja2 templates">
    <meta name="author" content="David Thomas">
    <meta name="twitter:card" content="summary">
    <meta name="twitter:title" content="Deploying Files :: Linux Reader">
    <meta name="twitter:description" content="Deploying filesJinja2 templatesJinja2 templates">
    <meta property="og:url" content="http://linuxreader.com/ansible/deploying-files/">
    <meta property="og:site_name" content="Linux Reader">
    <meta property="og:title" content="Deploying Files :: Linux Reader">
    <meta property="og:description" content="Deploying filesJinja2 templatesJinja2 templates">
    <meta property="og:locale" content="en_us">
    <meta property="og:type" content="website">
    <meta itemprop="name" content="Deploying Files :: Linux Reader">
    <meta itemprop="description" content="Deploying filesJinja2 templatesJinja2 templates">
    <meta itemprop="wordCount" content="6">
    <title>Deploying Files :: Linux Reader</title>
    <link href="http://linuxreader.com/ansible/deploying-files/" rel="canonical" type="text/html" title="Deploying Files :: Linux Reader">
    <link href="/ansible/deploying-files/index.xml" rel="alternate" type="application/rss+xml" title="Deploying Files :: Linux Reader">
    <link href="/images/favicon.svg?1762528139" rel="icon" type="image/svg+xml">
    <link href="/css/auto-complete/auto-complete.min.css?1762528139" rel="stylesheet">
    <script src="/js/auto-complete/auto-complete.min.js?1762528139" defer></script>
    <script src="/js/search-lunr.min.js?1762528139" defer></script>
    <script src="/js/search.min.js?1762528139" defer></script>
    <script>
      window.relearn = window.relearn || {};
      window.relearn.index_js_url="/searchindex.en.js?1762528139";
    </script>
    <script src="/js/lunr/lunr.min.js?1762528139" defer></script>
    <script src="/js/lunr/lunr.stemmer.support.min.js?1762528139" defer></script>
    <script src="/js/lunr/lunr.multi.min.js?1762528139" defer></script>
    <script src="/js/lunr/lunr.en.min.js?1762528139" defer></script>
    <script>
      window.relearn = window.relearn || {};
      window.relearn.contentLangs=['en'];
    </script>
    <link href="/fonts/fontawesome/css/fontawesome-all.min.css?1762528139" rel="stylesheet" media="print" onload="this.media='all';this.onload=null;"><noscript><link href="/fonts/fontawesome/css/fontawesome-all.min.css?1762528139" rel="stylesheet"></noscript>
    <link href="/css/perfect-scrollbar/perfect-scrollbar.min.css?1762528139" rel="stylesheet">
    <link href="/css/theme.min.css?1762528139" rel="stylesheet">
    <link href="/css/format-print.min.css?1762528139" rel="stylesheet" id="R-format-style">
    <script>
      window.relearn = window.relearn || {};
      // configuration
      window.relearn.min = `.min`;
      window.relearn.path='\/ansible\/deploying-files\/';
      window.relearn.relBasePath='..\/..';
      window.relearn.relBaseUri='..\/..';
      window.relearn.absBaseUri='http:\/\/linuxreader.com';
      window.relearn.disableAnchorCopy=false;
      window.relearn.disableAnchorScrolling=false;
      window.relearn.disableInlineCopyToClipboard=true;
      window.relearn.enableBlockCodeWrap=true;
      // legal
      window.relearn.getItem = (s,n) => {return s.getItem(n)};
      window.relearn.setItem = (s,n,v) => {return s.setItem(n,v)};
      window.relearn.removeItem = (s,n) => {return s.removeItem(n)};
      // translations
      window.T_Copy_to_clipboard = `Copy to clipboard`;
      window.T_Copied_to_clipboard = `Copied to clipboard!`;
      window.T_Copy_link_to_clipboard = `Copy link to clipboard`;
      window.T_Link_copied_to_clipboard = `Copied link to clipboard!`;
      window.T_Reset_view = `Reset view`;
      window.T_View_reset = `View reset!`;
      window.T_No_results_found = `No results found for "{0}"`;
      window.T_N_results_found = `{1} results found for "{0}"`;
      // variant stuff
      window.relearn.themevariants = [ 'oled' ];
      window.relearn.customvariantname = "my-custom-variant";
      window.relearn.changeVariant = function(variant) {
        var oldVariant = document.documentElement.dataset.rThemeVariant;
        window.relearn.setItem(window.localStorage, window.relearn.absBaseUri + "/variant", variant);
        document.documentElement.dataset.rThemeVariant = variant;
        if (oldVariant != variant) {
          document.dispatchEvent( new CustomEvent('themeVariantLoaded', { detail: { variant, oldVariant } }) );
          window.relearn.markVariant();
        }
      }
      window.relearn.markVariant = function() {
        var variant = window.relearn.getItem(window.localStorage, window.relearn.absBaseUri + "/variant");
        document.querySelectorAll(".R-variantswitcher select").forEach((select) => {select.value = variant;});
      }
      window.relearn.initVariant = function() {
        var variant = window.relearn.getItem(window.localStorage, window.relearn.absBaseUri + "/variant") ?? "";
        if( variant == window.relearn.customvariantname ){
        }else if( !variant || !window.relearn.themevariants.includes(variant) ){
          variant = window.relearn.themevariants[0];
          window.relearn.setItem(window.localStorage, window.relearn.absBaseUri + "/variant", variant);
        }
        document.documentElement.dataset.rThemeVariant = variant;
      }
      window.relearn.initVariant();
      window.relearn.markVariant();
    </script><style>
:root {
    --MENU-WIDTH-S: 14.375rem;
    --MENU-WIDTH-M: 14.375rem;
    --MENU-WIDTH-L: 18.75rem;
    --MAIN-WIDTH-MAX: 80rem;
    font-size: 1.2rem;
}
</style>

  </head>
  <body class="mobile-support print" data-url="/ansible/deploying-files/">
    <div id="R-body" class="default-animation">
      <div id="R-body-overlay"></div>
      <nav id="R-topbar">
        <div class="topbar-wrapper">
          <div class="topbar-sidebar-divider"></div>
          <div class="topbar-area topbar-area-start" data-area="start">
            <div class="topbar-button topbar-button-sidebar" data-content-empty="disable" data-width-s="show" data-width-m="hide" data-width-l="hide">
<span class="btn cstyle link noborder notitle interactive"><button onclick="toggleNav()" type="button" title="Menu (CTRL&#43;ALT&#43;n)"><i class="fa-fw fas fa-bars"></i></button></span>
            </div>
            <div class="topbar-button topbar-button-prev" data-content-empty="disable" data-width-s="show" data-width-m="show" data-width-l="show">
<span class="btn cstyle link noborder notitle interactive"><a href="/ansible/control-node/setting-up-an-ansible-lab/" title="Setting up an Ansible Lab (ü°ê)"><i class="fa-fw fas fa-chevron-left"></i></a></span>
            </div>

            <div class="topbar-button topbar-button-toc" data-content-empty="hide" data-width-s="show" data-width-m="show" data-width-l="show">
<span class="btn cstyle link noborder notitle interactive"><button onclick="toggleTopbarFlyout(this)" type="button" title="Table of Contents (CTRL&#43;ALT&#43;t)"><i class="fa-fw fas fa-list-alt"></i></button></span>
              <div class="topbar-content">
                <div class="topbar-content-wrapper"> 
                </div>
              </div>
            </div>


          </div>
          <span class="topbar-breadcrumbs highlightable">
            Deploying Files
          </span>
          <div class="topbar-area topbar-area-end" data-area="end">
            <div class="topbar-button topbar-button-print" data-content-empty="disable" data-width-s="area-more" data-width-m="show" data-width-l="show">
<span class="btn cstyle link noborder notitle interactive"><a href="/ansible/deploying-files/index.print.html" title="Print whole chapter (CTRL+ALT+p)"><i class="fa-fw fas fa-print"></i></a></span>
            </div>

            <div class="topbar-button topbar-button-next" data-content-empty="disable" data-width-s="show" data-width-m="show" data-width-l="show">
<span class="btn cstyle link noborder notitle interactive"><a href="/ansible/deploying-files/deploying-files/" title="Deploying files (ü°í)"><i class="fa-fw fas fa-chevron-right"></i></a></span>
            </div>







          </div>
        </div>
      </nav>
      <div id="R-main-overlay"></div>
      <main id="R-body-inner" class="highlightable ansible" tabindex="-1">
        <div class="flex-block-wrapper">
<article class="default">
  <header class="headline">
  </header>

<h1 id="deploying-files">Deploying Files</h1>

<div class="children children-type-card children-sort-"><ul class="card-container">
<li>
  <article class="card card-popout" aria-labelledby="R-card-14c40bc5dcbc2a40cbc1edb11cea6ab1">
    <div class="card-content">
      <div class="card-title" id="R-card-14c40bc5dcbc2a40cbc1edb11cea6ab1">
        <a href="/ansible/deploying-files/deploying-files/">
        Deploying files
        </a>
      </div>
      <div class="card-content-text">
          <!-- raw HTML omitted -->

      </div>
    </div>
  </article>
</li>
<li>
  <article class="card card-popout" aria-labelledby="R-card-5608eb69ee3e2f0c13419f5d7f0f31f4">
    <div class="card-content">
      <div class="card-title" id="R-card-5608eb69ee3e2f0c13419f5d7f0f31f4">
        <a href="/ansible/deploying-files/jinja2-templates/">
        Jinja2 templates
        </a>
      </div>
      <div class="card-content-text">
          <!-- raw HTML omitted -->

      </div>
    </div>
  </article>
</li>
<li>
  <article class="card card-popout" aria-labelledby="R-card-5608eb69ee3e2f0c13419f5d7f0f31f4">
    <div class="card-content">
      <div class="card-title" id="R-card-5608eb69ee3e2f0c13419f5d7f0f31f4">
        <a href="/ansible/deploying-files/selinux-file-properties/">
        Jinja2 templates
        </a>
      </div>
      <div class="card-content-text">
          <!-- raw HTML omitted -->

      </div>
    </div>
  </article>
</li>
</ul>
</div>

  <footer class="footline">
  </footer>
</article>
          <section>
            <h1 class="a11y-only">Subsections of Deploying Files</h1>
<article class="default">
  <header class="headline">
  </header>

<h1 id="deploying-files">Deploying files</h1>

<p>This chapter covers the following subjects:</p>
<p>‚Ä¢ Using Modules to Manipulate Files
‚Ä¢ Managing SELinux Properties
‚Ä¢ Using Jinja2 Templates</p>
<h3 id="rhce-exam-topics">RHCE exam topics</h3>
<p>‚Ä¢ Use Ansible modules for system administration tasks that work with:
‚Ä¢ File contents
‚Ä¢ Use advanced Ansible features
‚Ä¢ Create and use templates to create customized configuration files</p>
<h3 id="using-modules-to-manipulate-files">Using Modules to Manipulate Files</h3>
<h4 id="file-module-manipulation-overview">File Module Manipulation Overview</h4>
<p>Common modules to manipulate files
<strong>copy</strong></p>
<ul>
<li>Copies files to remote locations
<strong>fetch</strong></li>
<li>Fetches files from remote locations
<strong>file</strong></li>
<li>Manage file and file properties</li>
<li>Create new files or directories</li>
<li>Create links</li>
<li>Remove files</li>
<li>Set permissions and ownership</li>
</ul>
<p><strong>acl</strong></p>
<ul>
<li>Work with file system ACLs
<strong>find</strong></li>
<li>Find files based on properties
<strong>lineinfile</strong></li>
<li>Manages lines in text files
<strong>blockinfile</strong></li>
<li>Manage blocks in text files
<strong>replace</strong></li>
<li>Replaces strings in text files based on regex
<strong>synchronize</strong></li>
<li>Performs rsync-based synchronization tasks
<strong>stat</strong></li>
<li>Retrieves file or file system status</li>
<li>enables you to retrieve file status information.</li>
<li>gets status information and is not used to change anything</li>
<li>use it to check specific file and perform an action if the properties are not set as expected.
Shows:</li>
<li>which permission mode is set,</li>
<li>whether it is a link,</li>
<li>which checksum is set on the file</li>
<li>etc.</li>
<li>See <code>ansible-doc stat</code> for list of full output</li>
</ul>
<h3 id="lab-view-information-about-etchosts-file">Lab: View information about /etc/hosts file</h3>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yml" data-lang="yml"><span style="display:flex;"><span>- <span style="color:#ff6ac1">name</span>: stat module tests
</span></span><span style="display:flex;"><span>  <span style="color:#ff6ac1">hosts</span>: ansible1
</span></span><span style="display:flex;"><span>  <span style="color:#ff6ac1">tasks</span>:
</span></span><span style="display:flex;"><span>  - <span style="color:#ff6ac1">stat</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#ff6ac1">path</span>: /etc/hosts
</span></span><span style="display:flex;"><span>    <span style="color:#ff6ac1">register</span>: st
</span></span><span style="display:flex;"><span>  - <span style="color:#ff6ac1">name</span>: show current values
</span></span><span style="display:flex;"><span>    <span style="color:#ff6ac1">debug</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#ff6ac1">msg</span>: current value of the st variable is {{ st }}</span></span></code></pre></div>
<h3 id="lab-write-a-message-if-the-expected-permission-mode-is-not-set">Lab: write a message if the expected permission mode is not set.</h3>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yml" data-lang="yml"><span style="display:flex;"><span>---
</span></span><span style="display:flex;"><span>- <span style="color:#ff6ac1">name</span>: stat module test
</span></span><span style="display:flex;"><span>  <span style="color:#ff6ac1">hosts</span>: ansible1
</span></span><span style="display:flex;"><span>  <span style="color:#ff6ac1">tasks</span>:
</span></span><span style="display:flex;"><span>  - <span style="color:#ff6ac1">command</span>: touch /tmp/statfile
</span></span><span style="display:flex;"><span>  - <span style="color:#ff6ac1">stat</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#ff6ac1">path</span>: /tmp/statfile
</span></span><span style="display:flex;"><span>    <span style="color:#ff6ac1">register</span>: st
</span></span><span style="display:flex;"><span>  - <span style="color:#ff6ac1">name</span>: show current values
</span></span><span style="display:flex;"><span>    <span style="color:#ff6ac1">debug</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#ff6ac1">msg</span>: current value of the st variable is {{ st }}
</span></span><span style="display:flex;"><span>  - <span style="color:#ff6ac1">fail</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#ff6ac1">msg</span>: <span style="color:#5af78e">&#34;unexpected file mode, should be set to 0640&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff6ac1">when</span>: st.stat.mode != &#39;0640&#39;                               </span></span></code></pre></div>
<h3 id="lab--use-the-file-module-to-correct-file-properties-discovered-with-stat">Lab:  Use the file Module to Correct File Properties Discovered with stat</h3>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yml" data-lang="yml"><span style="display:flex;"><span>---
</span></span><span style="display:flex;"><span>- <span style="color:#ff6ac1">name</span>: stat module tests
</span></span><span style="display:flex;"><span>  <span style="color:#ff6ac1">hosts</span>: ansible1
</span></span><span style="display:flex;"><span>  <span style="color:#ff6ac1">tasks</span>:
</span></span><span style="display:flex;"><span>  - <span style="color:#ff6ac1">command</span>: touch /tmp/statfile
</span></span><span style="display:flex;"><span>  - <span style="color:#ff6ac1">stat</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#ff6ac1">path</span>: /tmp/statfile
</span></span><span style="display:flex;"><span>    <span style="color:#ff6ac1">register</span>: st
</span></span><span style="display:flex;"><span>  - <span style="color:#ff6ac1">name</span>: show current values
</span></span><span style="display:flex;"><span>    <span style="color:#ff6ac1">debug</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#ff6ac1">msg</span>: current value of the st variable is {{ st }}
</span></span><span style="display:flex;"><span>  - <span style="color:#ff6ac1">name</span>: changing file permissions if that&#39;s needed
</span></span><span style="display:flex;"><span>    <span style="color:#ff6ac1">file</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#ff6ac1">path</span>: /tmp/statfile
</span></span><span style="display:flex;"><span>      <span style="color:#ff6ac1">mode</span>: <span style="color:#ff9f43">0640</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff6ac1">when</span>: st.stat.mode != &#39;0640&#39;</span></span></code></pre></div>
<h4 id="managing-file-contents">Managing File Contents</h4>
<p>Use lineinfile or blockinfile instead of copy to manage text in a file</p>
<h3 id="lab-change-a-string-based-on-a-regular-expression">Lab: Change a string, based on a regular expression.</h3>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yml" data-lang="yml"><span style="display:flex;"><span>---
</span></span><span style="display:flex;"><span>- <span style="color:#ff6ac1">name</span>: configuring SSH
</span></span><span style="display:flex;"><span>  <span style="color:#ff6ac1">hosts</span>: all
</span></span><span style="display:flex;"><span>  <span style="color:#ff6ac1">tasks</span>:
</span></span><span style="display:flex;"><span>  - <span style="color:#ff6ac1">name</span>: disable root SSH login
</span></span><span style="display:flex;"><span>    <span style="color:#ff6ac1">lineinfile</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#ff6ac1">dest</span>: /etc/ssh/sshd_config
</span></span><span style="display:flex;"><span>      <span style="color:#ff6ac1">regexp</span>: <span style="color:#5af78e">&#34;^PermitRootLogin&#34;</span>
</span></span><span style="display:flex;"><span>      <span style="color:#ff6ac1">line</span>: <span style="color:#5af78e">&#34;PermitRootLogin no&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff6ac1">notify</span>: restart sshd
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#ff6ac1">handlers</span>:
</span></span><span style="display:flex;"><span>  - <span style="color:#ff6ac1">name</span>: restart sshd
</span></span><span style="display:flex;"><span>    <span style="color:#ff6ac1">service</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#ff6ac1">name</span>: sshd
</span></span><span style="display:flex;"><span>      <span style="color:#ff6ac1">state</span>: restarted</span></span></code></pre></div>
<h3 id="lab-manipulate-multiple-lines">Lab: Manipulate multiple lines</h3>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yml" data-lang="yml"><span style="display:flex;"><span>---
</span></span><span style="display:flex;"><span>- <span style="color:#ff6ac1">name</span>: modifying file
</span></span><span style="display:flex;"><span>  <span style="color:#ff6ac1">hosts</span>: all
</span></span><span style="display:flex;"><span>  <span style="color:#ff6ac1">tasks</span>:
</span></span><span style="display:flex;"><span>  - <span style="color:#ff6ac1">name</span>: ensure /tmp/hosts exists
</span></span><span style="display:flex;"><span>    <span style="color:#ff6ac1">file</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#ff6ac1">path</span>: /tmp/hosts
</span></span><span style="display:flex;"><span>      <span style="color:#ff6ac1">state</span>: touch
</span></span><span style="display:flex;"><span>  - <span style="color:#ff6ac1">name</span>: add some lines to /tmp/hosts
</span></span><span style="display:flex;"><span>    <span style="color:#ff6ac1">blockinfile</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#ff6ac1">path</span>: /tmp/hosts
</span></span><span style="display:flex;"><span>      <span style="color:#ff6ac1">block</span>: |<span style="color:#5af78e">
</span></span></span><span style="display:flex;"><span><span style="color:#5af78e">        192.168.4.110 host1.example.com
</span></span></span><span style="display:flex;"><span><span style="color:#5af78e">        192.168.4.120 host2.example.com</span>
</span></span><span style="display:flex;"><span>      <span style="color:#ff6ac1">state</span>: present</span></span></code></pre></div>
<p>When blockinfile is used, the text specified in the block is copied with a start and end indicator.</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#ff6ac1">[</span>ansible@ansible1 ~<span style="color:#ff6ac1">]</span>$ cat /tmp/hosts
</span></span><span style="display:flex;"><span>127.0.0.1   localhost localhost.localdomain localhost4 localhost4.localdomain4
</span></span><span style="display:flex;"><span>::1         localhost localhost.localdomain localhost6 localhost6.localdomain6
</span></span><span style="display:flex;"><span>192.168.122.201 ansible1
</span></span><span style="display:flex;"><span>192.168.122.202 ansible2
</span></span><span style="display:flex;"><span>192.168.122.203 ansible3
</span></span><span style="display:flex;"><span><span style="color:#78787e"># BEGIN ANSIBLE MANAGED BLOCK</span>
</span></span><span style="display:flex;"><span>192.168.4.110 host1.example.com
</span></span><span style="display:flex;"><span>192.168.4.120 host2.example.com
</span></span><span style="display:flex;"><span><span style="color:#78787e"># END ANSIBLE MANAGED BLOCK</span></span></span></code></pre></div>
<h3 id="lab-creating-and-removing-files">Lab: Creating and Removing Files</h3>
<p>Use the file module to create a new directory and in that directory create an empty file, then remove the directory recursively.</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yml" data-lang="yml"><span style="display:flex;"><span>---
</span></span><span style="display:flex;"><span>- <span style="color:#ff6ac1">name</span>: using the file module
</span></span><span style="display:flex;"><span>  <span style="color:#ff6ac1">hosts</span>: ansible1
</span></span><span style="display:flex;"><span>  <span style="color:#ff6ac1">tasks</span>:
</span></span><span style="display:flex;"><span>  - <span style="color:#ff6ac1">name</span>: create directory
</span></span><span style="display:flex;"><span>    <span style="color:#ff6ac1">file</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#ff6ac1">path</span>: /newdir
</span></span><span style="display:flex;"><span>      <span style="color:#ff6ac1">owner</span>: ansible
</span></span><span style="display:flex;"><span>      <span style="color:#ff6ac1">group</span>: ansible
</span></span><span style="display:flex;"><span>      <span style="color:#ff6ac1">mode</span>: <span style="color:#ff9f43">770</span>
</span></span><span style="display:flex;"><span>      <span style="color:#ff6ac1">state</span>: directory
</span></span><span style="display:flex;"><span>  - <span style="color:#ff6ac1">name</span>: create file in that directory
</span></span><span style="display:flex;"><span>    <span style="color:#ff6ac1">file</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#ff6ac1">path</span>: /newdir/newfile
</span></span><span style="display:flex;"><span>      <span style="color:#ff6ac1">state</span>: touch
</span></span><span style="display:flex;"><span>  - <span style="color:#ff6ac1">name</span>: show the new file
</span></span><span style="display:flex;"><span>    <span style="color:#ff6ac1">stat</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#ff6ac1">path</span>: /newdir/newfile
</span></span><span style="display:flex;"><span>    <span style="color:#ff6ac1">register</span>: result
</span></span><span style="display:flex;"><span>  - <span style="color:#ff6ac1">debug</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#ff6ac1">msg</span>: |<span style="color:#5af78e">
</span></span></span><span style="display:flex;"><span><span style="color:#5af78e">        This shows that newfile was created
</span></span></span><span style="display:flex;"><span><span style="color:#5af78e">        &#34;{{ result }}&#34;</span>
</span></span><span style="display:flex;"><span>  - <span style="color:#ff6ac1">name</span>: removing everything again
</span></span><span style="display:flex;"><span>    <span style="color:#ff6ac1">file</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#ff6ac1">path</span>: /newdir
</span></span><span style="display:flex;"><span>      <span style="color:#ff6ac1">state</span>: absent               </span></span></code></pre></div>
<ul>
<li><strong>state: absent</strong> recursively removes the directory.</li>
</ul>
<h4 id="moving-files-around">Moving Files Around</h4>
<p>copy module
copies a file from the Ansible control host to a managed machine.</p>
<p>fetch module
enables you to do the opposite</p>
<p>synchronize module
performs Linux rsync-like tasks,
ensuring that a file from the control host is synchronized to a file with that name on the managed host.</p>
<p>copy module always creates a new file, whereas the synchronize module updates a current existing file.</p>
<h3 id="lab-moving-a-file-around-with-ansible">Lab: Moving a File Around with Ansible</h3>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yml" data-lang="yml"><span style="display:flex;"><span>---
</span></span><span style="display:flex;"><span>- <span style="color:#ff6ac1">name</span>: file copy modules
</span></span><span style="display:flex;"><span>  <span style="color:#ff6ac1">hosts</span>: all
</span></span><span style="display:flex;"><span>  <span style="color:#ff6ac1">tasks</span>:
</span></span><span style="display:flex;"><span>  - <span style="color:#ff6ac1">name</span>: copy file demo
</span></span><span style="display:flex;"><span>    <span style="color:#ff6ac1">copy</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#ff6ac1">src</span>: /etc/hosts
</span></span><span style="display:flex;"><span>      <span style="color:#ff6ac1">dest</span>: /tmp/
</span></span><span style="display:flex;"><span>  - <span style="color:#ff6ac1">name</span>: add some lines to /tmp/hosts
</span></span><span style="display:flex;"><span>    <span style="color:#ff6ac1">blockinfile</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#ff6ac1">path</span>: /tmp/hosts
</span></span><span style="display:flex;"><span>      <span style="color:#ff6ac1">block</span>: |<span style="color:#5af78e">
</span></span></span><span style="display:flex;"><span><span style="color:#5af78e">        192.168.4.110 host1.example.com
</span></span></span><span style="display:flex;"><span><span style="color:#5af78e">        192.168.4.120 host2.example.com</span>
</span></span><span style="display:flex;"><span>      <span style="color:#ff6ac1">state</span>: present
</span></span><span style="display:flex;"><span>  - <span style="color:#ff6ac1">name</span>: verify file checksum
</span></span><span style="display:flex;"><span>    <span style="color:#ff6ac1">stat</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#ff6ac1">path</span>: /tmp/hosts
</span></span><span style="display:flex;"><span>      <span style="color:#ff6ac1">checksum_algorithm</span>: md5
</span></span><span style="display:flex;"><span>    <span style="color:#ff6ac1">register</span>: result
</span></span><span style="display:flex;"><span>  - <span style="color:#ff6ac1">debug</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#ff6ac1">msg</span>: <span style="color:#5af78e">&#34;The checksum of /tmp/hosts is {{ result.stat.checksum }}&#34;</span>
</span></span><span style="display:flex;"><span>  - <span style="color:#ff6ac1">name</span>: fetch a file
</span></span><span style="display:flex;"><span>    <span style="color:#ff6ac1">fetch</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#ff6ac1">src</span>: /tmp/hosts
</span></span><span style="display:flex;"><span>      <span style="color:#ff6ac1">dest</span>: /tmp/</span></span></code></pre></div>
<ul>
<li>Ansible creates a subdirectory on the control node for each managed host in the dest directory and puts the file that fetch has copied from the remote host in that subdirectory:</li>
</ul>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>/tmp/ansible1/tmp/hosts
</span></span><span style="display:flex;"><span>/tmp/ansible2/tmp/hosts</span></span></code></pre></div>
<h3 id="lab-managing-files-with-ansible">Lab: Managing Files with Ansible</h3>
<p>1. Create a file with the name exercise81.yaml and give it the following play header:
2. Add a task that creates a new empty file:
3. Use the stat module to check on the status of the new file:
4. To see what the status module is doing, add a line that uses the debug module:
5. Now that you understand which values are stored in newfile, you can add a conditional play that changes the current owner if not set correctly:
6. Add a second play to the playbook that fetches a remote file:
7. Now that you have fetched the file so that it is on the Ansible control machine, use blockinfile to edit it:
8. In the final step, copy the modified file to ansible2 by including the following play:
9. At this point you&rsquo;re ready to run the playbook. Type <code>ansible-playbook exercise81.yaml</code> to run it and observe the results.
10. Type <code>ansible ansible2 -a &quot;cat /tmp/motd&quot;</code> to verify that the modified motd file was successfully copied to ansible2.</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yml" data-lang="yml"><span style="display:flex;"><span>---
</span></span><span style="display:flex;"><span>- <span style="color:#ff6ac1">name</span>: testing file manipulation skills
</span></span><span style="display:flex;"><span>  <span style="color:#ff6ac1">hosts</span>: ansible1
</span></span><span style="display:flex;"><span>  <span style="color:#ff6ac1">tasks</span>:
</span></span><span style="display:flex;"><span>    - <span style="color:#ff6ac1">name</span>: create new file
</span></span><span style="display:flex;"><span>      <span style="color:#ff6ac1">file</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#ff6ac1">name</span>: /tmp/newfile
</span></span><span style="display:flex;"><span>        <span style="color:#ff6ac1">state</span>: touch
</span></span><span style="display:flex;"><span>    - <span style="color:#ff6ac1">name</span>: check the status of the new file
</span></span><span style="display:flex;"><span>      <span style="color:#ff6ac1">stat</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#ff6ac1">path</span>: /tmp/newfile
</span></span><span style="display:flex;"><span>      <span style="color:#ff6ac1">register</span>: newfile
</span></span><span style="display:flex;"><span>    - <span style="color:#ff6ac1">name</span>: for debugging only
</span></span><span style="display:flex;"><span>      <span style="color:#ff6ac1">debug</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#ff6ac1">msg</span>: the current values for newfile are {{ newfile }}
</span></span><span style="display:flex;"><span>    - <span style="color:#ff6ac1">name</span>: change file owner if needed
</span></span><span style="display:flex;"><span>      <span style="color:#ff6ac1">file</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#ff6ac1">path</span>: /tmp/newfile
</span></span><span style="display:flex;"><span>        <span style="color:#ff6ac1">owner</span>: ansible
</span></span><span style="display:flex;"><span>      <span style="color:#ff6ac1">when</span>: newfile.stat.pw_name != &#39;ansible&#39;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>- <span style="color:#ff6ac1">name</span>: fetching a remote file
</span></span><span style="display:flex;"><span>  <span style="color:#ff6ac1">hosts</span>: ansible1
</span></span><span style="display:flex;"><span>  <span style="color:#ff6ac1">tasks</span>:
</span></span><span style="display:flex;"><span>    - <span style="color:#ff6ac1">name</span>: fetch file from remote machine
</span></span><span style="display:flex;"><span>      <span style="color:#ff6ac1">fetch</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#ff6ac1">src</span>: /etc/motd
</span></span><span style="display:flex;"><span>        <span style="color:#ff6ac1">dest</span>: /tmp
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>- <span style="color:#ff6ac1">name</span>: adding text to the text file that is now on localhost
</span></span><span style="display:flex;"><span>  <span style="color:#ff6ac1">hosts</span>: localhost
</span></span><span style="display:flex;"><span>  <span style="color:#ff6ac1">tasks</span>:
</span></span><span style="display:flex;"><span>  - <span style="color:#ff6ac1">name</span>: add a message
</span></span><span style="display:flex;"><span>    <span style="color:#ff6ac1">blockinfile</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#ff6ac1">path</span>: /tmp/ansible1/etc/motd
</span></span><span style="display:flex;"><span>      <span style="color:#ff6ac1">block</span>: |<span style="color:#5af78e">
</span></span></span><span style="display:flex;"><span><span style="color:#5af78e">        welcome to this server
</span></span></span><span style="display:flex;"><span><span style="color:#5af78e">        for authorized users only</span>
</span></span><span style="display:flex;"><span>      <span style="color:#ff6ac1">state</span>: present
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>- <span style="color:#ff6ac1">name</span>: copy the modified file to ansible2
</span></span><span style="display:flex;"><span>  <span style="color:#ff6ac1">hosts</span>: ansible2
</span></span><span style="display:flex;"><span>  <span style="color:#ff6ac1">tasks</span>:
</span></span><span style="display:flex;"><span>  - <span style="color:#ff6ac1">name</span>: copy motd file
</span></span><span style="display:flex;"><span>    <span style="color:#ff6ac1">copy</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#ff6ac1">src</span>: /tmp/ansible1/etc/motd
</span></span><span style="display:flex;"><span>      <span style="color:#ff6ac1">dest</span>: /tmp</span></span></code></pre></div>

  <footer class="footline">
  </footer>
</article>
<article class="default">
  <header class="headline">
  </header>

<h1 id="jinja2-templates">Jinja2 templates</h1>

<h3 id="using-jinja2-templates">Using Jinja2 Templates</h3>
<ul>
<li>A template is a configuration file that contains variables and, based on the variables, is generated on the managed hosts according to host-specific requirements.</li>
<li>Using templates allows for a structural way to generate configuration files, which is much more powerful than changing specific lines from specific files.</li>
<li>Ansible uses Jinja2 to generate templates.</li>
<li>Jinja2 is a generic templating language for Python developers.</li>
<li>It is used in Ansible templates, but Jinja2-based approaches are also found in other parts of Ansible. For instance, the way variables are referred to is based on Jinja2.</li>
</ul>
<p>In a Jinja2 template, three elements can be used.
<strong>data</strong></p>
<ul>
<li><code>sample text</code>
<strong>comment</strong></li>
<li><code>{# sample text #}</code>
<strong>variable</strong></li>
<li><code>{{ ansible_facts['default_ipv4']['address'] }}</code>
<strong>expression</strong></li>
</ul>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0"><code>{% for myhost in groups[&#39;web&#39;] %}
{{ myhost }}
{% endfor %}</code></pre></div>
<ul>
<li>To work with a template, you must create a template file, written in Jinja2.</li>
<li>Template file must be included in an Ansible playbook that uses the template module.</li>
</ul>
<p>Sample Template:</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0"><code># {{ ansible_managed }}

&lt;VirtualHost *:80&gt;
        ServerAdmin webmaster@{{ ansible_facts[&#39;fqdn&#39;] }}
        ServerName {{ ansible_facts[&#39;fqdn&#39;] }}
        ErrorLog logs/{{ ansible_facts[&#39;hostname&#39;] }}-error.log
        CustomLog       logs/{{ ansible_facts[&#39;hostname&#39;] }}-common.log common
        DocumentRoot /var/www/vhosts/{{ ansible_facts[&#39;hostname&#39;] }}/

        &lt;Directory /var/www/vhosts/{{ ansible_facts[&#39;hostname&#39;] }}&gt;
                Options +Indexes +FollowSymlinks +Includes
                Require all granted
        &lt;/Directory&gt;
&lt;/VirtualHost&gt;</code></pre></div>
<ul>
<li>
<p>starts with <strong># {{ ansible_managed }}</strong>.</p>
</li>
<li>
<p>This string is commonly used to identify that a file is managed by Ansible so that administrators are not going to change file contents by accident.</p>
</li>
<li>
<p>While processing the template, this string is replaced with the value of the <strong>ansible_managed</strong> variable.</p>
</li>
<li>
<p>This variable can be set in ansible.cfg.</p>
</li>
<li>
<p>For instance, you can use <strong>ansible_managed = This file is managed by Ansible</strong> to substitute the variable with its value while generating the template.</p>
</li>
<li>
<p>template file is just a text file that uses variables to substitute specific variables to their values.</p>
</li>
</ul>
<p>Calling a template:</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yml" data-lang="yml"><span style="display:flex;"><span>    ---
</span></span><span style="display:flex;"><span>    - <span style="color:#ff6ac1">name</span>: installing a template file
</span></span><span style="display:flex;"><span>      <span style="color:#ff6ac1">hosts</span>: ansible1
</span></span><span style="display:flex;"><span>      <span style="color:#ff6ac1">tasks</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#ff6ac1">name</span>: install httpd
</span></span><span style="display:flex;"><span>        <span style="color:#ff6ac1">yum</span>:
</span></span><span style="display:flex;"><span>          <span style="color:#ff6ac1">name</span>: httpd
</span></span><span style="display:flex;"><span>          <span style="color:#ff6ac1">state</span>: latest
</span></span><span style="display:flex;"><span>      - <span style="color:#ff6ac1">name</span>: start and enable httpd
</span></span><span style="display:flex;"><span>        <span style="color:#ff6ac1">service</span>:
</span></span><span style="display:flex;"><span>          <span style="color:#ff6ac1">name</span>: httpd
</span></span><span style="display:flex;"><span>          <span style="color:#ff6ac1">state</span>: started
</span></span><span style="display:flex;"><span>          <span style="color:#ff6ac1">enabled</span>: <span style="color:#ff6ac1">true</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#ff6ac1">name</span>: install vhost config file
</span></span><span style="display:flex;"><span>        <span style="color:#ff6ac1">template</span>:
</span></span><span style="display:flex;"><span>          <span style="color:#ff6ac1">src</span>: listing813.j2
</span></span><span style="display:flex;"><span>          <span style="color:#ff6ac1">dest</span>: /etc/httpd/conf.d/vhost.conf
</span></span><span style="display:flex;"><span>          <span style="color:#ff6ac1">owner</span>: root
</span></span><span style="display:flex;"><span>          <span style="color:#ff6ac1">group</span>: root
</span></span><span style="display:flex;"><span>          <span style="color:#ff6ac1">mode</span>: <span style="color:#ff9f43">0644</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#ff6ac1">name</span>: restart httpd
</span></span><span style="display:flex;"><span>        <span style="color:#ff6ac1">service</span>:
</span></span><span style="display:flex;"><span>          <span style="color:#ff6ac1">name</span>: httpd
</span></span><span style="display:flex;"><span>          <span style="color:#ff6ac1">state</span>: restarted</span></span></code></pre></div>
<h4 id="applying-control-structures-in-jinja2-using-for">Applying Control Structures in Jinja2 Using for</h4>
<ul>
<li>Control structures can be used to dynamically generate contents.</li>
<li>A <strong>for</strong> statement can be used to iterate over all elements that exist as the value of a variable.</li>
</ul>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0"><code>{% for node in groups[&#39;all&#39;] %}
host_port={{ node }}:8080
{% endfor %}</code></pre></div>
<ul>
<li>variable with the name <strong>host_ports</strong> is defined on the second line (which is the line that will be written to the target file).</li>
<li>To produce its value, the host group <strong>all</strong> is processed in the <strong>for</strong> statement on the first line.</li>
<li>While processing the host group, a temporary variable with the name <strong>node</strong> is defined.</li>
<li>This value of the <strong>node</strong> variable is replaced with the name of the host while it is processed, and after the host name, the string <strong>:8080</strong> is copied, which will result in a separate line for each host that was found.</li>
<li>As the last element, <strong>{% endfor %}</strong> is used to close the <strong>for</strong> loop.</li>
</ul>
<h3 id="lab-generating-a-template-with-a-conditional-statement">LAB: Generating a Template with a Conditional Statement</h3>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0"><code>    ---
    - name: generate host list
      hosts: ansible2
      tasks:
      - name: template loop
        template:
          src: listing815.j2
          dest: /tmp/hostports.txt</code></pre></div>
<p>To verify, you can use the ad hoc command <code>ansible ansible2 -a &quot;cat /tmp/hostports.txt&quot;</code></p>
<h4 id="using-conditional-statements-with-if">Using Conditional Statements with if</h4>
<ul>
<li>The <strong>for</strong> statement can be used in templates to iterate over a series of values.</li>
<li>The <strong>if</strong> statement can be used to include text only if a variable contains a specific value or evaluates to a Boolean true.</li>
</ul>
<p>Template Example with <strong>if</strong>
if.j2</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0"><code>    {% if apache_package == &#39;apache2&#39; %}
      Welcome to Apache2
    {% else %}
      Welcome to httpd
    {% endif %}</code></pre></div>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yml" data-lang="yml"><span style="display:flex;"><span>---
</span></span><span style="display:flex;"><span>- <span style="color:#ff6ac1">name</span>: work with template file
</span></span><span style="display:flex;"><span>  <span style="color:#ff6ac1">vars</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#ff6ac1">apache_package</span>: <span style="color:#5af78e">&#39;httpd&#39;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ff6ac1">hosts</span>: ansible2
</span></span><span style="display:flex;"><span>  <span style="color:#ff6ac1">tasks</span>:
</span></span><span style="display:flex;"><span>  - <span style="color:#ff6ac1">template</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#ff6ac1">src</span>: if.j2
</span></span><span style="display:flex;"><span>      <span style="color:#ff6ac1">dest</span>: /tmp/httpd.conf</span></span></code></pre></div>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#ff6ac1">[</span>ansible@control ~<span style="color:#ff6ac1">]</span>$ ansible ansible2 -a <span style="color:#5af78e">&#34;cat /tmp/httpd.conf&#34;</span>
</span></span><span style="display:flex;"><span>ansible2 | CHANGED | <span style="color:#ff5c57">rc</span><span style="color:#ff6ac1">=</span><span style="color:#ff9f43">0</span> &gt;&gt;
</span></span><span style="display:flex;"><span>  Welcome to httpd</span></span></code></pre></div>
<h4 id="using-filters">Using Filters</h4>
<ul>
<li>In Jinja2 templates, you can use filters.</li>
<li>Filters are a way to perform an operation on the value of a template expression, such as a variable.</li>
<li>The filter is included in the variable definition itself, and the result of the variable and its filter is used in the file that is generated.</li>
</ul>
<p>Common filters
<strong>{{ myvar | to_json }}</strong></p>
<ul>
<li>writes the contents of myvar in JSON format
<strong>{{ myvar || to_yaml }}</strong></li>
<li>writes the contents of myvar in YAML format
<strong>{{ myvar | ipaddr }}</strong></li>
<li>tests whether myvar contains an IP address</li>
</ul>
<h2 id="from-">From <a href="https://docs.ansible.com" rel="external" target="_blank">https://docs.ansible.com</a>:</h2>
<h4 id="how-do-i-loop-over-a-list-of-hosts-in-a-group-inside-of-a-template">How do I loop over a list of hosts in a group, inside of a template?</h4>
<p>A pretty common pattern is to iterate over a list of hosts inside of a host group, perhaps to populate a template configuration file with a list of servers. To do this, you can just access the ‚Äú$groups‚Äù dictionary in your template, like this:</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0"><code>{% for host in groups[&#39;db_servers&#39;] %}
    {{ host }}
{% endfor %}</code></pre></div>
<p>If you need to access facts about these hosts, for example, the IP address of each hostname, you need to make sure that the facts have been populated. For example, make sure you have a play that talks to db_servers:</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0"><code>- hosts:  db_servers
  tasks:
    - debug: msg=&#34;doesn&#39;t matter what you do, just that they were talked to previously.&#34;</code></pre></div>
<p>Then you can use the facts inside your template, like this:</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0"><code>{% for host in groups[&#39;db_servers&#39;] %}
   {{ hostvars[host][&#39;ansible_eth0&#39;][&#39;ipv4&#39;][&#39;address&#39;] }}
{% endfor %}</code></pre></div>
<h3 id="lab-working-with-conditional-statements-in-templates">Lab: Working with Conditional Statements in Templates</h3>
<p>1. Use your editor to create the file exercise83.j2. Include the following line to open the Jinja2 conditional statement:</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0"><code class="language-pre1" data-lang="pre1">{% for host in groups[&#39;all&#39;] %}</code></pre></div>
<p>2. This statement defines a variable with the name <strong>host</strong>. This variable iterates over the magic variable <strong>groups</strong>, which holds all Ansible host groups as defined in inventory. Of these groups, the <strong>all</strong> group (which holds all inventory host names) is processed.</p>
<p>3. Add the following line (write it as one line; it will wrap over two lines, but do not press Enter to insert a newline character):</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0"><code class="language-pre1" data-lang="pre1">{{ hostvars[host][&#39;ansible_default_ipv4&#39;][&#39;address&#39;] }} {{ hostvars[host][&#39;ansible_fqdn&#39;] }} {{ hostvars[host][&#39;ansible_hostname&#39;] }}</code></pre></div>
<ul>
<li>This line writes a single line for each inventory host, containing three items.</li>
<li>To do so, you use the magic variable <strong>hostvars</strong>, which can be used to identify Ansible facts that were discovered on the inventory host.</li>
<li>The <strong>[host]</strong> part is replaced with the name of the current host, and after that, the specific facts are referred to. As a result, for each host a line is produced that holds the IP address, the FQDN, and next the host name.</li>
</ul>
<p>4. Add the following line to close the <strong>for</strong> loop:</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0"><code class="language-pre1" data-lang="pre1">{% endfor %}</code></pre></div>
<p>5. Verify that the complete file contents look like the following and write and quit the file:</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0"><code class="language-pre1" data-lang="pre1">{% for host in groups[&#39;all&#39;] %}
{{ hostvars[host][&#39;ansible_default_ipv4&#39;][&#39;address&#39;] }} {{ hostvars[host][&#39;ansible_fqdn&#39;] }} {{ hostvars[host][&#39;ansible_hostname&#39;] }}
{% endfor %}</code></pre></div>
<p>6. Use your editor to create the file exercise83.yaml. It should contain the following lines:</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yml" data-lang="yml"><span style="display:flex;"><span>---
</span></span><span style="display:flex;"><span>- <span style="color:#ff6ac1">name</span>: generate /etc/hosts file
</span></span><span style="display:flex;"><span>  <span style="color:#ff6ac1">hosts</span>: all
</span></span><span style="display:flex;"><span>  <span style="color:#ff6ac1">tasks</span>:
</span></span><span style="display:flex;"><span>  - <span style="color:#ff6ac1">name</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#ff6ac1">template</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#ff6ac1">src</span>: exercise83.j2
</span></span><span style="display:flex;"><span>      <span style="color:#ff6ac1">dest</span>: /tmp/hosts</span></span></code></pre></div>
<p>7. Run the playbook by using <code>ansible-playbook exercise83.yaml</code></p>
<p>8. Verify the /tmp/hosts file was generated by using <code>ansible all -a &quot;cat /tmp/hosts&quot;</code></p>
<p>This lab only worked if every host in the inventory file was reachable.</p>
<h3 id="lab-generate-an-etchosts-file">Lab: Generate an /etc/hosts File</h3>
<p>Write a playbook that generates an /etc/hosts file on all managed hosts.
Apply the following requirements:</p>
<p>‚Ä¢ All hosts that are defined in inventory should be added to the
/etc/hosts file.</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0"><code>[ansible@control ~]$ cat hostfile.yaml
---
- name: generate /etc/hosts
  hosts: all
  gather_facts: yes
  tasks: 
  - name: Generate hosts file with template
    template: 
      src: hosts.j2
      dest: /etc/hosts
[ansible@control ~]$ cat hosts.j2
{% for host in groups[&#39;all&#39;] %}
{{ hostvars[host][&#39;ansible_default_ipv4&#39;][&#39;address&#39;] }} {{ hostvars[host][&#39;ansible_fqdn&#39;] }} {{ hostvars[host][&#39;ansible_hostname&#39;] }}
{% endfor %}}</code></pre></div>
<h3 id="lab-manage-a-vsftpd-service">Lab: Manage a vsftpd Service</h3>
<ul>
<li>Write a playbook that uses at least two plays to install a vsftpd service</li>
<li>configure the vsftpd service using templates</li>
<li>configure permissions as well as SELinux.</li>
<li>Install, start, and enable the vsftpd service.</li>
<li>open a port in the firewall to make it accessible.</li>
<li>Use the /etc/vsftpd/vsftpd.conf file to generate a template.</li>
<li>In this template, you should use the following variables to configure specific settings.</li>
<li>Replace these settings with the variables and leave all else unmodified:</li>
</ul>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0"><code>Anonymous_enable: yes
Local_enable: yes
Write_enable: yes
Anon_upload_enable: yes</code></pre></div>
<ul>
<li>Set permissions on the /var/ftp/pub directory to mode 0777.</li>
<li>Configure the <strong>ftpd_anon_write</strong> Boolean to allow anonymous user writes.</li>
<li>Set the <strong>public_content_rw_t</strong> SELinux context type to the /var/ftp/pub directory.</li>
<li>If any additional tasks are required to get this done, take care of them.</li>
</ul>
<p><code> vim vsftpd.yaml</code></p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yml" data-lang="yml"><span style="display:flex;"><span>---
</span></span><span style="display:flex;"><span>- <span style="color:#ff6ac1">name</span>: manage vsftpd
</span></span><span style="display:flex;"><span>  <span style="color:#ff6ac1">hosts</span>: ansible1
</span></span><span style="display:flex;"><span>  <span style="color:#ff6ac1">vars</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#ff6ac1">anonymous_enable</span>: <span style="color:#ff6ac1">yes</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff6ac1">local_enable</span>: <span style="color:#ff6ac1">yes</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff6ac1">write_enable</span>: <span style="color:#ff6ac1">yes</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff6ac1">Anon_upload_enable</span>: <span style="color:#ff6ac1">yes</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ff6ac1">tasks</span>:
</span></span><span style="display:flex;"><span>    - <span style="color:#ff6ac1">name</span>: install vsftpd
</span></span><span style="display:flex;"><span>      <span style="color:#ff6ac1">dnf</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#ff6ac1">name</span>: vsftpd
</span></span><span style="display:flex;"><span>        <span style="color:#ff6ac1">state</span>: latest
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    - <span style="color:#ff6ac1">name</span>: configure vsftpd configuration file
</span></span><span style="display:flex;"><span>      <span style="color:#ff6ac1">template</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#ff6ac1">src</span>: vsftpd.j2
</span></span><span style="display:flex;"><span>        <span style="color:#ff6ac1">dest</span>: /etc/vsftpd/vsftpd.conf
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>- <span style="color:#ff6ac1">name</span>: apply permissions
</span></span><span style="display:flex;"><span>  <span style="color:#ff6ac1">hosts</span>: ansible1
</span></span><span style="display:flex;"><span>  <span style="color:#ff6ac1">tasks</span>:
</span></span><span style="display:flex;"><span>    - <span style="color:#ff6ac1">name</span>: set folder permissions to /var/ftp/pub
</span></span><span style="display:flex;"><span>      <span style="color:#ff6ac1">file</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#ff6ac1">path</span>: /var/ftp/pub
</span></span><span style="display:flex;"><span>        <span style="color:#ff6ac1">mode</span>: <span style="color:#ff9f43">0777</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    - <span style="color:#ff6ac1">name</span>: set ftpd_anon_write boolean
</span></span><span style="display:flex;"><span>      <span style="color:#ff6ac1">seboolean</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#ff6ac1">name</span>: ftpd_anon_write
</span></span><span style="display:flex;"><span>        <span style="color:#ff6ac1">state</span>: <span style="color:#ff6ac1">yes</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ff6ac1">persistent</span>: <span style="color:#ff6ac1">yes</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    - <span style="color:#ff6ac1">name</span>: set public_content_rw_t SELinux context type to /var/ftp/pub directory
</span></span><span style="display:flex;"><span>      <span style="color:#ff6ac1">sefcontext</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#ff6ac1">target</span>: <span style="color:#5af78e">&#39;/var/ftp/pub(/.*)?&#39;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ff6ac1">setype</span>: public_content_rw_t
</span></span><span style="display:flex;"><span>        <span style="color:#ff6ac1">state</span>: present
</span></span><span style="display:flex;"><span>      <span style="color:#ff6ac1">notify</span>: restore selinux contexts
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    - <span style="color:#ff6ac1">name</span>: firewall stuff
</span></span><span style="display:flex;"><span>      <span style="color:#ff6ac1">firewalld</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#ff6ac1">service</span>: ftp
</span></span><span style="display:flex;"><span>        <span style="color:#ff6ac1">state</span>: enabled
</span></span><span style="display:flex;"><span>        <span style="color:#ff6ac1">permanent</span>: <span style="color:#ff6ac1">true</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ff6ac1">immediate</span>: <span style="color:#ff6ac1">true</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    - <span style="color:#ff6ac1">name</span>: start and enable fsftpd
</span></span><span style="display:flex;"><span>      <span style="color:#ff6ac1">service</span>: 
</span></span><span style="display:flex;"><span>        <span style="color:#ff6ac1">name</span>: vsftpd
</span></span><span style="display:flex;"><span>        <span style="color:#ff6ac1">state</span>: started
</span></span><span style="display:flex;"><span>        <span style="color:#ff6ac1">enabled</span>: <span style="color:#ff6ac1">yes</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#ff6ac1">handlers</span>:
</span></span><span style="display:flex;"><span>    - <span style="color:#ff6ac1">name</span>: restore selinux contexts
</span></span><span style="display:flex;"><span>      <span style="color:#ff6ac1">command</span>: restorecon -v /var/ftp/pub</span></span></code></pre></div>
<p>vsftpd.j2</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0"><code>{{ ansible_managed }}

anonymous_enable={{ anonymous_enable }}
local_enable={{ local_enable }}
write_enable={{ write_enable }}
Anon_upload_enable{{ Anon_upload_enable }}
local_umask=022
dirmessage_enable=YES
xferlog_enable=YES
connect_from_port_20=YES
xferlog_std_format=YES
listen=NO
listen_ipv6=YES
pam_service_name=vsftpd
userlist_enable=YES</code></pre></div>

  <footer class="footline">
  </footer>
</article>
<article class="default">
  <header class="headline">
  </header>

<h1 id="jinja2-templates">Jinja2 templates</h1>

<h3 id="managing-selinux-properties">Managing SELinux Properties</h3>
<ul>
<li>SELinux can be used on files to manage file context</li>
<li>context can be set on ports</li>
<li>SELinux properties can be managed using Booleans.</li>
</ul>
<p>Modules for Managing Changes on SELinux:
<strong>file</strong></p>
<ul>
<li>Manages context on files but not in the SELinux Policy
<strong>sefcontext</strong></li>
<li>Manages file context in the SELinux policy
<strong>command</strong></li>
<li>Is required to run the <code>restorecon</code> command after using sefcontext
<strong>selinux</strong></li>
<li>Manages current SELinux state
<strong>seboolean</strong></li>
<li>Manages SELinux Booleans</li>
</ul>
<h4 id="managing-selinux-file-context">Managing SELinux File Context</h4>
<ul>
<li>The context type that is set on the file defines which processes can work with the files.</li>
<li>The file context type can be set on a file directly, or it can be set on the SELinux policy.</li>
<li>All SELinux properties should be set in the SELinux policy.</li>
</ul>
<p><strong>sefcontext</strong> module.</p>
<ul>
<li>Setting a context type in the policy doesn&rsquo;t automatically apply it to files though.</li>
<li>You still need to run the Linux <code>restorecon</code> command to do this.</li>
<li>Ansible does not offer a module to run this command; it needs to be invoked using the command module.</li>
</ul>
<p><strong>file</strong> module</p>
<ul>
<li>Can set SELinux context.</li>
<li>The context is set directly on the file, not in the SELinux policy.</li>
<li>As a result, if at any time default context is applied from the policy to the file system, all context that has been set with the Ansible file module risks being overwritten.</li>
</ul>
<p><strong>policycoreutils-python-utils RPM</strong></p>
<ul>
<li>Not installed by default in all installation patterns.</li>
<li>Needed to be able to work with the Ansible sefcontext module and the Linux <code>restorecon</code> command</li>
</ul>
<h3 id="lab-managing-selinux-context-with-sefcontext">Lab Managing SELinux Context with sefcontext</h3>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yml" data-lang="yml"><span style="display:flex;"><span>---
</span></span><span style="display:flex;"><span>- <span style="color:#ff6ac1">name</span>: show selinux
</span></span><span style="display:flex;"><span>  <span style="color:#ff6ac1">hosts</span>: all
</span></span><span style="display:flex;"><span>  <span style="color:#ff6ac1">tasks</span>:
</span></span><span style="display:flex;"><span>  - <span style="color:#ff6ac1">name</span>: install required packages
</span></span><span style="display:flex;"><span>    <span style="color:#ff6ac1">yum</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#ff6ac1">name</span>: policycoreutils-python-utils
</span></span><span style="display:flex;"><span>      <span style="color:#ff6ac1">state</span>: present
</span></span><span style="display:flex;"><span>  - <span style="color:#ff6ac1">name</span>: create testfile
</span></span><span style="display:flex;"><span>    <span style="color:#ff6ac1">file</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#ff6ac1">name</span>: /tmp/selinux
</span></span><span style="display:flex;"><span>      <span style="color:#ff6ac1">state</span>: touch
</span></span><span style="display:flex;"><span>  - <span style="color:#ff6ac1">name</span>: set selinux context
</span></span><span style="display:flex;"><span>    <span style="color:#ff6ac1">sefcontext</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#ff6ac1">target</span>: /tmp/selinux
</span></span><span style="display:flex;"><span>      <span style="color:#ff6ac1">setype</span>: httpd_sys_content_t
</span></span><span style="display:flex;"><span>      <span style="color:#ff6ac1">state</span>: present
</span></span><span style="display:flex;"><span>    <span style="color:#ff6ac1">notify</span>:
</span></span><span style="display:flex;"><span>      - run restorecon
</span></span><span style="display:flex;"><span>  <span style="color:#ff6ac1">handlers</span>:
</span></span><span style="display:flex;"><span>    - <span style="color:#ff6ac1">name</span>: run restorecon
</span></span><span style="display:flex;"><span>      <span style="color:#ff6ac1">command</span>: restorecon -v /tmp/selinux</span></span></code></pre></div>
<ul>
<li>You might just have to configure a service with a nondefault documentroot, which means that SELinux will deny access to the service.</li>
<li>You should ask yourself if this task requires any changes at an SELinux level.</li>
</ul>
<h4 id="applying-generic-selinux-management-tasks">Applying Generic SELinux Management Tasks</h4>
<p><strong>selinux</strong> module</p>
<ul>
<li>enables you to set the current state of SELinux to either permissive, enforcing, or disabled.</li>
</ul>
<p><strong>seboolean</strong> module</p>
<ul>
<li>enables you to easily enable or disable functionality in SELinux using Booleans.</li>
</ul>
<h3 id="lab-changing-selinux-state-and-booleans">Lab: Changing SELinux State and Booleans</h3>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yml" data-lang="yml"><span style="display:flex;"><span>    ---
</span></span><span style="display:flex;"><span>    - <span style="color:#ff6ac1">name</span>: enabling SELinux and a boolean
</span></span><span style="display:flex;"><span>      <span style="color:#ff6ac1">hosts</span>: ansible1
</span></span><span style="display:flex;"><span>      <span style="color:#ff6ac1">vars</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#ff6ac1">myboolean</span>: httpd_read_user_content
</span></span><span style="display:flex;"><span>      <span style="color:#ff6ac1">tasks</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#ff6ac1">name</span>: enabling SELinux
</span></span><span style="display:flex;"><span>        <span style="color:#ff6ac1">selinux</span>:
</span></span><span style="display:flex;"><span>          <span style="color:#ff6ac1">policy</span>: targeted &lt;--- must specify policy
</span></span><span style="display:flex;"><span>          <span style="color:#ff6ac1">state</span>: enforcing
</span></span><span style="display:flex;"><span>      - <span style="color:#ff6ac1">name</span>: checking current {{ myboolean }} Boolean status
</span></span><span style="display:flex;"><span>        <span style="color:#ff6ac1">shell</span>: getsebool -a | grep {{ myboolean }}
</span></span><span style="display:flex;"><span>        <span style="color:#ff6ac1">register</span>: bool_stat
</span></span><span style="display:flex;"><span>      - <span style="color:#ff6ac1">name</span>: showing boolean status
</span></span><span style="display:flex;"><span>        <span style="color:#ff6ac1">debug</span>:
</span></span><span style="display:flex;"><span>          <span style="color:#ff6ac1">msg</span>: the current {{ myboolean }} status is {{ bool_stat.stdout }}
</span></span><span style="display:flex;"><span>      - <span style="color:#ff6ac1">name</span>: enabling boolean
</span></span><span style="display:flex;"><span>        <span style="color:#ff6ac1">seboolean</span>:
</span></span><span style="display:flex;"><span>          <span style="color:#ff6ac1">name</span>: <span style="color:#5af78e">&#34;{{ myboolean }}&#34;</span>
</span></span><span style="display:flex;"><span>          <span style="color:#ff6ac1">state</span>: <span style="color:#ff6ac1">yes</span>
</span></span><span style="display:flex;"><span>          <span style="color:#ff6ac1">persistent</span>: <span style="color:#ff6ac1">yes</span></span></span></code></pre></div>
<h3 id="lab-changing-selinux-context">Lab: Changing SELinux Context</h3>
<ul>
<li>Install, start, and configure a web server that has the DocumentRoot set to the /web directory.</li>
<li>In this directory, create a file named index.html that shows the message &ldquo;welcome to the webserver.&rdquo;</li>
<li>Ensure that SELinux is enabled and allows access to the web server document root.</li>
<li>Also ensure that SELinux allows users to publish web pages from their home directory.</li>
</ul>
<p>1. Start by creating a playbook outline. A good approach for doing this is to create the playbook play header and list all tasks that need to be accomplished by providing a name as well as the name of the task that you want to run.
2. Enable SELinux and set to the enforcing state.
3. Install the web server, start and enable it, create the /web directory, and create the index.html file in the /web directory.
4. Use the <strong>lineinfile</strong> module to change the httpd.conf contents. Two different lines need to be changed.
5. Configure the SELinux-specific settings.
6. Run the playbook and verify its output.
8. Verify that the web service is accessible by using <code>curl http://ansible1</code>. In this case, it should not work. Try to analyze why.</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yml" data-lang="yml"><span style="display:flex;"><span>---
</span></span><span style="display:flex;"><span>- <span style="color:#ff6ac1">name</span>: Managing web server SELinux properties
</span></span><span style="display:flex;"><span>  <span style="color:#ff6ac1">hosts</span>: ansible1
</span></span><span style="display:flex;"><span>  <span style="color:#ff6ac1">tasks</span>:
</span></span><span style="display:flex;"><span>  - <span style="color:#ff6ac1">name</span>: ensure SELinux is enabled and enforcing
</span></span><span style="display:flex;"><span>    <span style="color:#ff6ac1">selinux</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#ff6ac1">policy</span>: targeted
</span></span><span style="display:flex;"><span>      <span style="color:#ff6ac1">state</span>: enforcing
</span></span><span style="display:flex;"><span>  - <span style="color:#ff6ac1">name</span>: install the webserver
</span></span><span style="display:flex;"><span>    <span style="color:#ff6ac1">yum</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#ff6ac1">name</span>: httpd
</span></span><span style="display:flex;"><span>      <span style="color:#ff6ac1">state</span>: latest
</span></span><span style="display:flex;"><span>  - <span style="color:#ff6ac1">name</span>: start and enable the webserver
</span></span><span style="display:flex;"><span>    <span style="color:#ff6ac1">service</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#ff6ac1">name</span>: httpd
</span></span><span style="display:flex;"><span>      <span style="color:#ff6ac1">state</span>: started
</span></span><span style="display:flex;"><span>      <span style="color:#ff6ac1">enabled</span>: <span style="color:#ff6ac1">yes</span>
</span></span><span style="display:flex;"><span>  - <span style="color:#ff6ac1">name</span>: open the firewall service
</span></span><span style="display:flex;"><span>    <span style="color:#ff6ac1">firewalld</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#ff6ac1">service</span>: http
</span></span><span style="display:flex;"><span>      <span style="color:#ff6ac1">state</span>: enabled
</span></span><span style="display:flex;"><span>      <span style="color:#ff6ac1">immediate</span>: <span style="color:#ff6ac1">yes</span>
</span></span><span style="display:flex;"><span>  - <span style="color:#ff6ac1">name</span>: create the /web directory
</span></span><span style="display:flex;"><span>    <span style="color:#ff6ac1">file</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#ff6ac1">name</span>: /web
</span></span><span style="display:flex;"><span>      <span style="color:#ff6ac1">state</span>: directory
</span></span><span style="display:flex;"><span>  - <span style="color:#ff6ac1">name</span>: create the index.html file in /web
</span></span><span style="display:flex;"><span>    <span style="color:#ff6ac1">copy</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#ff6ac1">content</span>: ‚Äôwelcome to the exercise82 web server‚Äô
</span></span><span style="display:flex;"><span>      <span style="color:#ff6ac1">dest</span>: /web/index.html
</span></span><span style="display:flex;"><span>  - <span style="color:#ff6ac1">name</span>: use lineinfile to change webserver configuration
</span></span><span style="display:flex;"><span>    <span style="color:#ff6ac1">lineinfile</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#ff6ac1">path</span>: /etc/httpd/conf/httpd.conf
</span></span><span style="display:flex;"><span>      <span style="color:#ff6ac1">regexp</span>: ‚Äô^DocumentRoot &#34;/var/www/html&#34;‚Äô
</span></span><span style="display:flex;"><span>      <span style="color:#ff6ac1">line</span>: DocumentRoot &#34;/web&#34;
</span></span><span style="display:flex;"><span>    <span style="color:#ff6ac1">notify</span>: restart httpd
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  - <span style="color:#ff6ac1">name</span>: use lineinfile to change webserver security
</span></span><span style="display:flex;"><span>    <span style="color:#ff6ac1">lineinfile</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#ff6ac1">path</span>: /etc/httpd/conf/httpd.conf
</span></span><span style="display:flex;"><span>      <span style="color:#ff6ac1">regexp</span>: ‚Äô^&lt;Directory &#34;/var/www&#34;&gt;‚Äô
</span></span><span style="display:flex;"><span>      <span style="color:#ff6ac1">line</span>: ‚Äô&lt;Directory &#34;/web&#34;&gt;‚Äô
</span></span><span style="display:flex;"><span>  - <span style="color:#ff6ac1">name</span>: use sefcontext to set context on new documentroot
</span></span><span style="display:flex;"><span>    <span style="color:#ff6ac1">sefcontext</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#ff6ac1">target</span>: ‚Äô/web(/.*)?‚Äô
</span></span><span style="display:flex;"><span>      <span style="color:#ff6ac1">setype</span>: httpd_sys_content_t
</span></span><span style="display:flex;"><span>      <span style="color:#ff6ac1">state</span>: present
</span></span><span style="display:flex;"><span>  - <span style="color:#ff6ac1">name</span>: run the restorecon command
</span></span><span style="display:flex;"><span>    <span style="color:#ff6ac1">command</span>: restorecon -Rv /web
</span></span><span style="display:flex;"><span>  - <span style="color:#ff6ac1">name</span>: allow the web server to run user content
</span></span><span style="display:flex;"><span>    <span style="color:#ff6ac1">seboolean</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#ff6ac1">name</span>: httpd_read_user_content
</span></span><span style="display:flex;"><span>      <span style="color:#ff6ac1">state</span>: <span style="color:#ff6ac1">yes</span>
</span></span><span style="display:flex;"><span>      <span style="color:#ff6ac1">persistent</span>: <span style="color:#ff6ac1">yes</span>
</span></span><span style="display:flex;"><span>      
</span></span><span style="display:flex;"><span>  <span style="color:#ff6ac1">handlers</span>:
</span></span><span style="display:flex;"><span>    - <span style="color:#ff6ac1">name</span>: restart httpd
</span></span><span style="display:flex;"><span>      <span style="color:#ff6ac1">service</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#ff6ac1">name</span>: httpd
</span></span><span style="display:flex;"><span>        <span style="color:#ff6ac1">state</span>: restarted</span></span></code></pre></div>

  <footer class="footline">
  </footer>
</article>
          </section>
        </div>
      </main>
    </div>
    <script>
      window.MathJax = Object.assign( window.MathJax || {}, {
        tex: {
          inlineMath:  [['\\(', '\\)'], ['$',  '$']],  
          displayMath: [['\\[', '\\]'], ['$$', '$$']], 
        },
        options: {
          enableMenu: false 
        }
      }, JSON.parse("{}") );
    </script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="/js/js-yaml/js-yaml.min.js?1762528139" defer></script>
    <script src="/js/d3/d3-color.min.js?1762528139" defer></script>
    <script src="/js/d3/d3-dispatch.min.js?1762528139" defer></script>
    <script src="/js/d3/d3-drag.min.js?1762528139" defer></script>
    <script src="/js/d3/d3-ease.min.js?1762528139" defer></script>
    <script src="/js/d3/d3-interpolate.min.js?1762528139" defer></script>
    <script src="/js/d3/d3-selection.min.js?1762528139" defer></script>
    <script src="/js/d3/d3-timer.min.js?1762528139" defer></script>
    <script src="/js/d3/d3-transition.min.js?1762528139" defer></script>
    <script src="/js/d3/d3-zoom.min.js?1762528139" defer></script>
    <script src="https://unpkg.com/mermaid/dist/mermaid.min.js" defer></script>
    <script>
      window.relearn.themeUseMermaid = JSON.parse("{ \"theme\": \"default\" }");
    </script>
    <script src="/js/clipboard/clipboard.min.js?1762528139" defer></script>
    <script src="/js/perfect-scrollbar/perfect-scrollbar.min.js?1762528139" defer></script>
    <script src="/js/theme.min.js?1762528139" defer></script>
  </body>
</html>
