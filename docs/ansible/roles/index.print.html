<!DOCTYPE html>
<html lang="en-us" dir="ltr" itemscope itemtype="http://schema.org/Article" data-r-output-format="print">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="height=device-height, width=device-width, initial-scale=1.0, minimum-scale=1.0">
    <meta name="generator" content="Hugo 0.152.2">
    <meta name="generator" content="Relearn 8.2.0+d150cc8909ed7836ff5d545e76544f6923ffacf5">
    <meta name="description" content="Ansible Galaxy RolesAnsible RolesUsing RHEL System roles">
    <meta name="author" content="David Thomas">
    <meta name="twitter:card" content="summary">
    <meta name="twitter:title" content="Roles :: Linux Reader">
    <meta name="twitter:description" content="Ansible Galaxy RolesAnsible RolesUsing RHEL System roles">
    <meta property="og:url" content="http://linuxreader.com/ansible/roles/">
    <meta property="og:site_name" content="Linux Reader">
    <meta property="og:title" content="Roles :: Linux Reader">
    <meta property="og:description" content="Ansible Galaxy RolesAnsible RolesUsing RHEL System roles">
    <meta property="og:locale" content="en_us">
    <meta property="og:type" content="website">
    <meta itemprop="name" content="Roles :: Linux Reader">
    <meta itemprop="description" content="Ansible Galaxy RolesAnsible RolesUsing RHEL System roles">
    <meta itemprop="wordCount" content="9">
    <title>Roles :: Linux Reader</title>
    <link href="http://linuxreader.com/ansible/roles/" rel="canonical" type="text/html" title="Roles :: Linux Reader">
    <link href="/ansible/roles/index.xml" rel="alternate" type="application/rss+xml" title="Roles :: Linux Reader">
    <link href="/images/favicon.svg?1762527413" rel="icon" type="image/svg+xml">
    <link href="/css/auto-complete/auto-complete.min.css?1762527413" rel="stylesheet">
    <script src="/js/auto-complete/auto-complete.min.js?1762527413" defer></script>
    <script src="/js/search-lunr.min.js?1762527413" defer></script>
    <script src="/js/search.min.js?1762527413" defer></script>
    <script>
      window.relearn = window.relearn || {};
      window.relearn.index_js_url="/searchindex.en.js?1762527413";
    </script>
    <script src="/js/lunr/lunr.min.js?1762527413" defer></script>
    <script src="/js/lunr/lunr.stemmer.support.min.js?1762527413" defer></script>
    <script src="/js/lunr/lunr.multi.min.js?1762527413" defer></script>
    <script src="/js/lunr/lunr.en.min.js?1762527413" defer></script>
    <script>
      window.relearn = window.relearn || {};
      window.relearn.contentLangs=['en'];
    </script>
    <link href="/fonts/fontawesome/css/fontawesome-all.min.css?1762527413" rel="stylesheet" media="print" onload="this.media='all';this.onload=null;"><noscript><link href="/fonts/fontawesome/css/fontawesome-all.min.css?1762527413" rel="stylesheet"></noscript>
    <link href="/css/perfect-scrollbar/perfect-scrollbar.min.css?1762527413" rel="stylesheet">
    <link href="/css/theme.min.css?1762527413" rel="stylesheet">
    <link href="/css/format-print.min.css?1762527413" rel="stylesheet" id="R-format-style">
    <script>
      window.relearn = window.relearn || {};
      // configuration
      window.relearn.min = `.min`;
      window.relearn.path='\/ansible\/roles\/';
      window.relearn.relBasePath='..\/..';
      window.relearn.relBaseUri='..\/..';
      window.relearn.absBaseUri='http:\/\/linuxreader.com';
      window.relearn.disableAnchorCopy=false;
      window.relearn.disableAnchorScrolling=false;
      window.relearn.disableInlineCopyToClipboard=true;
      window.relearn.enableBlockCodeWrap=true;
      // legal
      window.relearn.getItem = (s,n) => {return s.getItem(n)};
      window.relearn.setItem = (s,n,v) => {return s.setItem(n,v)};
      window.relearn.removeItem = (s,n) => {return s.removeItem(n)};
      // translations
      window.T_Copy_to_clipboard = `Copy to clipboard`;
      window.T_Copied_to_clipboard = `Copied to clipboard!`;
      window.T_Copy_link_to_clipboard = `Copy link to clipboard`;
      window.T_Link_copied_to_clipboard = `Copied link to clipboard!`;
      window.T_Reset_view = `Reset view`;
      window.T_View_reset = `View reset!`;
      window.T_No_results_found = `No results found for "{0}"`;
      window.T_N_results_found = `{1} results found for "{0}"`;
      // variant stuff
      window.relearn.themevariants = [ 'oled' ];
      window.relearn.customvariantname = "my-custom-variant";
      window.relearn.changeVariant = function(variant) {
        var oldVariant = document.documentElement.dataset.rThemeVariant;
        window.relearn.setItem(window.localStorage, window.relearn.absBaseUri + "/variant", variant);
        document.documentElement.dataset.rThemeVariant = variant;
        if (oldVariant != variant) {
          document.dispatchEvent( new CustomEvent('themeVariantLoaded', { detail: { variant, oldVariant } }) );
          window.relearn.markVariant();
        }
      }
      window.relearn.markVariant = function() {
        var variant = window.relearn.getItem(window.localStorage, window.relearn.absBaseUri + "/variant");
        document.querySelectorAll(".R-variantswitcher select").forEach((select) => {select.value = variant;});
      }
      window.relearn.initVariant = function() {
        var variant = window.relearn.getItem(window.localStorage, window.relearn.absBaseUri + "/variant") ?? "";
        if( variant == window.relearn.customvariantname ){
        }else if( !variant || !window.relearn.themevariants.includes(variant) ){
          variant = window.relearn.themevariants[0];
          window.relearn.setItem(window.localStorage, window.relearn.absBaseUri + "/variant", variant);
        }
        document.documentElement.dataset.rThemeVariant = variant;
      }
      window.relearn.initVariant();
      window.relearn.markVariant();
    </script><style>
:root {
    --MENU-WIDTH-S: 14.375rem;
    --MENU-WIDTH-M: 14.375rem;
    --MENU-WIDTH-L: 18.75rem;
    --MAIN-WIDTH-MAX: 80rem;
    font-size: 1.2rem;
}
</style>

  </head>
  <body class="mobile-support print" data-url="/ansible/roles/">
    <div id="R-body" class="default-animation">
      <div id="R-body-overlay"></div>
      <nav id="R-topbar">
        <div class="topbar-wrapper">
          <div class="topbar-sidebar-divider"></div>
          <div class="topbar-area topbar-area-start" data-area="start">
            <div class="topbar-button topbar-button-sidebar" data-content-empty="disable" data-width-s="show" data-width-m="hide" data-width-l="hide">
<span class="btn cstyle link noborder notitle interactive"><button onclick="toggleNav()" type="button" title="Menu (CTRL&#43;ALT&#43;n)"><i class="fa-fw fas fa-bars"></i></button></span>
            </div>
            <div class="topbar-button topbar-button-prev" data-content-empty="disable" data-width-s="show" data-width-m="show" data-width-l="show">
<span class="btn cstyle link noborder notitle interactive"><a href="/ansible/playbooks/including-and-importing-files/" title="Including and importing Files (ðŸ¡)"><i class="fa-fw fas fa-chevron-left"></i></a></span>
            </div>

            <div class="topbar-button topbar-button-toc" data-content-empty="hide" data-width-s="show" data-width-m="show" data-width-l="show">
<span class="btn cstyle link noborder notitle interactive"><button onclick="toggleTopbarFlyout(this)" type="button" title="Table of Contents (CTRL&#43;ALT&#43;t)"><i class="fa-fw fas fa-list-alt"></i></button></span>
              <div class="topbar-content">
                <div class="topbar-content-wrapper"> 
                </div>
              </div>
            </div>


          </div>
          <span class="topbar-breadcrumbs highlightable">
            Roles
          </span>
          <div class="topbar-area topbar-area-end" data-area="end">
            <div class="topbar-button topbar-button-print" data-content-empty="disable" data-width-s="area-more" data-width-m="show" data-width-l="show">
<span class="btn cstyle link noborder notitle interactive"><a href="/ansible/roles/index.print.html" title="Print whole chapter (CTRL+ALT+p)"><i class="fa-fw fas fa-print"></i></a></span>
            </div>

            <div class="topbar-button topbar-button-next" data-content-empty="disable" data-width-s="show" data-width-m="show" data-width-l="show">
<span class="btn cstyle link noborder notitle interactive"><a href="/ansible/roles/ansible-galaxy-roles/" title="Ansible Galaxy Roles (ðŸ¡’)"><i class="fa-fw fas fa-chevron-right"></i></a></span>
            </div>







          </div>
        </div>
      </nav>
      <div id="R-main-overlay"></div>
      <main id="R-body-inner" class="highlightable ansible" tabindex="-1">
        <div class="flex-block-wrapper">
<article class="default">
  <header class="headline">
  </header>

<h1 id="roles">Roles</h1>

<div class="children children-type-card children-sort-"><ul class="card-container">
<li>
  <article class="card card-popout" aria-labelledby="R-card-372749c138562637304ba0534c57a09c">
    <div class="card-content">
      <div class="card-title" id="R-card-372749c138562637304ba0534c57a09c">
        <a href="/ansible/roles/ansible-galaxy-roles/">
        Ansible Galaxy Roles
        </a>
      </div>
      <div class="card-content-text">
          <!-- raw HTML omitted -->

      </div>
    </div>
  </article>
</li>
<li>
  <article class="card card-popout" aria-labelledby="R-card-b5f5ecfba72a4b2a9170c483b1c49e79">
    <div class="card-content">
      <div class="card-title" id="R-card-b5f5ecfba72a4b2a9170c483b1c49e79">
        <a href="/ansible/roles/using-ansible-roles/">
        Ansible Roles
        </a>
      </div>
      <div class="card-content-text">
          <!-- raw HTML omitted -->

      </div>
    </div>
  </article>
</li>
<li>
  <article class="card card-popout" aria-labelledby="R-card-cdbc9a2d2b2f5e933dd2f915086e5e3a">
    <div class="card-content">
      <div class="card-title" id="R-card-cdbc9a2d2b2f5e933dd2f915086e5e3a">
        <a href="/ansible/roles/using-rhel-system-roles/">
        Using RHEL System roles
        </a>
      </div>
      <div class="card-content-text">
          <!-- raw HTML omitted -->

      </div>
    </div>
  </article>
</li>
</ul>
</div>

  <footer class="footline">
  </footer>
</article>
          <section>
            <h1 class="a11y-only">Subsections of Roles</h1>
<article class="default">
  <header class="headline">
  </header>

<h1 id="ansible-galaxy-roles">Ansible Galaxy Roles</h1>

<h3 id="using-ansible-galaxy-roles">Using Ansible Galaxy Roles</h3>
<ul>
<li>Ansible Galaxy is a public library of Ansible content and contains thousands of roles that have been provided by community members.</li>
</ul>
<h4 id="working-with-galaxy">Working with Galaxy</h4>
<p>The easiest way to work with Ansible Galaxy is to use the website at <a href="https://galaxy.ansible.com" rel="external" target="_blank">https://galaxy.ansible.com</a>:</p>
<p><a href="#R-image-9b104cd73168ecacea5d61d37404368f" class="lightbox-link"><img alt="Image" class="lazy lightbox figure-image" loading="lazy" src="/Images/2436_09fig01.jpg" style="height: auto;width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-9b104cd73168ecacea5d61d37404368f"><img alt="Image" class="lazy lightbox lightbox-image" loading="lazy" src="/Images/2436_09fig01.jpg"></a></p>
<p><a href="#R-image-e17c4796a9c64396484f8748ddf4e576" class="lightbox-link"><img alt="Image" class="lazy lightbox figure-image" loading="lazy" src="/Images/2436_09fig02.jpg" style="height: auto;width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-e17c4796a9c64396484f8748ddf4e576"><img alt="Image" class="lazy lightbox lightbox-image" loading="lazy" src="/Images/2436_09fig02.jpg"></a></p>
<ul>
<li>
<p>Use the Search Feature to Search for Specific Packages</p>
</li>
<li>
<p>In the result of any Search action, you see a list of collections as well as a list of roles.</p>
</li>
<li>
<p>An Ansible Galaxy collection is a distribution format for Ansible content.</p>
</li>
<li>
<p>It can contain roles, but also playbooks, modules, and plug-ins.</p>
</li>
<li>
<p>In most cases you just need the roles, not the collection: roles contain all that you include in the playbooks you&rsquo;re working with.</p>
</li>
<li>
<p>Some important indicators are the number of times the role has been downloaded and the score of the role.</p>
</li>
<li>
<p>This information enables you to easily distinguish between commonly used roles and roles that are not used that often.</p>
</li>
<li>
<p>Also, you can use tags to make identifying Galaxy roles easier.</p>
</li>
<li>
<p>These tags provide more information about a role and make it  possible to search for roles in a more efficient way.</p>
</li>
</ul>
<p><a href="#R-image-1208c3052fb499c99906281340e29285" class="lightbox-link"><img alt="Image" class="lazy lightbox figure-image" loading="lazy" src="/Images/2436_09fig03.jpg" style="height: auto;width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-1208c3052fb499c99906281340e29285"><img alt="Image" class="lazy lightbox lightbox-image" loading="lazy" src="/Images/2436_09fig03.jpg"></a></p>
<ul>
<li>You can download roles directly from the Ansible Galaxy website</li>
<li>You can also use the <code>ansible-galaxy</code> command</li>
</ul>
<h4 id="using-the-ansible-galaxy-command">Using the <code>ansible-galaxy</code> Command</h4>
<p><code>ansible-galaxy search</code></p>
<ul>
<li>Find roles based on many different keywords and manage them.</li>
<li>Must provide a string as an argument.</li>
<li>Ansible searches for this string in the name and description of the roles.</li>
</ul>
<p>Useful Command-Line Options:
<strong>&ndash;platforms</strong></p>
<ul>
<li>Operating system platform to search for
<strong>&ndash;author</strong></li>
<li>GitHub username of the author
<strong>&ndash;galaxy-tags</strong></li>
<li>Additional tags to filter by</li>
</ul>
<p>`ansible-galaxy info</p>
<ul>
<li>Get more information about a role.</li>
</ul>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#ff6ac1">[</span>ansible@control ansible-lab<span style="color:#ff6ac1">]</span>$ ansible-galaxy info geerlingguy.docker
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Role: geerlingguy.docker
</span></span><span style="display:flex;"><span>        description: Docker <span style="color:#ff6ac1">for</span> Linux.
</span></span><span style="display:flex;"><span>        commit: 9115e969c1e57a1639160d9af3477f09734c94ac
</span></span><span style="display:flex;"><span>        commit_message: Merge pull request <span style="color:#78787e">#501 from adamus1red/adamus1red/alpine-compose</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>add compose package to Alpine specific variables
</span></span><span style="display:flex;"><span>        created: 2023-05-08T20:49:45.679874Z
</span></span><span style="display:flex;"><span>        download_count: <span style="color:#ff9f43">23592264</span>
</span></span><span style="display:flex;"><span>        github_branch: master
</span></span><span style="display:flex;"><span>        github_repo: ansible-role-docker
</span></span><span style="display:flex;"><span>        github_user: geerlingguy
</span></span><span style="display:flex;"><span>        id: <span style="color:#ff9f43">10923</span>
</span></span><span style="display:flex;"><span>        imported: 2025-03-24T00:01:45.901567
</span></span><span style="display:flex;"><span>        modified: 2025-03-24T00:01:47.840887Z
</span></span><span style="display:flex;"><span>        path: <span style="color:#ff6ac1">(</span><span style="color:#5af78e">&#39;/home/ansible/.ansible/roles&#39;</span>, <span style="color:#5af78e">&#39;/usr/share/ansible/roles&#39;</span>, <span style="color:#5af78e">&#39;/etc/ansible/roles&#39;</span><span style="color:#ff6ac1">)</span>
</span></span><span style="display:flex;"><span>        upstream_id: None
</span></span><span style="display:flex;"><span>        username: geerlingguy</span></span></code></pre></div>
<h4 id="managing-ansible-galaxy-roles">Managing Ansible Galaxy Roles</h4>
<p><code>ansible-galaxy install</code></p>
<ul>
<li>Install a role</li>
<li>normally installs the role into the ~/.ansible/roles directory because this role is specified in the <strong>role_path</strong> setting in ansible.cfg.</li>
<li>If you want roles to be installed in another directory, consider changing this parameter.
<code>-p</code></li>
<li>option to install the role to a different role path directory.</li>
</ul>
<p><strong>requirements</strong> file.</p>
<ul>
<li>YAML file that you can include when using the <code>ansible-roles</code> command.</li>
</ul>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yml" data-lang="yml"><span style="display:flex;"><span>    - <span style="color:#ff6ac1">src</span>: geerlingguy.nginx
</span></span><span style="display:flex;"><span>      <span style="color:#ff6ac1">version</span>: <span style="color:#5af78e">&#34;2.7.0&#34;</span></span></span></code></pre></div>
<ul>
<li>possible to add roles from sources other than Ansible Galaxy, such as a Git repository or a tarball.</li>
<li>In that case, you must specify the exact URL to the role using the <code>src</code> option.</li>
<li>When you are installing roles from a Git repository, the <code>scm</code> keyword is also required and must be set to <code>git</code>.</li>
</ul>
<p>To install a role using the requirements file, you can use the <code>-r</code> option with the <code>ansible-galaxy install</code> command:
<code>ansible-galaxy install -r roles/requirements.yml</code></p>
<p><code>ansible-galaxy list</code></p>
<ul>
<li>Get a list of currently installed roles</li>
</ul>
<p><code>ansible-galaxy remove</code></p>
<ul>
<li>Remove roles from your system.</li>
</ul>
<h3 id="lab-using-ansible-galaxy-to-manage-roles">LAB: Using <code>ansible-galaxy</code> to Manage Roles</h3>
<ul>
<li>Type <code>ansible-galaxy search --author geerlingguy --platforms EL</code> to see a list of roles that geerlingguy has created.</li>
<li>Make the command more specific and type <code>ansible-galaxy search nginx --author geerlingguy --platforms EL</code> to find the <strong>geerlingguy.nginx</strong> role.</li>
<li>Request more information about this role by using <code>ansible-galaxy info geerlingguy.nginx</code>.</li>
<li>Create a requirements file with the name <strong>listing96.yaml</strong> and give this file the following contents:</li>
</ul>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yml" data-lang="yml"><span style="display:flex;"><span>- <span style="color:#ff6ac1">src</span>: geerlingguy.nginx
</span></span><span style="display:flex;"><span>  <span style="color:#ff6ac1">version</span>: <span style="color:#5af78e">&#34;2.7.0&#34;</span></span></span></code></pre></div>
<ul>
<li>
<p>Add the line <code>roles_path = /home/ansible/roles</code> to the ansible.cfg file.</p>
</li>
<li>
<p>Use the command <code>ansible-galaxy install -r listing96.yaml</code> to install the role from the requirements file. It is possible that by the time you run this exercise, the specified version 2.7.0 is no longer available. If that is the case, use <code>ansible-galaxy info</code> again to find a version that still is available, and change the requirements file accordingly.</p>
</li>
<li>
<p>Type <code>ansible-galaxy list</code> to verify that the new role was successfully installed on your system.</p>
</li>
<li>
<p>Write a playbook with the name exercise92.yaml that uses the role and has the following contents:</p>
</li>
</ul>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yml" data-lang="yml"><span style="display:flex;"><span>---
</span></span><span style="display:flex;"><span>- <span style="color:#ff6ac1">name</span>: install nginx using Galaxy role
</span></span><span style="display:flex;"><span>  <span style="color:#ff6ac1">hosts</span>: ansible2
</span></span><span style="display:flex;"><span>  <span style="color:#ff6ac1">roles</span>:
</span></span><span style="display:flex;"><span>  - geerlingguy.nginx</span></span></code></pre></div>
<ul>
<li>Run the playbook using <code>ansible-playbook exercise92.yaml</code> and observe that the new role is installed from the custom roles path.</li>
</ul>

  <footer class="footline">
  </footer>
</article>
<article class="default">
  <header class="headline">
  </header>

<h1 id="ansible-roles">Ansible Roles</h1>

<p>Work with roles and Create roles</p>
<h3 id="using-ansible-roles">Using Ansible Roles</h3>
<ul>
<li>Ready-to-use playbook-based Ansible solutions that you can easily include in your own playbooks.</li>
<li>Community roles are provided through Ansible Galaxy</li>
<li>Also possible to create your own roles.</li>
<li>Red Hat provides RHEL System Roles.</li>
<li>Roles make it possible to provide Ansible code in a reusable way.</li>
<li>You can easily define a specific task in a role, and after defining it in a role, you can easily redistribute that and ensure that tasks are handled the same way, no matter where they are executed.</li>
<li>Roles can be custom-made for specific environments, or default roles provided from Ansible Galaxy can be used.</li>
</ul>
<h4 id="understanding-ansible-roles">Understanding Ansible Roles</h4>
<ul>
<li>work with include files.</li>
<li>All the different components that you may use in a playbook are used in roles and stored in separate directories.</li>
<li>While defining the role, you don&rsquo;t need to tell the role that it should look in some of these specific directories; it does that automatically.</li>
<li>The only thing you need to do is tell your Ansible playbook that it should include a role.</li>
<li>Different components of the role are stored in different subdirectories.</li>
</ul>
<p>Roles Sample Directory Structure:</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0"><code>    [ansible@control roles]$ tree testrole/
    testrole/
    |-- defaults
    |   `-- main.yml
    |-- files
    |-- handlers
    |   `-- main.yml
    |-- meta
    |   `-- main.yml
    |-- README.md
    |-- tasks
    |   `-- main.yml
    |-- templates
    |-- tests
    |   |-- inventory
    |   `-- test.yml
    `-- vars
        `-- main.yml</code></pre></div>
<p>Role Directory Structure
<strong>defaults</strong></p>
<ul>
<li>
<p>Default variables that may be overwritten by other variables
<strong>files</strong></p>
</li>
<li>
<p>Static files that are needed by role tasks
<strong>handlers</strong></p>
</li>
<li>
<p>Handlers for use in this role
<strong>meta</strong></p>
</li>
<li>
<p>metadata, such as dependencies, plus license and maintainer information
<strong>tasks</strong></p>
</li>
<li>
<p>Role task definitions
<strong>templates</strong></p>
</li>
<li>
<p>Jinja2 templates
<strong>tests</strong></p>
</li>
<li>
<p>Optional inventory and a test.yml file to test the role
<strong>vars</strong></p>
</li>
<li>
<p>Variables that are not meant to be overwritten</p>
</li>
<li>
<p>Most of the role directories have a main.yml file.</p>
</li>
<li>
<p>This is the entry-point YAML file that is used to define components in the role.</p>
</li>
</ul>
<h4 id="understanding-role-location">Understanding Role Location</h4>
<p>Roles can be stored in different locations:</p>
<p><strong>./roles</strong></p>
<ul>
<li>store roles in the current project directory.</li>
<li>highest precedence.</li>
</ul>
<p><strong>~/.ansible/roles</strong></p>
<ul>
<li>exists in the current user home directory and makes the role available to the current user only.</li>
<li>second-highest precedence.</li>
</ul>
<p><strong>/etc/ansible/roles</strong></p>
<ul>
<li>Where roles are stored to make them accessible to any user.</li>
</ul>
<p><strong>/usr/share/ansible/roles</strong></p>
<ul>
<li>Where roles are stored after they are installed from RPM files.</li>
<li>lowest precedence</li>
<li>should not be used for storing custom-made roles.</li>
</ul>
<p><code>ansible-galaxy init { newrolename }</code></p>
<ul>
<li>create a custom role</li>
<li>creates the default role directory structure with a main.yml file</li>
<li>includes sample files</li>
</ul>
<h4 id="using-roles-from-playbooks">Using Roles from Playbooks</h4>
<ul>
<li>Call roles in a playbook the same way you call a task</li>
<li>Roles are included as a list.</li>
</ul>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yml" data-lang="yml"><span style="display:flex;"><span>    ---
</span></span><span style="display:flex;"><span>    - <span style="color:#ff6ac1">name</span>: include some roles
</span></span><span style="display:flex;"><span>      <span style="color:#ff6ac1">roles</span>:
</span></span><span style="display:flex;"><span>      - role1
</span></span><span style="display:flex;"><span>      - role2</span></span></code></pre></div>
<ul>
<li>Roles are executed before the tasks.</li>
<li>In specific cases you might have to execute tasks before the roles. To do so, you can specify these tasks in a <strong>pre_tasks</strong> section.</li>
<li>Also, it&rsquo;s possible to use the <strong>post_tasks</strong> section to include tasks that will be executed after the roles, but also after tasks specified in the playbook as well as the handlers they call.</li>
</ul>
<h4 id="creating-custom-roles">Creating Custom Roles</h4>
<ul>
<li>Use <code>mkdir roles</code> to create a roles subdirectory in the current directory, and use <code>cd roles</code> to get into that subdirectory.</li>
<li>Use <code>ansible-galaxy init motd</code> to create the motd role structure.</li>
<li>Add contents to <strong>motd/tasks/main.yml</strong></li>
<li>Add contents to motd/templates/motd.j2</li>
<li>Add contents to <strong>motd/defaults/main.yml</strong></li>
<li>Add contents to <strong>motd/meta/main.yml</strong></li>
<li>Create the playbook <strong>exercise91.yaml</strong> to run the role</li>
<li>Run the playbook by using <code>ansible-playbook exercise91.yaml</code></li>
<li>Verify that modifications have been applied correctly by using the ad hoc command <code>ansible ansible2 -a &quot;cat /etc/motd&quot;</code></li>
</ul>
<p>Sample role all under <strong>roles/motd/</strong>:</p>
<p><strong>defaults/main.yml</strong></p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yml" data-lang="yml"><span style="display:flex;"><span>---
</span></span><span style="display:flex;"><span><span style="color:#78787e"># defaults file for motd</span>
</span></span><span style="display:flex;"><span><span style="color:#ff6ac1">system_manager</span>: anna@example.com</span></span></code></pre></div>
<p><strong>meta/main.yml</strong></p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yml" data-lang="yml"><span style="display:flex;"><span><span style="color:#ff6ac1">galaxy_info</span>:
</span></span><span style="display:flex;"><span><span style="color:#ff6ac1">author</span>: Sander van V
</span></span><span style="display:flex;"><span><span style="color:#ff6ac1">description</span>: your description
</span></span><span style="display:flex;"><span><span style="color:#ff6ac1">company</span>: your company (optional)
</span></span><span style="display:flex;"><span><span style="color:#ff6ac1">license</span>: license (GPLv2, CC-BY, etc)
</span></span><span style="display:flex;"><span><span style="color:#ff6ac1">min_ansible_version</span>: <span style="color:#ff9f43">2.5</span></span></span></code></pre></div>
<p><strong>tasks/main.yml</strong></p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yml" data-lang="yml"><span style="display:flex;"><span>---
</span></span><span style="display:flex;"><span>tasks file for motd
</span></span><span style="display:flex;"><span>- <span style="color:#ff6ac1">name</span>: copy motd file
</span></span><span style="display:flex;"><span>  <span style="color:#ff6ac1">template</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#ff6ac1">src</span>: templates/motd.j2
</span></span><span style="display:flex;"><span>    <span style="color:#ff6ac1">dest</span>: /etc/motd
</span></span><span style="display:flex;"><span>    <span style="color:#ff6ac1">owner</span>: root
</span></span><span style="display:flex;"><span>    <span style="color:#ff6ac1">group</span>: root
</span></span><span style="display:flex;"><span>    <span style="color:#ff6ac1">mode</span>: <span style="color:#ff9f43">0444</span></span></span></code></pre></div>
<p><strong>templates/motd.j2</strong></p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0"><code>Welcome to {{ ansible_hostname }}
    
This file was created on {{ ansible_date_time.date }}
Disconnect if you have no business being here
    
Contact {{ system_manager }} if anything is wrong</code></pre></div>
<p>Playbook <strong>motd.yml</strong>:</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yml" data-lang="yml"><span style="display:flex;"><span>---
</span></span><span style="display:flex;"><span>- <span style="color:#ff6ac1">name</span>: use the motd role playbook
</span></span><span style="display:flex;"><span>  <span style="color:#ff6ac1">hosts</span>: ansible2
</span></span><span style="display:flex;"><span>  <span style="color:#ff6ac1">roles</span>:
</span></span><span style="display:flex;"><span>  - <span style="color:#ff6ac1">role</span>: motd
</span></span><span style="display:flex;"><span>    <span style="color:#ff6ac1">system_manager</span>: bob@example.com</span></span></code></pre></div>
<p>handlers/main.yml example:</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yml" data-lang="yml"><span style="display:flex;"><span>---
</span></span><span style="display:flex;"><span><span style="color:#78787e"># handlers file for base-config</span>
</span></span><span style="display:flex;"><span>  - <span style="color:#ff6ac1">name</span>: source profile
</span></span><span style="display:flex;"><span>    <span style="color:#ff6ac1">command</span>: source /etc/profile
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  - <span style="color:#ff6ac1">name</span>: source bash
</span></span><span style="display:flex;"><span>    <span style="color:#ff6ac1">command</span>: source /etc/bash.bashrc                               </span></span></code></pre></div>
<h4 id="managing-role-dependencies">Managing Role Dependencies</h4>
<ul>
<li>Roles may use other roles as a dependency.</li>
<li>You can put role dependencies in meta/main.yml</li>
<li>Dependent roles are always executed before the roles that depend on them.</li>
<li>Dependent roles are executed once.</li>
<li>When two roles that are used in a playbook call the same dependency, the dependent role is executed once only.</li>
<li>When calling dependent roles, it is possible to pass variables to the dependent role.</li>
<li>You can define a <strong>when</strong> statement to ensure that the dependent role is executed only in specific situations.</li>
</ul>
<p>Defining dependencies in <strong>meta/main.yml</strong></p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yml" data-lang="yml"><span style="display:flex;"><span>    <span style="color:#ff6ac1">dependencies</span>:
</span></span><span style="display:flex;"><span>    - <span style="color:#ff6ac1">role</span>: apache
</span></span><span style="display:flex;"><span>      <span style="color:#ff6ac1">port</span>: <span style="color:#ff9f43">8080</span>
</span></span><span style="display:flex;"><span>    - <span style="color:#ff6ac1">role</span>: mariabd
</span></span><span style="display:flex;"><span>      <span style="color:#ff6ac1">when</span>: environment == â€™productionâ€™</span></span></code></pre></div>
<h4 id="understanding-file-organization-best-practices">Understanding File Organization Best Practices</h4>
<ul>
<li>
<p>Working with roles splits the contents of the role off the tasks that are run through the playbook.</p>
</li>
<li>
<p>Splitting files to store them in a location that makes sense is common in Ansible</p>
</li>
<li>
<p>When you&rsquo;re working with Ansible, it&rsquo;s a good idea to work with project directories in bigger environments.</p>
</li>
<li>
<p>Working with project directories makes it easier to delegate tasks and have the right people responsible for the right things.</p>
</li>
<li>
<p>Each project directory may have its own ansible.cfg file, inventory file, and playbooks.</p>
</li>
<li>
<p>If the project grows bigger, variable files and other include files may be used, and they are normally stored in subdirectories.</p>
</li>
<li>
<p>At the top-level directory, create the main playbook from which other playbooks are included. The suggested name for the main playbook is <strong>site.yml</strong>.</p>
</li>
<li>
<p>Use <strong>group_vars/</strong> and <strong>host_vars/</strong> to set host-related variables and do not define them in inventory.</p>
</li>
<li>
<p>Consider using different inventory files to differentiate between production and staging phases.</p>
</li>
<li>
<p>Use roles to standardize common tasks.</p>
</li>
</ul>
<p>When you are working with roles, some additional recommendations apply:</p>
<ul>
<li>
<p>Use a version control repository to maintain roles in a consistent way. Git is commonly used for this purpose.</p>
</li>
<li>
<p>Sensitive information should never be included in roles. Use Ansible Vault to store sensitive information in an encrypted way.</p>
</li>
<li>
<p>Use <code>ansible-galaxy init</code> to create the role base structure. Remove files and directories you don&rsquo;t use.</p>
</li>
<li>
<p>Don&rsquo;t forget to provide additional information in the role&rsquo;s <strong>README.md</strong> and <strong>meta/main.yml</strong> files.</p>
</li>
<li>
<p>Keep roles focused on a specific function. It is better to use multiple roles to perform multiple tasks.</p>
</li>
<li>
<p>Try to develop roles in a generic way, such that they can be used for multiple purposes.</p>
</li>
</ul>
<h3 id="lab-9-1">Lab 9-1</h3>
<p>Create a playbook that starts the Nginx web server on ansible1, according to the following requirements:
â€¢ A requirements file must be used to install the Nginx web server. Do NOT use the latest version of the Galaxy role, but instead use the version before that.
â€¢ The same requirements file must also be used to install the latest version of postgresql.
â€¢ The playbook needs to ensure that neither httpd nor mysql is currently installed.</p>
<h3 id="lab-9-2">Lab 9-2</h3>
<p>Use the RHEL SELinux System Role to manage SELinux properties according
to the following requirements:</p>
<p>â€¢ A Boolean is set to allow SELinux relabeling to be automated using
cron.
â€¢ The directory /var/ftp/uploads is created, permissions are set to 777,
and the context label is set to public_content_rw_t.
â€¢ SELinux should allow web servers to use port 82 instead of port 80.
â€¢ SELinux is in enforcing state.
Subjects:
<code>ansible-playbook timesync.yaml</code> to run the playbook. Observe its output. Notice that some messages in red are shown, but these can safely be ignored.</p>
<p>5. Use <code>ansible ansible2 -a &quot;timedatectl show&quot;</code> and notice that the <strong>timezone</strong> variable is set to UTC.</p>
<h3 id="lab-9-1-1">Lab 9-1</h3>
<p>Create a playbook that starts the Nginx web server on ansible1, according to the following requirements:
â€¢ A requirements file must be used to install the Nginx web server. Do NOT use the latest version of the Galaxy role, but instead use the version before that.
â€¢ The same requirements file must also be used to install the latest version of postgresql.
<code>ansible-galaxy install -r roles/requirements.yml</code></p>
<p><code>cat roles/requirements.yml</code></p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yml" data-lang="yml"><span style="display:flex;"><span>- <span style="color:#ff6ac1">src</span>: geerlingguy.nginx
</span></span><span style="display:flex;"><span>  <span style="color:#ff6ac1">version</span>: <span style="color:#5af78e">&#34;3.1.4&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>- <span style="color:#ff6ac1">src</span>: geerlingguy.postgresql</span></span></code></pre></div>
<p>â€¢ The playbook needs to ensure that neither httpd nor mysql is currently installed.</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yml" data-lang="yml"><span style="display:flex;"><span>---
</span></span><span style="display:flex;"><span>- <span style="color:#ff6ac1">name</span>: ensure conflicting packages are not installed
</span></span><span style="display:flex;"><span>  <span style="color:#ff6ac1">hosts</span>: web1
</span></span><span style="display:flex;"><span>  <span style="color:#ff6ac1">tasks</span>:
</span></span><span style="display:flex;"><span>  - <span style="color:#ff6ac1">name</span>: remove packages
</span></span><span style="display:flex;"><span>    <span style="color:#ff6ac1">yum</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#ff6ac1">name</span>: 
</span></span><span style="display:flex;"><span>      - mysql
</span></span><span style="display:flex;"><span>      - httpd
</span></span><span style="display:flex;"><span>      <span style="color:#ff6ac1">state</span>: absent
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>- <span style="color:#ff6ac1">name</span>: nginx web server
</span></span><span style="display:flex;"><span>  <span style="color:#ff6ac1">hosts</span>: web1
</span></span><span style="display:flex;"><span>  <span style="color:#ff6ac1">roles</span>: 
</span></span><span style="display:flex;"><span>  - geerlingguy.nginx
</span></span><span style="display:flex;"><span>  - geerlingguy.postgresql</span></span></code></pre></div>
<p>(Had to add a variable file for redhat 10 into the role. )</p>
<h3 id="lab-9-2-1">Lab 9-2</h3>
<p>Use the RHEL SELinux System Role to manage SELinux properties according to the following requirements:</p>
<p>â€¢ A Boolean is set to allow SELinux relabeling to be automated using
cron.
â€¢ The directory /var/ftp/uploads is created, permissions are set to 777,
and the context label is set to public_content_rw_t.
â€¢ SELinux should allow web servers to use port 82 instead of port 80.
â€¢ SELinux is in enforcing state.</p>
<p><code>vim lab92.yml</code></p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yml" data-lang="yml"><span style="display:flex;"><span>---
</span></span><span style="display:flex;"><span>- <span style="color:#ff6ac1">name</span>: manage ftp selinux properties
</span></span><span style="display:flex;"><span>  <span style="color:#ff6ac1">hosts</span>: ftp1
</span></span><span style="display:flex;"><span>  <span style="color:#ff6ac1">vars</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#ff6ac1">selinux_booleans</span>: 
</span></span><span style="display:flex;"><span>      - <span style="color:#ff6ac1">name</span>: cron_can_relabel
</span></span><span style="display:flex;"><span>        <span style="color:#ff6ac1">state</span>: <span style="color:#ff6ac1">true</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ff6ac1">persistent</span>: <span style="color:#ff6ac1">true</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff6ac1">selinux_state</span>: enforcing
</span></span><span style="display:flex;"><span>    <span style="color:#ff6ac1">selinux_ports</span>:
</span></span><span style="display:flex;"><span>    - <span style="color:#ff6ac1">ports</span>: <span style="color:#ff9f43">82</span>
</span></span><span style="display:flex;"><span>      <span style="color:#ff6ac1">proto</span>: tcp
</span></span><span style="display:flex;"><span>      <span style="color:#ff6ac1">setype</span>: http_port_t
</span></span><span style="display:flex;"><span>      <span style="color:#ff6ac1">state</span>: present
</span></span><span style="display:flex;"><span>      <span style="color:#ff6ac1">local</span>: <span style="color:#ff6ac1">true</span>
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span>  <span style="color:#ff6ac1">tasks</span>:
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  - <span style="color:#ff6ac1">name</span>: create /var/ftp/uploads/
</span></span><span style="display:flex;"><span>    <span style="color:#ff6ac1">file</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#ff6ac1">path</span>: /var/ftp/uploads
</span></span><span style="display:flex;"><span>      <span style="color:#ff6ac1">state</span>: directory
</span></span><span style="display:flex;"><span>      <span style="color:#ff6ac1">mode</span>: <span style="color:#ff9f43">777</span>
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>  - <span style="color:#ff6ac1">name</span>: set selinux context
</span></span><span style="display:flex;"><span>    <span style="color:#ff6ac1">sefcontext</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#ff6ac1">target</span>: <span style="color:#5af78e">&#39;/var/ftp/uploads(/.*)?&#39;</span>
</span></span><span style="display:flex;"><span>      <span style="color:#ff6ac1">setype</span>: public_content_rw_t
</span></span><span style="display:flex;"><span>      <span style="color:#ff6ac1">ftype</span>: d
</span></span><span style="display:flex;"><span>      <span style="color:#ff6ac1">state</span>: present
</span></span><span style="display:flex;"><span>    <span style="color:#ff6ac1">notify</span>: run restorecon
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  - <span style="color:#ff6ac1">name</span>: Execute the role and reboot in a rescue block
</span></span><span style="display:flex;"><span>    <span style="color:#ff6ac1">block</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#ff6ac1">name</span>: Include selinux role
</span></span><span style="display:flex;"><span>        <span style="color:#ff6ac1">include_role</span>:
</span></span><span style="display:flex;"><span>          <span style="color:#ff6ac1">name</span>: rhel-system-roles.selinux
</span></span><span style="display:flex;"><span>    <span style="color:#ff6ac1">rescue</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#ff6ac1">name</span>: &gt;-<span style="color:#5af78e">
</span></span></span><span style="display:flex;"><span><span style="color:#5af78e">          Fail if failed for a different reason than selinux_reboot_required</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ff6ac1">fail</span>:
</span></span><span style="display:flex;"><span>          <span style="color:#ff6ac1">msg</span>: <span style="color:#5af78e">&#34;role failed&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ff6ac1">when</span>: not selinux_reboot_required
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>      - <span style="color:#ff6ac1">name</span>: Restart managed host
</span></span><span style="display:flex;"><span>        <span style="color:#ff6ac1">reboot</span>:
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>      - <span style="color:#ff6ac1">name</span>: Wait for managed host to come back
</span></span><span style="display:flex;"><span>        <span style="color:#ff6ac1">wait_for_connection</span>:
</span></span><span style="display:flex;"><span>          <span style="color:#ff6ac1">delay</span>: <span style="color:#ff9f43">10</span>
</span></span><span style="display:flex;"><span>          <span style="color:#ff6ac1">timeout</span>: <span style="color:#ff9f43">300</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>      - <span style="color:#ff6ac1">name</span>: Reapply the role
</span></span><span style="display:flex;"><span>        <span style="color:#ff6ac1">include_role</span>:
</span></span><span style="display:flex;"><span>          <span style="color:#ff6ac1">name</span>: rhel-system-roles.selinux
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>  <span style="color:#ff6ac1">handlers</span>:
</span></span><span style="display:flex;"><span>    - <span style="color:#ff6ac1">name</span>:  run restorecon
</span></span><span style="display:flex;"><span>      <span style="color:#ff6ac1">command</span>: restorecon -v /var/ftp/uploads</span></span></code></pre></div>

  <footer class="footline">
  </footer>
</article>
<article class="default">
  <header class="headline">
  </header>

<h1 id="using-rhel-system-roles">Using RHEL System roles</h1>

<h3 id="using-rhel-system-roles">Using RHEL System Roles</h3>
<ul>
<li>Allows for a uniform approach while managing multiple RHEL versions</li>
<li>Red Hat provides RHEL System Roles.</li>
<li>RHEL System Roles make managing different parts of the operating system easy.</li>
</ul>
<p>RHEL System Roles:</p>
<p><strong>rhel-system-roles.kdump</strong></p>
<ul>
<li>Configures the kdump crash recovery service
<strong>rhel system-roles.network</strong></li>
<li>Configures network interfaces
<strong>rhel system-roles.postfix</strong></li>
<li>Configures hosts as a Mail Transfer Agent using Postfix
<strong>rhel system-roles.selinux</strong></li>
<li>Manages SELinux settings
<strong>rhel system-roles.storage</strong></li>
<li>Configures storage
<strong>rhel system-roles.timesync</strong></li>
<li>Configures time synchronization</li>
</ul>
<h4 id="understanding-rhel-system-roles">Understanding RHEL System Roles</h4>
<ul>
<li>RHEL System Roles are based on the community Linux System Roles</li>
<li>Provide a uniform interface to make configuration tasks easier where significant differences may exist between versions of the managed operating system.</li>
<li>RHEL System Roles can be used to manage Red Hat Enterprise Linux 6.10 and later, as well as RHEL 7.4 and later, and all versions of RHEL 8.</li>
<li>Linux System Roles are not supported by RHEL technical support.</li>
</ul>
<h4 id="installing-rhel-system-roles">Installing RHEL System Roles</h4>
<ul>
<li>
<p>To use RHEL System Roles, you need to install the <strong>rhel-system-roles</strong> package on the control node by using <code>sudo yum install rhel-system-roles</code>.</p>
</li>
<li>
<p>This package can be found in the RHEL 8 AppStream repository.</p>
</li>
<li>
<p>After installation, the roles are copied to the <strong>/usr/share/ansible/roles</strong> directory, a directory that is a default part of the Ansible <strong>roles_path</strong> setting.</p>
</li>
<li>
<p>If a modification to the <strong>roles_path</strong> setting has been made in ansible.cfg, the roles are applied to the first directory listed in the <strong>roles_path</strong>.</p>
</li>
<li>
<p>With the roles, some very useful documentation is installed also; you can find it in the <strong>/usr/share/doc/rhel-system-roles</strong> directory.</p>
</li>
<li>
<p>To pass configuration to the RHEL System Roles, variables are important.</p>
</li>
<li>
<p>In the documentation directory, you can find information about variables that are required and used by the role.</p>
</li>
<li>
<p>Some roles also contain a sample playbook that can be used as a blueprint when defining your own role.</p>
</li>
<li>
<p>It&rsquo;s a good idea to use these as the basis for your own RHEL System Roles&ndash;based configuration.</p>
</li>
<li>
<p>The next two sections describe the SELinux and the TimeSync System Roles, which provide nice and easy-to-implement examples of how you can use the RHEL System Roles.</p>
</li>
</ul>
<h4 id="using-the-rhel-selinux-system-role">Using the RHEL SELinux System Role</h4>
<ul>
<li>
<p>You learned earlier how to manage SELinux settings using task definitions in your own playbooks.</p>
</li>
<li>
<p>Using the RHEL SELinux System Role provides an easy-to-use alternative.</p>
</li>
<li>
<p>To use this role, start by looking at the documentation, which is in the /usr/share/doc/rhel-system-roles/selinux directory.</p>
</li>
<li>
<p>A good file to start with is the README.md file, which provides lists of all the ingredients that can be used.</p>
</li>
<li>
<p>The SELinux System Role also comes with a sample playbook file.</p>
</li>
<li>
<p>The most important part of this file is the <strong>vars:</strong> section, which defines the variables that should be applied by SELinux.</p>
</li>
</ul>
<p>Variable Definition in the SELinux System Role:</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yml" data-lang="yml"><span style="display:flex;"><span>    ---
</span></span><span style="display:flex;"><span>    - <span style="color:#ff6ac1">hosts</span>: all
</span></span><span style="display:flex;"><span>      <span style="color:#ff6ac1">become</span>: <span style="color:#ff6ac1">true</span>
</span></span><span style="display:flex;"><span>      <span style="color:#ff6ac1">become_method</span>: sudo
</span></span><span style="display:flex;"><span>      <span style="color:#ff6ac1">become_user</span>: root
</span></span><span style="display:flex;"><span>      <span style="color:#ff6ac1">vars</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#ff6ac1">selinux_policy</span>: targeted
</span></span><span style="display:flex;"><span>        <span style="color:#ff6ac1">selinux_state</span>: enforcing
</span></span><span style="display:flex;"><span>        <span style="color:#ff6ac1">selinux_booleans</span>:
</span></span><span style="display:flex;"><span>          - { <span style="color:#ff6ac1">name: â€™samba_enable_home_dirsâ€™, state</span>: â€™onâ€™ }
</span></span><span style="display:flex;"><span>          - { <span style="color:#ff6ac1">name: â€™ssh_sysadm_loginâ€™, state: â€™onâ€™, persistent</span>: â€™yesâ€™ }
</span></span><span style="display:flex;"><span>        <span style="color:#ff6ac1">selinux_fcontexts</span>:
</span></span><span style="display:flex;"><span>          - { <span style="color:#ff6ac1">target: â€™/tmp/test_dir(/.*)?â€™, setype: â€™user_home_dir_tâ€™, ftype</span>: â€™dâ€™ }
</span></span><span style="display:flex;"><span>        <span style="color:#ff6ac1">selinux_restore_dirs</span>:
</span></span><span style="display:flex;"><span>          - /tmp/test_dir
</span></span><span style="display:flex;"><span>        <span style="color:#ff6ac1">selinux_ports</span>:
</span></span><span style="display:flex;"><span>          - { <span style="color:#ff6ac1">ports: â€™22100â€™, proto: â€™tcpâ€™, setype: â€™ssh_port_tâ€™, state</span>: â€™presentâ€™ }
</span></span><span style="display:flex;"><span>        <span style="color:#ff6ac1">selinux_logins</span>:
</span></span><span style="display:flex;"><span>          - { <span style="color:#ff6ac1">login: â€™sar-userâ€™, seuser: â€™staff_uâ€™, serange: â€™s0-s0:c0.c1023â€™, state</span>: â€™presentâ€™ }</span></span></code></pre></div>
<p>SELinux Variables Overview</p>
<p><strong>selinux_policy</strong></p>
<ul>
<li>
<p>Policy to use, usually set to targeted
<strong>selinux_state</strong></p>
</li>
<li>
<p>SELinux state, as managed with setenforce
<strong>selinux_booleans</strong></p>
</li>
<li>
<p>List of Booleans that need to be set
<strong>selinux_fcontext</strong></p>
</li>
<li>
<p>List of file contexts that need to be set, including the target file or directory to which they should be applied.
<strong>selinux_restore_dir</strong></p>
</li>
<li>
<p>List of directories at which the Linux restorecon command needs to be executed to apply new context.
<strong>selinux_ports</strong></p>
</li>
<li>
<p>List of ports and SELinux port types
<strong>selinux_logins</strong></p>
</li>
<li>
<p>A list of SELinux user and roles that can be created</p>
</li>
<li>
<p>Most of the time while configuring SELinux, you need to apply the correct state as well as file context.</p>
</li>
<li>
<p>To set the appropriate file context, you first need to define the <strong>selinux_fcontext</strong> variable.</p>
</li>
<li>
<p>Next, you have to define <strong>selinux_restore_dirs</strong> also to ensure that the desired context is applied correctly.</p>
</li>
</ul>
<h3 id="lab-sets-the-httpd_-context-type-to-the-web-directory">Lab: Sets the <strong>httpd_sys_content_t</strong> context type to the <strong>/web</strong> directory.</h3>
<ul>
<li>Sample doc is used and unnecessary lines are removed and the values of two variables have been set</li>
<li>When you use the RHEL SELinux System Role, some changes require the managed host to be rebooted.</li>
<li>To take care of this, a block structure is used, where the System Role runs in the block.</li>
<li>When a change that requires a reboot is applied, the SELinux System Role sets the variable <strong>selinux_reboot_required</strong> and fails.</li>
<li>As a result, the rescue section in the playbook is executed.</li>
<li>This rescue section first makes sure that the playbook fails because of the <strong>selinux_reboot_required</strong> variable being set to true.</li>
<li>If that is the case, the reboot module is called to reboot the managed host.</li>
<li>While rebooting, playbook execution waits for the rebooted host to reappear, and when that happens, the RHEL SELinux System Role is called again to complete its work.</li>
</ul>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yml" data-lang="yml"><span style="display:flex;"><span>---
</span></span><span style="display:flex;"><span>- <span style="color:#ff6ac1">hosts</span>: ansible2
</span></span><span style="display:flex;"><span>  <span style="color:#ff6ac1">vars</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#ff6ac1">selinux_policy</span>: targeted
</span></span><span style="display:flex;"><span>    <span style="color:#ff6ac1">selinux_state</span>: enforcing
</span></span><span style="display:flex;"><span>    <span style="color:#ff6ac1">selinux_fcontexts</span>:
</span></span><span style="display:flex;"><span>      - { <span style="color:#ff6ac1">target: â€™/web(/.*)?â€™, setype: â€™httpd_sys_content_tâ€™, ftype</span>: â€™dâ€™ }
</span></span><span style="display:flex;"><span>    <span style="color:#ff6ac1">selinux_restore_dirs</span>:
</span></span><span style="display:flex;"><span>      - /web
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span><span style="color:#78787e"># prepare prerequisites which are used in this playbook</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ff6ac1">tasks</span>:
</span></span><span style="display:flex;"><span>    - <span style="color:#ff6ac1">name</span>: Creates directory
</span></span><span style="display:flex;"><span>        <span style="color:#ff6ac1">file</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#ff6ac1">path</span>: /web
</span></span><span style="display:flex;"><span>        <span style="color:#ff6ac1">state</span>: directory
</span></span><span style="display:flex;"><span>    - <span style="color:#ff6ac1">name</span>: execute the role and catch errors
</span></span><span style="display:flex;"><span>        <span style="color:#ff6ac1">block</span>:
</span></span><span style="display:flex;"><span>        - <span style="color:#ff6ac1">include_role</span>:
</span></span><span style="display:flex;"><span>            <span style="color:#ff6ac1">name</span>: rhel-system-roles.selinux
</span></span><span style="display:flex;"><span>        <span style="color:#ff6ac1">rescue</span>:
</span></span><span style="display:flex;"><span>            <span style="color:#78787e"># Fail if failed for a different reason than selinux_reboot_required.</span>
</span></span><span style="display:flex;"><span>            - <span style="color:#ff6ac1">name</span>: handle errors
</span></span><span style="display:flex;"><span>              <span style="color:#ff6ac1">fail</span>:
</span></span><span style="display:flex;"><span>                <span style="color:#ff6ac1">msg</span>: <span style="color:#5af78e">&#34;role failed&#34;</span>
</span></span><span style="display:flex;"><span>              <span style="color:#ff6ac1">when</span>: not selinux_reboot_required
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>            - <span style="color:#ff6ac1">name</span>: restart managed host
</span></span><span style="display:flex;"><span>              <span style="color:#ff6ac1">shell</span>: sleep 2 &amp;&amp; shutdown -r now &#34;Ansible updates triggered&#34;
</span></span><span style="display:flex;"><span>              <span style="color:#ff6ac1">async</span>: <span style="color:#ff9f43">1</span>
</span></span><span style="display:flex;"><span>              <span style="color:#ff6ac1">poll</span>: <span style="color:#ff9f43">0</span>
</span></span><span style="display:flex;"><span>              <span style="color:#ff6ac1">ignore_errors</span>: <span style="color:#ff6ac1">true</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>            - <span style="color:#ff6ac1">name</span>: wait for managed host to come back
</span></span><span style="display:flex;"><span>              <span style="color:#ff6ac1">wait_for_connection</span>:
</span></span><span style="display:flex;"><span>                <span style="color:#ff6ac1">delay</span>: <span style="color:#ff9f43">10</span>
</span></span><span style="display:flex;"><span>                <span style="color:#ff6ac1">timeout</span>: <span style="color:#ff9f43">300</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>            - <span style="color:#ff6ac1">name</span>: reapply the role
</span></span><span style="display:flex;"><span>              <span style="color:#ff6ac1">include_role</span>:
</span></span><span style="display:flex;"><span>                <span style="color:#ff6ac1">name</span>: rhel-system-roles.selinux</span></span></code></pre></div>
<h4 id="using-the-rhel-timesync-system-role">Using the RHEL TimeSync System Role</h4>
<p><strong>timesync_ntp_servers</strong> variable</p>
<ul>
<li>
<p>most important setting</p>
</li>
<li>
<p>specifies attributes to indicate which time servers should be used.</p>
</li>
<li>
<p>The <strong>hostname</strong> attribute identifies the name of IP address of the time server.</p>
</li>
<li>
<p>The <strong>iburst</strong> option is used to enable or disable fast initial time synchronization using the <strong>timesync_ntp_servers</strong> variable.</p>
</li>
<li>
<p>The System Role finds out which version of RHEL is used, and according to the currently used version, it either configures NTP or Chronyd.</p>
</li>
</ul>
<h3 id="lab-using-an-rhel-system-role-to-manage-time-synchronization">Lab: Using an RHEL System Role to Manage Time Synchronization</h3>
<p>1. Copy the sample timesync playbook to the current directory:
<code>cp /usr/share/doc/rhel-system-roles/timesync/example-single-pool-playbook.yml timesync.yaml</code></p>
<p>2. Add the target host, NTP hostname pool.ntp.org, and remove pool true in the file timesync.yaml:</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span>---
</span></span><span style="display:flex;"><span>- <span style="color:#ff6ac1">name</span>: Configure NTP
</span></span><span style="display:flex;"><span>  <span style="color:#ff6ac1">hosts</span>: <span style="color:#5af78e">&#34;{{ host }}&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ff6ac1">vars</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#ff6ac1">timesync_ntp_servers</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#ff6ac1">hostname</span>: pool.ntp.org
</span></span><span style="display:flex;"><span>        <span style="color:#ff6ac1">iburst</span>: <span style="color:#ff6ac1">true</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ff6ac1">roles</span>:
</span></span><span style="display:flex;"><span>    - rhel-system-roles.timesync</span></span></code></pre></div>
<p>3. Add the timezone module and the <strong>timezone</strong> variable to the playbook to set the timezone as well. The complete playbook should look like the following:</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yml" data-lang="yml"><span style="display:flex;"><span>---
</span></span><span style="display:flex;"><span>- <span style="color:#ff6ac1">hosts</span>: ansible2
</span></span><span style="display:flex;"><span>  <span style="color:#ff6ac1">vars</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#ff6ac1">timesync_ntp_servers</span>:
</span></span><span style="display:flex;"><span>    - <span style="color:#ff6ac1">hostname</span>: pool.ntp.org
</span></span><span style="display:flex;"><span>      <span style="color:#ff6ac1">iburst</span>: <span style="color:#ff6ac1">yes</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff6ac1">timezone</span>: UTC
</span></span><span style="display:flex;"><span>  <span style="color:#ff6ac1">roles</span>:
</span></span><span style="display:flex;"><span>  - rhel-system-roles.timesync
</span></span><span style="display:flex;"><span>  <span style="color:#ff6ac1">tasks</span>:
</span></span><span style="display:flex;"><span>  - <span style="color:#ff6ac1">name</span>: set timezone
</span></span><span style="display:flex;"><span>    <span style="color:#ff6ac1">timezone</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#ff6ac1">name</span>: <span style="color:#5af78e">&#34;{{ timezone }}&#34;</span></span></span></code></pre></div>
<p>4. Use <code>ansible-playbook timesync.yaml</code> to run the playbook. Observe its output. Notice that some messages in red are shown, but these can safely be ignored.</p>
<p>5. Use <code>ansible ansible2 -a &quot;timedatectl show&quot;</code> and notice that the <strong>timezone</strong> variable is set to UTC.</p>

  <footer class="footline">
  </footer>
</article>
          </section>
        </div>
      </main>
    </div>
    <script>
      window.MathJax = Object.assign( window.MathJax || {}, {
        tex: {
          inlineMath:  [['\\(', '\\)'], ['$',  '$']],  
          displayMath: [['\\[', '\\]'], ['$$', '$$']], 
        },
        options: {
          enableMenu: false 
        }
      }, JSON.parse("{}") );
    </script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="/js/js-yaml/js-yaml.min.js?1762527413" defer></script>
    <script src="/js/d3/d3-color.min.js?1762527413" defer></script>
    <script src="/js/d3/d3-dispatch.min.js?1762527413" defer></script>
    <script src="/js/d3/d3-drag.min.js?1762527413" defer></script>
    <script src="/js/d3/d3-ease.min.js?1762527413" defer></script>
    <script src="/js/d3/d3-interpolate.min.js?1762527413" defer></script>
    <script src="/js/d3/d3-selection.min.js?1762527413" defer></script>
    <script src="/js/d3/d3-timer.min.js?1762527413" defer></script>
    <script src="/js/d3/d3-transition.min.js?1762527413" defer></script>
    <script src="/js/d3/d3-zoom.min.js?1762527413" defer></script>
    <script src="https://unpkg.com/mermaid/dist/mermaid.min.js" defer></script>
    <script>
      window.relearn.themeUseMermaid = JSON.parse("{ \"theme\": \"default\" }");
    </script>
    <script src="/js/clipboard/clipboard.min.js?1762527413" defer></script>
    <script src="/js/perfect-scrollbar/perfect-scrollbar.min.js?1762527413" defer></script>
    <script src="/js/theme.min.js?1762527413" defer></script>
  </body>
</html>
